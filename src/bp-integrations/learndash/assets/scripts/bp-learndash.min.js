!function(p){var r={$report_tables:null,$report_selects:null,init:function(){this.$report_tables=jQuery(".bp_ld_report_table"),this.fetch_table_data()},fetch_table_data:function(){this.$report_tables.each(this.fetch_data.bind(this))},fetch_data:function(t,e){var o=this,a=p('[data-report-filter="step"]').val(),r=BP_LD_REPORTS_DATA.table_columns[a],n={columns:this.adjustTableColumns(r,e),processing:!0,serverSide:!0,searching:!1,lengthChange:!1,info:!1,pageLength:BP_LD_REPORTS_DATA.config.perpage,language:{processing:BP_LD_REPORTS_DATA.text.processing,emptyTable:BP_LD_REPORTS_DATA.text.emptyTable,paginate:{first:BP_LD_REPORTS_DATA.text.paginate_first,last:BP_LD_REPORTS_DATA.text.paginate_last,next:BP_LD_REPORTS_DATA.text.paginate_next,previous:BP_LD_REPORTS_DATA.text.paginate_previous}},ajax:{url:BP_LD_REPORTS_DATA.ajax_url,type:"POST",data:function(a){p("[data-report-filter]").each(function(){var t=p(this).data("report-filter");a[t]=p(this).val()}),a.nonce=BP_LD_REPORTS_DATA.nonce,a.action="bp_ld_group_get_reports",a.group=BP_LD_REPORTS_DATA.current_group,a.completed=p(e).data("completed")?1:0,a.display=!0}}};p(e).on("xhr.dt",function(t,a,e){0<e.data.length?p(t.target).closest(".bp_ld_report_table_wrapper").removeClass("no-data hidden").addClass("has-data"):p(t.target).closest(".bp_ld_report_table_wrapper").removeClass("has-data").addClass("no-data hidden"),p(t.target).data("data_length",e.data.length);var r=0;o.$report_tables.each(function(){0==p(this).data("data_length")&&r++}),r==o.$report_tables.length?p(".ld-report-export-csv, .ld-report-no-data").removeClass("has-data").addClass("no-data hidden"):p(".ld-report-export-csv, .ld-report-no-data").removeClass("no-data hidden").addClass("has-data")}).DataTable(n)},adjustTableColumns:function(t,a){var e=p(a).data("completed")?"updated_date":"completion_date",r=[];return p(t).each(function(t,a){a.name!=e&&r.push(a)}),r},prepareExport:function(t){t.preventDefault();var a=p(t.target);if(a.data("exported"))return window.location.href=a.data("export_url"),!1;var e={start:0,length:BP_LD_REPORTS_DATA.config.perpage,nonce:BP_LD_REPORTS_DATA.nonce,action:"bp_ld_group_get_reports",group:BP_LD_REPORTS_DATA.current_group,export:!0};p("[data-report-filter]").each(function(){var t=p(this).data("report-filter");e[t]=p(this).val()}),a.data("export_args",e),r.startExport(a)},startExport:function(a){var e=this,r=a.data("export_args");a.prop("disabled",!0),p.post(BP_LD_REPORTS_DATA.ajax_url,r,function(t){if(a.prop("disabled",!1),t.success){if(t.data.has_more)return r.start=r.start+r.length,r.hash=t.data.hash,a.data("export_args",r),p(".export-indicator").show(),p(".export-indicator .export-current-step").text(t.data.page),p(".export-indicator .export-total-step").text(t.data.total),void e.startExport(a);a.data("exported",!0),a.data("export_url",t.data.url),window.location.href=t.data.url,p(".export-indicator").hide()}else p(".export-indicator").text(BP_LD_REPORTS_DATA.text.export_failed)},"json")}};p.fn.dataTable.ext.classes.sPageButton="button",p(function(){r.init(),p(".ld-report-export-csv").on("click",r.prepareExport)})}(jQuery);