window.bp=window.bp||{},function(s){bp.Zoom={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){},addListeners:function(){s(".meeting-item-container").on("click",".load-more a",this.loadMoreMeetings.bind(this)),s(document).on("click","#bp-zoom-meeting-form-submit",this.updateMeeting.bind(this)),s(".meeting-item-wrap").on("click",".bp-zoom-meeting-delete",this.deleteMeeting.bind(this)),s(".meeting-item-wrap").on("click","#bp-zoom-meeting-view-recordings",this.viewRecordings.bind(this)),s("#bp-zoom-single-meeting").on("click",".toggle-password",this.togglePassword.bind(this)),s("#bp-zoom-single-meeting").on("click","#copy-invitation",this.copyInvitation.bind(this)),s(document).on("click",".join-meeting-in-browser",this.joinMeetingInBrowser.bind(this)),s(document).on("click","#bp-add-meeting",this.openCreateMeetingModal.bind(this)),s(document).on("click","#bp-meeting-create-meeting-close",this.closeCreateMeetingModal.bind(this)),s(document).on("click",".play_btn",this.openRecordingModal.bind(this)),s(document).on("click",".bb-close-model",this.closeRecordingModal.bind(this))},loadMoreMeetings:function(e){var t=s(e.currentTarget);if(e.preventDefault(),t.hasClass("loading"))return!1;t.addClass("loading"),s.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_load_more",acpage:this.getLinkParams(s(this).prop("href"),"acpage")},success:function(e){void 0!==e.data&&e.data.contents&&t.closest(".load-more").replaceWith(e.data.contents)}})},updateMeeting:function(e){var t=s(e.currentTarget);if(e.preventDefault(),t.hasClass("loading"))return!1;t.addClass("loading");var n=s("#bp-new-zoom-meeting-form").serializeArray(),o={action:"zoom_meeting_add"};for(var i in n)o.hasOwnProperty(n[i].name)?(s.isArray(o[n[i].name])||(o[n[i].name]=[o[n[i].name]]),o[n[i].name]=o[n[i].name].concat(n[i].value)):o[n[i].name]=n[i].value;s.ajax({type:"POST",url:bp_zoom_meeting_vars.ajax_url,data:o,success:function(e){if(e.success){if(void 0!==e.data&&e.data.redirect_url)return window.location.href=e.data.redirect_url,!1}else console.log(e),t.removeClass("loading")}})},deleteMeeting:function(e){var t=s(e.target),n=t.closest(".meeting-item-wrap"),o=n.data("meeting-id"),i=n.data("id"),a=t.data("nonce");e.preventDefault(),s.ajax({type:"POST",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_delete",meeting_id:o,id:i,_wpnonce:a},success:function(e){if(!0===e.data.deleted){if("1"===bp_zoom_meeting_vars.is_single_meeting&&""!==bp_zoom_meeting_vars.group_meetings_url)return window.location.href=bp_zoom_meeting_vars.group_meetings_url,!1;s(n).remove()}}})},viewRecordings:function(e){var t=s(e.target).closest(".meeting-item");e.preventDefault(),s.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_recordings",meeting_id:t.data("meeting-id")},success:function(e){e.success&&e.data.recordings?t.parent().find(".recording-list").html(e.data.recordings):t.parent().find(".recording-list").html(e.data.error)}})},togglePassword:function(e){var t=s(e.currentTarget),n=t.closest(".single-meeting-item");e.preventDefault(),t.hasClass("show-pass")?(t.hide(),n.find(".toggle-password.hide-pass").show(),n.find(".hide-password").hide(),n.find(".show-password").show()):(t.hide(),n.find(".toggle-password.show-pass").show(),n.find(".show-password").hide(),n.find(".hide-password").show())},copyInvitation:function(e){var t=s(e.currentTarget);e.preventDefault();var n=document.createElement("textarea");n.value=t.data("join-url"),document.body.appendChild(n),n.select();try{document.execCommand("copy")&&(t.addClass("copied"),setTimeout(function(){t.removeClass("copied")},3e3))}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(n)},getLinkParams:function(e,t){var n=e?-1!==e.indexOf("?")?"?"+e.split("?")[1]:"":document.location.search;if(!n)return null;var o=n.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return t?o[t]:o},joinMeetingInBrowser:function(e){var t=s(e.currentTarget);e.preventDefault(),ZoomMtg.preLoadWasm(),ZoomMtg.prepareJssdk(),s("#zmmtg-root").addClass("active");var n={apiKey:bp_zoom_meeting_vars.bp_zoom_key,apiSecret:bp_zoom_meeting_vars.bp_zoom_secret,meetingNumber:t.data("meeting-id"),userName:"TEST USER",passWord:t.data("meeting-pwd"),leaveUrl:bp_zoom_meeting_vars.home_url,role:"1"==t.data("is-host")?1:0},o=ZoomMtg.generateSignature({meetingNumber:n.meetingNumber,apiKey:n.apiKey,apiSecret:n.apiSecret,role:n.role,success:function(e){console.log(e.result)}});ZoomMtg.init({leaveUrl:n.leaveUrl,isSupportAV:!0,success:function(){ZoomMtg.join({meetingNumber:n.meetingNumber,userName:n.userName,signature:o,apiKey:n.apiKey,passWord:n.passWord,success:function(e){console.log("join meeting success")},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},openCreateMeetingModal:function(e){e.preventDefault(),s("#bp-meeting-create").show(),s("#bp-zoom-meeting-start-date").datetimepicker({format:"Y-m-d H:i:s",minDateTime:0}),s("#bp-zoom-meeting-alt-host-ids").select2({minimumInputLength:0,closeOnSelect:!0,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",dropdownCssClass:"bb-select-dropdown",containerCssClass:"bb-select-container"})},closeCreateMeetingModal:function(e){e.preventDefault(),s("#bp-meeting-create").hide()},openRecordingModal:function(e){var t=s(e.currentTarget);e.preventDefault(),t.closest(".video_link").find(".bb-media-model-wrapper").show()},closeRecordingModal:function(e){e.preventDefault(),s(".bb-media-model-wrapper").hide()}},bp.Zoom.start()}((bp,jQuery));