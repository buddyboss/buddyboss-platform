!function(a){var t={config:{topicListSelector:".bb-activity-topics-list",modalSelector:"#bb-activity-topic-form_modal",modalContentSelector:".bb-action-popup-content",backdropSelector:"#bb-hello-backdrop-activity-topic",topicNameSelector:"#bb_topic_name",topicWhoCanPostSelector:'input[name="bb_permission_type"]',topicIdSelector:"#bb_topic_id",itemIdSelector:"#bb_item_id",itemTypeSelector:"#bb_item_type",nonceSelector:"#bb_topic_nonce",actionFromSelector:"#bb_action_from",addTopicButtonSelector:".bb-add-topic",closeModalSelector:".bb-model-close-button, #bb_topic_cancel",submitButtonSelector:"#bb_topic_submit",editTopicSelector:".bb-edit-topic",deleteTopicSelector:".bb-delete-topic",errorContainerSelector:".bb-hello-error",errorContainer:'<div class="bb-hello-error"><i class="bb-icon-rf bb-icon-exclamation"></i>',topicActionsButton:".bb-topic-actions-wrapper .bb-topic-actions_button",modalOpenClass:"activity-modal-open",addTopicAction:"bb_add_topic",editTopicAction:"bb_edit_topic",deleteTopicAction:"bb_delete_topic",topicsLimit:bbTopicsManagerVars.topics_limit,ajaxUrl:bbTopicsManagerVars.ajax_url},start:function(){this.init()},init:function(t){t&&a.extend(!0,this.config,t),this.setupElements(),this.addListeners(),this.checkTopicsLimit()},setupElements:function(){this.$document=a(document),this.$topicList=a(this.config.topicListSelector),this.$modal=a(this.config.modalSelector),this.$backdrop=a(this.config.backdropSelector),this.$topicName=a(this.config.topicNameSelector),this.$topicWhoCanPost=a(this.config.topicWhoCanPostSelector),this.$topicId=a(this.config.topicIdSelector),this.$addTopicButton=a(this.config.addTopicButtonSelector),this.$nonce=a(this.config.nonceSelector),this.$itemId=a(this.config.itemIdSelector),this.$itemType=a(this.config.itemTypeSelector),this.$actionFrom=a(this.config.actionFromSelector)},addListeners:function(){this.$document.on("click",this.config.addTopicButtonSelector,this.handleAddTopic.bind(this)),this.$document.on("click",this.config.submitButtonSelector,this.handleSubmitTopic.bind(this)),this.$document.on("click",this.config.closeModalSelector,this.handleCloseModal.bind(this)),this.$document.on("click",this.config.editTopicSelector,this.handleEditTopic.bind(this)),this.$document.on("click",this.config.deleteTopicSelector,this.handleDeleteTopic.bind(this)),this.$document.on("click",this.config.topicActionsButton,this.handleActionsDropdown.bind(this)),this.$document.on("click",function(t){a(t.target).closest(".bb-topic-actions-wrapper").length||a(".bb-topic-actions-wrapper").removeClass("active")})},handleAddTopic:function(t){t.preventDefault(),t.stopPropagation(),this.checkTopicsLimit()||(a("body").addClass(this.config.modalOpenClass),this.$topicName.val(""),this.$topicId.val(""),this.$modal.show(),this.$backdrop.show())},handleSubmitTopic:function(t){t.preventDefault(),t.stopPropagation();var i=this.$topicName.val(),o=this.$topicWhoCanPost.filter(":checked").val(),e=this.$topicId.val(),c=this.$itemId.val(),n=this.$itemType.val(),s=this.$nonce.val(),t=this.$actionFrom.val();""!==i&&(this.$modal.find("#bb_activity_topic_name").closest(this.config.modalContentSelector).find(".bb-hello-error").remove(),s={action:this.config.addTopicAction,name:i,permission_type:o,topic_id:e,item_id:c,item_type:n,nonce:s,action_from:t},t=this.config.ajaxUrl,a.post(t,s,function(t){t.success?window.location.reload():(this.$modal.find(this.config.modalContentSelector).prepend(this.config.errorContainer),this.$modal.find(this.config.errorContainerSelector).append(t.data.error))}.bind(this)))},handleCloseModal:function(t){t.preventDefault(),t.stopPropagation(),a("body").removeClass(this.config.modalOpenClass),this.$modal.hide(),this.$backdrop.hide(),this.$topicName.val(""),this.$topicWhoCanPost.prop("checked",!1),this.$topicId.val("")},handleEditTopic:function(t){t.preventDefault(),t.stopPropagation();var i=a(t.currentTarget).data("topic-attr"),o=i.id,e=i.item_id,c=i.item_type,t=i.nonce;a("body").addClass(this.config.modalOpenClass),this.$modal.show(),this.$backdrop.show(),this.$topicWhoCanPost.prop("checked",!1);i=this.$modal.find(this.config.errorContainerSelector);0<i.length&&i.remove();c={action:this.config.editTopicAction,topic_id:o,item_id:e,item_type:c,nonce:t},t=this.config.ajaxUrl||wp.ajax.settings.url;a.post(t,c,function(t){var i;t.success?(i=t.data.topic,this.$topicName.val(i.name),this.$topicWhoCanPost.filter('[value="'+i.permission_type+'"]').prop("checked",!0),this.$topicId.val(i.id)):(this.$modal.find(this.config.modalContentSelector).prepend(this.config.errorContainer),this.$modal.find(this.config.errorContainerSelector).append(t.data.error))}.bind(this))},handleDeleteTopic:function(t){t.preventDefault(),t.stopPropagation();var i=a(t.currentTarget),o=i.closest(".bb-activity-topic-item"),e=i.data("topic-attr"),c=e.id,t=e.nonce,i=e.item_id,e=e.item_type;confirm(bbTopicsManagerVars.delete_topic_confirm)&&(i={action:this.config.deleteTopicAction,topic_id:c,nonce:t,item_id:i,item_type:e},e=this.config.ajaxUrl,a.post(e,i,function(t){t.success?o.fadeOut(300,function(){a(this).remove(),this.checkTopicsLimit()}.bind(this)):alert(t.data.error)}.bind(this)))},checkTopicsLimit:function(){var t=this.$topicList.find(".bb-activity-topic-item").length,t=this.config.topicsLimit<=t;return t?this.$addTopicButton.hide():this.$addTopicButton.show(),t},handleActionsDropdown:function(t){t.preventDefault(),t.stopPropagation();t=a(t.currentTarget).closest(".bb-topic-actions-wrapper");a(".bb-topic-actions-wrapper.active").not(t).removeClass("active"),t.toggleClass("active")}};a(function(){t.start()}),window.TopicsManager=t}(jQuery);