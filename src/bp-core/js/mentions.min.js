window.bp=window.bp||{},function(e,t,i){var n,o=[];e.mentions=e.mentions||{},e.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(e.mentions.users=window.BP_Suggestions.friends||e.mentions.users),t.fn.bp_mentions=function(e,i,r){t.isArray(e)&&(e={data:e}),i||(i={}),r||(r={});var s=t.extend(!0,{},{delay:200,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:10,startWithSpace:!1,suffix:"",callbacks:{filter:function(e,t,i){var n,o,r,s=[],a=new RegExp("^"+e+"| "+e,"ig");for(o=0,r=t.length;o<r;o++)(n=t[o])[i].toLowerCase().match(a)&&s.push(n);return s},highlighter:function(e,t){if(!t)return e;var i=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+t.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return e.replace(i,function(e,t,i,n){return">"+t+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(e){var i,n,o,r,s=t("#atwho-ground-"+this.id+" .atwho-view"),a=t("body"),d=this.$inputor.data("atwho");"undefined"!==d&&"undefined"!==d.iframe&&null!==d.iframe?(i=this.$inputor.caret("offset",{iframe:d.iframe}),"undefined"!==(o=t(d.iframe).offset())&&(i.left+=o.left,i.top+=o.top)):i=this.$inputor.caret("offset"),i.left>a.width()/2?(s.addClass("right"),r=i.left-e.left-this.view.$el.width()):(s.removeClass("right"),r=i.left-e.left+1),a.width()<=400&&t(document).scrollTop(i.top-6),(!(n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))||n<5)&&(n=19),e.top=i.top+n,e.left+=r},inserting_wrapper:function(e,t,i){return""+t+i}}},i),a=t.extend(!0,{},{callbacks:{remoteFilter:function(e,i){var r=t(this),s={};"object"!=typeof(n=o[e])?(r.xhr&&r.xhr.abort(),s={action:"bp_get_suggestions",term:e,type:"members"},void 0!==window.BP_Nouveau&&void 0!==window.BP_Nouveau.messages&&void 0!==window.BP_Nouveau.messages.force_friendship_to_message&&window.BP_Nouveau.messages.force_friendship_to_message&&(s.only_friends=1),t.isNumeric(this.$inputor.data("suggestions-group-id"))&&(s["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),r.xhr=t.getJSON(ajaxurl,s).done(function(n){if(n.success){var r=t.map(n.data,function(e){return e.search=e.search||e.ID+" "+e.name,e});o[e]=r,i(r)}})):i(n)},beforeInsert:function(e){return e+=" "}},data:t.map(e.data,function(e){return e.search=e.search||e.ID+" "+e.name,e}),at:"@",searchKey:"search",displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,r);this.on("hidden.atwho",function(e){if(void 0!==e.currentTarget&&void 0!==e.currentTarget.innerHTML)for(var i=t(e.currentTarget).find("span.atwho-query"),n=0;n<i.length;n++)t(i[n]).replaceWith(i[n].innerText)}),this.on("inserted.atwho",function(e){if(void 0!==e.currentTarget&&void 0!==e.currentTarget.innerHTML){var t=0;if(void 0!==window.forums_medium_reply_editor){var i=Object.keys(window.forums_medium_reply_editor);if(i.length)for(t=0;t<i.length;t++)window.forums_medium_reply_editor[i[t]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var n=Object.keys(window.forums_medium_topic_editor);if(n.length)for(t=0;t<n.length;t++)window.forums_medium_topic_editor[n[t]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(t=0;t<o.length;t++)window.forums_medium_forum_editor[o[t]].checkContentChanged()}}});var d=t.extend(!0,{},s,a,e);return t.fn.atwho.call(this,d)},t(document).ready(function(){t(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){t(this).data("bp_mentions_activated")||void 0!==e&&(t(this).bp_mentions(e.mentions.users),t(this).data("bp_mentions_activated",!0))})}),e.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&t(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",t(".wp-editor-wrap iframe")[0]).bp_mentions(e.mentions.users)}}(bp,jQuery);