window.bp=window.bp||{},function(t,e,i){var n,s,a=[];t.mentions=t.mentions||{},t.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(window.BP_Suggestions.friends&&window.BP_Suggestions.friends.length>0?t.mentions.users=window.BP_Suggestions.friends:window.BP_Suggestions.members&&window.BP_Suggestions.members.length>0?t.mentions.users=window.BP_Suggestions.members:t.mentions.users&&t.mentions.users.length>0&&(t.mentions.users=t.mentions.users)),t.mentions.xhr=null,t.mentions.xhr_scroll=null,t.mentions.clearCache=function(){a=[]},e.fn.bp_mentions=function(i,o,r){e.isArray(i)&&(i={data:i}),o||(o={}),r||(r={});var l=navigator.userAgent.toLowerCase(),d=l.indexOf("android")>-1,u=l.indexOf("chrome")>-1,h=e.extend(!0,{},{delay:500,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:100,startWithSpace:!1,callbacks:{filter:function(t,e,i){var n,s,a,o=[],r=RegExp("^"+t+"| "+t,"ig");for(s=0,a=e.length;s<a;s++)(n=e[s])[i].toLowerCase().match(r)&&o.push(n);return o},highlighter:function(t,e){if(!e)return t;var i=RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+e.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return t.replace(i,function(t,e,i,n){return">"+e+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(t){var i,n,s,a,o=e("#atwho-ground-"+this.id+" .atwho-view"),r=e("body"),l=this.$inputor.data("atwho");"undefined"!==l&&"undefined"!==l.iframe&&null!==l.iframe?(i=this.$inputor.caret("offset",{iframe:l.iframe}),"undefined"!==(s=e(l.iframe).offset())&&(i.left+=s.left,i.top+=s.top)):i=this.$inputor.caret("offset"),i.left>r.width()/2?(o.addClass("right"),a=i.left-t.left-this.view.$el.width()):(o.removeClass("right"),a=i.left-t.left+1),400>=r.width()&&e(document).scrollTop(i.top-6),(n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))&&!(n<5)||(n=19),t.top=i.top+n,t.left+=a},inserting_wrapper:function(t,e){return""+e}}},o),c=e.extend(!0,{},{callbacks:{remoteFilter:function(i,s){var o={action:"bp_get_suggestions",term:i,type:"members"},r=this.$el,l=this,d=r.find("ul"),u=function(){d.scrollTop()+d.innerHeight()>=d[0].scrollHeight&&!0===l.allow_scroll&&!d.hasClass("list-loading")&&(null==l.total_pages||parseInt(l.total_pages)!==parseInt(o.page))&&!t.mentions.xhr_scroll&&(d.addClass("list-loading"),d.find("li:last-child").hasClass("list-loader")||d.append('<li class="list-loader">Loading more results…</li>'),o.term=l.s_query,o.page=r.data("page")+1,r.data("page",o.page),t.mentions.xhr_scroll=e.getJSON(ajaxurl,o).done(function(i){if(i.success){t.mentions.xhr_scroll=null,void 0!==i.data.total_pages&&(l.total_pages=parseInt(i.data.total_pages)),a[l.s_query].page=o.page;var n=e.map(i.data.results,function(t){return t.search=t.search||t.ID+" "+t.name,t});if(0==n.length){d.find(".list-loader").remove(),d.removeClass("list-loading"),l.allow_scroll=!1;return}l.data=l.data.concat(n),d.find(".list-loader").remove(),l.render_view(l.data),a[l.s_query].data=l.data,d.removeClass("list-loading")}}))};if(l.allow_scroll=!0,l.render_view=s,l.total_pages=1,l.s_query=i,r.data("page",1),t.mentions.xhr&&t.mentions.xhr.abort(),t.mentions.xhr_scroll&&t.mentions.xhr_scroll.abort(),"object"==typeof(n=a[i])&&n.data){r.data("page",n.page),l.data=n.data,l.render_view(n.data),l.total_pages=n.total_pages,n.page<n.total_pages&&!d.find("li:last-child").hasClass("list-loader")&&d.append('<li class="list-loader">Loading more results…</li>'),t.mentions.xhr_scroll=null,r.hasClass("has-events")||(d.on("scroll",function(){u()}),r.addClass("has-events"));return}d.find("li:last-child").hasClass("list-loader")||d.append('<li class="list-loader">Loading more results…</li>'),r.data("page")?o.page=r.data("page"):(o.page=1,r.data("page",1)),e.isNumeric(this.$inputor.data("suggestions-group-id"))&&(o["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),t.mentions.xhr=e.getJSON(ajaxurl,o).done(function(n){if(n.success){a[i]={},a[i].page=o.page;var s=e.map(n.data.results,function(t){return t.search=t.search||t.ID+" "+t.name,t});void 0!==n.data.total_pages&&(l.total_pages=parseInt(n.data.total_pages),a[i].total_pages=parseInt(n.data.total_pages)),l.data=s,a[i].data=s,d.find(".list-loader").remove(),l.render_view(s),d.removeClass("list-loading"),l.$inputor.trigger("keyup"),t.mentions.xhr_scroll=null}}),r.hasClass("has-events")||(d.on("scroll",function(){u()}),r.addClass("has-events"))},sorter:function(t,e){return e},beforeReposition:function(t){if(e("body.rtl").length>0){var i=this.$el.find(".atwho-view");i.length>0&&(t.left=this.rect().left-i.width())}}},data:e.map(i.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,r);this.on("blur.atwhoInner",function(){jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading")}),this.on("inserted.atwho",function(t){if(u&&jQuery(this).on("keyup",function(t){if(13===(s=t.keyCode)){if(jQuery(this).hasClass("medium-editor-element")){var i=jQuery(this).attr("contenteditable");void 0!==i&&!1!==i&&jQuery(this).attr("contenteditable","false")}setTimeout(function(){e.each(BP_Mentions_Options.selectors,function(t,e){if(jQuery(e).hasClass("medium-editor-element")){var i=jQuery(e).attr("contenteditable");void 0!==i&&!1!==i&&(jQuery(e).attr("contenteditable","true"),jQuery(e).find(".atwho-inserted").closest(".medium-editor-element").focus())}})},10)}}),jQuery(this).on("keydown",function(t){d||(8==t.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==t.currentTarget&&void 0!==t.currentTarget.innerHTML){var i=0;if(void 0!==window.forums_medium_reply_editor){var n=Object.keys(window.forums_medium_reply_editor);if(n.length)for(i=0;i<n.length;i++)window.forums_medium_reply_editor[n[i]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var a=Object.keys(window.forums_medium_topic_editor);if(a.length)for(i=0;i<a.length;i++)window.forums_medium_topic_editor[a[i]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(i=0;i<o.length;i++)window.forums_medium_forum_editor[o[i]].checkContentChanged()}}jQuery("#atwho-ground-whats-new").data("page",1),jQuery("#atwho-ground-whats-new").find(".list-loader").remove(),jQuery("#atwho-ground-whats-new").find(".list-loading").removeClass("list-loading"),jQuery(this).focus()}),this.on("keyup",function(){if(d){var t=jQuery(this).text().length;localStorage.setItem("charCount",t),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")})}});var f=e.extend(!0,{},h,c,i);return e.fn.atwho.call(this,f)},e(document).ready(function(){localStorage.setItem("charCount",0),e(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){!e(this).data("bp_mentions_activated")&&void 0!==t&&(e(this).bp_mentions(t.mentions.users),e(this).data("bp_mentions_activated",!0))})}),t.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&e(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",e(".wp-editor-wrap iframe")[0]).bp_mentions(t.mentions.users)}}(bp,jQuery);