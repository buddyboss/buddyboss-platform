window.bp=window.bp||{},function(t,e,n){var i,o=[];t.mentions=t.mentions||{},t.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(t.mentions.users=window.BP_Suggestions.friends||window.BP_Suggestions.members||t.mentions.users),t.mentions.xhr=null,e.fn.bp_mentions=function(n,r,s){e.isArray(n)&&(n={data:n}),r||(r={}),s||(s={});var a=e.extend(!0,{},{delay:200,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:10,startWithSpace:!1,callbacks:{filter:function(t,e,n){var i,o,r,s=[],a=new RegExp("^"+t+"| "+t,"ig");for(o=0,r=e.length;o<r;o++)(i=e[o])[n].toLowerCase().match(a)&&s.push(i);return s},highlighter:function(t,e){if(!e)return t;var n=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+e.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return t.replace(n,function(t,e,n,i){return">"+e+"<strong>"+n+"</strong>"+i+"<"})},before_reposition:function(t){var n,i,o,r,s=e("#atwho-ground-"+this.id+" .atwho-view"),a=e("body"),u=this.$inputor.data("atwho");"undefined"!==u&&"undefined"!==u.iframe&&null!==u.iframe?(n=this.$inputor.caret("offset",{iframe:u.iframe}),"undefined"!==(o=e(u.iframe).offset())&&(n.left+=o.left,n.top+=o.top)):n=this.$inputor.caret("offset"),n.left>a.width()/2?(s.addClass("right"),r=n.left-t.left-this.view.$el.width()):(s.removeClass("right"),r=n.left-t.left+1),a.width()<=400&&e(document).scrollTop(n.top-6),(!(i=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))||i<5)&&(i=19),t.top=n.top+i,t.left+=r},inserting_wrapper:function(t,e){return""+e}}},r),u=e.extend(!0,{},{callbacks:{remoteFilter:function(n,r){var s={};"object"!=typeof(i=o[n])?(t.mentions.xhr&&t.mentions.xhr.abort(),s={action:"bp_get_suggestions",term:n,type:"members"},e.isNumeric(this.$inputor.data("suggestions-group-id"))&&(s["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),t.mentions.xhr=e.getJSON(ajaxurl,s).done(function(t){if(t.success){var i=e.map(t.data,function(t){return t.search=t.search||t.ID+" "+t.name,t});o[n]=i,r(i)}})):r(i)},beforeInsert:function(t){return t+=" "}},data:e.map(n.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,s);this.on("inserted.atwho",function(t){if(jQuery(this).on("keydown",function(t){isAndroid()||(8==t.keyCode?jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")}):jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).attr("contenteditable",!1)}))}),void 0!==t.currentTarget&&void 0!==t.currentTarget.innerHTML){var e=0;if(void 0!==window.forums_medium_reply_editor){var n=Object.keys(window.forums_medium_reply_editor);if(n.length)for(e=0;e<n.length;e++)window.forums_medium_reply_editor[n[e]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var i=Object.keys(window.forums_medium_topic_editor);if(i.length)for(e=0;e<i.length;e++)window.forums_medium_topic_editor[i[e]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(e=0;e<o.length;e++)window.forums_medium_forum_editor[o[e]].checkContentChanged()}}jQuery(this).focus()}),this.on("keyup",function(t){var e=(e=localStorage.getItem("charCount"))?parseInt(e):0;if(isAndroid()){var n=jQuery(this).text().length;localStorage.setItem("charCount",n),jQuery(this).find(".atwho-inserted").each(function(){jQuery(this).removeAttr("contenteditable")})}});var d=e.extend(!0,{},a,u,n);return e.fn.atwho.call(this,d)},e(document).ready(function(){localStorage.setItem("charCount",0),e(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){void 0!==t&&(e(this).bp_mentions(t.mentions.users),e(this).data("bp_mentions_activated",!0))})}),t.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&e(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",e(".wp-editor-wrap iframe")[0]).bp_mentions(t.mentions.users)},window.isAndroid=function(){return userAgent=navigator.userAgent.toLowerCase(),userAgent.indexOf("android")>-1}}(bp,jQuery);
