window.bp=window.bp||{},function(s,d){var a,u=[];s.mentions=s.mentions||{},s.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(s.mentions.users=window.BP_Suggestions.friends||window.BP_Suggestions.members||s.mentions.users),s.mentions.xhr=null,d.fn.bp_mentions=function(t,e,i){d.isArray(t)&&(t={data:t}),e=e||{},i=i||{};var n=d.extend(!0,{},{delay:200,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:10,startWithSpace:!1,suffix:"",callbacks:{filter:function(t,e,i){for(var n,o=[],r=new RegExp("^"+t+"| "+t,"ig"),s=0,a=e.length;s<a;s++)(n=e[s])[i].toLowerCase().match(r)&&o.push(n);return o},highlighter:function(t,e){if(!e)return t;var i=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+e.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return t.replace(i,function(t,e,i,n){return">"+e+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(t){var e,i,n,o,r=d("#atwho-ground-"+this.id+" .atwho-view"),s=d("body"),a=this.$inputor.data("atwho");"undefined"!==a&&"undefined"!==a.iframe&&null!==a.iframe?(e=this.$inputor.caret("offset",{iframe:a.iframe}),"undefined"!==(n=d(a.iframe).offset())&&(e.left+=n.left,e.top+=n.top)):e=this.$inputor.caret("offset"),o=e.left>s.width()/2?(r.addClass("right"),e.left-t.left-this.view.$el.width()):(r.removeClass("right"),e.left-t.left+1),s.width()<=400&&d(document).scrollTop(e.top-6),(!(i=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))||i<5)&&(i=19),t.top=e.top+i,t.left+=o},inserting_wrapper:function(t,e,i){return""+e+i}}},e),o=d.extend(!0,{},{callbacks:{remoteFilter:function(i,n){var t={};"object"!=typeof(a=u[i])?(s.mentions.xhr&&s.mentions.xhr.abort(),t={action:"bp_get_suggestions",term:i,type:"members"},d.isNumeric(this.$inputor.data("suggestions-group-id"))&&(t["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),s.mentions.xhr=d.getJSON(ajaxurl,t).done(function(t){var e;t.success&&(e=d.map(t.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),u[i]=e,n(e))})):n(a)},beforeInsert:function(t){return t+=" "}},data:d.map(t.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),at:"@",searchKey:"search",startWithSpace:!0,displayTpl:BP_Mentions_Options.display_tpl},BP_Mentions_Options.extra_options,i);this.on("inserted.atwho",function(t){if(jQuery(this).on("keydown",function(t){8==t.keyCode&&jQuery(this).find(".atwho-inserted:last-child").each(function(){jQuery(this).removeAttr("contenteditable")})}),void 0!==t.currentTarget&&void 0!==t.currentTarget.innerHTML){var e=0;if(void 0!==window.forums_medium_reply_editor){var i=Object.keys(window.forums_medium_reply_editor);if(i.length)for(e=0;e<i.length;e++)window.forums_medium_reply_editor[i[e]].checkContentChanged()}if(void 0!==window.forums_medium_topic_editor){var n=Object.keys(window.forums_medium_topic_editor);if(n.length)for(e=0;e<n.length;e++)window.forums_medium_topic_editor[n[e]].checkContentChanged()}if(void 0!==window.forums_medium_forum_editor){var o=Object.keys(window.forums_medium_forum_editor);if(o.length)for(e=0;e<o.length;e++)window.forums_medium_forum_editor[o[e]].checkContentChanged()}}});var r=d.extend(!0,{},n,o,t);return d.fn.atwho.call(this,r)},d(document).ready(function(){d(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){d(this).data("bp_mentions_activated")||void 0!==s&&(d(this).bp_mentions(s.mentions.users),d(this).data("bp_mentions_activated",!0))})}),s.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&d(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",d(".wp-editor-wrap iframe")[0]).bp_mentions(s.mentions.users)}}(bp,jQuery);