window.wp=window.wp||{},window.bp=window.bp||{},function(f){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var n=f("body").find("#group-invites-send-to-input"),a=1,o="";this.addSelect2(n);var r=f("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),u=f("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),p=f("#group-invites-container .bb-groups-invites-right .bp-invites-feedback"),s=f("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback"),c=f("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p"),d=f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback"),l=f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),v=f(".group-invites-members-listing #members-list"),g=f(".group-invites-members-listing .last"),b=f(".members.bp-invites-content #members-list"),m=f("#group-invites-container .group-invites-column .subnav-filters div .last");d.attr("class","bp-feedback"),d.addClass("loading"),l.html(BP_Nouveau.group_invites.loading),f("#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),f(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){f(this).prop("disabled",!0)}),n.on("select2:unselect",function(e){var t=e.params.data;f('#group-invites-send-to-input option[value="'+t.id+'"]').each(function(){f(this).remove()}),f("#group-invites-container .bb-groups-invites-left #members-list li."+t.id).removeClass("selected"),f("#group-invites-container .bb-groups-invites-left #members-list li."+t.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var h,e,t,i=f(".groups.group-invites.pending-invites");i.length&&(h=0,f(window).scroll(function(){var e,t,i,s=f(".groups.group-invites.pending-invites #group-invites-container .group-invites-column .bp-invites-content #members-list li.load-more");s.length&&(t=(e=f(window).scrollTop())+f(window).height(),((i=f(s).offset().top)+f(s).height()<=t&&e<=i||f(window).scrollTop()+f(window).height()>=f(document).height())&&0==h&&(f("#group-invites-container .last #bp-group-invites-next-page").trigger("click"),h=1))})),i.length?(f(".groups.group-invites.pending-invites .subnav #pending-invites-groups-li").addClass("current selected"),e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(b.html(""),b.html(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),c.html(e.data.feedback),a+=1,f("#group-invites-container .bp-invites-feedback").hide()):(b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(e.data.feedback),f("#group-invites-container .bp-invites-feedback").show())}}),f(document).on("click","#group-invites-container .last #bp-group-invites-next-page",function(){d.attr("class","bp-feedback"),d.addClass("loading"),l.html(BP_Nouveau.group_invites.loading);var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:f("#group-invites-container .group-invites-column #group_invites_search").val()};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){h=0,e.success?(b.find(".load-more").remove(),b.append(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),c.html(e.data.feedback),a+=1):(b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(e.data.feedback))}})}),f(document).on("click","#group-invites-container .last #bp-group-invites-prev-page",function(){f("#group-invites-container .bp-invites-feedback").show(),f("#group-invites-container .bp-invites-feedback .bp-feedback").addClass("info"),c.html(BP_Nouveau.group_invites.loading),--a;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:f("#group-invites-container .group-invites-column #group_invites_search").val()};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(b.html(""),b.html(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info")):(b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type)),c.html(e.data.feedback)}})}),f(document).on("search",".pending-invites #group-invites-container #group_invites_search",function(e){var t;e.preventDefault(),""===this.value&&(a=1,t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(b.html(""),b.html(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),c.html(e.data.feedback),a+=1,f("#group-invites-container .bp-invites-feedback").hide()):(b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(e.data.feedback),f("#group-invites-container .bp-invites-feedback").show())}}))}),f(document).on("click","#group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var t=f("#group-invites-container #group_invites_search").val();if(""===t)return!1;a=1;var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:t};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(b.html(""),b.html(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),c.html(e.data.feedback),f("#group-invites-container .bp-invites-feedback").hide()):(b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(e.data.feedback),f("#group-invites-container .bp-invites-feedback").show())}})}),f(document).on("click","#group-invites-container #members-list li .action .group-remove-invite-button",function(e){e.preventDefault(),f("#group-invites-container .group-invites-column #bp-pending-invites-loader").show(),s.attr("class","bp-feedback"),s.addClass("loading"),c.html(""),c.html(BP_Nouveau.group_invites.removing);var i=f(this).closest("li"),t={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.uninvite,group_id:BP_Nouveau.group_invites.group_id,user:f(this).attr("data-bp-user-id")};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){var t;e.success?(i.remove(),e.data.has_invites||(s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(""),c.html(e.data.feedback)),f("#group-invites-container .group-invites-column .bp-invites-content #members-list").html(""),a=1,t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(b.html(""),b.html(e.data.html),m.html(""),m.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),c.html(e.data.feedback),f("#group-invites-container .bp-invites-feedback").hide()):(f("#group-invites-container .bp-invites-feedback").show(),b.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(e.data.feedback)),f("#group-invites-container .group-invites-column #bp-pending-invites-loader").hide()}})):(s.attr("class","bp-feedback"),s.addClass(e.data.type),c.html(""),c.html(e.data.feedback),f("#group-invites-container .group-invites-column #bp-pending-invites-loader").hide())}})})):(v.scroll(this.loadMoreInvitesMembers),f(".groups.group-invites.send-invites .subnav #send-invites-groups-li").addClass("current selected"),t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),f("#group-invites-container .bb-groups-invites-right").show(),f(".bb-groups-invites-right .bp-invites-feedback").show()):(f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback),f("#group-invites-container .bb-groups-invites-right").hide())}})),f(document).on("search",".send-invites #group-invites-container #group_invites_search",function(e){var t,i;e.preventDefault(),""===this.value&&(t="",t=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t,page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:i,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback))}}))}),f(document).on("search",".group-create.group-invites.create #group-invites-container #group_invites_search",function(e){var t,i;e.preventDefault(),""===this.value&&(t="",t=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t,page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:i,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback))}}))}),f("#bp-group-send-invite-switch-checkbox").on("change",function(){f("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").removeClass("bp-invites-dropdown-options-loader-hide");var e,t="";(t=f(this).is(":checked")?"friends":"members")&&(a=1,e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t,page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){var t;e.success?(f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide(),v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),t=f("#group-invites-send-to-input").val(),f.isArray(t)&&t.length&&f.each(t,function(e,t){t&&(f("#members-list li."+t).addClass("selected"),f("#members-list li."+t+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.cancel_invite_tooltip))})):(f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback)),f("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").addClass("bp-invites-dropdown-options-loader-hide")}}))}),f(document).on("click","#group-invites-container .bb-groups-invites-left .group-add-remove-invite-button",function(){var t,e,i=f(this).attr("data-bp-user-id"),s=f(this).attr("data-bp-user-name"),a={id:i,text:s};f(this).closest("li").hasClass("selected")?(f(this).closest("li").removeClass("selected"),t=[],f.grep(n.select2("data"),function(e){return e.id!=i}).forEach(function(e){t.push(+e.id)}),n.val(t).trigger("change"),f('#group-invites-send-to-input option[value="'+i+'"]').each(function(){f(this).remove()}),f(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_invite_tooltip)):(f(this).closest("li").addClass("selected"),n.find("option[value='"+a.id+"']").length||(e=new Option(a.text,a.id,!0,!0),n.append(e).trigger("change")),f(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.cancel_invite_tooltip))}),f(document).on("click","#group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){a+=1,o=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:o,page:a,search_terms:f("#group-invites-container .bb-groups-invites-left #group_invites_search").val()};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(f("#group-invites-container .group-invites-members-listing #members-list li.load-more").remove(),v.append(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info")):(d.attr("class","bp-feedback"),d.addClass(e.data.type)),l.html(e.data.feedback)}})}),f(document).on("click",".bb-more-invites-wrap .bb-add-invites",function(e){e.preventDefault(),f(".bb-groups-invites-left").addClass("bb-select-member-view")}),f(document).on("click",".bb-close-invites-members",function(e){e.preventDefault(),f(".bb-groups-invites-left").removeClass("bb-select-member-view")}),f(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(e){e.preventDefault();var t=[],i=f.grep(n.select2("data"),function(e){return 0!=e.id});f("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").show(),i.forEach(function(e){t.push(+e.id)});var s={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:f("textarea#send-invites-control").val(),users:t};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){var t;e.success?(p.show(),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(""),u.html(e.data.feedback),setTimeout(function(){r.removeClass(e.data.type),r.addClass("info"),u.html(""),u.html(BP_Nouveau.group_invites.member_invite_info_text),f("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},4e3),n.find("option").remove(),f("textarea#send-invites-control").val(""),o=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:o,page:a},f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info")):(f("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type)),l.html(e.data.feedback)}})):(p.show(),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(""),u.html(e.data.feedback),setTimeout(function(){r.removeClass(e.data.type),r.addClass("info"),u.html(""),u.html(BP_Nouveau.group_invites.member_invite_info_text),f("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},4e3))}})}),f(document).on("click","#group-invites-container #bp_invites_reset",function(e){e.preventDefault(),f("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").show(),p.hide(),n.find("option").remove(),f("textarea#send-invites-control").val(""),a=1,o=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:o,page:a};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),f(".bb-groups-invites-right-top .bp-invites-feedback").show()):(v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback)),setTimeout(function(){f("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},1e3)}})}),f(document).on("click",".send-invites #group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var t=f("#group-invites-container #group_invites_search").val();if(""===t)return!1;a=1,o=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:o,page:a,search_terms:t};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show())}})}),f(document).on("click",".group-create.group-invites.create #group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var t=f("#group-invites-container #group_invites_search").val();if(""===t)return!1;a=1,o=f("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:o,page:a,search_terms:t};f.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),d.attr("class","bp-feedback"),d.addClass("info"),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(v.html(""),g.html(""),d.attr("class","bp-feedback"),d.addClass(e.data.type),l.html(e.data.feedback),f(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show())}})})},addSelect2:function(e){var i=[];e.select2({placeholder:"",minimumInputLength:1,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return f.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(s){return!1===jQuery.isEmptyObject(i)&&f.each(i,function(e,t){for(var i=0;i<s.data.results.length;i++)s.data.results[i].id===t&&s.data.results.splice(i,1)}),{results:s&&s.success?s.data.results:[]}}}}),e.on("select2:select",function(e){var t=e.params.data;i.push(t.id)}),e.on("select2:unselect",function(e){var t=e.params.data;i=jQuery.grep(i,function(e){return e!==t.id})})},isScrolledIntoView:function(e){var t=f(window).scrollTop(),i=t+f(window).height(),s=f(e).offset().top;return s+f(e).height()<=i&&t<=s},loadMoreInvitesMembers:function(e){var t=f(e.currentTarget);t[0].scrollHeight-t.scrollTop()-t.innerHeight()<=30&&f("#group-invites-container .group-invites-members-listing #members-list li.load-more").length&&f("#group-invites-container .group-invites-members-listing .last #bp-group-invites-next-page").trigger("click")}},bp.Nouveau.GroupInvites.start())}((bp,jQuery));