window.wp=window.wp||{},window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var e=t("body").find("#group-invites-send-to-input"),i=1,a="";this.addSelect2(e);var s=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),n=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),o=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback"),r=t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback"),u=t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p"),c=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback"),p=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),l=t(".group-invites-members-listing #members-list"),d=t(".group-invites-members-listing .last"),v=t(".members.bp-invites-content #members-list"),g=t("#group-invites-container .group-invites-column .subnav-filters div .last");c.attr("class","bp-feedback"),c.addClass("loading"),p.html(BP_Nouveau.group_invites.loading),s.attr("class","bp-feedback"),s.addClass("help"),n.html(""),n.html(BP_Nouveau.group_invites.invites_form),t("#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),t(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){t(this).prop("disabled",!0)}),e.on("select2:unselect",function(e){var i=e.params.data;t('#group-invites-send-to-input option[value="'+i.id+'"]').each(function(){t(this).remove()}),t("#group-invites-container .bb-groups-invites-left #members-list li."+i.id).removeClass("selected"),t("#group-invites-container .bb-groups-invites-left #members-list li."+i.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var b=t(".groups.group-invites.pending-invites");if(b.length){var m=0;t(window).scroll(function(){var e=t(".groups.group-invites.pending-invites #group-invites-container .group-invites-column .bp-invites-content #members-list li.load-more");if(e.length){var i=t(window).scrollTop(),a=i+t(window).height(),s=t(e).offset().top;(s+t(e).height()<=a&&s>=i||t(window).scrollTop()+t(window).height()>=t(document).height())&&0==m&&(t("#group-invites-container .last #bp-group-invites-next-page").trigger("click"),m=1)}})}if(b.length){t(".groups.group-invites.pending-invites .subnav #pending-invites-groups-li").addClass("current selected");var _={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:_,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),r.attr("class","bp-feedback"),r.addClass("info"),u.html(e.data.feedback),i+=1):(v.html(""),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(e.data.feedback))}}),t(document).on("click","#group-invites-container .last #bp-group-invites-next-page",function(){c.attr("class","bp-feedback"),c.addClass("loading"),p.html(BP_Nouveau.group_invites.loading),i+=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i,search_terms:t("#group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){m=0,e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),r.attr("class","bp-feedback"),r.addClass("info"),u.html(e.data.feedback)):(v.html(""),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .last #bp-group-invites-prev-page",function(){t("#group-invites-container .bp-invites-feedback").show(),t("#group-invites-container .bp-invites-feedback .bp-feedback").addClass("info"),u.html(BP_Nouveau.group_invites.loading),i-=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i,search_terms:t("#group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),r.attr("class","bp-feedback"),r.addClass("info"),u.html(e.data.feedback)):(v.html(""),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var a=t("#group-invites-container #group_invites_search").val();if(""===a)return!1;i=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i,search_terms:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),r.attr("class","bp-feedback"),r.addClass("info"),u.html(e.data.feedback)):(v.html(""),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container #members-list li .action .group-remove-invite-button",function(e){e.preventDefault(),r.attr("class","bp-feedback"),r.addClass("loading"),u.html(""),u.html(BP_Nouveau.group_invites.removing);var a=t(this).closest("li"),s={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.uninvite,group_id:BP_Nouveau.group_invites.group_id,user:t(this).attr("data-bp-user-id")};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){if(e.success){a.remove(),e.data.has_invites||(r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(""),u.html(e.data.feedback)),t("#group-invites-container .group-invites-column .bp-invites-content #members-list").html(""),i=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:s,success:function(e){e.success?(v.html(""),v.html(e.data.html),g.html(""),g.html(e.data.pagination),r.attr("class","bp-feedback"),r.addClass("info"),u.html(e.data.feedback)):(v.html(""),r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(e.data.feedback))}})}else r.attr("class","bp-feedback"),r.addClass(e.data.type),u.html(""),u.html(e.data.feedback)}})})}else{l.scroll(this.loadMoreInvitesMembers),t(".groups.group-invites.send-invites .subnav #send-invites-groups-li").addClass("current selected");var h={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:h,success:function(e){e.success?(l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback),t("#group-invites-container .bb-groups-invites-right").show()):(t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback),t("#group-invites-container .bb-groups-invites-right").hide())}})}t("#bp-group-send-invite-switch-checkbox").on("change",function(){t("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").removeClass("bp-invites-dropdown-options-loader-hide");var e="";if(e=t(this).is(":checked")?"friends":"members"){i=1;var a={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e,page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){e.success?(t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide(),l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback)),t("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").addClass("bp-invites-dropdown-options-loader-hide")}})}}),t(document).on("click","#group-invites-container .bb-groups-invites-left .group-add-remove-invite-button",function(){var i=t(this).attr("data-bp-user-id"),a=t(this).attr("data-bp-user-name"),s={id:i,text:a};if(t(this).closest("li").hasClass("selected")){t(this).closest("li").removeClass("selected");var n=[];t.grep(e.select2("data"),function(e){return e.id!=i}).forEach(function(e){n.push(+e.id)}),e.val(n).trigger("change"),t('#group-invites-send-to-input option[value="'+i+'"]').each(function(){t(this).remove()}),t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)}else{if(t(this).closest("li").addClass("selected"),!e.find("option[value='"+s.id+"']").length){var o=new Option(s.text,s.id,!0,!0);e.append(o).trigger("change")}t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.remove_recipient)}}),t(document).on("click","#group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){i+=1,a=t("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:a,page:i,search_terms:t("#group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(t("#group-invites-container .group-invites-members-listing #members-list li.load-more").remove(),l.append(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback))}})}),t(document).on("click",".bb-more-invites-wrap .bb-add-invites",function(e){e.preventDefault(),t(".bb-groups-invites-left").addClass("bb-select-member-view")}),t(document).on("click",".bb-close-invites-members",function(e){e.preventDefault(),t(".bb-groups-invites-left").removeClass("bb-select-member-view")}),t(document).on("click","#group-invites-container .bb-groups-invites-left #group_invites_search",function(){var e=t("#group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===e)return!1;a=t("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:a,page:1,search_terms:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success?(l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),i=e.data.page,c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(""),p.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(r){r.preventDefault();var u=[];t.grep(e.select2("data"),function(e){return 0!=e.id}).forEach(function(e){u.push(+e.id)});var v={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:t("textarea#send-invites-control").val(),users:u};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:v,success:function(r){if(r.success){o.show(),s.attr("class","bp-feedback"),s.addClass(r.data.type),n.html(""),n.html(r.data.feedback),e.find("option").remove(),t("textarea#send-invites-control").val(""),a=t("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",i=1;var u={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:a,page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:u,success:function(e){e.success?(l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback))}})}else o.show(),s.attr("class","bp-feedback"),s.addClass(r.data.type),n.html(""),n.html(r.data.feedback)}})}),t(document).on("click","#group-invites-container #bp_invites_reset",function(s){s.preventDefault(),o.hide(),e.find("option").remove(),t("textarea#send-invites-control").val(""),i=1,a=t("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var n={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:a,page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:n,success:function(e){e.success?(l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var s=t("#group-invites-container #group_invites_search").val();if(""===s)return!1;i=1,a=t("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var n={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:a,page:i,search_terms:s};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){e.success?(l.html(""),l.html(e.data.html),d.html(""),d.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),p.html(e.data.feedback)):(l.html(""),d.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),p.html(e.data.feedback))}})})},addSelect2:function(e){var i=[];e.select2({placeholder:"",minimumInputLength:1,ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return t.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(e){return!1===jQuery.isEmptyObject(i)&&t.each(i,function(t,i){for(var a=0;a<e.data.results.length;a++)e.data.results[a].id===i&&e.data.results.splice(a,1)}),{results:e&&e.success?e.data.results:[]}}}}),e.on("select2:select",function(e){var t=e.params.data;i.push(t.id)}),e.on("select2:unselect",function(e){var t=e.params.data;i=jQuery.grep(i,function(e){return e!==t.id})})},isScrolledIntoView:function(e){var i=t(window).scrollTop(),a=i+t(window).height(),s=t(e).offset().top;return s+t(e).height()<=a&&s>=i},loadMoreInvitesMembers:function(e){var i=t(e.currentTarget);i[0].scrollHeight-i.scrollTop()===i.innerHeight()&&t("#group-invites-container .group-invites-members-listing #members-list li.load-more").length&&t("#group-invites-container .group-invites-members-listing .last #bp-group-invites-next-page").trigger("click")}},bp.Nouveau.GroupInvites.start())}(bp,jQuery);