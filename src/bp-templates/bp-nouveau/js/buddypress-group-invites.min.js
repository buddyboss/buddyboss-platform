window.wp=window.wp||{},window.bp=window.bp||{},function(h){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var s=h("body").find("#group-invites-send-to-input"),a=1,i="";this.addSelect2(s);var n=h("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),o=h("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),r=h("#group-invites-container .bb-groups-invites-right .bp-invites-feedback"),u=h("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback"),p=h("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p"),c=h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback"),d=h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),l=h(".group-invites-members-listing #members-list"),v=h(".group-invites-members-listing .last"),g=h(".members.bp-invites-content #members-list"),b=h("#group-invites-container .group-invites-column .subnav-filters div .last");c.attr("class","bp-feedback"),c.addClass("loading"),d.html(BP_Nouveau.group_invites.loading),h("#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),h(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){h(this).prop("disabled",!0)}),s.on("select2:unselect",function(e){e=e.params.data;h('#group-invites-send-to-input option[value="'+e.id+'"]').each(function(){h(this).remove()}),h("#group-invites-container .bb-groups-invites-left #members-list li."+e.id).removeClass("selected"),h("#group-invites-container .bb-groups-invites-left #members-list li."+e.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var m,e,t=h(".groups.group-invites.pending-invites");t.length&&(m=0,h(window).scroll(function(){var e,t,i,s=h(".groups.group-invites.pending-invites #group-invites-container .group-invites-column .bp-invites-content #members-list li.load-more");s.length&&(t=(e=h(window).scrollTop())+h(window).height(),((i=h(s).offset().top)+h(s).height()<=t&&e<=i||h(window).scrollTop()+h(window).height()>=h(document).height())&&0==m&&(h("#group-invites-container .last #bp-group-invites-next-page").trigger("click"),m=1))})),t.length?(h(".groups.group-invites.pending-invites .subnav #pending-invites-groups-li").addClass("current selected"),e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(g.html(""),g.html(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback),a+=1,h("#group-invites-container .bp-invites-feedback").hide()):(g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback),h("#group-invites-container .bp-invites-feedback").show())}}),h(document).on("click","#group-invites-container .last #bp-group-invites-next-page",function(){c.attr("class","bp-feedback"),c.addClass("loading"),d.html(BP_Nouveau.group_invites.loading);var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:h("#group-invites-container .group-invites-column #group_invites_search").val()};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){m=0,e.success?(g.find(".load-more").remove(),g.append(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback),a+=1):(g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})}),h(document).on("click","#group-invites-container .last #bp-group-invites-prev-page",function(){h("#group-invites-container .bp-invites-feedback").show(),h("#group-invites-container .bp-invites-feedback .bp-feedback").addClass("info"),p.html(BP_Nouveau.group_invites.loading),a-=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:h("#group-invites-container .group-invites-column #group_invites_search").val()};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(g.html(""),g.html(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info")):(g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type)),p.html(e.data.feedback)}})}),h(document).on("search",".pending-invites #group-invites-container #group_invites_search",function(e){e.preventDefault(),""===this.value&&(a=1,e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(g.html(""),g.html(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback),a+=1,h("#group-invites-container .bp-invites-feedback").hide()):(g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback),h("#group-invites-container .bp-invites-feedback").show())}}))}),h(document).on("click","#group-invites-container #group_invites_search_submit",function(e){e.preventDefault();e=h("#group-invites-container #group_invites_search").val();if(""===e)return!1;a=1;e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:e};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(g.html(""),g.html(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback),h("#group-invites-container .bp-invites-feedback").hide()):(g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback),h("#group-invites-container .bp-invites-feedback").show())}})}),h(document).on("click","#group-invites-container #members-list li .action .group-remove-invite-button",function(e){e.preventDefault(),h("#group-invites-container .group-invites-column #bp-pending-invites-loader").show(),u.attr("class","bp-feedback"),u.addClass("loading"),p.html(""),p.html(BP_Nouveau.group_invites.removing);var i=h(this).closest("li"),e={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.uninvite,group_id:BP_Nouveau.group_invites.group_id,user:h(this).attr("data-bp-user-id")};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){var t;e.success?(i.remove(),e.data.has_invites||(u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(""),p.html(e.data.feedback)),h("#group-invites-container .group-invites-column .bp-invites-content #members-list").html(""),a=1,t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(g.html(""),g.html(e.data.html),b.html(""),b.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback),h("#group-invites-container .bp-invites-feedback").hide()):(h("#group-invites-container .bp-invites-feedback").show(),g.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback)),h("#group-invites-container .group-invites-column #bp-pending-invites-loader").hide()}})):(u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(""),p.html(e.data.feedback),h("#group-invites-container .group-invites-column #bp-pending-invites-loader").hide())}})})):(l.scroll(this.loadMoreInvitesMembers),h(".groups.group-invites.send-invites .subnav #send-invites-groups-li").addClass("current selected"),e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),h("#group-invites-container .bb-groups-invites-right").show(),h(".bb-groups-invites-right .bp-invites-feedback").show()):(h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback),h("#group-invites-container .bb-groups-invites-right").hide())}})),h(document).on("search",".send-invites #group-invites-container #group_invites_search",function(e){e.preventDefault(),""===this.value&&(e="",e=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e,page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback))}}))}),h(document).on("search",".group-create.group-invites.create #group-invites-container #group_invites_search",function(e){e.preventDefault(),""===this.value&&(e="",e=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e,page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback))}}))}),h("#bp-group-send-invite-switch-checkbox").on("change",function(){h("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").removeClass("bp-invites-dropdown-options-loader-hide");var e="";(e=h(this).is(":checked")?"friends":"members")&&(a=1,e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e,page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){var t;e.success?(h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide(),l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),t=h("#group-invites-send-to-input").val(),h.isArray(t)&&t.length&&h.each(t,function(e,t){t&&(h("#members-list li."+t).addClass("selected"),h("#members-list li."+t+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.cancel_invite_tooltip))})):(h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback)),h("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").addClass("bp-invites-dropdown-options-loader-hide")}}))}),h(document).on("click","#group-invites-container .bb-groups-invites-left .group-add-remove-invite-button",function(){var t,i=h(this).attr("data-bp-user-id"),e=h(this).attr("data-bp-user-name"),e={id:i,text:e};h(this).closest("li").hasClass("selected")?(h(this).closest("li").removeClass("selected"),t=[],h.grep(s.select2("data"),function(e){return e.id!=i}).forEach(function(e){t.push(+e.id)}),s.val(t).trigger("change"),h('#group-invites-send-to-input option[value="'+i+'"]').each(function(){h(this).remove()}),h(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_invite_tooltip)):(h(this).closest("li").addClass("selected"),s.find("option[value='"+e.id+"']").length||(e=new Option(e.text,e.id,!0,!0),s.append(e).trigger("change")),h(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.cancel_invite_tooltip))}),h(document).on("click","#group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){a+=1,i=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:i,page:a,search_terms:h("#group-invites-container .bb-groups-invites-left #group_invites_search").val()};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(h("#group-invites-container .group-invites-members-listing #members-list li.load-more").remove(),l.append(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info")):(c.attr("class","bp-feedback"),c.addClass(e.data.type)),d.html(e.data.feedback)}})}),h(document).on("click",".bb-more-invites-wrap .bb-add-invites",function(e){e.preventDefault(),h(".bb-groups-invites-left").addClass("bb-select-member-view")}),h(document).on("click",".bb-close-invites-members",function(e){e.preventDefault(),h(".bb-groups-invites-left").removeClass("bb-select-member-view")}),h(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(e){e.preventDefault();var t=[],e=h.grep(s.select2("data"),function(e){return 0!=e.id});h("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").show(),e.forEach(function(e){t.push(+e.id)});e={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:h("textarea#send-invites-control").val(),users:t};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){var t;e.success?(r.show(),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(""),o.html(e.data.feedback),setTimeout(function(){n.removeClass(e.data.type),n.addClass("info"),o.html(""),o.html(BP_Nouveau.group_invites.member_invite_info_text),h("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},4e3),s.find("option").remove(),h("textarea#send-invites-control").val(""),i=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members",a=1,t={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:i,page:a},h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:t,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info")):(h("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show(),l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type)),d.html(e.data.feedback)}})):(r.show(),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(""),o.html(e.data.feedback),setTimeout(function(){n.removeClass(e.data.type),n.addClass("info"),o.html(""),o.html(BP_Nouveau.group_invites.member_invite_info_text),h("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},4e3))}})}),h(document).on("click","#group-invites-container #bp_invites_reset",function(e){e.preventDefault(),h("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").show(),r.hide(),s.find("option").remove(),h("textarea#send-invites-control").val(""),a=1,i=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:i,page:a};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),h(".bb-groups-invites-right-top .bp-invites-feedback").show()):(l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback)),setTimeout(function(){h("#group-invites-container .bb-groups-invites-right .bp-invites-submit-loader-hide").hide()},1e3)}})}),h(document).on("click",".send-invites #group-invites-container #group_invites_search_submit",function(e){e.preventDefault();e=h("#group-invites-container #group_invites_search").val();if(""===e)return!1;a=1,i=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:i,page:a,search_terms:e};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show())}})}),h(document).on("click",".group-create.group-invites.create #group-invites-container #group_invites_search_submit",function(e){e.preventDefault();e=h("#group-invites-container #group_invites_search").val();if(""===e)return!1;a=1,i=h("#bp-group-send-invite-switch-checkbox").is(":checked")?"friends":"members";e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:i,page:a,search_terms:e};h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(l.html(""),l.html(e.data.html),v.html(""),v.html(e.data.pagination),c.attr("class","bp-feedback"),c.addClass("info"),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").hide()):(l.html(""),v.html(""),c.attr("class","bp-feedback"),c.addClass(e.data.type),d.html(e.data.feedback),h(".bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback").show())}})})},addSelect2:function(e){var i=[];e.select2({placeholder:"",minimumInputLength:1,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return h.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(s){return!1===jQuery.isEmptyObject(i)&&h.each(i,function(e,t){for(var i=0;i<s.data.results.length;i++)s.data.results[i].id===t&&s.data.results.splice(i,1)}),{results:s&&s.success?s.data.results:[]}}}}),e.on("select2:select",function(e){e=e.params.data;i.push(e.id)}),e.on("select2:unselect",function(e){var t=e.params.data;i=jQuery.grep(i,function(e){return e!==t.id})})},isScrolledIntoView:function(e){var t=h(window).scrollTop(),i=t+h(window).height(),s=h(e).offset().top;return s+h(e).height()<=i&&t<=s},loadMoreInvitesMembers:function(e){e=h(e.currentTarget);e[0].scrollHeight-e.scrollTop()-e.innerHeight()<=30&&h("#group-invites-container .group-invites-members-listing #members-list li.load-more").length&&h("#group-invites-container .group-invites-members-listing .last #bp-group-invites-next-page").trigger("click")}},bp.Nouveau.GroupInvites.start())}((bp,jQuery));