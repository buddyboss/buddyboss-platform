window.bp=window.bp||{},function(i){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Moderation={start:function(){this.setupGlobals(),this.addListeners(),this.unblockUser()},setupGlobals:function(){this.current_page=1},addListeners:function(){i(document).on("click",'.bp-nouveau [data-bp-list="moderation"] .pager .md-more-container.load-more',this.injectModerations.bind(this)),i('#buddypress [data-bp-list="members"]').on("bp_ajax_request",this.bp_ajax_connection_request)},injectModerations:function(e){var t,a,o=bp.Nouveau.getStorage("bp-moderation"),r=o.scope||null,n=o.filter||null,s=i(e.currentTarget);s.hasClass("load-more")&&(t=+Number(this.current_page)+1,a=this,o="",e.preventDefault(),s.find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(o=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"moderation",scope:r,filter:n,search_terms:o,page:t,method:"append",target:"#buddypress [data-bp-list] table#moderation-list tbody"}).done(function(e){!0===e.success&&(s.parent(".pager").remove(),a.current_page=t,jQuery(window).scroll())}))},bp_ajax_connection_request:function(e,t){var a=i("#friends-personal-li").find(".count");a.html()!==t.response.count&&a.html(t.response.count)},unblockUser:function(){i(document).on("click",".moderation-item-actions .bp-unblock-user",function(a){if(!confirm(BP_Nouveau.moderation.unblock_user_msg))return!1;i(a.currentTarget).append(' <i class="bb-icon-l bb-icon-spinner animate-spin"></i>');var o=i(this),e={action:"bp_moderation_unblock_user",id:o.attr("data-id"),type:o.attr("data-type"),nonce:o.attr("data-nonce")};o.parent().closest(".moderation").find(".bp-feedback").hasClass("is_hidden")||o.parent().closest(".moderation").find(".bp-feedback").addClass("is_hidden"),i.post(ajaxurl,e,function(e){var t;!0===e.success?o.parent().closest(".moderation-item-wrp").fadeOut("normal",function(){o.parent().closest(".moderation-item-wrp").remove(),i("#moderation-list >tbody >tr").length<=0&&(i("#moderation-list").remove(),i(".bp-feedback").removeClass("error").addClass("info").removeClass("is_hidden"),i(".bp-feedback p").html(BP_Nouveau.moderation.no_user_msg))}):(i(a.currentTarget).find(".bb-icon-spinner").remove(),t="",e.data.message.errors.bp_moderation_missing_data?t=e.data.message.errors.bp_moderation_missing_data:e.data.message.errors.bp_moderation_not_exit?t=e.data.message.errors.bp_moderation_not_exit:e.data.message.errors.bp_rest_invalid_id?t=e.data.message.errors.bp_rest_invalid_id:e.data.message.errors.bp_moderation_block_error&&(t=e.data.message.errors.bp_moderation_block_error),o.parent().closest(".moderation").find(".bp-feedback").removeClass("is_hidden"),o.parent().closest(".moderation").find(".bp-feedback p").html(t))})})}},bp.Nouveau.Moderation.start())}((bp,jQuery));