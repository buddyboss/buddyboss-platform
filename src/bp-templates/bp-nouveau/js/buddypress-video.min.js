window.bp=window.bp||{},function(e,i){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=i("body");this.thumbnail_xhr=null,this.current_page=1,this.video_dropzone_obj=null,this.video_thumb_dropzone_obj=[],this.dropzone_video=[],this.dropzone_video_thumb=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,!this.video_album_id&&parseInt(BP_Nouveau.media.current_album)>0&&(this.video_album_id=parseInt(BP_Nouveau.media.current_album)),this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1);var t=document.getElementsByClassName("uploader-post-video-template").length?document.getElementsByClassName("uploader-post-video-template")[0].innerHTML:"";this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,previewTemplate:t},this.videoThumbnailOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,dictDefaultMessage:BP_Nouveau.video.dropzone_video_thumbnail_message,acceptedFiles:"image/jpeg,image/png",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:1,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.video.thumb_dict_file_exceeded},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){var e=i(".bp-nouveau");i(document).on("click","#bp-add-video",this.openUploader.bind(this)),i(document).on("click",".bp-video-thumbnail-submit",this.submitVideoThumbnail.bind(this)),i(document).on("click",".ac-video-thumbnail-edit",this.openEditThumbnailUploader.bind(this)),i(document).on("click",".bp-video-thumbnail-uploader-close",this.closeEditThumbnailUploader.bind(this)),i(document).on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),i(document).on("click","#bp-video-submit",this.submitVideo.bind(this)),i(document).on("click",".bp-video-uploader .modal-container .bb-field-uploader-actions",this.uploadVideoNavigate.bind(this)),i(document).on("click",".bb-activity-video-elem .video-action-wrap .video-action_more, #video-stream.video .bb-item-thumb .video-action-wrap .video-action_more, #media-stream.media .bb-video-thumb .video-action-wrap .video-action_more, .bb-activity-video-elem .video-action-wrap .video-action_list li a, .bb-media-model-container .activity-list .video-action-wrap.item-action-wrap > a, .bb-media-model-container .activity-list .video-action-wrap.item-action-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),i(document).on("click",".activity .bp-video-move-activity, #media-stream .bp-video-move-activity, #video-stream .bp-video-move-activity",this.moveVideoIntoAlbum.bind(this)),i(document).on("click",".bp-video-open-create-popup-album",this.createAlbumInPopup.bind(this)),i(document).on("click",".ac-video-close-button",this.closeVideoMove.bind(this)),i(document).on("click",".ac-video-move",this.openVideoMove.bind(this)),i(document).on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),i(document).on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this)),i(document).on("click",".video-action_list .video-file-delete, #bb-delete-video",this.deleteVideo.bind(this)),i(document).on("click",".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-custom .close-thumbnail-custom",this.deleteVideoThumb.bind(this)),e.on("click","#bb-create-video-album",this.openCreateVideoAlbumModal.bind(this)),e.on("click","#bp-video-create-album-close",this.closeCreateVideoAlbumModal.bind(this)),i(document).on("click","#bp-video-create-album-submit",this.saveAlbum.bind(this)),i('.bp-nouveau [data-bp-list="video"]').on("click","li.load-more",this.injectVideos.bind(this)),i(document).on("click",".bp-video-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this))},submitVideoThumbnail:function(e){var t,a=this,o=i(e.currentTarget);if(e.preventDefault(),o.hasClass("saving")||o.hasClass("is-disabled"))return!1;o.addClass("saving");var d=i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-video-id").val(),n=i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-attachment-id").val(),s=i('.bp-video-thumbnail-uploader.opened-edit-thumbnail input[type="radio"]:checked').val();t={action:"video_thumbnail_save",_wpnonce:BP_Nouveau.nonces.video,video_thumbnail:a.dropzone_video_thumb,video_id:d,video_attachment_id:n,video_default_id:s},i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+d+'"]').find("img").length&&i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",t.data.thumbnail),i('.bb-activity-video-elem a.bb-video-cover-wrap[data-id="'+d+'"]').find("img").length&&i('.bb-activity-video-elem a.bb-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",t.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find(".vjs-poster").length&&(i('.bb-activity-video-elem .video-js[data-id="'+d+'"]').attr("poster",t.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find("video").attr("poster",t.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find(".vjs-poster").css("background-image",'url("'+t.data.thumbnail+'")')),i("#theatre-video-"+d).length&&(i("#theatre-video-"+d).attr("poster",t.data.thumbnail),i("#theatre-video-"+d).find("video").attr("poster",t.data.thumbnail),i("#theatre-video-"+d).find(".vjs-poster").css("background-image",'url("'+t.data.thumbnail+'")'),i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",t.data.thumbnail));for(var n=0;n<a.dropzone_video_thumb.length;n++)a.dropzone_video_thumb[n].saved=!0;t.data.video_attachments&&i('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+t.data.video_attachment_id+'"]').attr("data-video-attachments",t.data.video_attachments),a.closeEditThumbnailUploader(e)}o.removeClass("saving")}})},uploadVideoNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=i(t).closest("#bp-video-uploader");i(t).hasClass("bb-field-uploader-next")?(a.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.find("#bp-video-submit, #bp-video-prev, .bp-video-open-create-popup-album.create-album, #bb-video-privacy").show(),0!==Number(i(a).find(".bb-album-selected-id"))&&i(a).find(".location-album-list li.is_active").length&&i(a).find(".location-album-list").scrollTop(i(a).find(".location-album-list li.is_active").offset().top-i(a).find(".location-album-list").offset().top),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){e>0&&i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))})):(i(t).hide(),a.find("#bp-video-prev, .bp-video-open-create-popup-album").hide(),a.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.closest("#bp-media-single-folder").length&&i("#bb-video-privacy").hide())},videoActivityActionButton:function(e){e.preventDefault(),i(e.currentTarget).closest(".bb-activity-video-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-video-elem").removeClass("is-visible"),i(e.currentTarget).closest(".bb-activity-video-elem").length<1&&i(e.currentTarget).closest(".bb-video-thumb").toggleClass("is-visible").parent().siblings().find(".bb-video-thumb").removeClass("is-visible"),i(e.currentTarget).closest(".bb-media-model-container").length&&i(e.currentTarget).closest(".video-action-wrap").toggleClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||i(e.currentTarget).hasClass("video-action_more")||(i(e.currentTarget).closest(".bb-activity-video-elem").removeClass("is-visible"),i(e.currentTarget).closest(".bb-item-thumb").removeClass("is-visible"))},toggleSelectAllVideo:function(e){e.preventDefault(),i(e.currentTarget).hasClass("selected")?(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllVideo(e)):(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllVideo(e)),i(e.currentTarget).toggleClass("selected")},selectAllVideo:function(e){e.preventDefault(),i("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){i(this).prop("checked",!0),i(this).closest(".bb-item-thumb").addClass("selected"),i(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllVideo:function(e){e.preventDefault(),i("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){i(this).prop("checked",!1),i(this).closest(".bb-item-thumb").removeClass("selected"),i(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var t=e.currentTarget;if(i(t).is(":checked"))i(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),i(t).closest(".bb-item-thumb").addClass("selected");else{i(t).closest(".bb-item-thumb").removeClass("selected"),i(t).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select);var a=i(".bp-nouveau #bb-select-deselect-all-video");a.hasClass("selected")&&a.removeClass("selected")}},submitVideo:function(e){var t,a=this,o=i(e.currentTarget),d=i("#bb-video-privacy");if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),"bp-video-dropzone-content"===a.current_tab){var n=i("#bp-video-post-content").val(),s=i(e.currentTarget).closest(".open-popup").find(".bb-album-selected-id").val();if(s.length&&parseInt(s)>0){!1,s=s;for(var l=0;l<a.dropzone_video.length;l++)a.dropzone_video[l].album_id=s}else s=a.album_id;t={action:"video_save",_wpnonce:BP_Nouveau.nonces.video,videos:a.dropzone_video,content:n,album_id:s,group_id:a.video_group_id,privacy:d.val()},i("#bp-video-dropzone-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){i("#bp-media-single-album").length?(i("#media-stream ul.media-list").length||(i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-videos-actions").show(),i(".bb-photos-actions").length&&i(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",t.data.video,"prepend")):(i("#video-stream ul.video-list").length||(i("#video-stream .bp-feedback").remove(),i("#video-stream").append('<ul class="video-list item-list bp-list bb-video-list grid"></ul>'),i(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",t.data.video,"prepend")),t.data.video_personal_count&&i("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(t.data.video_personal_count),t.data.video_group_count&&i("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(t.data.video_group_count),"yes"===BP_Nouveau.video.is_video_directory&&(i("#buddypress").find(".video-type-navs ul.video-nav li#video-all a span.count").text(t.data.video_all_count),i("#buddypress").find(".video-type-navs ul.video-nav li#video-personal a span.count").text(t.data.video_personal_count),i("#buddypress").find(".video-type-navs ul.video-nav li#video-groups a span.count").text(t.data.video_group_count));for(var d=0;d<a.dropzone_video.length;d++)a.dropzone_video[d].saved=!0;a.closeUploader(e),jQuery(window).scroll()}else i("#bp-video-dropzone-content").prepend(t.data.feedback);o.removeClass("saving")}})}else if("bp-existing-video-content"===a.current_tab){var r=[];i('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){r.push(i(this).val())}),t={action:"video_move_to_album",_wpnonce:BP_Nouveau.nonces.video,medias:r,album_id:a.video_album_id,group_id:a.video_group_id},i("#bp-existing-video-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?(i("#video-stream ul.media-list").length||(i("#video-stream").html(i("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),i(".bb-video-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",t.data.video,"prepend"),i('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){i(this).closest("li").data("id")===i(this).val()&&i(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):i("#bp-existing-video-content").prepend(t.data.feedback),o.removeClass("saving")}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},clearFolderLocationUI:function(e){var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");i.length>0&&(i.find(".location-album-list-wrap-main .location-album-list-wrap .location-album-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),i.find(".location-album-list-wrap-main .location-album-list-wrap .location-album-list li").show().children("span, i").show(),i.find(".location-folder-title").text(BP_Nouveau.video.target_text),i.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),i.find(".ac_document_search_folder").val(""),i.find(".bb-model-header h4 span").text("..."),i.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-album-list-wrap").find(".location-album-list").show())},openUploader:function(e){var t,a,o=this;e.preventDefault(),this.moveToIdPopup=BP_Nouveau.video.move_to_id_popup,this.moveToTypePopup=BP_Nouveau.video.current_type,void 0!==window.Dropzone&&i("div.video-uploader-wrapper #video-uploader").length&&(i("#bp-video-uploader").show(),i("#bp-video-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(t="#bp-video-uploader.bp-video-uploader",0!==Number(i(t).find(".bb-album-selected-id").data("value"))?(a=i(t).find(".bb-album-selected-id").data("value"),i(t).find("#bb-video-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(i(document).find(".open-popup .location-album-list-wrap").hide(),i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),i(document).find(".open-popup .location-album-list-wrap").show()),!1===e.data.create_album?i(document).find(".open-popup .bp-video-open-create-popup-album").removeClass("create-album"):i(document).find(".open-popup .bp-video-open-create-popup-album").addClass("create-album"),i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-album-create-from").val("profile"),i(t).find(".location-album-list-wrap .location-album-list").remove(),i(t).find(".location-album-list-wrap").append(e.data.html),i(t).find('ul.location-album-list span[data-id="'+a+'"]').trigger("click"),i(t).find(".bb-album-selected-id").val(a)}})),i(document).on("click",t+" .location-album-list li span",function(e){if(e.preventDefault(),!i(this).parent().hasClass("is_active")&&(0!=i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+i(this).attr("id")+'">'+i(this).text()+"</span>"),i(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),!i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled"))){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(i(e.currentTarget).data("id"));var t=i(e.currentTarget).closest("#bp-video-uploader").find("#bb-video-privacy");0!==Number(i(e.currentTarget).data("id"))?(t.find("option").removeAttr("selected"),t.val(i(e.currentTarget).parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}}),i(document).on("click",t+" .breadcrumb .item > span",function(e){if(!i(this).hasClass("is-disabled")){i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(0),i(e.currentTarget).closest(".bb-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),a==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):i(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled");var t=i(e.currentTarget).closest("#bp-video-uploader").find("#bb-video-privacy"),o=i(e.currentTarget).closest("#bp-video-uploader").find(".location-album-list li.is_active").data("privacy");0!==Number(i(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val())?(t.find("option").removeAttr("selected"),t.val(void 0===o?"public":o),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))}}),o.video_dropzone_obj=new Dropzone("div.video-uploader-wrapper #video-uploader",o.videoOptions),o.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),o.video_dropzone_obj.on("addedfile",function(e){setTimeout(function(){o.video_dropzone_obj.getAcceptedFiles().length&&i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video.length,o.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3),e.dataURL||bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),o.video_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),o.video_dropzone_obj.on("queuecomplete",function(){i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),o.video_dropzone_obj.on("processing",function(){i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),o.video_dropzone_obj.on("uploadprogress",function(e,t){i(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text);var a=i(e.previewElement).find(".dz-progress-ring circle")[0],o=2*a.r.baseVal.value*Math.PI;a.style.strokeDasharray=o+" "+o,a.style.strokeDashoffset=o;var d=o-e.upload.progress.toFixed(0)/100*o;a.style.strokeDashoffset=d,100===e.upload.progress&&i(t.previewElement).closest(".dz-preview").addClass("dz-complete")}),o.video_dropzone_obj.on("success",function(e,t){t.data.id?(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=o.dropzone_video.length,t.data.album_id=o.video_album_id,t.data.group_id=o.video_group_id,t.data.js_preview=i(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.data.saved=!1,o.dropzone_video.push(t.data)):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-video-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),i(".bb-field-steps-1 #bp-video-next, #bp-video-submit").show(),i(".bb-field-steps-1").addClass("controls-added"),i("#bp-video-submit").show(),i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video.length,o.video_dropzone_obj.getAcceptedFiles().length)).show()}),o.video_dropzone_obj.on("removedfile",function(e){if(o.dropzone_video.length)for(var t in o.dropzone_video)if(e.upload.uuid==o.dropzone_video[t].uuid){void 0===o.dropzone_video[t].saved||o.dropzone_video[t].saved||o.removeVideoAttachment(o.dropzone_video[t].id),o.dropzone_video.splice(t,1);break}o.video_dropzone_obj.getAcceptedFiles().length?i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,o.dropzone_video.length,o.video_dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-video-uploader-modal-status-text").text(""),i("#bp-video-next").hide(),i(".bb-field-steps-1").removeClass("controls-added"),i("#bp-video-submit").hide())}))},openEditThumbnailUploader:function(e){var t=this;e.preventDefault();var a=i(e.currentTarget),o=a.attr("data-parent-activity-id"),d=a.attr("data-video-attachment-id"),n=a.attr("data-video-attachments"),s=a.attr("data-video-id"),l="";if(i(e.currentTarget).closest(".activity-inner").length>0?l=i(e.currentTarget).closest(".activity-inner"):i("#bp-media-single-album").length>0?l=i("#bp-media-single-album").find("#media-stream").parent():i(e.currentTarget).closest("#bb-media-model-container").length>0&&i(e.currentTarget).closest(".bb-video-container.bb-media-container.group-video").length>0?l=i(e.currentTarget).closest(".bb-video-container.bb-media-container.group-video"):i(e.currentTarget).closest("#bb-media-model-container").length>0&&i(e.currentTarget).closest(".bb-media-model-wrapper.video-theatre").siblings("#video-stream").length>0?l=i(e.currentTarget).closest(".bb-media-model-wrapper.video-theatre").parent():i(e.currentTarget).closest("#video-stream.video").length>0?l=i(e.currentTarget).closest("#video-stream.video").parent():i(e.currentTarget).closest("#bb-media-model-container").length>0?l=i("ul.activity-list li#activity-"+o).find(".activity-inner"):i(e.currentTarget).closest("#media-stream.media").length>0?l=i(e.currentTarget).closest("#media-stream.media").parent():i(e.currentTarget).closest(".forums-video-wrap").length>0?l=i(e.currentTarget).closest(".forums-video-wrap"):i(e.currentTarget).closest(".comment-item").length>0&&(l=i(e.currentTarget).closest(".comment-item")),i(l).find(".bp-video-thumbnail-uploader").addClass("opened-edit-thumbnail").show(),i(l).find(".bp-video-thumbnail-uploader").removeClass("no_generated_thumb"),i(document).on("click",".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated .bb-action-check-wrap",function(){i(this).closest(".bp-video-thumbnail-uploader").find(".bp-video-thumbnail-submit").removeClass("is-disabled")}),i(document).on("click",".bp-video-thumbnail-uploader.opened-edit-thumbnail:not(.generating_thumb) .video-thumb-list li",function(e){e.preventDefault(),i(this).find("input.bb-custom-check").prop("checked")||(i(this).find("input.bb-custom-check").prop("checked",!0),i(this).closest(".bp-video-thumbnail-uploader").find(".bp-video-thumbnail-submit").removeClass("is-disabled"))}),i(document).on("click",".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content",function(e){i(e.target).hasClass("bb-custom-check")||i(e.target).hasClass("bb-icon")||i(e.target).hasClass("dz-remove")||i(e.target).hasClass("dz-clickable")||i(e.target).hasClass("close-thumbnail-custom")||i(this).find(".video-thumbnail-custom").hasClass("is_hidden")||!i(this).find("input.bb-custom-check").prop("checked")&&i(e.target).closest(".bp-video-thumbnail-dropzone-content").hasClass("has_image")&&(i(this).find("input.bb-custom-check").prop("checked",!0),i(this).closest(".bp-video-thumbnail-uploader").find(".bp-video-thumbnail-submit").removeClass("is-disabled"))}),i(document).on("click",".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-custom .close-thumbnail-custom",function(){i(this).siblings("img").attr("src","").parent().hide(),i(this).closest(".video-thumbnail-content").find(".video-thumbnail-uploader-wrapper").show(),i(this).closest(".video-thumbnail-custom").siblings(".bb-action-check-wrap").find("input").prop("checked")&&(i(this).closest(".video-thumbnail-custom").siblings(".bb-action-check-wrap").find("input").prop("checked",!1),i(this).closest(".bp-video-thumbnail-dropzone-content").find(".bp-video-thumbnail-submit").addClass("is-disabled")),i(this).closest(".video-thumbnail-custom").addClass("is_hidden"),i(this).closest(".bp-video-thumbnail-dropzone-content").removeClass("has_image")}),void 0!==window.Dropzone&&i("div.bp-video-thumbnail-uploader.opened-edit-thumbnail div.video-thumbnail-uploader-wrapper .video-thumbnail-uploader-dropzone-select").length){i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-video-id").val(s),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-edit-thumbnail-hidden-attachment-id").val(d);var r=document.getElementsByClassName("uploader-post-video-thumbnail-template").length?document.getElementsByClassName("uploader-post-video-thumbnail-template")[0].innerHTML:"";if(t.videoThumbnailOptions.previewTemplate=r,t.video_thumb_dropzone_obj=new Dropzone("div.bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-dropzone-select",t.videoThumbnailOptions),t.video_thumb_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_thumbnail_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_thumb_dropzone_obj.on("addedfile",function(e){e.video_thumbnail_edit_data?(t.dropzone_video_thumb.push(e.video_thumbnail_edit_data),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-wrapper .dropzone.dz-clickable").addClass("dz-max-files-reached"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .bb-action-check-wrap").show()):setTimeout(function(){t.video_thumb_dropzone_obj.getAcceptedFiles().length&&i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_thumb_dropzone_obj.on("uploadprogress",function(e){var t=i(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a;var o=a-e.upload.progress.toFixed(0)/100*a;t.style.strokeDashoffset=o}),t.video_thumb_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-video-move-popup" style="display: block;" class="open-popup video-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .bb-action-check-wrap").hide())}),t.video_thumb_dropzone_obj.on("queuecomplete",function(){i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb)}),t.video_thumb_dropzone_obj.on("success",function(e,a){a.data.id?(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_video.length,a.data.album_id=t.video_album_id,a.data.group_id=t.video_group_id,a.data.saved=!1,a.data.js_preview=i(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video_thumb.push(a.data)):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-submit").removeClass("is-disabled"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content").addClass("has_image"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .bb-custom-check").prop("checked",!0),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .video-thumbnail-custom.is_hidden").removeClass("is_hidden")}),t.video_thumb_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video_thumb.length)for(var a in t.dropzone_video_thumb)if(e.upload.uuid==t.dropzone_video_thumb[a].uuid){void 0===t.dropzone_video_thumb[a].saved||t.dropzone_video_thumb[a].saved||t.removeVideoThumbnailAttachment(t.dropzone_video_thumb[a].id),t.dropzone_video_thumb.splice(a,1);break}t.video_thumb_dropzone_obj.getAcceptedFiles().length?i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show():(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(""),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-submit").addClass("is-disabled"),i(".bp-video-thumbnail-dropzone-content .bb-action-check-wrap input:checked")&&(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .bb-action-check-wrap input").prop("checked",!1),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content").removeClass("has_image"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .bb-action-check-wrap").hide(),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content .video-thumbnail-custom img").attr("src","").parent().hide()))}),void 0!==n){var p="";void 0!==(n=JSON.parse(n)).default_images?(i.each(n.default_images,function(e,i){var t="";void 0!==n.selected_id&&void 0!==n.selected_id.id&&i.id==n.selected_id.id&&(t='checked="checked"'),void 0!==i.url&&(p+='<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3">',p+='<div class="">',p+="<input "+t+' id="bb-video-'+i.id+'" class="bb-custom-check" type="radio" value="'+i.id+'" name="bb-video-thumbnail-select" />',p+='<label class="bp-tooltip" data-bp-tooltip-pos="up" data-bp-tooltip="Select" for="bb-video-'+i.id+'"><span class="bb-icon bb-icon-check"></span></label>',p+='<a class="" href="#">',p+='<img src="'+i.url+'" class=""/>',p+="</a>",p+="</div>",p+="</li>")}),""!=p&&(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").removeClass("loading"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").html(p),i(".bp-video-thumbnail-uploader").removeClass("generating_thumb"),n.default_images.length<2&&BP_Nouveau.video.is_ffpmeg_installed&&(i(".bp-video-thumbnail-uploader").addClass("generating_thumb"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 thumb_loader"><div class="video-thumb-block"><i class="bb-icon-loader animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 thumb_loader"><div class="video-thumb-block"><i class="bb-icon-loader animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>")))):i(l).find(".bp-video-thumbnail-uploader").addClass("no_generated_thumb"),void 0!==n.preview&&void 0!==n.preview.dropzone&&1==n.preview.dropzone&&(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-custom").show(),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-custom img").attr("src",n.preview.url),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content").addClass("has_image"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-dropzone-content").find("input").prop("checked",!0),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-wrapper").hide(),i("#custom_image_ele").find("input").attr("id","bb-video-"+n.preview.attachment_id),i("#custom_image_ele").find("label").attr("for","bb-video-"+n.preview.attachment_id),i("#custom_image_ele").find("input").val(n.preview.attachment_id),void 0!==n.selected_id&&n.preview.attachment_id==n.selected_id.id&&i("#custom_image_ele").find("input").attr("checked","checked")),void 0!==n.selected_id&&i(l).find(".bp-video-thumbnail-uploader #bb-video-"+n.selected_id.id).prop("checked",!0)}var u={action:"video_get_edit_thumbnail_data",_wpnonce:BP_Nouveau.nonces.video,attachment_id:d,video_id:s};BP_Nouveau.video.is_ffpmeg_installed&&(void 0===n.default_images||n.default_images.length<2)?(this.thumbnail_xhr&&this.thumbnail_xhr.abort(),i(".bp-video-thumbnail-uploader").addClass("generating_thumb").removeClass("no_generated_thumb"),this.thumbnail_xhr=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:u,success:function(e){if(e.success){var t=i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list");e.data.default_images&&(t.html(""),t.html(e.data.default_images)),e.data.ffmpeg_generated&&"no"===e.data.ffmpeg_generated&&t.html(""),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list li").length<2?(i(".bp-video-thumbnail-uploader").addClass("generating_thumb").removeClass("no_generated_thumb"),0===i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list li.thumb_loader").length&&(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 thumb_loader"><div class="video-thumb-block"><i class="bb-icon-loader animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 thumb_loader"><div class="video-thumb-block"><i class="bb-icon-loader animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"))):0===i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list li.thumb_loader").length&&i(".bp-video-thumbnail-uploader").removeClass("generating_thumb no_generated_thumb")}}})):(i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-auto-generated ul.video-thumb-list").removeClass("loading"),i(".bp-video-thumbnail-uploader").removeClass("generating_thumb"))}},createThumbnailFromUrl:function(e){var i=this;i.video_thumb_dropzone_obj.createThumbnailFromUrl(e,i.video_thumb_dropzone_obj.options.thumbnailWidth,i.video_thumb_dropzone_obj.options.thumbnailHeight,i.video_thumb_dropzone_obj.options.thumbnailMethod,!0,function(t){i.video_thumb_dropzone_obj.emit("thumbnail",e,t),i.video_thumb_dropzone_obj.emit("complete",e)})},closeEditThumbnailUploader:function(e){e.preventDefault(),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .bp-video-thumbnail-uploader-modal-status-text").text(""),i(".bp-video-thumbnail-uploader.opened-edit-thumbnail .video-thumbnail-uploader-wrapper .video-thumbnail-uploader-dropzone-select").html(""),this.video_thumb_dropzone_obj.destroy(),this.dropzone_video_thumb=[],i(".bp-video-thumbnail-uploader.opened-edit-thumbnail").hide(),i(".bp-video-thumbnail-uploader").find(".bp-video-thumbnail-submit").addClass("is-disabled"),i(".bp-video-thumbnail-uploader").removeClass("opened-edit-thumbnail"),i(window).scroll()},openAlbumUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&i("div#video-album-uploader").length&&(i("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div#video-album-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(t.data.feedback):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("queuecomplete",function(){i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,a){a.data.id?(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_video.length,a.data.album_id=t.video_album_id,a.data.group_id=t.video_group_id,a.data.saved=!1,a.data.js_preview=i(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video.push(a.data)):(jQuery(".media-error-popup").length||i("body").append('<div id="bp-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),i("#bp-video-submit").show(),i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var a in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[a].uuid){void 0===t.dropzone_video[a].saved||t.dropzone_video[a].saved||t.removeVideoAttachment(t.dropzone_video[a].id),t.dropzone_video.splice(a,1);break}t.video_dropzone_obj.getAcceptedFiles().length?i("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-video-uploader-modal-status-text").text(""),i("#bp-video-submit").hide())}))},removeVideoAttachment:function(e){var t={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t})},removeVideoThumbnailAttachment:function(e){var t={action:"video_thumbnail_delete_attachment",_wpnonce:BP_Nouveau.nonces.video,id:e};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t})},closeUploader:function(e){e.preventDefault(),i("#bp-video-uploader").hide(),i("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload),i("#bp-video-uploader-modal-status-text").text(""),this.video_dropzone_obj&&this.video_dropzone_obj.destroy(),this.dropzone_video=[];var t=i(e.currentTarget).closest("#bp-video-uploader");i(".close-create-popup-album").trigger("click"),i(".close-create-popup-folder").trigger("click"),t.find('.breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find(".bb-field-steps-1 #bp-video-next").hide(),t.find(".bb-field-steps-1").removeClass("controls-added"),t.find("#bp-video-prev, #bp-video-submit, .bp-video-open-create-popup-album, .create-popup-album-wrap").hide()),this.clearFolderLocationUI(e)},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1},deleteVideo:function(e){var t=this,a=i(e.currentTarget);e.preventDefault();var o,d=[],n=i("#buddypress"),s=a.attr("data-type"),l=a.data("item-from"),r=a.data("root-parent-activity-id"),p="";if("video"===s&&!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;if(a.hasClass("bb-delete")){if(!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;n.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){i(this).closest(".bb-video-thumb").addClass("loading deleting"),d.push(i(this).val())})}if(o=a.data("parent-activity-id"),l&&l.length&&"activity"===l&&0==d.length&&(p=a.attr("data-item-id"),d.push(p)),0==d.length&&d.push(a.data("item-id")),0==d.length)return!1;a.prop("disabled",!0),i("#buddypress #video-stream.video .bp-feedback").remove();var u={action:"video_delete",_wpnonce:BP_Nouveau.nonces.video,video:d,activity_id:o,from_where:l};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:u,success:function(e){var s="";if(l&&l.length&&"activity"===l){if(e.success)if(i.each(d,function(e,t){i('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').length&&i('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').remove(),i("body .bb-activity-video-elem."+t).length&&i("body .bb-activity-video-elem."+t).remove()}),0==i('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"] .activity-content .activity-inner .bb-activity-video-elem').length&&i('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"]').remove(),!0===e.data.delete_activity){if(i("body #buddypress .activity-list li#activity-"+o).remove(),i("body .bb-activity-video-elem.video-activity."+p).remove(),i("body .activity-comments li#acomment-"+o).remove(),r&&i(".activity-list").length){var u=i(".activity-list li#activity-"+r+" .activity-comments > ul > li").length;if(0===u){i(".activity-list li#activity-"+r+" .activity-comments ul").remove();var c=i(".activity-list li#activity-"+r+" .activity-state .activity-state-comments .comments-count");if(c.length){var v=BP_Nouveau.activity.strings.commentLabel;c.text(v.replace("%d",0))}i(".activity-list li#activity-"+r+" .activity-content .activity-state").removeClass("has-comments")}else{var b=parseInt(u),m=i(".activity-list li#activity-"+r+" .activity-state .activity-state-comments .comments-count");if(m.length){var h=b>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;m.text(h.replace("%d",b))}}}}else i("body #buddypress .activity-list li#activity-"+o).replaceWith(e.data.activity_content)}else if(l&&l.length&&"video"===l){if(e.success)if("yes"===BP_Nouveau.video.is_video_directory){var _=bp.Nouveau.getStorage("bp-video").scope;"personal"===_?(i(document).find("li#video-personal a").trigger("click"),i(document).find("li#video-personal").trigger("click")):"groups"===_?(i(document).find("li#video-groups a").trigger("click"),i(document).find("li#video-groups").trigger("click")):(i(document).find("li#video-all a").trigger("click"),i(document).find("li#video-all").trigger("click"))}else e.data.video_personal_count&&i("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),e.data.video_group_count&&i("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count),i.each(d,function(e,a){i('#video-stream ul.video-list li[data-id="'+a+'"]').length&&i('#video-stream ul.video-list li[data-id="'+a+'"]').remove(),t.video_album_id&&i('#media-stream ul.media-list li[data-id="'+a+'"]').length&&i('#media-stream ul.media-list li[data-id="'+a+'"]').remove()}),0==i("#buddypress").find(".video-list:not(.existing-video-list)").find("li:not(.load-more)").length&&(i(".bb-videos-actions").hide(),s='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.video.i18n_strings.no_videos_found+"</p>\n\t</aside>",i('#buddypress [data-bp-list="video"]').html(s))}else setTimeout(function(){a.prop("disabled",!1)},500),e.success?(n.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){i(this).closest("li").remove()}),0==i("#buddypress").find(".video-list:not(.existing-video-list)").find("li:not(.load-more)").length&&(i(".bb-videos-actions").hide(),s='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.video.i18n_strings.no_videos_found+"</p>\n\t</aside>",i('#buddypress [data-bp-list="video"]').html(s))):i("#buddypress #video-stream.video").prepend(e.data.feedback);jQuery(window).scroll()}})},deleteVideoThumb:function(e){var t=i(e.currentTarget);e.preventDefault();var a=i(".video-edit-thumbnail-hidden-video-id").val(),o=i(".video-edit-thumbnail-hidden-attachment-id").val(),d=t.closest(".bb-dropzone-wrap").find("input").val();i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_thumbnail_delete",_wpnonce:BP_Nouveau.nonces.video,video_id:a,attachment_id:o,video_attachment_id:d},success:function(e){e.data.video_attachments&&i('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+o+'"]').attr("data-video-attachments",e.data.video_attachments),e.data.thumbnail_id&&0!==e.data.thumbnail_id&&i("#bb-video-"+e.data.thumbnail_id).length&&(i("#bb-video-"+e.data.thumbnail_id).prop("checked",!0),i(".bp-video-thumbnail-submit").removeClass("is-disabled")),e.data.thumbnail&&(i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+a+'"]').find("img").length&&i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+a+'"]').find("img").attr("src",e.data.thumbnail),i('.bb-activity-video-elem a.bb-video-cover-wrap[data-id="'+a+'"]').find("img").length&&i('.bb-activity-video-elem a.bb-video-cover-wrap[data-id="'+a+'"]').find("img").attr("src",e.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+a+'"]').find(".vjs-poster").length&&(i('.bb-activity-video-elem .video-js[data-id="'+a+'"]').attr("poster",e.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+a+'"]').find("video").attr("poster",e.data.thumbnail),i('.bb-activity-video-elem .video-js[data-id="'+a+'"]').find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")')),i("#theatre-video-"+a).length&&(i("#theatre-video-"+a).attr("poster",e.data.thumbnail),i("#theatre-video-"+a).find("video").attr("poster",e.data.thumbnail),i("#theatre-video-"+a).find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),i('.bb-video-thumb a.bb-video-cover-wrap[data-id="'+a+'"]').find("img").attr("src",e.data.thumbnail)))}})},openCreateVideoAlbumModal:function(e){e.preventDefault(),this.openAlbumUploader(e),i("#bp-video-create-album").show()},closeCreateVideoAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),i("#bp-video-create-album").hide(),i("#bb-album-title").val("")},saveAlbum:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-title"),d=i("#bb-album-privacy");if(t.hasClass("saving"))return!1;if(e.preventDefault(),""===i.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.addClass("saving"),t.attr("disabled",!0);var n={action:"video_album_save",_wpnonce:BP_Nouveau.nonces.video,title:o.val(),videos:a.dropzone_video,privacy:d.val()};a.album_id&&(n.album_id=a.album_id),a.group_id&&(n.group_id=a.group_id),i("#bp-media-single-album .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(n){setTimeout(function(){t.removeClass("saving"),t.prop("disabled",!1)},500),n.success?a.album_id?(i("#bp-single-album-title").text(o.val()),i("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(i("#buddypress .bb-albums-list").prepend(n.data.album),window.location.href=n.data.redirect_url):a.album_id?i("#bp-media-single-album").prepend(n.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(n.data.feedback)}})},injectVideos:function(e){var t=bp.Nouveau.getStorage("bp-video"),a=t.scope||null,o=t.filter||null;if(i(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page)+1,n=this,s="";e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(s=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"video",scope:a,filter:o,search_terms:s,page:d,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(t){!0===t.success&&(i(e.currentTarget).remove(),n.current_page=d,jQuery(window).scroll())})}},openVideoMove:function(e){var t,a,o,d;e.preventDefault(),this.moveToIdPopup=i(e.currentTarget).attr("id"),this.moveToTypePopup=i(e.currentTarget).attr("data-type"),i(e.currentTarget).closest(".activity-inner").length>0?t=i(e.currentTarget).closest(".activity-inner"):i(e.currentTarget).closest("#media-stream.media").length>0?t=i(e.currentTarget).closest("#media-stream.media"):i(e.currentTarget).closest("#video-stream.video").length>0?t=i(e.currentTarget).closest("#video-stream.video"):i(e.currentTarget).closest(".comment-item").length>0&&(t=i(e.currentTarget).closest(".comment-item")),i(t).find(".bp-video-move-file").addClass("open").show(),o=i(e.currentTarget).closest(".video-action-wrap").siblings("a").data("id"),a=i(e.currentTarget).closest(".video-action-wrap").siblings("a").data("album-id"),void 0===o&&(o=i(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("id"),a=i(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("album-id")),t.find(".bp-video-move").attr("id",o),t.find(".bb-model-footer .bp-video-move").addClass("is-disabled"),d=i(e.currentTarget).closest(".video-action_list").closest("li.comment-item").length?"#"+i(e.currentTarget).closest(".video-action_list").closest("li").attr("id")+".comment-item .bp-video-move-file":"#"+i(e.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-video-move-file",i(d).find(".bp-document-move").attr("id",i(e.currentTarget).closest(".document-activity").attr("data-id")),(i(e.currentTarget).closest(".media-list").length>0||i(e.currentTarget).closest(".video-list").length>0)&&(d=".bp-video-move-file"),"group"===this.moveToTypePopup?i(document).find(".location-album-list-wrap h4").show():i(document).find(".location-album-list-wrap h4").hide(),i(d).addClass("open-popup"),i(d).find(".location-album-list-wrap .location-album-list").remove(),i(d).find(".location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-loader animate-spin"></i></li></ul>');var n=a,s=this.moveToTypePopup;""!==this.moveToIdPopup&&i.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-video").html(e.data.first_span_text),""===e.data.html?(i(document).find(".open-popup .location-album-list-wrap").hide(),i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(i(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),i(document).find(".open-popup .location-album-list-wrap").show()),"group"===s?(i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide(),i(document).find(".open-popup .bb-album-create-from").val("group")):(i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(document).find(".open-popup .bb-album-create-from").val("profile")),!1===e.data.create_album?(i(document).find(".open-popup .bp-video-open-create-popup-album").removeClass("create-album"),i(document).find(".open-popup .bp-video-open-create-popup-album").hide()):(i(document).find(".open-popup .bp-video-open-create-popup-album").addClass("create-album"),i(document).find(".open-popup .bp-video-open-create-popup-album").show()),i(d).find(".location-album-list-wrap .location-album-list").remove(),i(d).find(".location-album-list-wrap").append(e.data.html),i(d).find("ul.location-album-list span#"+n).trigger("click")}}),i(document).on("click",d+" .location-album-list li span",function(e){if(e.preventDefault(),!i(this).parent().hasClass("is_active")){0!=i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+i(this).attr("id")+'">'+i(this).text()+"</span>"),i(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected");var t=i(document).find('a.bb-open-video-theatre[data-id="'+o+'"]').data("album-id");Number(t)==Number(i(e.currentTarget).data("id"))?i(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").addClass("is-disabled"):i(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").removeClass("is-disabled"),i(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").hasClass("is-disabled")||i(e.currentTarget).closest(".bp-video-move-file").find(".bb-album-selected-id").val(i(e.currentTarget).data("id"))}}),i(document).on("click",d+" .breadcrumb .item > span",function(e){i(this).hasClass("is-disabled")||(i(e.currentTarget).closest(".bp-video-move-file").find(".bb-album-selected-id").val(0),i(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&i(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),n==i(e.currentTarget).data("id")?i(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").addClass("is-disabled"):i(e.currentTarget).closest(".bp-video-move-file").find(".bb-model-footer .bp-video-move").removeClass("is-disabled"))})},createAlbumInPopup:function(e){e.preventDefault();var t=parseInt(i(document).find(".open-popup .bb-album-selected-id").val()),a=i(document).find(".open-popup .bb-album-create-from").val();t>0?i(document).find(".open-popup .privacy-field-wrap-hide-show").hide():i(document).find(".open-popup .privacy-field-wrap-hide-show").show(),"group"===a?i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide():i(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),i(".modal-container .bb-model-footer").hide(),i(".bb-field-wrap-search").hide(),i(".bp-video-open-create-popup-album").hide(),i(".location-album-list-wrap-main").hide(),i(".bb-field-steps-2 #bp-media-prev").hide(),i(".create-popup-album-wrap").show(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide(),i(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>Create Album</p>"),i(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),i(document).find(".open-popup .error").hide()},closeVideoMove:function(e){e.preventDefault(),0!=i(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&i(e.currentTarget).closest(".bp-video-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").remove(),i(e.currentTarget).closest(".bp-video-move-file").hide()},moveVideoIntoAlbum:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("id"),o=t.closest(".bp-video-move-file").find(".bb-album-selected-id").val();if(""===a||""===o)return t.closest(".modal-container").find(".location-album-list").addClass("has-error"),!1;t.closest(".modal-container").find(".location-album-list").removeClass("has-error"),t.addClass("loading");var d;d=i(document).find('li.move_video a[data-video-id="'+a+'"]').attr("data-parent-activity-id");var n=parseInt(this.group_id);n||(n=!1,"group"===i(document).find('li.move_video a[data-video-id="'+a+'"]').attr("data-type")&&(n=i(document).find('li.move_video a[data-video-id="'+a+'"]').attr("id")));var s={action:"video_move",_wpnonce:BP_Nouveau.nonces.video,video_id:a,album_id:o,group_id:n,activity_id:d};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){if(e.success){if("yes"===BP_Nouveau.video.is_video_directory)"personal"===bp.Nouveau.getStorage("bp-video").scope?(i(document).find("li#video-personal a").trigger("click"),i(document).find("li#video-personal").trigger("click")):(i(document).find("li#video-all a").trigger("click"),i(document).find("li#video-all").trigger("click"));else parseInt(BP_Nouveau.video.current_album)>0?(i('#video-stream ul.video-list li[data-id="'+a+'"]').remove(),i('#media-stream ul.media-list li[data-id="'+a+'"]').remove()):i('#media-stream ul.media-list li.bb-video-li[data-id="'+a+'"]').length?i('#media-stream ul.media-list li.bb-video-li[data-id="'+a+'"]').remove():i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+a+'"]').length&&!i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+a+'"]').parents().hasClass("bb-video-length-1")&&(i('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+a+'"]').remove(),d&&d.length&&(i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-video-wrap').remove(),i('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.video_content),jQuery(window).scroll())),i(document).find(".open-popup .error").hide(),i(document).find(".open-popup .error").html(""),t.removeClass("loading"),i(document).removeClass("open-popup");t.closest(".bp-video-move-file").find(".ac-video-close-button").trigger("click"),i(document).find('a.bb-open-video-theatre[data-id="'+a+'"]').data("album-id",o)}else alert(e.data.feedback.replace("&#039;","'"))}})},submitCreateAlbumInPopup:function(e){e.preventDefault();var t=i(e.currentTarget).closest(".open-popup"),a=i(t).find(".bp-video-create-popup-album-submit"),o=t.find(".bb-album-selected-id").val();""===o&&(o=0),this.currentTargetParent=o;var d=this.currentTargetParent,n=0,s=i.trim(i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title").val()),l=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title"),r="",p="",u=0;if("group"===this.moveToTypePopup?(r="grouponly",n=this.moveToIdPopup):(r=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy").val(),p=i(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy")),""===s)return alert(BP_Nouveau.media.create_album_error_title),!1;a.addClass("loading"),setTimeout(function(){var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:s,privacy:r,parent:d,group_id:n};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){e.success&&(t.find(".location-album-list-wrap .location-album-list").remove(),t.find(".location-album-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(t,e.data.album_id),u=e.data.album_id,""===e.data.tree_view?(t.find(".location-album-list-wrap").hide(),t.find(".location-album-list-wrap-main span.no-album-exists").show()):(t.find(".location-album-list-wrap-main span.no-album-exists").hide(),t.find(".location-album-list-wrap").show()),t.find("ul.location-album-list span#"+u).trigger("click"),t.find(".bb-model-footer").show(),t.find(".bb-field-wrap-search").show(),t.find(".bp-video-open-create-popup-album").show(),t.find(".location-album-list-wrap-main").show(),t.find(".create-popup-album-wrap").hide(),t.find(".bb-field-steps-2 #bp-media-prev").show(),t.find(".bb-album-selected-id").val(),t.find(".bb-album-selected-id").val(u),t.find(".bb-model-header").children().show(),t.find(".bb-model-header p").hide(),l.val(""),""!==p&&p.val("public"),i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){e>0&&i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>i(t).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||i('<span class="more_options">...</span>').insertAfter(i(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),a.removeClass("loading"))}}),this.currentTargetParent=u,t.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide(),t.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),t.find(".location-album-list li span.selected").removeClass("selected"),t.find(".location-album-list li.is_active").children("span").addClass("selected")},0)}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=i(".bb-next-media"),this.previousVideoLink=i(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){i(document).on("click",".bb-open-video-theatre",this.openTheatre.bind(this)),i(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),i(document).on("click",".bb-prev-media",this.previous.bind(this)),i(document).on("click",".bb-next-media",this.next.bind(this)),i(document).on("click",".bp-add-video-activity-description",this.openVideoActivityDescription.bind(this)),i(document).on("click","#bp-activity-description-new-reset",this.closeVideoActivityDescription.bind(this)),i(document).on("click","#bp-activity-description-new-submit",this.submitVideoActivityDescription.bind(this)),i(document).on("bp_activity_ajax_delete_request_video",this.videoActivityDeleted.bind(this))},openTheatre:function(e){e.preventDefault();var t,a=i(e.currentTarget);if(a.closest("#bp-existing-video-content").length)return!1;this.setupGlobals(),this.setVideos(a),t=a.data("id"),this.setCurrentVideo(t),this.showVideo(),this.navigationCommands(),this.getParentActivityHtml(a),void 0!==BP_Nouveau.activity&&this.current_video&&void 0!==this.current_video.activity_id&&0!=this.current_video.activity_id&&!this.current_video.is_forum&&"comment"!==this.current_video.privacy?this.getActivity():this.getVideosDescription(),i(".bb-media-model-wrapper.media").hide(),i(".bb-media-model-wrapper.document").hide(),i(".bb-media-model-wrapper.video").show(),this.is_open_video=!0},closeTheatre:function(e){e.preventDefault();i(".bb-media-model-wrapper.video .bb-media-section").find("video").length&&i(".bb-media-model-wrapper.video .bb-media-section").find("video").attr("src",""),this.is_open_video=!1,this.resetRemoveActivityCommentsData(),this.current_video=!1,this.getParentActivityHtml(i(e.currentTarget))},getParentActivityHtml:function(e){var t=i("#hidden_parent_id").val(),a=e.closest(".bb-media-model-wrapper").find("#bb-media-model-container .activity-list li.activity-item").data("bp-activity-id");if(parseInt(t)===parseInt(a)){var o=i('#bb-media-model-container [data-bp-activity-id="'+t+'"]');i('[data-bp-activity-id="'+t+'"] > .activity-state').html(i(o).find(".activity-state").html()),i('[data-bp-activity-id="'+t+'"] > .activity-meta').html(i(o).find(".activity-meta").html()),i('[data-bp-activity-id="'+t+'"] > .activity-comments').html(i(o).find(".activity-comments").html()),i("#hidden_parent_id").length&&i("#hidden_parent_id").remove()}},getVideosDescription:function(){i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),0!=this.activity_ajax&&this.activity_ajax.abort();var e=i('[data-bp-activity-id="'+this.current_video.activity_id+'"] .activity-comments');e.length&&(this.current_video.parent_activity_comments=!0,e.html("")),!0===this.current_video.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+this.current_video.activity_id+'" id="hidden_parent_id"/>'),this.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_video_description",id:this.current_video.id,attachment_id:this.current_video.attachment_id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&i(".bb-media-model-wrapper.video:visible").length?(i(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),i(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").attr("autoplay",!0),i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),i(".bb-media-info-section:visible").show(),i(window).scroll()):i(".bb-media-info-section.media").hide()}})},setVideos:function(e){var t=i(".bb-open-video-theatre"),a=0;if(i("body").hasClass("activity")&&(t=i(e).closest(".bb-activity-video-wrap").find(".bb-open-video-theatre")),void 0!==t)for(this.videos=[],a=0;a<t.length;a++){var o=i(t[a]);if(!o.closest("#bp-existing-media-content").length){var d={id:o.data("id"),attachment:o.data("attachment-full"),activity_id:o.data("activity-id"),attachment_id:o.data("attachment-id"),privacy:o.data("privacy"),parent_activity_id:o.data("parent-activity-id"),album_id:o.data("album-id"),group_id:o.data("group-id"),is_forum:!1};o.closest(".forums-video-wrap").length&&(d.is_forum=!0),void 0!==d.privacy&&"message"==d.privacy?d.is_message=!0:d.is_message=!1,this.videos.push(d)}}},setCurrentVideo:function(e){var i=0;for(i=0;i<this.videos.length;i++)if(e===this.videos[i].id){this.current_video=this.videos[i],this.current_index=i;break}},showVideo:function(){if(void 0===this.current_video)return!1;i(".bb-media-model-wrapper.video .bb-media-section").find("figure").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');var e=i(".bb-media-section .bb-media-privacy-wrap");if(e.length){e.show(),e.find("ul.media-privacy li").removeClass("selected"),e.find(".bp-tooltip").attr("data-bp-tooltip","");var t=e.find("ul.media-privacy").find("li[data-value="+this.current_video.privacy+"]");t.addClass("selected"),e.find(".bp-tooltip").attr("data-bp-tooltip",t.text()),e.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(this.current_video.privacy),(void 0!==BP_Nouveau.activity&&void 0!==this.current_video.activity_id&&0!=this.current_video.activity_id||this.group_id||this.current_video.is_forum||this.current_video.group_id||this.current_video.album_id||this.current_video.is_message)&&e.hide()}this.navigationCommands()},navigationCommands:function(){0==this.current_index&&this.current_index!=this.videos.length-1?(this.previousVideoLink.hide(),this.nextVideoLink.show()):0==this.current_index&&this.current_index==this.videos.length-1?(this.previousVideoLink.hide(),this.nextVideoLink.hide()):this.current_index==this.videos.length-1?(this.previousVideoLink.show(),this.nextVideoLink.hide()):(this.previousVideoLink.show(),this.nextVideoLink.show())},next:function(e){e.preventDefault();var i;this.resetRemoveActivityCommentsData(),void 0!==this.videos[this.current_index+1]?(this.current_index=this.current_index+1,i=this.current_video.activity_id,this.current_video=this.videos[this.current_index],this.showVideo(),i!=this.current_video.activity_id&&"comment"!==this.current_video.privacy?this.getActivity():this.getVideosDescription()):this.nextLink.hide()},previous:function(e){e.preventDefault();var i;this.resetRemoveActivityCommentsData(),void 0!==this.videos[this.current_index-1]?(this.current_index=this.current_index-1,i=this.current_video.activity_id,this.current_video=this.videos[this.current_index],this.showVideo(),i!=this.current_video.activity_id&&"comment"!==this.current_video.privacy?this.getActivity():this.getVideosDescription()):this.previousLink.hide()},resetRemoveActivityCommentsData:function(){var e=!1,t=!1,a=!1,o=!1,d=!1,n=!1;this.current_video.parent_activity_comments&&((e=(o=i('.bb-media-model-wrapper.video [data-bp-activity-id="'+this.current_video.activity_id+'"]')).find(".activity-comments")).length&&(d=e.html(),n=e.attr("class"),e.remove(),(e=i('[data-bp-activity-id="'+this.current_video.activity_id+'"] .activity-comments')).length&&(e.html(d),e.attr("class",n))),(a=o.find(".activity-state")).length&&(d=a.html(),n=a.attr("class"),a.remove(),(a=i('[data-bp-activity-id="'+this.current_video.activity_id+'"] .activity-state')).length&&(a.html(d),a.attr("class",n))),(t=o.find(".activity-meta")).length&&(d=t.html(),n=t.attr("class"),t.remove(),(t=i('[data-bp-activity-id="'+this.current_video.activity_id+'"] > .activity-meta')).length&&(t.html(d),t.attr("class",n))),o.remove())},getActivity:function(){if(i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>'),void 0!==BP_Nouveau.activity&&this.current_video&&void 0!==this.current_video.activity_id&&0!=this.current_video.activity_id&&!this.current_video.is_forum){0!=this.activity_ajax&&this.activity_ajax.abort(),i(".bb-media-info-section.media").show();var e=i('[data-bp-activity-id="'+this.current_video.activity_id+'"] .activity-comments');e.length&&(this.current_video.parent_activity_comments=!0,e.html("")),!0===this.current_video.parent_activity_comments&&i(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+this.current_video.activity_id+'" id="hidden_parent_id"/>'),this.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_activity",id:this.current_video.activity_id,group_id:_.isUndefined(this.current_video.group_id)?0:this.current_video.group_id,video_id:_.isUndefined(this.current_video.id)?0:this.current_video.id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&i(".bb-media-model-wrapper.video:visible").length&&(i(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),i(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").attr("autoplay",!0),i(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").addClass("popup-video"),i(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),i(".bb-media-info-section:visible").show(),jQuery(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},1e3))}})}else i(".bb-media-info-section.media").hide()},openVideoActivityDescription:function(e){e.preventDefault();var t=i(e.currentTarget);if(t.parents(".activity-video-description").find(".bp-edit-video-activity-description").length<1)return!1;t.parents(".activity-video-description").find(".bp-edit-video-activity-description").show().addClass("open"),t.parents(".activity-video-description").find(".bp-video-activity-description").hide(),t.hide()},closeVideoActivityDescription:function(e){e.preventDefault();var t=i(e.currentTarget);if(t.parents(".activity-video-description").length<1)return!1;var a=t.parents(".activity-video-description").find("#add-activity-description").get(0).defaultValue;t.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),t.parents(".activity-video-description").find(".bp-video-activity-description").show(),t.parents(".activity-video-description").find("#add-activity-description").val(a),t.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open")},submitVideoActivityDescription:function(e){e.preventDefault();var t=i(e.currentTarget),a=t.parents(".activity-video-description"),o={action:"video_description_save",description:a.find("#add-activity-description").val(),attachment_id:a.find("#bp-attachment-id").val(),_wpnonce:BP_Nouveau.nonces.video};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,async:!1,success:function(e){e.success?(t.parents(".activity-video-description").find(".bp-video-activity-description").html(e.data.description).show(),t.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),a.find("#add-activity-description").val(e.data.description),a.find("#add-activity-description").get(0).defaultValue=e.data.description,""==e.data.description?t.parents(".activity-video-description").find(".bp-add-video-activity-description").removeClass("show-edit").addClass("show-add"):t.parents(".activity-video-description").find(".bp-add-video-activity-description").addClass("show-edit").removeClass("show-add"),t.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open"),t.parents(".activity-video-description").find(".bp-video-activity-description").show(),t.parents(".activity-video-description").find(".bp-feedback.error").remove()):t.parents(".activity-video-description").prepend(e.data.feedback)}})},videoActivityDeleted:function(e,t){var a=0;if(this.is_open_video&&void 0!==t&&"delete_activity"===t.action&&this.current_video.activity_id==t.id){for(i(document).find('[data-bp-list="video"] .bb-open-video-theatre[data-id="'+this.current_video.id+'"]').closest("li").remove(),i(document).find('[data-bp-list="activity"] .bb-open-video-theatre[data-id="'+this.current_video.id+'"]').closest(".bb-activity-video-elem").remove(),a=0;a<this.videos.length;a++)if(this.videos[a].activity_id==t.id){this.videos.splice(a,1);break}0==this.current_index&&this.current_index!=this.videos.length?(this.current_index=-1,this.next(e)):0==this.current_index&&this.current_index==this.videos.length?(i(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+this.current_video.activity_id+'"]').remove(),this.closeTheatre(e)):this.current_index==this.videos.length?this.previous(e):(this.current_index=-1,this.next(e))}}},bp.Nouveau.Video.Theatre.start(),bp.Nouveau.Video.Player={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.player=[],this.playerTime=0,this.playerID="",bp.Nouveau.Video.Player.openPlayer(),i(window).on("scroll resize",function(){bp.Nouveau.Video.Player.openPlayer()})},addListeners:function(){i(document).on("click",".video-js",this.openPlayer.bind(this))},openPlayer:function(){var e=this.player;i(".video-js:not(.loaded)").each(function(){var t=this,a=i(this).attr("id");if(e[i(this).attr("id")]=videojs(t,{controlBar:{volumePanel:{inline:!1}}},function(){this.on("ended",function(){}),this.on("play",function(){i(".video-js").each(function(){a!==i(this).attr("id")&&this.player.pause()})})}),void 0!==e[i(this).attr("id")]&&(e[i(this).attr("id")].seekButtons({forward:5,back:5}),setTimeout(function(){var e=i(t).parent();e.find(".vjs-control-bar > .vjs-seek-button.skip-back, .vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon-pos","up"),e.find(".vjs-control-bar > .vjs-seek-button.skip-back").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_skip_back_text),e.find(".vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_skip_forward_text)},0)),bp.Nouveau.Video.Player.playerTime>0&&i(this).attr("id")=="theatre-"+bp.Nouveau.Video.Player.playerID?(e[i(t).parent().attr("id")].currentTime(bp.Nouveau.Video.Player.playerTime),e[i(t).parent().attr("id")].play()):(bp.Nouveau.Video.Player.playerTime=0,bp.Nouveau.Video.Player.playerID=""),i(t).hasClass("single-activity-video")){var o=i(this).attr("id");e[i(this).attr("id")].controlBar.addChild("button").addClass("vjs-icon-square");var d=i(this).find(".vjs-icon-square").addClass("enlarge_button");d.attr("data-balloon-pos","up"),d.attr("data-balloon",BP_Nouveau.video.i18n_strings.video_enlarge_text);var n=i(this).find(".vjs-error-display.vjs-modal-dialog"),s=i(this);d.on("click touchstart",function(){e[o].currentTime()>0&&(bp.Nouveau.Video.Player.playerTime=e[o].currentTime(),bp.Nouveau.Video.Player.playerID=i("#"+o).parent().find(".video-js video").attr("id")),e[o].pause(),i("#"+o).parent().find(".bb-open-video-theatre").trigger("click")}),n.on("click",function(){i("#"+o).parent().find(".bb-open-video-theatre").trigger("click")}),s.on("click",function(t){i(t.target).hasClass("video-js")&&(s.hasClass("vjs-paused")?e[o].play():e[o].pause())})}if(i(t).closest(".video-theatre").length){var l=i(this).parent().find(".vjs-fullscreen-control");l.attr("data-balloon-pos","up"),l.attr("data-balloon",BP_Nouveau.video.i18n_strings.video_fullscreen_text)}i(t).parent().find(".vjs-control-bar > button, .vjs-control-bar > div").attr("data-balloon-pos","up");var r=i(t).parent();r.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_play_text),r.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon-pause",BP_Nouveau.video.i18n_strings.video_pause_text),r.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon-pos","right"),r.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_volume_text),r.find(".vjs-control-bar > .vjs-picture-in-picture-control").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_miniplayer_text),r.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon-pos","left"),r.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_speed_text),i(this).addClass("loaded")})}},bp.Nouveau.Video.Player.start())}(bp,jQuery);