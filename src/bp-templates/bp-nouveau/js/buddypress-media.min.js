window.bp=window.bp||{},function(u){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!u("body").hasClass("single-topic")&&!u("body").hasClass("single-forum")&&"bp-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_reply_edit&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_topic_edit&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_forum_edit&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_media?window.BP_Forums_Nouveau.media.reply_edit_media:[],this.bbp_topic_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_media?window.BP_Forums_Nouveau.media.topic_edit_media:[],this.bbp_forum_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_media?window.BP_Forums_Nouveau.media.forum_edit_media:[],this.bbp_reply_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_gif_data?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_gif_data?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_gif_data?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1},addListeners:function(){u(".bp-nouveau").on("click","#bp-add-media",this.openUploader.bind(this)),u(".bp-nouveau").on("click","#bp-media-submit",this.submitMedia.bind(this)),u(".bp-nouveau").on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),u(".bp-nouveau").on("click","#bb-delete-media",this.deleteMedia.bind(this)),u(".bp-nouveau").on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),u('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),u(".bp-nouveau").on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),u(".bp-nouveau").on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),u(".bp-nouveau").on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),u(".bp-nouveau").on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),u("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),u('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),u(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),u(".bp-existing-media-wrap").on("click","li.load-more",this.appendMedia.bind(this)),u(".bp-nouveau").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),u(".bp-existing-media-wrap").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),u(".bp-nouveau").on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),u(".bp-nouveau").on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),u(".bp-nouveau").on("click","#bp-save-album-title",this.saveAlbum.bind(this)),u(".bp-nouveau").on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),u(".bp-nouveau").on("click","#bb-delete-album",this.deleteAlbum.bind(this)),u(document).on("click","#forums-media-button",this.openForumsUploader.bind(this)),u(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this)),u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),u(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),u(".buddypress.groups.messages").length||u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),u(document).find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),u(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this));var e=u(".buddypress.groups.messages"),i=u(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar"),t=u(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),a=u(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");e.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),e.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),i.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),i.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),t.scroll(this.loadMoreGroupMessagesGif.bind(this)),u(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),a.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),u(document).on("click",".gif-image-container",this.playVideo.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1)),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&u("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&this.editGifPreview()},bp_ajax_media_request:function(e,i){void 0!==i&&void 0!==i.response.scopes.personal&&0===i.response.scopes.personal&&u(".bb-photos-actions").hide()},addSelectedClassToWrapper:function(e){var i=e.currentTarget;u(i).is(":checked")?(u(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),u(i).closest(".bb-photo-thumb").addClass("selected")):(u(i).closest(".bb-photo-thumb").removeClass("selected"),u(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),u(".bp-nouveau #bb-select-deselect-all-media").hasClass("selected")&&u(".bp-nouveau #bb-select-deselect-all-media").removeClass("selected"))},deleteMedia:function(e){var t=u(e.currentTarget);e.preventDefault();var i=[];if(u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest(".bb-photo-thumb").addClass("loading deleting"),i.push(u(this).val())}),0==i.length)return!1;t.prop("disabled",!0),u("#buddypress .media-list .bp-feedback").remove();var a={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:i};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){var i;setTimeout(function(){t.prop("disabled",!1)},500),e.success?(u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest("li").remove()}),0==u("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length&&(u(".bb-photos-actions").hide(),i='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>",u('#buddypress [data-bp-list="media"]').html(i))):u("#buddypress .media-list").prepend(e.data.feedback)}})},toggleSelectAllMedia:function(e){e.preventDefault(),u(e.currentTarget).hasClass("selected")?(u(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(u(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),u(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault(),u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){u(this).prop("checked",!0),u(this).closest(".bb-photo-thumb").addClass("selected"),u(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault(),u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){u(this).prop("checked",!1),u(this).closest(".bb-photo-thumb").removeClass("selected"),u(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),u("#bb-album-title").show(),u("#bp-save-album-title").show(),u("#bp-cancel-edit-album-title").show(),u("#bp-edit-album-title").hide(),u("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),u("#bb-album-title").hide(),u("#bp-save-album-title").hide(),u("#bp-cancel-edit-album-title").hide(),u("#bp-edit-album-title").show(),u("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),u("#bp-media-uploader").hide(),u("#bp-media-add-more").hide(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),u("#bp-media-uploader-modal-status-text").text(""),this.dropzone_obj.destroy(),this.dropzone_media=[]},loadMoreGif:function(e){var i,t,a=e.target,o=this,d=u(e.target).closest("form").find(".forums-attached-gif-container"),s=d.data("key");o.gif_container_key=s,a.scrollTop+a.offsetHeight>=a.scrollHeight&&!d.hasClass("loading")&&0<o.gif_data[s].total_count&&o.gif_data[s].offset<=o.gif_data[s].total_count&&(i={offset:o.gif_data[s].offset,fmt:"json",limit:o.gif_data[s].limit},d.addClass("loading"),t=null,t=_.isNull(o.gif_data[s].q)?o.giphy.trending(i,_.bind(o.loadMoreGifResponse,o)):o.giphy.search(_.extend({q:o.gif_data[s].q},i),_.bind(o.loadMoreGifResponse,o)),o.gif_data[s].requests.push(t),o.gif_data[s].offset=o.gif_data[s].offset+o.gif_data[s].limit)},loadMoreGroupMessagesGif:function(e){var i,t,a=e.target,o=this,d=u(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");o.gif_container_key=d,a.scrollTop+a.offsetHeight>=a.scrollHeight&&!u(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&0<o.gif_total_count&&o.gif_offset<=o.gif_total_count&&(i={offset:o.gif_offset,fmt:"json",limit:o.gif_limit},u(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),t=null,t=_.isNull(o.gif_q)?o.giphy.trending(i,_.bind(o.loadMoreGroupMessagesGifResponse,o)):o.giphy.search(_.extend({q:o.gif_q},i),_.bind(o.loadMoreGroupMessagesGifResponse,o)),o.gif_requests.push(t),o.gif_offset=o.gif_offset+o.gif_limit,o.gif_data[d].requests.push(t),o.gif_data[d].offset=o.gif_data[d].offset+o.gif_data[d].limit)},loadMoreGroupMessagesGifResponse:function(e){var i=0;if(u(".bp-group-messages-attached-gif-container").removeClass("loading"),void 0!==e.data&&e.data.length){for(var t="",i=0;i<e.data.length;i++){t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[i].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[i].images.original.url+'" data-id="'+e.data[i].id+'">\n\t\t<img src="'+e.data[i].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[i].saved=!1,this.gif_data.push(e.data[i])}u(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(this.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var i=this,t=0;if(u('div.forums-attached-gif-container[data-key="'+i.gif_container_key+'"]').removeClass("loading"),void 0!==e.data&&e.data.length){for(var a="",t=0;t<e.data.length;t++){a+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[t].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[t].images.original.url+'" data-id="'+e.data[t].id+'">\n\t\t<img src="'+e.data[t].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[t].saved=!1,i.gif_data[i.gif_container_key].data.push(e.data[t])}u('div.forums-attached-gif-container[data-key="'+i.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(a)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_data[i.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,i={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?i=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?i=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(i=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===i.images)return!1;u("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.images.fixed_width.url+")",u("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",u("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.images.original.height+"px",u("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.images.original.width+"px",u("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.images.original.url),u("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),u("#bbp_media_gif").length&&u("#bbp_media_gif").val(JSON.stringify(i))},selectGif:function(e){var i=this,t=0,a=u(e.currentTarget),o=a.closest("form").find(".forums-attached-gif-container");e.preventDefault(),o.closest("form").find(".gif-media-search-dropdown").removeClass("open");var d=o.data("key");if(void 0!==i.gif_data[d]&&void 0!==i.gif_data[d].data&&i.gif_data[d].data.length)for(t=0;t<i.gif_data[d].data.length;t++)if(i.gif_data[d].data[t].id==e.currentTarget.dataset.id){a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.gif_data[d].data[t].images.fixed_width.url+")",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.gif_data[d].data[t].images.original.height+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.gif_data[d].data[t].images.original.width+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.gif_data[d].data[t].images.original.url),a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),a.closest("form").find("#bbp_media_gif").length&&a.closest("form").find("#bbp_media_gif").val(JSON.stringify(i.gif_data[d].data[t]));break}},selectGroupMessagesGif:function(e){var i=this,t=0;e.preventDefault();var a=u("#whats-new-attachments .bp-group-messages-attached-gif-container"),o=u("#bp_group_messages_gif");if(u("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),i.gif_data.length)for(t=0;t<i.gif_data.length;t++)if(i.gif_data[t].id==e.currentTarget.dataset.id){a[0].style.backgroundImage="url("+i.gif_data[t].images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=i.gif_data[t].images.original.height+"px",a[0].style.width=i.gif_data[t].images.original.width+"px",a.find(".gif-image-container img").attr("src",i.gif_data[t].images.original.url),a.removeClass("closed"),o.length&&o.val(JSON.stringify(i.gif_data[t]));break}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var i=u(e.target);i.closest("form").find(".gif-media-search-dropdown").removeClass("open"),i.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active");var t=i.closest("form").find("#whats-new-attachments .forums-attached-gif-container");t&&(t.addClass("closed"),t.find(".gif-image-container img").attr("src",""),t[0].style=""),i.closest("form").find("#bbp_media_gif").length&&i.closest("form").find("#bbp_media_gif").val("")},resetGroupMessagesGifComponent:function(){var e=u("#whats-new-attachments .bp-group-messages-attached-gif-container"),i=u("#bp_group_messages_gif");u("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),u("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",i.length&&i.val("")},searchGif:function(e){var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGroupMessagesGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGifRequest:function(t){var a=this;a.gif_q=t.target.value;var o=a.gif_offset=0;a.clearGifRequests(),u(t.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var e=a.giphy.search({q:a.gif_q,offset:a.gif_offset,fmt:"json",limit:a.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(o=0;o<e.data.length;o++){i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[o].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[o].images.original.url+'" data-id="'+e.data[o].id+'">\n\t\t<img src="'+e.data[o].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[o].saved=!1,a.gif_data.push(e.data[o])}u(t.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(a.gif_total_count=e.pagination.total_count),u(t.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")});a.gif_requests.push(e),a.gif_offset=a.gif_offset+a.gif_limit},searchGifRequest:function(t){var a=this,o=0,d=u(t.target).closest("form").find(".forums-attached-gif-container");d.addClass("loading");var s=d.data("key");a.clearGifRequests(s),a.gif_data[s].q=t.target.value,a.gif_data[s].offset=0;var e=a.giphy.search({q:a.gif_data[s].q,offset:a.gif_data[s].offset,fmt:"json",limit:a.gif_data[s].limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(o=0;o<e.data.length;o++){i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[o].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[o].images.original.url+'" data-id="'+e.data[o].id+'">\n\t\t<img src="'+e.data[o].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[o].saved=!1,a.gif_data[s].data.push(e.data[o])}u(t.target).closest(".gif-search-content").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(a.gif_data[s].total_count=e.pagination.total_count),d.removeClass("loading")});a.gif_data[s].requests.push(e),a.gif_data[s].offset=a.gif_data[s].offset+a.gif_data[s].limit},clearGifRequests:function(e){var i=this;if(void 0!==i.gif_data[e]&&void 0!==i.gif_data[e].requests){for(var t=0;t<i.gif_data[e].requests.length;t++)i.gif_data[e].requests[t].abort();u('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),i.gif_data[e].requests=[],i.gif_data[e].data=[],i.gif_data.splice(e,1)}},toggleGifSelector:function(e){var t,a,i,o=this,d=u(e.currentTarget),s=d.closest("form").find(".gif-media-search-dropdown"),n=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&(o.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),(t=d.closest("form").find(".forums-attached-gif-container")).addClass("loading"),a=t.data("key"),o.clearGifRequests(a),o.gif_data[a]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]},i=o.giphy.trending({offset:o.gif_data[a].offset,fmt:"json",limit:o.gif_data[a].limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(n=0;n<e.data.length;n++){i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[n].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[n].images.original.url+'" data-id="'+e.data[n].id+'">\n\t\t<img src="'+e.data[n].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[n].saved=!1,o.gif_data[a].data.push(e.data[n])}d.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(o.gif_data[a].total_count=e.pagination.total_count),t.removeClass("loading")}),o.gif_data[a].requests.push(i),o.gif_data[a].offset=o.gif_data[a].offset+o.gif_data[a].limit),s.toggleClass("open"),d.toggleClass("active");var r=d.closest("form").find("#forums-post-media-uploader");r.length&&o.resetForumsMediaComponent(r.data("key"))},toggleGroupMessagesGifSelector:function(e){var i,t=this,a=u(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&null==t.giphy&&(t.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),t.gif_offset=0,t.gif_q=null,t.gif_limit=20,t.gif_requests=[],t.gif_data=[],t.clearGifRequests(),u(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading"),i=t.giphy.trending({offset:t.gif_offset,fmt:"json",limit:t.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(d=0;d<e.data.length;d++){i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[d].saved=!1,t.gif_data.push(e.data[d])}a.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_total_count=e.pagination.total_count),u(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")}),t.gif_requests.push(i),t.gif_offset=t.gif_offset+t.gif_limit),o.toggleClass("open"),a.toggleClass("active"),t.resetGroupMessagesMediaComponent()},resetGroupMessagesMediaComponent:function(){this.dropzone_obj&&this.dropzone_obj.destroy(),this.dropzone_media=[],u("div#bp-group-messages-post-media-uploader").html(""),u("div#bp-group-messages-post-media-uploader").addClass("closed").removeClass("open")},resetForumsMediaComponent:function(e){void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),u('div#forums-post-media-uploader[data-key="'+e+'"]').html(""),u('div#forums-post-media-uploader[data-key="'+e+'"]').addClass("closed").removeClass("open"))},openForumsUploader:function(e){var t=this,a=u(e.currentTarget).closest("form").find("#forums-post-media-uploader"),i=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length){var o=a.data("key");if(a.hasClass("closed")){if(t.dropzone_obj[o]=new Dropzone(a[0],t.options),t.dropzone_media[o]=[],t.dropzone_obj[o].on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj[o].on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(i.data.feedback):t.dropzone_obj[o].removeFile(e)}),t.dropzone_obj[o].on("success",function(e,i){i.data.id&&(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=t.album_id,i.data.group_id=t.group_id,i.data.saved=!1,t.dropzone_media[o].push(i.data),t.addMediaIdsToForumsForm(a))}),t.dropzone_obj[o].on("removedfile",function(e){if(t.dropzone_media[o].length)for(var i in t.dropzone_media[o])if(e.upload.uuid==t.dropzone_media[o][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[o][i].saved||t.dropzone_media[o][i].saved||t.removeAttachment(t.dropzone_media[o][i].id),t.dropzone_media[o].splice(i,1),t.addMediaIdsToForumsForm(a);break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?i=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?i=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(i=this.bbp_forum_edit_media),i.length)){for(var d=!1,s=0;s<i.length;s++)d=!1,t.dropzone_media[o].push({id:i[s].attachment_id,media_id:i[s].id,name:i[s].title,thumb:i[s].thumb,url:i[s].full,uuid:i[s].id,menu_order:s,saved:!0}),d={name:i[s].title,accepted:!0,kind:"image",upload:{filename:i[s].title,uuid:i[s].id},dataURL:i[s].url,id:i[s].id},t.dropzone_obj[o].files.push(d),t.dropzone_obj[o].emit("addedfile",d),t.createThumbnailFromUrl(d,a);t.addMediaIdsToForumsForm(a)}a.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e)}else t.resetForumsMediaComponent(o)}},openGroupMessagesUploader:function(e){var t=this,i=u("div#bp-group-messages-post-media-uploader"),a=[];if(e.preventDefault(),void 0!==window.Dropzone&&i.length)if(i.hasClass("closed")){if(t.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(i.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("success",function(e,i){i.data.id&&(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=t.album_id,i.data.group_id=t.group_id,i.data.saved=!1,t.dropzone_media.push(i.data),t.addMediaIdsToGroupMessagesForm())}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var i in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[i].uuid){void 0===t.dropzone_media[i].saved||t.dropzone_media[i].saved||t.removeAttachment(t.dropzone_media[i].id),t.dropzone_media.splice(i,1),t.addMediaIdsToGroupMessagesForm();break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?a=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?a=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(a=this.bbp_forum_edit_media),a.length)){for(var o=!1,d=0;d<a.length;d++)o=!1,t.dropzone_media.push({id:a[d].attachment_id,media_id:a[d].id,name:a[d].title,thumb:a[d].thumb,url:a[d].full,uuid:a[d].id,menu_order:d,saved:!0}),o={name:a[d].title,accepted:!0,kind:"image",upload:{filename:a[d].title,uuid:a[d].id},dataURL:a[d].url,id:a[d].id},t.dropzone_obj.files.push(o),t.dropzone_obj.emit("addedfile",o),t.createThumbnailFromUrl(o);t.addMediaIdsToGroupMessagesForm()}i.removeClass("closed").addClass("open"),t.resetGroupMessagesGifComponent()}else t.resetGroupMessagesMediaComponent()},addMediaIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(this.dropzone_media[i]))},createThumbnailFromUrl:function(i,e){var t=this,a=e.data("key");t.dropzone_obj[a].createThumbnailFromUrl(i,t.dropzone_obj[a].options.thumbnailWidth,t.dropzone_obj[a].options.thumbnailHeight,t.dropzone_obj[a].options.thumbnailMethod,!0,function(e){t.dropzone_obj[a].emit("thumbnail",i,e),t.dropzone_obj[a].emit("complete",i)})},openUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&u("div#media-uploader").length&&(u("#bp-media-uploader").show(),t.dropzone_obj=new Dropzone("div#media-uploader",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(i.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("queuecomplete",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,i){i.data.id&&(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_media.length,i.data.album_id=t.album_id,i.data.group_id=t.group_id,i.data.saved=!1,t.dropzone_media.push(i.data)),u("#bp-media-add-more").show(),u("#bp-media-submit").show(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var i in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[i].uuid){void 0===t.dropzone_media[i].saved||t.dropzone_media[i].saved||t.removeAttachment(t.dropzone_media[i].id),t.dropzone_media.splice(i,1);break}t.dropzone_obj.getAcceptedFiles().length?u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(u("#bp-media-uploader-modal-status-text").text(""),u("#bp-media-add-more").hide(),u("#bp-media-submit").hide())}))},removeAttachment:function(e){var i={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i})},changeUploadModalTab:function(e){e.preventDefault();var i=u(e.currentTarget).data("content");u(".bp-media-upload-tab-content").hide(),u("#"+i).show(),this.current_tab=i,u(e.currentTarget).closest("#bp-media-uploader").find(".bp-media-upload-tab").removeClass("selected"),u(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),u("#bp-media-create-album").show()},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),u("#bp-media-create-album").hide(),u("#bb-album-title").val("")},submitMedia:function(t){var e,i,a,o=this,d=u(t.currentTarget);if(t.preventDefault(),d.hasClass("saving"))return!1;d.addClass("saving"),"bp-dropzone-content"===o.current_tab?(e=u("#bp-media-post-content").val(),i={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:o.dropzone_media,content:e,album_id:o.album_id,group_id:o.group_id},u("#bp-dropzone-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){if(e.success){u("#media-stream ul.media-list").length||(u("#media-stream").html(u("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),u(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend");for(var i=0;i<o.dropzone_media.length;i++)o.dropzone_media[i].saved=!0;o.closeUploader(t),jQuery(window).scroll()}else u("#bp-dropzone-content").prepend(e.data.feedback);d.removeClass("saving")}})):"bp-existing-media-content"===o.current_tab?(a=[],u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){a.push(u(this).val())}),i={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:a,album_id:o.album_id,group_id:o.group_id},u("#bp-existing-media-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(u("#media-stream ul.media-list").length||(u("#media-stream").html(u("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),u(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest("li").data("id")===u(this).val()&&u(this).closest("li").remove()}),jQuery(window).scroll(),o.closeUploader(t)):u("#bp-existing-media-content").prepend(e.data.feedback),d.removeClass("saving")}})):o.current_tab||(o.closeUploader(t),d.removeClass("saving"))},saveAlbum:function(i){var t=u(i.currentTarget),a=this,o=u("#bb-album-title"),d=u("#bb-album-privacy");if(i.preventDefault(),""===u.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===u.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.prop("disabled",!0);var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(e.album_id=a.album_id),a.group_id&&(e.group_id=a.group_id),u(".bb-single-album-header .bp-feedback").remove(),u("#boss-media-create-album-popup .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){setTimeout(function(){t.prop("disabled",!1)},500),e.success?a.album_id?(u("#bp-single-album-title").text(o.val()),u("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(i)):(u("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):a.album_id?u("#bp-media-single-album").prepend(e.data.feedback):u("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(i){if(i.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;u(i.currentTarget).prop("disabled",!0);var e={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?window.location.href=e.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),u(i.currentTarget).prop("disabled",!1))}})},addMediaIdsToGroupMessagesForm:function(){u("#bp_group_messages_media").length&&u("#bp_group_messages_media").val(JSON.stringify(this.dropzone_media))},injectMedias:function(i){var t,a,e,o=bp.Nouveau.getStorage("bp-media"),d=o.scope||null,s=o.filter||null;u(i.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,a=this,e="",i.preventDefault(),u(i.currentTarget).find("a").first().addClass("loading"),u("#buddypress .dir-search input[type=search]").length&&(e=u("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:d,filter:s,search_terms:e,page:t,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(u(i.currentTarget).remove(),a.current_page=t,jQuery(window).scroll())}))},appendMedia:function(i){var t,a,e,o=bp.Nouveau.getStorage("bp-media"),d=o.scope||null,s=o.filter||null;u(i.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page_existing_media)+1,a=this,e="",i.preventDefault(),u(i.currentTarget).find("a").first().addClass("loading"),u("#buddypress .dir-search input[type=search]").length&&(e=u("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:d,filter:s,search_terms:e,page:t,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(e){!0===e.success&&(u(i.currentTarget).remove(),a.current_page_existing_media=t)}))},appendAlbums:function(i){var t=+Number(this.current_page_albums)+1,a=this;i.preventDefault(),u(i.currentTarget).find("a").first().addClass("loading");var e={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:t};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){!0===e.success&&(u(i.currentTarget).remove(),u("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){u("#albums-dir-list ul.bb-albums-list").append(e.data.albums),u(this).fadeIn(100)}),a.current_page_albums=t)}})},toggleSubmitMediaButton:function(){var e=u("#bp-media-submit"),i=u("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),i.show()):(e.hide(),i.hide()):"bp-existing-media-content"===this.current_tab&&(u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),i.hide())},playVideo:function(e){e.preventDefault();var i=u(e.currentTarget).find("video").get(0),t=u(e.currentTarget).find(".gif-play-button");1==i.paused?(i.play(),t.hide()):(i.pause(),t.show())},autoPlayGifVideos:function(){u(".gif-player").each(function(){var e=u(this).find("video").get(0),i=u(this).find(".gif-play-button");u(this).is(":in-viewport")?(e.play(),i.hide()):(e.pause(),i.show())})}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.current_media=!1,this.current_index=0,this.is_open=!1,this.nextLink=u(".bb-next-media"),this.previousLink=u(".bb-prev-media"),this.activity_ajax=!1},addListeners:function(){u(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),u(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),u(document).on("click",".bb-prev-media",this.previous.bind(this)),u(document).on("click",".bb-next-media",this.next.bind(this)),u(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this))},documentClick:function(e){var i,t;this.is_open&&(i=e.target,null!=(t=document.getElementById("bb-media-model-container"))&&!t.contains(i)&&document.body.contains(i)&&this.closeTheatre(e))},checkPressedKey:function(e){switch((e=e||window.event).keyCode){case 27:this.closeTheatre(e);break;case 37:this.previous(e);break;case 39:this.next(e)}},openTheatre:function(e){e.preventDefault();var i,t=u(e.currentTarget),a=this;if(t.closest("#bp-existing-media-content").length)return!1;a.setupGlobals(),a.setMedias(t),i=t.data("id"),a.setCurrentMedia(i),a.showMedia(),a.navigationCommands(),a.getActivity(),u(".bb-media-model-wrapper").show(),a.is_open=!0,document.addEventListener("keyup",a.checkPressedKey.bind(a))},closeTheatre:function(e){e.preventDefault();u(".bb-media-model-wrapper").hide(),this.is_open=!1,document.removeEventListener("keyup",this.checkPressedKey.bind(this))},setMedias:function(e){var i=u(".bb-open-media-theatre"),t=0;if(u("body").hasClass("activity")&&(i=u(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==i)for(this.medias=[],t=0;t<i.length;t++){var a,o=u(i[t]);o.closest("#bp-existing-media-content").length||(a={id:o.data("id"),attachment:o.data("attachment-full"),activity_id:o.data("activity-id"),is_forum:!1},o.closest(".forums-media-wrap").length&&(a.is_forum=!0),this.medias.push(a))}},setCurrentMedia:function(e){for(var i=this,t=0,t=0;t<i.medias.length;t++)if(e===i.medias[t].id){i.current_media=i.medias[t],i.current_index=t;break}},showMedia:function(){u(".bb-media-model-wrapper .bb-media-section").find("img").attr("src",this.current_media.attachment+"?"+(new Date).getTime()),this.navigationCommands()},next:function(e){e.preventDefault();var i,t=this;void 0!==t.medias[t.current_index+1]?(t.current_index=t.current_index+1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),i!=t.current_media.activity_id&&t.getActivity()):t.nextLink.hide()},previous:function(e){e.preventDefault();var i,t=this;void 0!==t.medias[t.current_index-1]?(t.current_index=t.current_index-1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),i!=t.current_media.activity_id&&t.getActivity()):t.previousLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},getActivity:function(){var e=this;u(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),void 0!==BP_Nouveau.activity&&e.current_media&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id&&!e.current_media.is_forum?(0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e.current_media.activity_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(u(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),u(".bb-media-info-section").show(),jQuery(window).scroll())}})):u(".bb-media-info-section").hide()},activityDeleted:function(e,i){var t=this,a=0;if(t.is_open&&void 0!==i&&"delete_activity"===i.action&&t.current_media.activity_id==i.id){for(u(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+t.current_media.id+'"]').closest("li").remove(),u(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+t.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),a=0;a<t.medias.length;a++)if(t.medias[a].activity_id==i.id){t.medias.splice(a,1);break}0==t.current_index&&t.current_index!=t.medias.length?(t.current_index=-1,t.next(e)):0==t.current_index&&t.current_index==t.medias.length?t.closeTheatre(e):t.current_index==t.medias.length?t.previous(e):(t.current_index=-1,t.next(e))}}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}((bp,jQuery));