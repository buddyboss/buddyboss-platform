window.bp=window.bp||{},function(U){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(U(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:U(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options)&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[]},addListeners:function(){U("body").hasClass("activity-singular")||U("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),U("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),U('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),U("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),U('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments),U('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments),U('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),U('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),U('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),U('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),U("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),U(document).keydown(this.commentFormAction),U(document).click(this.togglePopupDropdown),U('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),U('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),U('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this)),U('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),U(document).on("click",this.toggleActivityOption.bind(this)),_.isUndefined(BP_Nouveau.activity.params.autoload)||U(window).scroll(this.loadMoreActivities)},heartbeatSend:function(e,t){this.heartbeat_data.first_recorded=U("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0,(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),t.bp_activity_last_recorded=this.heartbeat_data.last_recorded,U("#buddypress .dir-search input[type=search]").length&&(t.bp_activity_last_recorded_search_terms=U("#buddypress .dir-search input[type=search]").val()),U.extend(t,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,t){var a,o,i=bp.Nouveau.objects,d=bp.Nouveau.getStorage("bp-activity","scope"),s=this;void 0!==t&&t.bp_activity_newest_activities&&(this.heartbeat_data.newest=U.trim(t.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(t.bp_activity_newest_activities.last_recorded),t=U(this.heartbeat_data.newest).filter(".activity-item"),a=Number(t.length),i.push("mentions"),"all"===d?(U.each(t,function(e,a){a=U(a),U.each(i,function(e,t){-1!==U.inArray("bp-my-"+t,a.get(0).classList)&&(void 0===s.heartbeat_data.highlights[t]?s.heartbeat_data.highlights[t]=[a.data("bp-activity-id")]:-1===U.inArray(a.data("bp-activity-id"),s.heartbeat_data.highlights[t])&&s.heartbeat_data.highlights[t].push(a.data("bp-activity-id")))})}),o=new RegExp("bp-my-("+i.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(o,""),U(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(a)):(this.heartbeat_data.highlights[d]=[],U.each(t,function(e,t){s.heartbeat_data.highlights[d].push(U(t).data("bp-activity-id"))})),U.each(i,function(e,t){var a;void 0!==s.heartbeat_data.highlights[t]&&s.heartbeat_data.highlights[t].length&&(a=0,"mentions"===t&&(a=s.mentions_count),U(bp.Nouveau.objectNavParent+' [data-bp-scope="'+t+'"]').find("a span").html(Number(s.heartbeat_data.highlights[t].length)+a))}),i.pop(),U(document).prop("title","("+a+") "+this.heartbeat_data.document_title),U('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")?(o=U('#buddypress [data-bp-list="activity"] .load-newest a').html(),U('#buddypress [data-bp-list="activity"] .load-newest a').html(o.replace(/([0-9]+)/,a))):U('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+a+")</a></li>"),U('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),U('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau)&&bp.Nouveau.reportPopUp()},injectActivities:function(e){var t,a,o,i,d=bp.Nouveau.getStorage("bp-activity"),s=d.scope||null,d=d.filter||null;U(e.currentTarget).hasClass("load-newest")?(e.preventDefault(),U(e.currentTarget).remove(),o=U.parseHTML(this.heartbeat_data.newest),U.each(o,function(e,t){"LI"===t.nodeName&&U(t).hasClass("just-posted")&&U("#"+U(t).prop("id")).length&&U("#"+U(t).prop("id")).remove()}),U(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===s&&U(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===s&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),U(bp.Nouveau.objectNavParent+' [data-bp-scope="'+s+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[s]&&(this.heartbeat_data.highlights[s]=[]),setTimeout(function(){U(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+s+"_activity")},3e3),U(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()):U(e.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,a=this,o="",e.preventDefault(),(i=U(e.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],U(e.delegateTarget).children(".just-posted").each(function(){a.just_posted.push(U(this).data("bp-activity-id"))}),U("#buddypress .dir-search input[type=search]").length&&(o=U("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:s,filter:d,search_terms:o,page:t,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(i.remove(),a.current_page=t,jQuery(window).scroll())}))},hideComments:function(e){var a,o,i,e=U(e.target).find(".activity-comments");e.length&&e.each(function(e,t){i=U(t).children("ul").not(".conflict-activity-ul-li-comment"),!(o=U(i).find("li").not(U(".document-action-class, .media-action-class, .video-action-class"))).length||U("body").hasClass("activity-singular")&&""!==window.location.hash&&U(window.location.hash).length&&0!==U(window.location.hash).closest(".activity-comments").length||(a=U(t).closest(".activity-item"),U("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),o.each(function(e,t){if(e<o.length-4){if(e||U(t).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>"),window.location.hash&&"#"+U(t).attr("id")===window.location.hash)return U(t).parents("li.comment-item").show(),!1;U(t).addClass("bp-hidden").hide()}}),U(i).children(".bp-hidden").length===U(i).children("li").length-1&&U(i).find("li.show-all").length&&U(i).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showComments:function(e){e.preventDefault(),U(e.target).addClass("loading"),setTimeout(function(){U(e.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){U(e.target).parent("li").remove()})},600)},scopeLoaded:function(e,a){this.hideComments(e),this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(U.each(a.response.new_mentions,function(e,t){U("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&U.each(this.heartbeat_data.highlights[a.scope],function(e,t){U("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').length&&U("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",U.each(U(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,t){0===parseInt(U(t).html(),10)&&U(t).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),U(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){U("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){var e,t;!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit&&(t=U("#activity-"+BP_Nouveau.activity.params.is_activity_edit)).length&&(e=t.data("bp-activity"),t=""!==t.data("link-url")?t.data("link-url"):null,_.isUndefined(e)||bp.Nouveau.Activity.postForm.displayEditActivityForm(e,t))},activityPrivacyChange:function(e){var t=e.data,a=U(e.target),o=U(e.currentTarget).closest(".activity-item"),i=o.data("bp-activity-id");if(e.preventDefault(),void 0===a.data("value")||""==U.trim(a.data("value")))return!1;o.find(".privacy").addClass("loading"),t.ajax({action:"activity_update_privacy",id:i,privacy:a.data("value")},"activity").done(function(e){o.find(".privacy").removeClass("loading"),!0===e.success&&(o.find(".activity-privacy li").removeClass("selected"),o.find(".privacy-wrap").attr("data-bp-tooltip",a.text()),a.addClass("selected"),o.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),o.find(".privacy").addClass(a.data("value")),void 0!==e)&&void 0!==e.data&&void 0!==e.data.video_symlink&&(U(".document-description-wrap").length&&U(".document-description-wrap .bb-open-document-theatre").length&&(U(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",e.data.video_symlink),U(".document-description-wrap .bb-open-document-theatre").attr("data-extension",e.data.extension)),U(".document-description-wrap").length&&U(".document-detail-wrap.document-detail-wrap-description-popup").length&&(U(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",e.data.video_symlink),U(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",e.data.extension)),videojs(e.data.video_js_id).src({type:e.data.video_extension,src:e.data.video_symlink}))})},activityPrivacyRedirect:function(e){var t=U(e.target);if(e.preventDefault(),void 0===t.data("value")||""==U.trim(t.data("value")))return!1;window.location.href=t.data("value")},togglePrivacyDropdown:function(e){e.data,U(e.target);var t=U(e.currentTarget).closest(".activity-item");t.data("bp-activity-id");e.preventDefault(),U("ul.activity-privacy").not(t.find(".activity-privacy")).removeClass("bb-open"),t.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var s,a,t,o,i=e.data,n=U(e.target),r=U(e.currentTarget),l=r.data("bp-activity-id"),d=U(e.delegateTarget),c=r.find(".activity-state"),p=r.find(".comments-count"),m=r.find(".like-text"),u=this;if(((n=U(n).is("span")?U(n).closest("a"):n).hasClass("fav")||n.hasClass("unfav"))&&(a=n.hasClass("fav")?"fav":"unfav",e.preventDefault(),n.addClass("loading"),i.ajax({action:"activity_mark_"+a,id:l},"activity").done(function(t){var e;n.removeClass("loading"),!1!==t.success&&(n.fadeOut(200,function(){var e;(U(this).find("span").first().length?U(this).find("span").first():U(this)).html(t.data.content),"false"===U(this).attr("aria-pressed")?U(this).attr("aria-pressed","true"):U(this).attr("aria-pressed","false"),m.length&&(t.data.like_count?m.text(t.data.like_count)&&c.addClass("has-likes"):m.empty()&&c.removeClass("has-likes"),e=U("<textarea/>").html(t.data.tooltip).text(),m.attr("data-hint",e)),U(this).find(".like-count").length&&U(this).find(".like-count").html(t.data.content),U(this).fadeIn(200)}),"fav"==a?(void 0===t.data.directory_tab||U(i.objectNavParent+' [data-bp-scope="favorites"]').length||U(i.objectNavParent+' [data-bp-scope="all"]').after(t.data.directory_tab),n.removeClass("fav"),n.addClass("unfav")):"unfav"==a&&((e=U('[data-bp-user-scope="favorites"]').hasClass("selected")||U(i.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&r.remove(),void 0!==t.data.no_favorite&&(U(i.objectNavParent+' [data-bp-scope="all"]').length&&U(i.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?U(i.objectNavParent+' [data-bp-scope="favorites"]').remove():e&&d.append(t.data.no_favorite)),n.removeClass("unfav"),n.addClass("fav")))})),n.hasClass("delete-activity")||n.hasClass("acomment-delete")||n.hasClass("spam-activity")||n.hasClass("spam-activity-comment")){var v,b,h,f,y=n.closest("[data-bp-activity-comment-id]"),g=y.data("bp-activity-comment-id"),C=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;n.addClass("loading");var w={action:"delete_activity",id:l,_wpnonce:i.getLinkParams(n.prop("href"),"_wpnonce"),is_single:n.closest("[data-bp-single]").length};(n.hasClass("spam-activity")||n.hasClass("spam-activity-comment"))&&(w.action="bp_spam_activity"),v=r,g&&(delete w.is_single,w.id=g,w.is_comment=!0,v=y),i.ajax(w,"activity").done(function(e){if(n.removeClass("loading"),!1===e.success)v.prepend(e.data.feedback),v.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;var t;e.data.parent_activity_id&&e.data.activity&&U("#buddypress #activity-stream ul.activity-list li#activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),g&&(C=1,r.append(y.find("form")),U.each(y.find("li.comment-item"),function(){C+=1}),b=c.find("span.comments-count"),h=b.text().length?b.text().match(/\d+/)[0]:0,h=Number(h-C),p.length&&(t=1<h?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,p.text(t.replace("%d",h))),(f=r.find("li.show-all a")).length&&f.html(BP_Nouveau.show_x_comments.replace("%d",h)),0===h)&&(r.removeClass("has-comments"),c.removeClass("has-comments"),p.empty()),v.slideUp(300,function(){v.remove()}),g||r.data("bp-timestamp")!==i.Activity.heartbeat_data.last_recorded||(i.Activity.heartbeat_data.newest="",i.Activity.heartbeat_data.last_recorded=0),U(document).trigger("bp_activity_ajax_delete_request",U.extend(w,{response:e})),U(document).trigger("bp_activity_ajax_delete_request_video",U.extend(w,{response:e}))}})}if(n.closest("span").hasClass("activity-read-more")){var z=n.closest("div"),N=n.closest("span"),j=null;if(U(z).hasClass("activity-inner")?j=l:U(z).hasClass("acomment-content")&&(j=n.closest("li").data("bp-activity-comment-id")),!j)return e;e.preventDefault(),U(N).addClass("loading"),i.ajax({action:"get_single_activity_content",id:j},"activity").done(function(e){"object"!=typeof e&&0<n.closest("div").find(".bb-activity-media-wrap").length&&(e=JSON.parse(e)),U(N).removeClass("loading"),z.parent().find(".bp-feedback").length&&z.parent().find(".bp-feedback").remove(),!1===e.success?(z.after(e.data.feedback),z.parent().find(".bp-feedback").hide().fadeIn(300)):(U(z).html(e.data.contents).slideDown(300),jQuery(window).scroll(),r.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB)&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+j)))})}if((n.hasClass("activity-state-comments")||n.hasClass("acomment-reply")||n.parent().hasClass("acomment-reply")||n.hasClass("acomment-edit"))&&(P=U("#ac-form-"+(j=l)),T=U('[data-bp-activity-id="'+j+'"] .activity-comments'),o=!1,n.closest(".bb-media-model-container").length&&(P=n.closest(".bb-media-model-container").find("#ac-form-"+l),T=n.closest(".bb-media-model-container").find('[data-bp-activity-id="'+j+'"] .activity-comments')),e.preventDefault(),u.resetActivityCommentForm(P),n.parent().hasClass("acomment-reply")&&n.parent(),n.closest("li").data("bp-activity-comment-id")&&(j=n.closest("li").data("bp-activity-comment-id")),n.hasClass("acomment-edit")&&n.closest("li").data("bp-activity-comment")&&(o=n.closest("li").data("bp-activity-comment")),this.toggleMultiMediaOptions(P,n),P.removeClass("root"),U(".ac-form").hide(),U.each(P.children("div"),function(e,t){U(t).hasClass("error")&&U(t).remove()}),n.hasClass("acomment-edit")&&!_.isNull(o)?((F=U('[data-bp-activity-comment-id="'+j+'"]')).find("#acomment-display-"+j).addClass("bp-hide"),F.find("#acomment-edit-form-"+j).append(P),P.addClass("acomment-edit").attr("data-item-id",j),u.editActivityCommentForm(P,o)):j===l?(T.append(P),P.addClass("root")):U('[data-bp-activity-comment-id="'+j+'"]').append(P),P.slideDown(200),F=P.find(".post-elements-buttons-item.post-emoji").prevAll().not(":hidden").length+1,P.find(".post-elements-buttons-item.post-emoji").attr("data-nth-child",F),T=P.find(".post-elements-buttons-item.post-gif").prevAll().not(":hidden").length+1,P.find(".post-elements-buttons-item.post-gif").attr("data-nth-child",T),0<(F=P.find(".ac-input[contenteditable]")).length&&(t=F.get(0),T=U(t).attr("id")+(U(t).closest(".bb-media-model-inner").length?"-theater":""),-1===U.inArray(T,u.InitiatedCommentForms)||U(t).closest("form").hasClass("events-initiated")||(F=u.InitiatedCommentForms.indexOf(T),u.InitiatedCommentForms.splice(F,1)),-1!=U.inArray(T,u.InitiatedCommentForms)||U(t).closest("form").hasClass("events-initiated")||(t.addEventListener("paste",function(e){e.preventDefault();e=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),t.addEventListener("keyup",function(e){var t=jQuery(e.currentTarget).html();z=(z=U.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==jQuery(e.currentTarget).text().trim()||0<=z.indexOf("emojioneemoji")?jQuery(e.currentTarget).closest("form").addClass("has-content"):jQuery(e.currentTarget).closest("form").removeClass("has-content")}),U(t).closest("form").addClass("events-initiated"),u.InitiatedCommentForms.push(T))),n.attr("aria-expanded","true"),F=U(window).height()/2-75,jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=300<jQuery(window).height()?200:100;jQuery("html, body").animate({scrollTop:jQuery(t).offset().top-e},500)},500):U.scrollTo(P,500,{offset:-F,easing:"swing"}),U("#ac-form-"+l+" #ac-input-"+l).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==U("#ac-input-"+l).data("emojioneArea")||(T=U("#ac-input-"+l).html(),U("#ac-input-"+l).emojioneArea({standalone:!0,hideSource:!1,container:"#ac-reply-emoji-button-"+l,autocomplete:!1,pickerPosition:"bottom",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){U("#ac-input-"+l)[0].emojioneArea.hidePicker();var e=U("#ac-form-"+l+" #ac-input-"+l),t=e.html();z=(z=U.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==e.text()||0<=z.indexOf("emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},picker_show:function(){U(this.button[0]).closest(".post-emoji").addClass("active")},picker_hide:function(){U(this.button[0]).closest(".post-emoji").removeClass("active")}}}),n.hasClass("acomment-edit")&&!_.isNull(o)&&U("#ac-input-"+l).html(T)),void 0!==window.getSelection&&void 0!==document.createRange&&n.hasClass("acomment-edit")&&!_.isNull(o)&&((F=document.createRange()).selectNodeContents(U("#ac-input-"+l)[0]),F.collapse(!1),(T=window.getSelection()).removeAllRanges(),T.addRange(F)),_.isUndefined(window.MediumEditor)||U("#ac-input-"+l).hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(U("#ac-input-"+l)[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1}))),n.hasClass("activity-state-no-comments")&&e.preventDefault(),n.hasClass("ac-reply-cancel")&&((o=U(n).closest(".ac-form")).slideUp(200),U(".acomment-reply").attr("aria-expanded","false"),u.destroyCommentMediaUploader(l),u.destroyCommentDocumentUploader(l),u.resetActivityCommentForm(o),e.preventDefault()),"ac_form_submit"===n.prop("name")){var P=n.closest("form");j=l,e.preventDefault(),n.closest("li").data("bp-activity-comment-id")&&(j=n.closest("li").data("bp-activity-comment-id"));for(var x,B=(x=U(P).find(".ac-input").first()).find("span.atwho-query"),k=0;k<B.length;k++)U(B[k]).replaceWith(B[k].innerText);x.find("img.emoji").each(function(e,t){U(t).addClass("emojioneemoji");var a=U(t).attr("alt");U(t).attr("data-emoji-char",a),U(t).removeClass("emoji")}),x.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),n.addClass("loading").prop("disabled",!0),x.addClass("loading").prop("disabled",!0);var T=x[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""),F={action:"new_activity_comment",_wpnonce_new_activity_comment:U("#_wpnonce_new_activity_comment").val(),comment_id:j,form_id:l,content:T};U("#_bp_as_nonce_"+l).val()&&(F["_bp_as_nonce_"+l]=U("#_bp_as_nonce_"+l).val()),this.dropzone_media.length&&(F.media=this.dropzone_media),this.dropzone_document.length&&(F.document=this.dropzone_document),this.dropzone_video.length&&(F.video=this.dropzone_video,_.isEmpty(F.content))&&(F.content="&#8203;"),_.isUndefined(this.models[l])||(s=this.models[l],F.gif_data=this.models[l].get("gif_data")),F.content=F.content.replace(/&nbsp;/g," "),P.hasClass("acomment-edit")&&(F.edit_comment=!0),i.ajax(F,"activity").done(function(e){if(n.removeClass("loading"),x.removeClass("loading"),U(".acomment-reply").attr("aria-expanded","false"),!1===e.success)P.append(U(e.data.feedback).hide().fadeIn(200));else{var t=P.parent(),a=U.trim(e.data.contents);if(P.fadeOut(200,function(){P.hasClass("acomment-edit")?(e=P.attr("data-item-id"),P.closest(".activity-comments").append(P),U("li#acomment-"+e).replaceWith(a)):(0===t.children("ul").length&&(t.hasClass("activity-comments")?t.prepend("<ul></ul>"):t.append("<ul></ul>")),t.children("ul").append(U(a).hide().fadeIn(200)),U(P).find(".ac-input").first().html(""),t.parent().addClass("has-comments"),t.parent().addClass("comments-loaded"),c.addClass("has-comments"));var e=t.find(".ac-reply-content");e.find(".ac-reply-toolbar .ac-reply-media-button")&&e.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find(".ac-reply-toolbar .ac-reply-document-button")&&e.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find(".ac-reply-toolbar .ac-reply-video-button")&&e.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find(".ac-reply-toolbar .ac-reply-gif-button")&&(e.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),e.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),jQuery(window).scroll()}),!P.hasClass("acomment-edit")&&(b=c.find("span.comments-count"),h=b.text().length?b.text().match(/\d+/)[0]:0,h=Number(h)+1,p.length&&(e=1<h?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,p.text(e.replace("%d",h||1))),f=U(r).find(".show-all a"))&&f.html(BP_Nouveau.show_x_comments.replace("%d",h)),u.dropzone_media.length)for(var o=0;o<u.dropzone_media.length;o++)u.dropzone_media[o].saved=!0;if(u.dropzone_document.length)for(var i=0;i<u.dropzone_document.length;i++)u.dropzone_document[i].saved=!0;if(u.dropzone_video.length)for(var d=0;d<u.dropzone_video.length;d++)u.dropzone_video[d].saved=!0}_.isUndefined(s)||(s.set("gif_data",{}),U("#ac-reply-post-gif-"+l).find(".activity-attached-gif-container").removeAttr("style")),u.destroyCommentMediaUploader(l),u.destroyCommentDocumentUploader(l),u.destroyCommentVideoUploader(l),n.prop("disabled",!1),x.prop("disabled",!1)})}n.hasClass("edit")&&n.hasClass("edit-activity")&&(e.preventDefault(),o=r.data("bp-activity"),T=""!==r.data("link-url")?r.data("link-url"):null,void 0!==o)&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(o,T),n.closest("li").hasClass("groups")?U("#bp-nouveau-activity-form").addClass("group-activity"):U("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media)&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(U(document).find(".bb-close-media-theatre").trigger("click"),U(document).find(".bb-close-document-theatre").trigger("click"))},commentFormAction:function(e){var t,a;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0!==e.altKey&&!0!==e.metaKey&&"TEXTAREA"===t.tagName&&U(t).hasClass("ac-input")?void(27===(a=e.keyCode||e.which)&&!1===e.ctrlKey?"TEXTAREA"===t.tagName&&U(t).closest("form").slideUp(200):e.ctrlKey&&13===a&&U(t).val()&&U(t).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||U(t).hasClass("privacy-wrap")||U(t).parent().hasClass("privacy-wrap")?e:void U("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e,t=U(".load-more:visible").last(),a=U(window);t.closest(".activity-list").length&&t.get(0)&&!t.data("bp-autoloaded")&&(e=t.offset().top-50,a.scrollTop()+a.height()>e)&&(t.data("bp-autoloaded",1),t.find("a").text(BP_Nouveau.activity.strings.loadingMore),t.find("a").trigger("click"))},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),U("#ac-reply-post-media-uploader-"+e).html(""),U("#ac-reply-post-media-uploader-1-"+e).html("")),this.dropzone_media=[],U("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),U("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),U("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],U("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),U("#ac-reply-document-button-"+e).removeClass("active")},destroyCommentVideoUploader:function(e){_.isNull(this.dropzone_video_obj)||(this.dropzone_video_obj.destroy(),U("#ac-reply-post-video-uploader-"+e).html("")),this.dropzone_video=[],U("#ac-reply-post-video-uploader-"+e).removeClass("open").addClass("closed"),U("#ac-reply-video-button-"+e).removeClass("active")},resetGifPicker:function(e){U("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),U("#ac-reply-gif-button-"+e).removeClass("active"),_.isUndefined(this.models[e])||(this.models[e].set("gif_data",{}),U("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsMediaUploader:function(e){var r=this,i=U(e.currentTarget),t=i.data("ac-id"),t=i.closest(".ac-reply-content").find("#ac-reply-post-media-uploader-"+t);if(e.preventDefault(),U(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(t.hasClass("open")&&!e.isCustomEvent)return void t.trigger("click")}else U(e.currentTarget).toggleClass("active");var a=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"";void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:a,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},r.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+i.data("ac-id"),a),r.dropzone_obj.on("addedfile",function(e){e.media_edit_data&&(r.dropzone_media.push(e.media_edit_data),(e=i.parents(".ac-reply-toolbar")).find(".ac-reply-media-button"))&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),r.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);a=i.parents(".ac-reply-toolbar");i.closest(".ac-form").addClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_obj.on("uploadprogress",function(e){i.closest(".ac-form").addClass("media-uploading");var t=U(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI,e=(t.style.strokeDasharray=a+" "+a,(t.style.strokeDashoffset=a)-e.upload.progress.toFixed(0)/100*a);t.style.strokeDashoffset=e}),r.dropzone_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=U(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,r.dropzone_media.push(t.data),e.previewElement.classList.add("dz-success");var a,o,i,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],o=0,i=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;o<i;o++)a=d[o],s.push(a.textContent=n);return _.isNull(r.dropzone_obj.files)||0!==r.dropzone_obj.files.length||U(r.dropzone_obj.element).removeClass("files-uploaded"),s}),r.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),r.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?U(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&U(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".comment-media-error-popup").length||U("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),i.closest(".ac-form").removeClass("media-uploading"))}),r.dropzone_obj.on("removedfile",function(e){if(r.dropzone_media.length)for(var t in r.dropzone_media)if(e.upload.uuid==r.dropzone_media[t].uuid){void 0===r.dropzone_media[t].saved||r.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_media[t].id),r.dropzone_media.splice(t,1);break}var a,o;_.isNull(r.dropzone_obj)||_.isNull(r.dropzone_obj.files)||0!==r.dropzone_obj.files.length?i.closest(".ac-form").addClass("has-content"):(a=i.parents(".ac-reply-toolbar"),(o=i.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),U(r.dropzone_obj.element).removeClass("files-uploaded"),r.validateCommentContent(o.find(".ac-textarea").children(".ac-input")))}),r.dropzone_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),t.removeClass("closed").addClass("open")):(r.dropzone_obj&&void 0!==r.dropzone_obj&&r.dropzone_obj.destroy(),r.dropzone_media=[],t.html(""),t.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentDocumentUploader(a),this.destroyCommentVideoUploader(a),t=U(e.currentTarget).data("ac-id");this.resetGifPicker(t),U(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&U(i).closest(".ac-reply-content").find(".dropzone.media-dropzone").trigger("click")},openCommentsDocumentUploader:function(e){var r=this,i=U(e.currentTarget),t=i.data("ac-id"),t=i.closest(".ac-reply-content").find("#ac-reply-post-document-uploader-"+t);if(e.preventDefault(),U(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(t.hasClass("open")&&!e.isCustomEvent)return void t.trigger("click")}else U(e.currentTarget).toggleClass("active");var a=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:a,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation},r.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+i.data("ac-id"),a),r.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&r.dropzone_document.push(e.document_edit_data);var t=e.upload.filename,t=t.substr(t.lastIndexOf(".")+1),e=(U(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+t),i.parents(".ac-reply-toolbar"));e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),r.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);a=i.parents(".ac-reply-toolbar");i.closest(".ac-form").addClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_document_obj.on("uploadprogress",function(e){i.closest(".ac-form").addClass("media-uploading");var t=U(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI,e=(t.style.strokeDasharray=a+" "+a,(t.style.strokeDashoffset=a)-e.upload.progress.toFixed(0)/100*a);t.style.strokeDashoffset=e}),r.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),r.dropzone_document_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=U(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,r.dropzone_document.push(t.data),e.previewElement.classList.add("dz-success");var a,o,i,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],o=0,i=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;o<i;o++)a=d[o],s.push(a.textContent=n);return _.isNull(r.dropzone_document_obj.files)||0!==r.dropzone_document_obj.files.length||U(r.dropzone_document_obj.element).removeClass("files-uploaded"),s}),r.dropzone_document_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?U(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&U(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".comment-document-error-popup").length||U("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-document"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),i.closest(".ac-form").removeClass("media-uploading"))}),r.dropzone_document_obj.on("removedfile",function(e){if(r.dropzone_document.length)for(var t in r.dropzone_document)if(e.upload.uuid==r.dropzone_document[t].uuid){void 0===r.dropzone_document[t].saved||r.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_document[t].id),r.dropzone_document.splice(t,1);break}var a,o;_.isNull(r.dropzone_document_obj)||_.isNull(r.dropzone_document_obj.files)||0!==r.dropzone_document_obj.files.length?i.closest(".ac-form").addClass("has-content"):(a=i.parents(".ac-reply-toolbar"),(o=i.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),U(r.dropzone_document_obj.element).removeClass("files-uploaded"),r.validateCommentContent(o.find(".ac-textarea").children(".ac-input")))}),r.dropzone_document_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),t.removeClass("closed").addClass("open")):(r.dropzone_document_obj&&r.dropzone_document_obj.destroy(),r.dropzone_document=[],t.html(""),t.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentMediaUploader(a),this.destroyCommentVideoUploader(a),t=U(e.currentTarget).data("ac-id");this.resetGifPicker(t),U(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&U(i).closest(".ac-reply-content").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var r=this,i=U(e.currentTarget),t=i.data("ac-id"),t=i.closest(".ac-reply-content").find("#ac-reply-post-video-uploader-"+t);if(e.preventDefault(),U(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(t.hasClass("open")&&!e.isCustomEvent)return void t.trigger("click")}else U(e.currentTarget).toggleClass("active");var a=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:a,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},r.dropzone_video_obj=new Dropzone("#ac-reply-post-video-uploader-"+i.data("ac-id"),a),r.dropzone_video_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);a=i.parents(".ac-reply-toolbar");i.closest(".ac-form").addClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_video_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.video.empty_video_type):t()}),r.dropzone_video_obj.on("addedfile",function(e){var t;e.video_edit_data&&(r.dropzone_video.push(e.video_edit_data),(t=i.parents(".ac-reply-toolbar")).find(".ac-reply-video-button"))&&t.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),e.dataURL&&e.video_edit_data.thumb.length?(U(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' " />'),U(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),r.dropzone_video_obj.on("uploadprogress",function(e){i.closest(".ac-form").addClass("media-uploading");var t=U(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI,o=(t.style.strokeDasharray=a+" "+a,a-e.upload.progress.toFixed(0)/100*a);e.upload.progress<=99?(U(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),t.style.strokeDashoffset=o):100===e.upload.progress&&(t.style.strokeDashoffset=a-.99*a,U(e.previewElement).find(".dz-progress-count").text("99% "+BP_Nouveau.video.i18n_strings.video_uploaded_text))}),r.dropzone_video_obj.on("success",function(e,t){if(100===e.upload.progress&&(U(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,U(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),U(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=U(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,t.data.group_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,t.data.saved=!1,t.data.js_preview=U(e.previewElement).find(".dz-video-thumbnail img").attr("src"),r.dropzone_video.push(t.data),e.previewElement.classList.add("dz-success");var a,o,i,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],o=0,i=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;o<i;o++)a=d[o],s.push(a.textContent=n);return _.isNull(r.dropzone_video_obj.files)||0!==r.dropzone_video_obj.files.length||U(r.dropzone_video_obj.element).removeClass("files-uploaded"),s}),r.dropzone_video_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?U(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&U(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".comment-video-error-popup").length||U("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-video"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e),i.closest(".ac-form").removeClass("media-uploading"))}),r.dropzone_video_obj.on("removedfile",function(e){if(r.dropzone_video.length)for(var t in r.dropzone_video)if(e.upload.uuid==r.dropzone_video[t].uuid){void 0===r.dropzone_video[t].saved||r.dropzone_video[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_video[t].id),r.dropzone_video.splice(t,1);break}var a,o;_.isNull(r.dropzone_video_obj)||_.isNull(r.dropzone_video_obj.files)||0!==r.dropzone_video_obj.files.length?i.closest(".ac-form").addClass("has-content"):(a=i.parents(".ac-reply-toolbar"),(o=i.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),U(r.dropzone_video_obj.element).removeClass("files-uploaded"),r.validateCommentContent(o.find(".ac-textarea").children(".ac-input")))}),r.dropzone_video_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(i.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),t.removeClass("closed").addClass("open")):(r.dropzone_video_obj&&r.dropzone_video_obj.destroy(),r.dropzone_video=[],t.html(""),t.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a),t=U(e.currentTarget).data("ac-id");this.resetGifPicker(t),U(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&U(i).closest(".ac-reply-content").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var t,a,e=e.currentTarget,o=U(e).next(),i=e.id.match(/\d+$/)[0],d=U("#ac-reply-post-gif-"+i),s=(o.is(":empty")&&(t=new bp.Models.ACReply,s=new bp.Views.GifMediaSearchDropdown({model:t}),a=new bp.Views.ActivityAttachedGifPreview({model:t}),o.html(s.render().el),d.html(a.render().el),this.models[i]=t),U(e).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container"));U(e).hasClass("active")&&s.length&&""==U.trim(s.html())?U(e).removeClass("active"):U(e).addClass("active"),o.toggleClass("open"),this.destroyCommentMediaUploader(i),this.destroyCommentDocumentUploader(i),this.destroyCommentVideoUploader(i)},toggleMultiMediaOptions:function(e,t){var a,o;_.isUndefined(BP_Nouveau.media)||(a=t.closest(".activity-item"),o=t.closest(".activity-item").data("bp-activity"),t.closest("li").data("bp-activity-comment")&&(o=t.closest("li").data("bp-activity-comment")),t.closest("li").hasClass("groups")||a.hasClass("groups")?(_.isUndefined(o.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o.group_video)?!1===BP_Nouveau.media.group_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===o.group_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isNull(o)||_.isUndefined(o.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(o)||_.isUndefined(o.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(o)||_.isUndefined(o.profile_video)?!1===BP_Nouveau.media.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===o.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")))},fixAtWhoActivity:function(){U(".acomment-content, .activity-content").each(function(){for(var e=U(this).find("span.atwho-query"),t=0;t<e.length;t++)U(e[t]).replaceWith(e[t].innerText)})},toggleActivityOption:function(e){!U(e.target).hasClass("bb-activity-more-options-action")&&!U(e.target).parent().hasClass("bb-activity-more-options-action")||U(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").hasClass("is_visible")?U(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible"):(U(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible"),U(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").addClass("is_visible"))},navigateToSpecificComment:function(){setTimeout(function(){var e,t;window.location.hash&&(e=window.location.hash,t=0!==U("#wpadminbar").length?U("#wpadminbar").innerHeight():0,0<U(e).length)&&U("html, body").animate({scrollTop:parseInt(U(e).offset().top)-(80+t)},0)},200)},createThumbnailFromUrl:function(t){var a=this;a.dropzone_obj.createThumbnailFromUrl(t,a.dropzone_obj.options.thumbnailWidth,a.dropzone_obj.options.thumbnailHeight,a.dropzone_obj.options.thumbnailMethod,!0,function(e){a.dropzone_obj.emit("thumbnail",t,e),a.dropzone_obj.emit("complete",t)})},editActivityCommentForm:function(e,t){var a,o,i=e.find('input[name="comment_form_id"]').val(),d=e.find("#ac-reply-toolbar-"+i),s=e.find('input[name="ac_form_submit"]'),n=this,r=(e.find("#ac-input-"+i).html(t.content),s.attr("data-add-edit-label"));if(s.attr("data-add-edit-label",s.val()).val(r),void 0!==t.media&&0<t.media.length){d.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentDocumentUploader(d),n.disabledCommentVideoUploader(d),n.disabledCommentGifPicker(d);for(var l=t.media.length,c=0;c<l;c++){var p={},p=0<parseInt(t.id)?{id:t.media[c].attachment_id,media_id:t.media[c].id,name:t.media[c].name,thumb:t.media[c].thumb,url:t.media[c].url,uuid:t.media[c].attachment_id,menu_order:t.media[c].menu_order,album_id:t.media[c].album_id,group_id:t.media[c].group_id,saved:!0}:{id:t.media[c].id,name:t.media[c].name,thumb:t.media[c].thumb,url:t.media[c].url,uuid:t.media[c].id,menu_order:t.media[c].menu_order,album_id:t.media[c].album_id,group_id:t.media[c].group_id,saved:!1};p={name:t.media[c].name,accepted:!0,kind:"image",upload:{filename:t.media[c].name,uuid:t.media[c].attachment_id},dataURL:t.media[c].url,id:t.media[c].attachment_id,media_edit_data:p},n.dropzone_obj&&(n.dropzone_obj.files.push(p),n.dropzone_obj.emit("addedfile",p),n.createThumbnailFromUrl(p),n.dropzone_obj.emit("dz-success"),n.dropzone_obj.emit("dz-complete"))}}if(void 0!==t.document&&0<t.document.length){d.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentMediaUploader(d),n.disabledCommentVideoUploader(d),n.disabledCommentGifPicker(d);for(var m=t.document.length,u=0;u<m;u++){var v={},v=0<parseInt(t.id)?{id:t.document[u].doc_id,name:t.document[u].full_name,full_name:t.document[u].full_name,type:"document",url:t.document[u].url,size:t.document[u].size,uuid:t.document[u].doc_id,document_id:t.document[u].id,menu_order:t.document[u].menu_order,folder_id:t.document[u].folder_id,group_id:t.document[u].group_id,saved:!0,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon}:{id:t.document[u].id,name:t.document[u].full_name,full_name:t.document[u].full_name,type:"document",url:t.document[u].url,size:t.document[u].size,uuid:t.document[u].id,menu_order:t.document[u].menu_order,folder_id:t.document[u].folder_id,group_id:t.document[u].group_id,saved:!1,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon};v={name:t.document[u].full_name,size:t.document[u].size,accepted:!0,kind:"file",upload:{filename:t.document[u].full_name,uuid:t.document[u].doc_id},dataURL:t.document[u].url,id:t.document[u].doc_id,document_edit_data:v,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon},n.dropzone_document_obj&&(n.dropzone_document_obj.files.push(v),n.dropzone_document_obj.emit("addedfile",v),n.dropzone_document_obj.emit("complete",v))}}if(void 0!==t.video&&0<t.video.length){d.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentMediaUploader(d),n.disabledCommentDocumentUploader(d),n.disabledCommentGifPicker(d);for(var b=t.video.length,h=0;h<b;h++){var f={},f=0<parseInt(t.id)?{id:t.video[h].vid_id,name:t.video[h].name,type:"video",thumb:t.video[h].thumb,url:t.video[h].url,size:t.video[h].size,uuid:t.video[h].vid_id,video_id:t.video[h].id,menu_order:t.video[h].menu_order,album_id:t.video[h].album_id,group_id:t.video[h].group_id,saved:!0}:{id:t.video[h].id,name:t.video[h].name,type:"video",thumb:t.video[h].thumb,url:t.video[h].url,size:t.video[h].size,uuid:t.video[h].id,menu_order:t.video[h].menu_order,album_id:t.video[h].album_id,group_id:t.video[h].group_id,saved:!1};f={name:t.video[h].name,size:t.video[h].size,accepted:!0,kind:"file",upload:{filename:t.video[h].name,uuid:t.video[h].vid_id},dataURL:t.video[h].url,id:t.video[h].vid_id,video_edit_data:f},console.log(f),console.log(n.dropzone_video_obj),n.dropzone_video_obj&&(n.dropzone_video_obj.files.push(f),n.dropzone_video_obj.emit("addedfile",f),n.dropzone_video_obj.emit("complete",f))}}void 0!==t.gif&&0<Object.keys(t.gif).length&&(s=d.find(".ac-reply-gif-button").next(),r=U("#ac-reply-post-gif-"+i),d.find(".ac-reply-gif-button").trigger("click"),n.disabledCommentMediaUploader(d),n.disabledCommentDocumentUploader(d),n.disabledCommentVideoUploader(d),d=new bp.Models.ACReply,a=new bp.Views.GifMediaSearchDropdown({model:d}),o=new bp.Views.ActivityAttachedGifPreview({model:d}),a.model.set("gif_data",t.gif),s.html(a.render().el),r.html(o.render().el),this.models[i]=d),void 0===t.media&&void 0===t.document&&void 0===t.video&&void 0===t.gif&&e.find(".ac-reply-toolbar .post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e){var t,a,o,i;e.hasClass("acomment-edit")&&(t=e.find('input[name="comment_form_id"]').val(),a=e.attr("data-item-id"),i=U('[data-bp-activity-comment-id="'+a+'"]'),o=e.find('input[name="ac_form_submit"]'),i.find("#acomment-display-"+a).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),i=o.attr("data-add-edit-label"),o.attr("data-add-edit-label",o.val()).val(i),e.find("#ac-input-"+t).html(""),e.removeClass("has-content"),this.destroyCommentMediaUploader(t),this.destroyCommentDocumentUploader(t),this.destroyCommentVideoUploader(t),this.resetGifPicker(t))},disabledCommentMediaUploader:function(e){e.find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentDocumentUploader:function(e){e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentVideoUploader:function(e){e.find(".ac-reply-video-button")&&e.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentGifPicker:function(e){e.find(".ac-reply-gif-button")&&e.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")},validateCommentContent:function(e){var t=e.html(),t=(t=U.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," ");""!==e.text().trim()||0<=t.indexOf("emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")}},bp.Nouveau.Activity.start())}((bp,jQuery));