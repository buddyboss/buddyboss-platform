window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(t(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:t(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.models=[]},addListeners:function(){t("body").hasClass("activity-singular")||t("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),t("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),t("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),t('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments),t('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments),t('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),t("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t(document).keydown(this.commentFormAction),t(document).click(this.togglePopupDropdown),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),_.isUndefined(BP_Nouveau.activity.params.autoload)||t(window).scroll(this.loadMoreActivities)},heartbeatSend:function(e,a){this.heartbeat_data.first_recorded=t("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0,(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),a.bp_activity_last_recorded=this.heartbeat_data.last_recorded,t("#buddypress .dir-search input[type=search]").length&&(a.bp_activity_last_recorded_search_terms=t("#buddypress .dir-search input[type=search]").val()),t.extend(a,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,a){var i,o,d=bp.Nouveau.objects,s=bp.Nouveau.getStorage("bp-activity","scope"),n=this;if(void 0!==a&&a.bp_activity_newest_activities){if(this.heartbeat_data.newest=t.trim(a.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(a.bp_activity_newest_activities.last_recorded),o=t(this.heartbeat_data.newest).filter(".activity-item"),i=Number(o.length),d.push("mentions"),"all"===s){t.each(o,function(e,a){a=t(a),t.each(d,function(e,i){-1!==t.inArray("bp-my-"+i,a.get(0).classList)&&(void 0===n.heartbeat_data.highlights[i]?n.heartbeat_data.highlights[i]=[a.data("bp-activity-id")]:-1===t.inArray(a.data("bp-activity-id"),n.heartbeat_data.highlights[i])&&n.heartbeat_data.highlights[i].push(a.data("bp-activity-id")))})});var r=new RegExp("bp-my-("+d.join("|")+")","g");this.heartbeat_data.newest=this.heartbeat_data.newest.replace(r,""),t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(i)}else this.heartbeat_data.highlights[s]=[],t.each(o,function(e,a){n.heartbeat_data.highlights[s].push(t(a).data("bp-activity-id"))});if(t.each(d,function(e,a){if(void 0!==n.heartbeat_data.highlights[a]&&n.heartbeat_data.highlights[a].length){var i=0;"mentions"===a&&(i=n.mentions_count),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+a+'"]').find("a span").html(Number(n.heartbeat_data.highlights[a].length)+i)}}),d.pop(),t(document).prop("title","("+i+") "+this.heartbeat_data.document_title),t('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")){var l=t('#buddypress [data-bp-list="activity"] .load-newest a').html();t('#buddypress [data-bp-list="activity"] .load-newest a').html(l.replace(/([0-9]+)/,i))}else t('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+i+")</a></li>");t('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),t('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp()}},injectActivities:function(e){var a=bp.Nouveau.getStorage("bp-activity"),i=a.scope||null,o=a.filter||null;if(t(e.currentTarget).hasClass("load-newest")){e.preventDefault(),t(e.currentTarget).remove();var d=t.parseHTML(this.heartbeat_data.newest);t.each(d,function(e,a){"LI"===a.nodeName&&t(a).hasClass("just-posted")&&t("#"+t(a).prop("id")).length&&t("#"+t(a).prop("id")).remove()}),t(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===i&&t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===i&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+i+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[i]&&(this.heartbeat_data.highlights[i]=[]),setTimeout(function(){t(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+i+"_activity")},3e3),t(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()}else if(t(e.currentTarget).hasClass("load-more")){var s=1*Number(this.current_page)+1,n=this,r="";e.preventDefault();var l=t(e.currentTarget);l.find("a").first().addClass("loading"),this.just_posted=[],t(e.delegateTarget).children(".just-posted").each(function(){n.just_posted.push(t(this).data("bp-activity-id"))}),t("#buddypress .dir-search input[type=search]").length&&(r=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:i,filter:o,search_terms:r,page:s,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(l.remove(),n.current_page=s,jQuery(window).scroll())})}},hideComments:function(e){var a,i,o,d=t(e.target).find(".activity-comments");d.length&&d.each(function(e,d){o=t(d).children("ul").not(".conflict-activity-ul-li-comment"),(i=t(o).find("li").not(t(".document-action-class, .media-action-class"))).length&&(a=t(d).closest(".activity-item"),t("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html()||" ",i.each(function(e,o){e<i.length-4&&(t(o).addClass("bp-hidden").hide(),e||t(o).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>"))}),t(o).children(".bp-hidden").length===t(o).children("li").length-1&&t(o).find("li.show-all").length&&t(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showComments:function(e){e.preventDefault(),t(e.target).addClass("loading"),setTimeout(function(){t(e.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){t(e.target).parent("li").remove()})},600)},scopeLoaded:function(e,a){this.hideComments(e),this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(t.each(a.response.new_mentions,function(e,a){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+a+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&t.each(this.heartbeat_data.highlights[a.scope],function(e,i){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').length&&t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",t.each(t(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,a){0===parseInt(t(a).html(),10)&&t(a).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),t(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){t("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){if(!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit){var e=t("#activity-"+BP_Nouveau.activity.params.is_activity_edit);if(e.length){var a=e.data("bp-activity");_.isUndefined(a)||bp.Nouveau.Activity.postForm.displayEditActivityForm(a)}}},activityPrivacyChange:function(e){var a=e.data,i=t(e.target),o=t(e.currentTarget).closest(".activity-item"),d=o.data("bp-activity-id");if(e.preventDefault(),void 0===i.data("value")||""==t.trim(i.data("value")))return!1;o.find(".privacy").addClass("loading"),a.ajax({action:"activity_update_privacy",id:d,privacy:i.data("value")},"activity").done(function(e){o.find(".privacy").removeClass("loading"),!0===e.success&&(o.find(".activity-privacy li").removeClass("selected"),o.find(".privacy-wrap").attr("data-bp-tooltip",i.text()),i.addClass("selected"),o.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),o.find(".privacy").addClass(i.data("value")))})},activityPrivacyRedirect:function(e){var a=t(e.target);if(e.preventDefault(),void 0===a.data("value")||""==t.trim(a.data("value")))return!1;window.location.href=a.data("value")},togglePrivacyDropdown:function(e){e.data,t(e.target);var a=t(e.currentTarget).closest(".activity-item");a.data("bp-activity-id");e.preventDefault(),t("ul.activity-privacy").not(a.find(".activity-privacy")).removeClass("bb-open"),a.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var a,i,o,d=e.data,s=t(e.target),n=t(e.currentTarget),r=n.data("bp-activity-id"),l=t(e.delegateTarget),c=n.find(".activity-state"),p=n.find(".comments-count"),m=n.find(".like-text"),u=this;if(t(s).is("span")&&(s=t(s).closest("a")),s.hasClass("fav")||s.hasClass("unfav")){var v=s.hasClass("fav")?"fav":"unfav";e.preventDefault(),s.addClass("loading"),d.ajax({action:"activity_mark_"+v,id:r},"activity").done(function(e){if(s.removeClass("loading"),!1!==e.success)if(s.fadeOut(200,function(){if(t(this).find("span").first().length?t(this).find("span").first().html(e.data.content):t(this).html(e.data.content),"false"===t(this).attr("aria-pressed")?t(this).attr("aria-pressed","true"):t(this).attr("aria-pressed","false"),m.length){e.data.like_count?m.text(e.data.like_count)&&c.addClass("has-likes"):m.empty()&&c.removeClass("has-likes");var a=t("<textarea/>").html(e.data.tooltip).text();m.attr("data-hint",a)}t(this).find(".like-count").length&&t(this).find(".like-count").html(e.data.content),t(this).fadeIn(200)}),"fav"===v)void 0!==e.data.directory_tab&&(t(d.objectNavParent+' [data-bp-scope="favorites"]').length||t(d.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab)),s.removeClass("fav"),s.addClass("unfav");else if("unfav"===v){var a=t('[data-bp-user-scope="favorites"]').hasClass("selected")||t(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected");a&&n.remove(),void 0!==e.data.no_favorite&&(t(d.objectNavParent+' [data-bp-scope="all"]').length&&t(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?t(d.objectNavParent+' [data-bp-scope="favorites"]').remove():a&&l.append(e.data.no_favorite)),s.removeClass("unfav"),s.addClass("fav")}})}if(s.hasClass("delete-activity")||s.hasClass("acomment-delete")||s.hasClass("spam-activity")||s.hasClass("spam-activity-comment")){var b,h,f,y,g=s.closest("[data-bp-activity-comment-id]"),C=g.data("bp-activity-comment-id"),w=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;s.addClass("loading");var N={action:"delete_activity",id:r,_wpnonce:d.getLinkParams(s.prop("href"),"_wpnonce"),is_single:s.closest("[data-bp-single]").length};(s.hasClass("spam-activity")||s.hasClass("spam-activity-comment"))&&(N.action="bp_spam_activity"),b=n,C&&(delete N.is_single,N.id=C,N.is_comment=!0,b=g),d.ajax(N,"activity").done(function(e){if(s.removeClass("loading"),!1===e.success)b.prepend(e.data.feedback),b.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;if(C){if(w=1,n.append(g.find("form")),t.each(g.find("li.comment-item"),function(){w+=1}),h=c.find("span.comments-count"),f=h.text().length?h.text().match(/\d+/)[0]:0,f=Number(f-w),p.length){var a=f>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(a.replace("%d",f))}(y=n.find("li.show-all a")).length&&y.html(BP_Nouveau.show_x_comments.replace("%d",f)),0===f&&(n.removeClass("has-comments"),c.removeClass("has-comments"),p.empty())}b.slideUp(300,function(){b.remove()}),C||n.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),t(document).trigger("bp_activity_ajax_delete_request",t.extend(N,{response:e}))}})}if(s.closest("span").hasClass("activity-read-more")){var P=s.closest("div"),j=s.closest("span");if(a=null,t(P).hasClass("activity-inner")?a=r:t(P).hasClass("acomment-content")&&(a=s.closest("li").data("bp-activity-comment-id")),!a)return e;e.preventDefault(),t(j).addClass("loading"),d.ajax({action:"get_single_activity_content",id:a},"activity").done(function(e){"object"!=typeof e&&s.closest("div").find(".bb-activity-media-wrap").length>0&&(e=JSON.parse(e)),t(j).removeClass("loading"),P.parent().find(".bp-feedback").length&&P.parent().find(".bp-feedback").remove(),!1===e.success?(P.after(e.data.feedback),P.parent().find(".bp-feedback").hide().fadeIn(300)):(t(P).html(e.data.contents).slideDown(300),jQuery(window).scroll(),n.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+a))))})}if(s.hasClass("activity-state-comments")||s.hasClass("acomment-reply")||s.parent().hasClass("acomment-reply")){a=r,i=t("#ac-form-"+r);var z=t('[data-bp-activity-id="'+a+'"] .activity-comments');s.closest(".bb-media-model-container").length&&(i=s.closest(".bb-media-model-container").find("#ac-form-"+r),z=s.closest(".bb-media-model-container").find('[data-bp-activity-id="'+a+'"] .activity-comments')),e.preventDefault(),s.parent().hasClass("acomment-reply")&&s.parent(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id")),this.toggleMultiMediaOptions(i,s),i.removeClass("root"),t(".ac-form").hide(),t.each(i.children("div"),function(e,a){t(a).hasClass("error")&&t(a).remove()}),a===r?(z.append(i),i.addClass("root")):t('[data-bp-activity-comment-id="'+a+'"]').append(i),i.slideDown(200),s.attr("aria-expanded","true"),t.scrollTo(i,500,{offset:-100,easing:"swing"}),t("#ac-form-"+r+" #ac-input-"+r).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==t("#ac-input-"+r).data("emojioneArea")||t("#ac-input-"+r).emojioneArea({standalone:!0,hideSource:!1,container:"#ac-reply-emoji-button-"+r,autocomplete:!1,pickerPosition:"bottom",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){t("#ac-input-"+r)[0].emojioneArea.hidePicker()}}})}if(s.hasClass("ac-reply-cancel")&&(t(s).closest(".ac-form").slideUp(200),t(".acomment-reply").attr("aria-expanded","false"),u.destroyCommentMediaUploader(r),u.destroyCommentDocumentUploader(r),e.preventDefault()),"ac_form_submit"===s.prop("name")){var B,k;i=s.closest("form"),a=r,e.preventDefault(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id"));for(var x=(B=t(i).find(".ac-input").first()).find("span.atwho-query"),T=0;T<x.length;T++)t(x[T]).replaceWith(x[T].innerText);B.find("img.emoji").each(function(e,a){t(a).addClass("emojioneemoji");var i=t(a).attr("alt");t(a).attr("data-emoji-char",i),t(a).removeClass("emoji")}),B.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),s.addClass("loading").prop("disabled",!0),B.addClass("loading").prop("disabled",!0);var A=B[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"");k={action:"new_activity_comment",_wpnonce_new_activity_comment:t("#_wpnonce_new_activity_comment").val(),comment_id:a,form_id:r,content:A},t("#_bp_as_nonce_"+r).val()&&(k["_bp_as_nonce_"+r]=t("#_bp_as_nonce_"+r).val()),this.dropzone_media.length&&(k.media=this.dropzone_media,_.isEmpty(k.content)&&(k.content=" ")),this.dropzone_document.length&&(k.document=this.dropzone_document,_.isEmpty(k.content)&&(k.content=" ")),_.isUndefined(this.models[r])||(o=this.models[r],k.gif_data=this.models[r].get("gif_data"),_.isEmpty(k.content)&&(k.content=" ")),d.ajax(k,"activity").done(function(e){if(s.removeClass("loading"),B.removeClass("loading"),t(".acomment-reply").attr("aria-expanded","false"),!1===e.success)i.append(t(e.data.feedback).hide().fadeIn(200));else{var a=i.parent(),d=t.trim(e.data.contents);if(i.fadeOut(200,function(){0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>")),a.children("ul").append(t(d).hide().fadeIn(200)),t(i).find(".ac-input").first().html(""),a.parent().addClass("has-comments"),a.parent().addClass("comments-loaded"),c.addClass("has-comments");var e=a.find(".ac-reply-content");e.find(".ac-reply-toolbar .ac-reply-media-button")&&e.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find(".ac-reply-toolbar .ac-reply-document-button")&&e.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find(".ac-reply-toolbar .ac-reply-gif-button")&&e.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),jQuery(window).scroll()}),h=c.find("span.comments-count"),f=h.text().length?h.text().match(/\d+/)[0]:0,f=Number(f)+1,p.length){var l=f>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(l.replace("%d",f||1))}if((y=t(n).find(".show-all a"))&&y.html(BP_Nouveau.show_x_comments.replace("%d",f)),u.dropzone_media.length)for(var m=0;m<u.dropzone_media.length;m++)u.dropzone_media[m].saved=!0;if(u.dropzone_document.length)for(var v=0;v<u.dropzone_document.length;v++)u.dropzone_document[v].saved=!0}_.isUndefined(o)||(o.set("gif_data",{}),t("#ac-reply-post-gif-"+r).find(".activity-attached-gif-container").removeAttr("style")),u.destroyCommentMediaUploader(r),u.destroyCommentDocumentUploader(r),s.prop("disabled",!1),B.prop("disabled",!1)})}if(s.hasClass("edit")&&s.hasClass("edit-activity")){e.preventDefault();var D=n.data("bp-activity");void 0!==D&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(D),s.closest("li").hasClass("groups")?t("#bp-nouveau-activity-form").addClass("group-activity"):t("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(t(document).find(".bb-close-media-theatre").trigger("click"),t(document).find(".bb-close-document-theatre").trigger("click")))}},commentFormAction:function(e){var a,i;return(e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:"TEXTAREA"===a.tagName&&t(a).hasClass("ac-input")?void(27===(i=e.keyCode?e.keyCode:e.which)&&!1===e.ctrlKey?"TEXTAREA"===a.tagName&&t(a).closest("form").slideUp(200):e.ctrlKey&&13===i&&t(a).val()&&t(a).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var a;return(e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:t(a).hasClass("privacy-wrap")||t(a).parent().hasClass("privacy-wrap")?e:void t("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e=t(".load-more:visible").last(),a=t(window);if(e.closest(".activity-list").length&&e.get(0)&&!e.data("bp-autoloaded")){var i=e.offset().top-50;a.scrollTop()+a.height()>i&&(e.data("bp-autoloaded",1),e.find("a").text(BP_Nouveau.activity.strings.loadingMore),e.find("a").trigger("click"))}},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),t("#ac-reply-post-media-uploader-"+e).html(""),t("#ac-reply-post-media-uploader-1-"+e).html("")),this.dropzone_media=[],t("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),t("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],t("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-document-button-"+e).removeClass("active")},resetGifPicker:function(e){(t("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),t("#ac-reply-gif-button-"+e).removeClass("active"),_.isUndefined(this.models[e]))||(this.models[e].set("gif_data",{}),t("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsMediaUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),d=i.closest(".ac-reply-content").find("#ac-reply-post-media-uploader-"+o);e.preventDefault(),t(e.currentTarget).toggleClass("active"),void 0!==window.Dropzone&&d.length&&(d.hasClass("closed")?(a.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+i.data("ac-id"),a.dropzone_options),a.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click")}),a.dropzone_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_media.push(i.data),e.previewElement.classList.add("dz-success");var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),r=[],d=0,s=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<s;d++)o=n[d],r.push(o.textContent=l);return r}),a.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):(jQuery(".comment-media-error-popup").length||t("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var t in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[t].uuid){void 0===a.dropzone_media[t].saved||a.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_media[t].id),a.dropzone_media.splice(t,1);break}if(!_.isNull(a.dropzone_obj)&&!_.isNull(a.dropzone_obj.files)&&0===a.dropzone_obj.files.length){var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}),d.removeClass("closed").addClass("open")):(a.dropzone_obj&&void 0!==a.dropzone_obj&&a.dropzone_obj.destroy(),a.dropzone_media=[],d.html(""),d.addClass("closed").removeClass("open")));var s=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(s);var n=t(e.currentTarget).data("ac-id");this.resetGifPicker(n)},openCommentsDocumentUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),d=i.closest(".ac-reply-content").find("#ac-reply-post-document-uploader-"+o);if(e.preventDefault(),t(e.currentTarget).toggleClass("active"),void 0!==window.Dropzone&&d.length)if(d.hasClass("closed")){var s={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded};a.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+i.data("ac-id"),s),a.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click")}),a.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_document_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_document.push(i.data),e.previewElement.classList.add("dz-success");var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),r=[],d=0,s=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<s;d++)o=n[d],r.push(o.textContent=l);return r}),a.dropzone_document_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):(jQuery(".comment-document-error-popup").length||t("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-document"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),a.dropzone_document_obj.on("removedfile",function(e){if(a.dropzone_document.length)for(var t in a.dropzone_document)if(e.upload.uuid==a.dropzone_document[t].uuid){void 0===a.dropzone_document[t].saved||a.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_document[t].id),a.dropzone_document.splice(t,1);break}if(!_.isNull(a.dropzone_obj)&&!_.isNull(a.dropzone_obj.files)&&0===a.dropzone_obj.files.length){var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}),d.removeClass("closed").addClass("open")}else a.dropzone_document_obj&&a.dropzone_document_obj.destroy(),a.dropzone_document=[],d.html(""),d.addClass("closed").removeClass("open");var n=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(n);var r=t(e.currentTarget).data("ac-id");this.resetGifPicker(r)},openGifPicker:function(e){e.preventDefault();var a=e.currentTarget,i=t(a).next(),o=a.id.match(/\d+$/)[0],d=t("#ac-reply-post-gif-"+o);if(i.is(":empty")){var s=new bp.Models.ACReply,n=new bp.Views.GifMediaSearchDropdown({model:s}),r=new bp.Views.ActivityAttachedGifPreview({model:s});i.html(n.render().el),d.html(r.render().el),this.models[o]=s}var l=t(a).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container");t(a).hasClass("active")&&l.length&&""==t.trim(l.html())?t(a).removeClass("active"):t(a).addClass("active"),i.toggleClass("open"),this.destroyCommentMediaUploader(o),this.destroyCommentDocumentUploader(o)},toggleMultiMediaOptions:function(e,t){if(!_.isUndefined(BP_Nouveau.media)){var a=t.closest(".activity-item"),i=t.closest(".activity-item").data("bp-activity");t.closest("li").hasClass("groups")||a.hasClass("groups")?(_.isUndefined(i.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isUndefined(i.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled"))}},fixAtWhoActivity:function(){t(".acomment-content, .activity-content").each(function(){for(var e=t(this).find("span.atwho-query"),a=0;a<e.length;a++)t(e[a]).replaceWith(e[a].innerText)})}},bp.Nouveau.Activity.start())}(bp,jQuery);
