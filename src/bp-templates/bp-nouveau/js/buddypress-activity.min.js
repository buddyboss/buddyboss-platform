window.bp=window.bp||{},(q=>{"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(q(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:q(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options)&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[],this.activityHasUpdates=!1,this.currentActivityId=null,this.activityPinHasUpdates=!1},addListeners:function(){q("body").hasClass("activity-singular")||q("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),q("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),q(".actvity-head-bar").length&&(q(".actvity-head-bar").addClass("activity-head-bar").removeClass("actvity-head-bar"),q(".activity-head-bar > nav.activity-type-navs").length)&&q(".activity-head-bar .bb-subnav-filters-filtering").length&&q(".activity-head-bar > nav.activity-type-navs").remove(),q('#buddypress [data-bp-list="activity"]:not( #bb-schedule-posts_modal [data-bp-list="activity"] )').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),void 0!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request?q("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)):q(window).on("load",function(){setTimeout(function(){bp.Nouveau.Activity.openEditActivityPopup()}.bind(this),0)}),q("#activity-stream").on("click",".acomments-view-more",this.showActivity),q("body").on("click",".bb-close-action-popup",this.closeActivity),q(document).on("activityModalOpened",function(e,t){var a=t.activityId;q(document).on("click",".bb-activity-model-wrapper.activity-theatre",function(e){!(0<q("#activity-modal:visible").length&&0===q("#bp-nouveau-activity-form-placeholder:visible").length)||q(e.target).closest("#activity-modal").length||q(e.target).closest(".gif-media-search-dropdown-standalone").length||q(e.target).closest(".emojionearea-theatre").length||q(e.target).hasClass("dz-hidden-input")||(this.closeActivity(e),this.activitySyncOnModalClose(e,a))}.bind(this))}.bind(this)),q('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),q('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),q('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),q('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),q("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),q(".bb-activity-model-wrapper").on("click",".ac-form-placeholder",bp.Nouveau,this.activityRootComment.bind(this)),q(document).keydown(this.commentFormAction),q(document).click(this.togglePopupDropdown),q('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),q('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),q('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this)),q('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal .activity-list, .bb-modal-activity-footer').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),q(document).on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),q(document).on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(BP_Nouveau.activity.params.autoload)||q(window).scroll(this.loadMoreActivities),q(document).on("click",".bb-subnav-filters-container .subnav-filters-opener",this.openActivityFilter.bind(this)),q(document).on("click",this.closeActivityFilter.bind(this)),q(document).on("click",".bb-subnav-filters-container .subnav-filters-modal a",this.filterActivity.bind(this)),q(".bb-activity-model-wrapper, .bb-media-model-wrapper").on("click",".acomments-view-more",this.viewMoreComments.bind(this)),q(document).on("click","#activity-stream .activity-comments .view-more-comments, #activity-stream .activity-state-comments > .comments-count",function(e){e.preventDefault(),q(this).parents("li.activity-item").find(".activity-comments > ul > li.acomments-view-more, .activity-comments > .activity-actions > ul > li.acomments-view-more").trigger("click")}),q("#activity-modal > .bb-modal-activity-body").on("scroll",this.autoloadMoreComments.bind(this)),q("#activity-modal > .bb-modal-activity-body").on("scroll",this.discardGifEmojiPicker.bind(this)),q(".bb-activity-model-wrapper .bb-model-close-button").on("click",this.activitySyncOnModalClose.bind(this)),void 0!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request?q("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',function(){setTimeout(function(){q(".ac-form.not-initialized").each(function(){var e=q(this),t=e.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(e,t)})},1e3)}):setTimeout(function(){q(".ac-form.not-initialized").each(function(){var e=q(this),t=e.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(e,t)})},1e3),bp.Nouveau.wrapNavigation(".activity-topic-selector ul",120)},heartbeatSend:function(e,t){q(bp.Nouveau.objectNavParent+" [data-bp-orderby=date_updated].selected").length?void 0!==(a=q("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first()).data("bb-updated-timestamp")?this.heartbeat_data.first_recorded=a.data("bb-updated-timestamp"):a.length&&void 0!==a.data("bp-activity").date_updated&&""!==a.data("bp-activity").date_updated?(o=a.data("bp-activity").date_updated,o=new Date(o.replace(" ","T")+"Z").getTime()/1e3,this.heartbeat_data.first_recorded=o):this.heartbeat_data.first_recorded=a.data("bp-timestamp")||0:this.heartbeat_data.first_recorded=q("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first().data("bp-timestamp")||0;var a,i,o=q("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0;o>this.heartbeat_data.first_recorded&&(this.heartbeat_data.first_recorded=o),(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),t.bp_activity_last_recorded=this.heartbeat_data.last_recorded,q("#buddypress .activity-head-bar .activity-search input[type=search]").length&&(t.bp_activity_last_recorded_search_terms=q("#buddypress .activity-head-bar .activity-search input[type=search]").val()),q.extend(t,{bp_heartbeat:(a={scope:"all"},q("body.my-activity:not(.activity-singular)").length?a=bp.Nouveau.getStorage("bp-user-activity")||{scope:"just-me"}:(a=bp.Nouveau.getStorage("bp-activity")||{scope:"all"},q("body.activity.buddypress.groups.single-item").length&&(a.scope="all")),q(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length&&(i=q(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope"),void 0!==a.scope&&a.scope===i||(a.scope=i,"undefined"!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request&&(q("body.my-activity:not(.activity-singular)").length?bp.Nouveau.setStorage("bp-user-activity","scope",i):bp.Nouveau.setStorage("bp-activity","scope",i)))),q(bp.Nouveau.objectNavParent+" [data-bp-order].selected").length&&(i=q(bp.Nouveau.objectNavParent+" [data-bp-order].selected").data("bp-orderby"),a.order_by=i),(i=bp.Nouveau.getStorage("bp-activity","topic_id"))&&(t.bp_heartbeat=t.bp_heartbeat||{},t.bp_heartbeat.topic_id=i),a)})},heartbeatTick:function(e,t){var a,i,o=bp.Nouveau.objects,d=bp.Nouveau.getStorage("bp-activity","scope"),s=this,n=bp.Nouveau.getStorage("bp-activity","topic_id");void 0!==t&&t.bp_activity_newest_activities&&(this.heartbeat_data.newest=q.trim(t.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(t.bp_activity_newest_activities.last_recorded),t=q(this.heartbeat_data.newest).filter(".activity-item"),n&&(a=(t=t.filter(function(){var e=this.dataset.bpActivity?JSON.parse(this.dataset.bpActivity):null,e=e&&void 0!==e.topic_id?e.topic_id:null;return e&&parseInt(e)===parseInt(n)})).length),a=Number(t.length),o.push("mentions"),"all"===d?(q.each(t,function(e,a){a=q(a),q.each(o,function(e,t){-1!==q.inArray("bp-my-"+t,a.get(0).classList)&&(void 0===s.heartbeat_data.highlights[t]?s.heartbeat_data.highlights[t]=[a.data("bp-activity-id")]:-1===q.inArray(a.data("bp-activity-id"),s.heartbeat_data.highlights[t])&&s.heartbeat_data.highlights[t].push(a.data("bp-activity-id")))})}),i=new RegExp("bp-my-("+o.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(i,""),q(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(a)):(this.heartbeat_data.highlights[d]=[],q.each(t,function(e,t){s.heartbeat_data.highlights[d].push(q(t).data("bp-activity-id"))})),q.each(o,function(e,t){var a;void 0!==s.heartbeat_data.highlights[t]&&s.heartbeat_data.highlights[t].length&&(a=0,"mentions"===t&&(a=s.mentions_count),q(bp.Nouveau.objectNavParent+' [data-bp-scope="'+t+'"]').find("a span").html(Number(s.heartbeat_data.highlights[t].length)+a))}),o.pop(),q(document).prop("title","("+a+") "+this.heartbeat_data.document_title),q('#buddypress [data-bp-list="activity"]').first().hasClass("load-newest")?(i=q('#buddypress [data-bp-list="activity"] .load-newest a').html(),q('#buddypress [data-bp-list="activity"] .load-newest a').html(i.replace(/([0-9]+)/,a))):q('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+a+")</a></li>"),q('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),q('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau)&&bp.Nouveau.reportPopUp()},injectActivities:function(e){var t,a,i,o,d=q("body.my-activity:not(.activity-singular)").length?bp.Nouveau.getStorage("bp-user-activity"):bp.Nouveau.getStorage("bp-activity"),s=d.scope||null,d=d.filter||null;q(e.currentTarget).hasClass("load-newest")?(e.preventDefault(),q(e.currentTarget).remove(),i=q.parseHTML(this.heartbeat_data.newest),q.each(i,function(e,t){"LI"===t.nodeName&&q(t).hasClass("just-posted")&&q("#"+q(t).prop("id")).length&&q("#"+q(t).prop("id")).remove()}),(0<(i=q(e.delegateTarget).find(".activity-list .activity-item").first()).length&&i.hasClass("bb-pinned")?q(i).after(this.heartbeat_data.newest):q(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest)).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===s&&q(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===s&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),q(bp.Nouveau.objectNavParent+' [data-bp-scope="'+s+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[s]&&(this.heartbeat_data.highlights[s]=[]),setTimeout(function(){q(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+s+"_activity")},3e3),q(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()):q(e.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,a=this,i="",e.preventDefault(),(o=q(e.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],q(e.delegateTarget).children(".just-posted").each(function(){a.just_posted.push(q(this).data("bp-activity-id"))}),q("#buddypress .dir-search input[type=search]").length?i=q("#buddypress .dir-search input[type=search]").val():q("#buddypress .activity-search.bp-search input[type=search]").length&&(i=q("#buddypress .activity-search.bp-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:s,filter:d,search_terms:i,page:t,method:"append",exclude_just_posted:this.just_posted.join(","),target:'#buddypress [data-bp-list]:not( #bb-schedule-posts_modal [data-bp-list="activity"] ) ul.bp-list'}).done(function(e){!0===e.success&&(o.remove(),a.current_page=t,jQuery(window).scroll())})),q(".activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide()},hideComments:function(e){var a,i,o,e=q(e.target).find(".activity-comments");e.length&&e.each(function(e,t){o=q(t).children("ul").not(".conflict-activity-ul-li-comment"),!(i=q(o).find("li").not(q(".document-action-class, .media-action-class, .video-action-class"))).length||q("body").hasClass("activity-singular")&&""!==window.location.hash&&q(window.location.hash).length&&0!==q(window.location.hash).closest(".activity-comments").length||(a=q(t).closest(".activity-item"),q("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),i.each(function(e,t){if(e<i.length-4){if(e||q(t).parent("ul").before('<div class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></div>"),window.location.hash&&"#"+q(t).attr("id")===window.location.hash)return q(t).parents("li.comment-item").show(),!1;q(t).addClass("bp-hidden").hide()}}),q(o).children(".bp-hidden").length===q(o).children("li").length-1&&q(o).find("li.show-all").length&&q(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showActivity:function(e){e.preventDefault();var t=q(e.currentTarget).parent(),a=t.data("parent_comment_id"),t=q(t).data("activity_id");q(document).trigger("activityModalOpened",{activityId:t}),q(e.currentTarget).parents(".activity-comments").find(".ac-form").each(function(){var e=q(this),t=q(this).closest(".activity-comments"),a=q(this).closest(".comment-item");e.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),bp.Nouveau.Activity.resetActivityCommentForm(e,"hardReset"),t.append(e),a.find(".acomment-display").removeClass("display-focus"),a.removeClass("comment-item-focus")}),bp.Nouveau.Activity.launchActivityPopup(t,a)},closeActivity:function(e){e.preventDefault();var e=q(e.target).closest(".bb-activity-model-wrapper"),t=e.find(".bb-modal-activity-footer"),a=e.find(".activity-item").data("bp-activity-id"),i=e.find("#ac-form-"+a);bp.Nouveau.Activity.reinitializeActivityCommentForm(i),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!1,"",a),e.find("#activity-modal").removeClass("bb-closed-comments"),e.closest("body").removeClass("acomments-modal-open"),e.hide(),e.find("ul.activity-list").empty(),t.removeClass("active"),t.find("form.ac-form").remove()},scopeLoaded:function(e,a){this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(q.each(a.response.new_mentions,function(e,t){q("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&q.each(this.heartbeat_data.highlights[a.scope],function(e,t){q("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').length&&q("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",q.each(q(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,t){0===parseInt(q(t).html(),10)&&q(t).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),q(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){q("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){var e,t;!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit&&(t=q("#activity-"+BP_Nouveau.activity.params.is_activity_edit)).length&&t.children(".bb-activity-more-options-wrap").find(".button.edit-activity").length&&(e=t.data("bp-activity"),t=""!==t.data("link-url")?t.data("link-url"):null,_.isUndefined(e)||bp.Nouveau.Activity.postForm.displayEditActivityForm(e,t))},activityPrivacyChange:function(e){var t=e.data,a=q(e.target),i=q(e.currentTarget).closest(".activity-item"),o=i.data("bp-activity-id");if(e.preventDefault(),void 0===a.data("value")||""==q.trim(a.data("value")))return!1;i.find(".privacy").addClass("loading"),t.ajax({action:"activity_update_privacy",id:o,privacy:a.data("value")},"activity").done(function(e){i.find(".privacy").removeClass("loading"),!0===e.success&&(i.find(".activity-privacy li").removeClass("selected"),i.find(".privacy-wrap").attr("data-bp-tooltip",a.text()),a.addClass("selected"),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),i.find(".privacy").addClass(a.data("value")),void 0!==e&&void 0!==e.data&&void 0!==e.data.video_symlink&&(q(".document-description-wrap").length&&q(".document-description-wrap .bb-open-document-theatre").length&&(q(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",e.data.video_symlink),q(".document-description-wrap .bb-open-document-theatre").attr("data-extension",e.data.extension)),q(".document-description-wrap").length&&q(".document-detail-wrap.document-detail-wrap-description-popup").length&&(q(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",e.data.video_symlink),q(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",e.data.extension)),videojs(e.data.video_js_id).src({type:e.data.video_extension,src:e.data.video_symlink})),void 0!==e&&void 0!==e.data&&void 0!==e.data.edited_text&&""!==e.data.edited_text&&(i.find(".activity-date span.bb-activity-edited-text").length?i.find(".activity-date span.bb-activity-edited-text").replaceWith(e.data.edited_text):i.find(".activity-date").append(e.data.edited_text)),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=o)})},activityPrivacyRedirect:function(e){var t=q(e.target);if(e.preventDefault(),void 0===t.data("value")||""==q.trim(t.data("value")))return!1;window.location.href=t.data("value")},togglePrivacyDropdown:function(e){e.data,q(e.target);var t=q(e.currentTarget).closest(".activity-item");t.data("bp-activity-id");e.preventDefault(),q("ul.activity-privacy").not(t.find(".activity-privacy")).removeClass("bb-open"),t.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var s,L,d=e.data,l=q(e.target),n=q(e.currentTarget),m=n.data("bp-activity-id"),I=q(e.delegateTarget),c=n.find(".activity-state"),r=n.find(".comments-count"),p=this,v=0<l.closest("#activity-modal").length,t=0<l.closest(".bb-internal-model").length,a=(v&&(c=n.closest("#activity-modal").find(".activity-state"),r=n.closest("#activity-modal").find(".comments-count")),0);if(!(l=q(l).is("span")||q(l).is("i")||q(l).is("img")?q(l).closest("a"):l).parent(".ac-emotion_btn")||l.hasClass("fav")||l.hasClass("unfav")||(a=l.parents(".ac-emotion_item").attr("data-reaction-id")),l.hasClass("fav")||l.hasClass("unfav")||0<a){if(e.preventDefault(),q("body").hasClass("bb-is-mobile")&&q("body").hasClass("bb-reactions-mode")&&0===l.closest(".ac-emotion_btn").length&&!0!==e.customTriggered)return;if((l=q(l).is("a")?l:q(l).closest("a")).hasClass("loading"))return;l.addClass("loading");var i,o=l.hasClass("fav")?"fav":"unfav",u=!0,b="activity",y=l.parents(".acomment-display").first(),f=l.attr("data-reacted-id");if(0<a&&(o="fav"),l.parent(".ac-emotion_btn")&&(f=l.parents(".bp-generic-meta").find(".unfav").attr("data-reacted-id")),"fav"===o&&parseInt(a)===parseInt(f))return void l.removeClass("loading");0<y.length&&(u=!1,b="activity_comment");var h=u?(i=l.parents(".activity-item")).data("bp-activity-id"):(i=l.parents(".activity-comment").first()).data("bp-activity-comment-id"),f={action:"activity_mark_"+o,reaction_id:a,item_id:h,item_type:b};d.ajax(f,"activity").done(function(e){var t;!1===e.success?(l.removeClass("loading"),alert(e.data)):(l.fadeOut(200,function(){"false"===q(this).attr("aria-pressed")?q(this).attr("aria-pressed","true"):q(this).attr("aria-pressed","false"),void 0!==e.data.reaction_count&&(u?(0<i.find(".activity-content .activity-state-reactions").length?i.find(".activity-content  .activity-state-reactions").replaceWith(e.data.reaction_count):i.find(".activity-content .activity-state").prepend(e.data.reaction_count),""!==e.data.reaction_count?c.addClass("has-likes"):c.removeClass("has-likes")):0<i.find("#acomment-display-"+h+" .comment-reactions .activity-state-reactions").length?i.find("#acomment-display-"+h+" .comment-reactions .activity-state-reactions").replaceWith(e.data.reaction_count):i.find("#acomment-display-"+h+" .comment-reactions").prepend(e.data.reaction_count)),e.data.reaction_button&&(u?i.find(".bp-generic-meta a.bp-like-button:first"):i.find("#acomment-display-"+h+" .bp-generic-meta a.bp-like-button")).replaceWith(e.data.reaction_button),i.find(".ac-emotions_list").removeClass("active"),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=h,q(this).fadeIn(200),l.removeClass("loading")}),"activity_comment"===b?q(".activity-comment[data-bp-activity-comment-id="+h+"] > .acomment-display > .acomment_inner").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"):"activity"===b&&q(".activity[data-bp-activity-id="+h+"] > .activity-content").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"),"fav"===o?void 0===e.data.directory_tab||""===e.data.directory_tab||q(d.objectNavParent+' [data-bp-scope="favorites"]').length||q(d.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab):"unfav"===o&&((t=q('[data-bp-user-scope="favorites"]').hasClass("selected")||q(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&n.remove(),void 0!==e.data.no_favorite)&&(q(d.objectNavParent+' [data-bp-scope="all"]').length&&q(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?q(d.objectNavParent+' [data-bp-scope="favorites"]').remove():t&&I.append(e.data.no_favorite)))}).fail(function(){l.removeClass("loading")})}if(l.hasClass("delete-activity")||l.hasClass("acomment-delete")||l.hasClass("spam-activity")||l.hasClass("spam-activity-comment")){var g,C,N,w,z,P=l.closest("[data-bp-activity-comment-id]"),j=P.data("bp-activity-comment-id"),B=0;if((z=l.closest(".activity-comments")).addClass("active"),e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;l.addClass("loading");var x={action:"delete_activity",id:m,_wpnonce:d.getLinkParams(l.prop("href"),"_wpnonce"),is_single:l.closest("[data-bp-single]").length};(l.hasClass("spam-activity")||l.hasClass("spam-activity-comment"))&&(x.action="bp_spam_activity"),g=n,j&&(delete x.is_single,x.id=j,x.is_comment=!0,g=P),d.ajax(x,"activity").done(function(e){if(l.removeClass("loading"),!1===e.success)g.append(e.data.feedback),g.find(".bp-feedback").hide().fadeIn(300);else{var t,a,i=g.closest(".has-child-comments"),o=(g.hasClass("has-child-comments")&&(t=g.closest("ul").closest("li")),i.find("> ul"));if(e.data.redirect)return window.location.href=e.data.redirect;e.data.parent_activity_id&&e.data.activity&&q("body:not(.activity-singular) #buddypress #activity-stream ul.activity-list li#activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),j&&(B=1,a=P.find(".acomments-view-more").data("child-count"),n.append(P.find("form")),q.each(P.find("li.comment-item"),function(){B+=1}),B+=void 0!==a?parseFloat(a):0,C=c.find("span.comments-count"),N=C.text().length?C.text().match(/\d+/)[0]:0,N=Number(N-B),r.length?(a=1<N?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,r.text(a.replace("%d",N))):C.parent(".has-comments").removeClass("has-comments"),(w=n.find("li.show-all a")).length&&w.html(BP_Nouveau.show_x_comments.replace("%d",N)),0===N)&&(n.removeClass("has-comments"),c.removeClass("has-comments"),r.empty()),g.slideUp(300,function(){g.remove(),0===o.find("li").length&&i.removeClass("has-child-comments"),void 0!==t&&""===t.find("> ul").html().trim()&&t.removeClass("has-child-comments")}),j||n.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),q(document).trigger("bp_activity_ajax_delete_request",q.extend(x,{response:e})),q(document).trigger("bp_activity_ajax_delete_request_video",q.extend(x,{response:e})),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=m}z.removeClass("active")})}if(l.closest("span").hasClass("activity-read-more")){var A=l.closest("div"),S=l.closest("span");if(h=null,q(A).hasClass("activity-inner")?h=m:q(A).hasClass("acomment-content")&&(h=l.closest("li").data("bp-activity-comment-id")),!h)return e;e.preventDefault(),q(S).addClass("loading"),d.ajax({action:"get_single_activity_content",id:h},"activity").done(function(e){"object"!=typeof e&&0<l.closest("div").find(".bb-activity-media-wrap").length&&(e=JSON.parse(e)),q(S).removeClass("loading"),A.parent().find(".bp-feedback").length&&A.parent().find(".bp-feedback").remove(),!1===e.success?(A.after(e.data.feedback),A.parent().find(".bp-feedback").hide().fadeIn(300)):((q(A).children(".bb-poll-view").length?(q(A).children(":not(.bb-poll-view)").remove(),q(A).prepend(e.data.contents)):q(A).html(e.data.contents)).slideDown(300),jQuery(window).scroll(),n.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB)&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+h)))})}if(l.hasClass("ac-form")&&l.hasClass("not-initialized")&&l.closest(".activity-item").find(".acomment-reply").eq(0).trigger("click"),l.hasClass("activity-state-comments")||l.hasClass("acomment-reply")||l.parent().hasClass("acomment-reply")||l.hasClass("acomment-edit")){if(l.parents(".activity-item").hasClass("bb-closed-comments"))return void e.preventDefault();h=m,y=v?(s=q("#activity-modal").find("#ac-form-"+m),k=q("#activity-modal").find(".bb-modal-activity-footer"),"#activity-modal "):t?(s=q(".bb-internal-model").find("#ac-form-"+m),".bb-internal-model "):(s=q("#ac-form-"+m),k=q('[data-bp-activity-id="'+h+'"] .activity-comments'),"");var a=!1,f=(l.closest(".bb-media-model-container").length&&(s=l.closest(".bb-media-model-container").find("#ac-form-"+m),k=l.closest(".bb-media-model-container").find('[data-bp-activity-id="'+h+'"] .activity-comments')),l.closest(".activity-item").hasClass("has-comments")||l.closest(".activity-item").addClass("has-comments"),e.preventDefault(),p.resetActivityCommentForm(s,"hardReset"),l.parent().hasClass("acomment-reply")&&l.parent(),l.closest("li").data("bp-activity-comment-id")&&(h=l.closest("li").data("bp-activity-comment-id")),l.closest("li").data("bp-activity-comment")&&(a=l.closest("li").data("bp-activity-comment")),this.toggleMultiMediaOptions(s,l),s.removeClass("root"),q(".ac-form").addClass("not-initialized"),q(".ac-form").find(".ac-input:not(.emojionearea)").html(""),bp.Nouveau.Activity.clearFeedbackNotice(s),q.each(s.children("div"),function(e,t){q(t).hasClass("error")&&q(t).remove()}),l.hasClass("acomment-edit")&&!_.isNull(a)?((f=q(y+'[data-bp-activity-comment-id="'+h+'"]')).find("#acomment-display-"+h).addClass("bp-hide"),f.find("#acomment-edit-form-"+h).append(s),s.addClass("acomment-edit").attr("data-item-id",h),p.validateCommentContent(s.find(".ac-textarea").children(".ac-input")),p.editActivityCommentForm(s,a),v&&q(".bb-modal-activity-footer").removeClass("active")):h===m?(v&&(q(".bb-modal-activity-footer").addClass("active"),q("#activity-modal").find(".acomment-display").removeClass("display-focus"),q("#activity-modal").find(".comment-item").removeClass("comment-item-focus")),k.append(s),s.addClass("root"),k.find(".acomment-display").removeClass("display-focus"),k.find(".comment-item").removeClass("comment-item-focus")):(v?(q(".bb-modal-activity-footer").removeClass("active"),q("#activity-modal").find('[data-bp-activity-comment-id="'+h+'"]')):t?q(".bb-internal-model").find('[data-bp-activity-comment-id="'+h+'"]'):q('[data-bp-activity-comment-id="'+h+'"]')).append(s),s.removeClass("not-initialized"),s.find(".post-elements-buttons-item.post-emoji").prevAll().not(":hidden").length+1),k=(s.find(".post-elements-buttons-item.post-emoji").attr("data-nth-child",f),s.find(".post-elements-buttons-item.post-gif").prevAll().not(":hidden").length+1),t=(s.find(".post-elements-buttons-item.post-gif").attr("data-nth-child",k),s.find(".ac-input[contenteditable]")),f=(bp.Nouveau.Activity.listenCommentInput(t),l.attr("aria-expanded","true"),l.closest(".activity-comments").find(".acomment-display").removeClass("display-focus"),l.closest(".activity-comments").find(".comment-item").removeClass("comment-item-focus"),l.closest(".acomment-display").addClass("display-focus"),l.closest(".comment-item").addClass("comment-item-focus"),_.isNull(a)||(T=a.nickname),_.isNull(a)||(M=a.user_id),'<span class="atwho-inserted" data-atwho-at-query="@" contenteditable="false">@'+T+"</span>&nbsp;");_.isUndefined(BP_Nouveau.activity.params.user_id)||(R=BP_Nouveau.activity.params.user_id);var T,k={offset:-(q(window).height()/2-75),easing:"swing"},H=t.get(0);jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=300<jQuery(window).height()?200:100;jQuery("html, body").animate({scrollTop:jQuery(H).offset().top-e},500)},500):(v?q(".bb-modal-activity-body"):q).scrollTo(s,500,k),q(y+"#ac-form-"+m+" #ac-input-"+m).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==q(y+"#ac-input-"+m).data("emojioneArea")||(T=q(y+"#ac-input-"+m).html(),bp.Nouveau.Activity.initializeEmojioneArea(v,y,m),l.hasClass("acomment-edit")&&!_.isNull(a)&&q(y+"#ac-input-"+m).html(T)),l.hasClass("acomment-edit")||l.hasClass("button")||l.hasClass("activity-state-comments")||R===M||(q(y+"#ac-input-"+m).html(f),s.addClass("has-content")),void 0===window.getSelection||void 0===document.createRange||_.isNull(a)||((t=document.createRange()).selectNodeContents(q(y+"#ac-input-"+m)[0]),t.collapse(!1),(k=window.getSelection()).removeAllRanges(),k.addRange(t)),_.isUndefined(window.MediumEditor)||q(y+"#ac-input-"+m).hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(q(y+"#ac-input-"+m)[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1}))}if(l.hasClass("activity-state-no-comments")&&e.preventDefault(),l.hasClass("ac-reply-cancel")&&((T=q(l).closest(".ac-form")).addClass("not-initialized"),q(".acomment-reply").attr("aria-expanded","false"),p.destroyCommentMediaUploader(m),p.destroyCommentDocumentUploader(m),p.resetActivityCommentForm(T),e.preventDefault()),"ac_form_submit"===l.prop("name")){l.prop("disabled",!0),(z=l.closest(".activity-comments")).addClass("active"),s=l.closest("form"),h=m,e.preventDefault(),l.closest("li").data("bp-activity-comment-id")&&(h=l.closest("li").data("bp-activity-comment-id"));for(var U,G=(U=q(s).find(".ac-input").first()).find("span.atwho-query"),F=0;F<G.length;F++)q(G[F]).replaceWith(G[F].innerText);U.find("img.emoji").each(function(e,t){q(t).addClass("emojioneemoji");var a=q(t).attr("alt");q(t).attr("data-emoji-char",a),q(t).removeClass("emoji")}),U.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),void 0===m&&0<l.parents(".bb-modal-activity-footer").length&&(m=l.parents("form.ac-form").find("input[name=comment_form_id]").val(),h=m),l.parent().addClass("loading").prop("disabled",!0),U.addClass("loading").prop("disabled",!0);var R=U[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""),M={action:"new_activity_comment",_wpnonce_new_activity_comment:q("#_wpnonce_new_activity_comment").val(),comment_id:h,form_id:m,content:R},O=(q("#_bp_as_nonce_"+m).val()&&(M["_bp_as_nonce_"+m]=q("#_bp_as_nonce_"+m).val()),this.dropzone_media.length&&(M.media=this.dropzone_media),this.dropzone_document.length&&(M.document=this.dropzone_document),this.dropzone_video.length&&(M.video=this.dropzone_video,_.isEmpty(M.content))&&(M.content="&#8203;"),_.isUndefined(this.models[m])||(L=this.models[m],M.gif_data=this.models[m].get("gif_data")),M.content=M.content.replace(/&nbsp;/g," "),s.hasClass("acomment-edit")&&(M.edit_comment=!0),0<l.closest(".bb-modal-activity-footer").length);d.ajax(M,"activity").done(function(e){if(l.parent().removeClass("loading"),U.removeClass("loading"),q(".acomment-reply").attr("aria-expanded","false"),!1===e.success)s.append(q(e.data.feedback).hide().fadeIn(200));else{var t=0<l.closest(".elementor-activity-item").length,a=s.prev().hasClass("activity-actions"),t=t&&a?s.parent().find(".activity-actions"):s.parent(),a=q.trim(e.data.contents),e=(t.find(".acomment-display").removeClass("display-focus"),t.find(".comment-item").removeClass("comment-item-focus"),t.addClass("has-child-comments"),s.find('input[name="comment_form_id"]').val()),e=(v?(q("#activity-modal").find(".bb-modal-activity-footer").append(s).addClass("active"),s.removeClass("has-content").addClass("root")):(s.addClass("not-initialized").removeClass("has-content has-gif has-media"),s.closest(".activity-comments").append(s)),s.find("#ac-input-"+e).html(""),s.hasClass("acomment-edit")?(e=s.attr("data-item-id"),s.closest(".activity-comments").append(s),(v?q("#activity-modal").find("li#acomment-"+e):q("li#acomment-"+e)).replaceWith(a)):(0===t.children("ul").length&&(t.hasClass("activity-comments")?t.prepend("<ul></ul>"):t.append("<ul></ul>")),O?s.closest("#activity-modal").find(".bb-modal-activity-body .activity-comments, .bb-modal-activity-body .activity-comments .activity-actions").children("ul").append(q(a)):t.children("ul").append(q(a).hide().fadeIn(200)),q(s).find(".ac-input").first().html(""),t.parent().addClass("has-comments"),t.parent().addClass("comments-loaded"),c.addClass("has-comments")),s.removeClass("acomment-edit"),s.find(".ac-reply-content"));if(0<e.find(".ac-reply-toolbar .ac-reply-media-button").length&&e.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<e.find(".ac-reply-toolbar .ac-reply-document-button").length&&e.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<e.find(".ac-reply-toolbar .ac-reply-video-button").length&&e.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<e.find(".ac-reply-toolbar .ac-reply-gif-button").length&&(e.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),e.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),jQuery(window).scroll(),!s.hasClass("acomment-edit")&&(C=c.find("span.comments-count"),N=C.text().length?C.text().match(/\d+/)[0]:0,N=Number(N)+1,r.length&&(a=1<N?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,r.text(a.replace("%d",N||1))),C.parent(":not( .has-comments )").addClass("has-comments"),w=q(n).find(".show-all a"))&&w.html(BP_Nouveau.show_x_comments.replace("%d",N)),p.dropzone_media.length)for(var i=0;i<p.dropzone_media.length;i++)p.dropzone_media[i].saved=!0;if(p.dropzone_document.length)for(var o=0;o<p.dropzone_document.length;o++)p.dropzone_document[o].saved=!0;if(p.dropzone_video.length)for(var d=0;d<p.dropzone_video.length;d++)p.dropzone_video[d].saved=!0;bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=m}_.isUndefined(L)||(L.set("gif_data",{}),q("#ac-reply-post-gif-"+m).find(".activity-attached-gif-container").removeAttr("style")),p.destroyCommentMediaUploader(m),p.destroyCommentDocumentUploader(m),p.destroyCommentVideoUploader(m),l.prop("disabled",!1),U.prop("disabled",!1),z.removeClass("active"),bp.Nouveau.Activity.clearFeedbackNotice(s)}).fail(function(e){l.parent().removeClass("loading"),l.prop("disabled",!1),bp.Nouveau.Activity.clearFeedbackNotice(s),0===e.readyState?s.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+BP_Nouveau.activity.strings.commentPostError+"</div>"):(e=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:e.statusText,s.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+e+"</div>"))})}if(l.hasClass("edit")&&l.hasClass("edit-activity")&&(e.preventDefault(),f=n.data("bp-activity"),a=""!==n.data("link-url")?n.data("link-url"):null,void 0!==f)&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(f,a),l.closest("li").hasClass("groups")?q("#bp-nouveau-activity-form").addClass("group-activity"):q("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media)&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(q(document).find(".bb-close-media-theatre").trigger("click"),q(document).find(".bb-close-document-theatre").trigger("click")),v&&(l.hasClass("bb-open-media-theatre")||l.hasClass("bb-open-video-theatre")||l.hasClass("bb-open-document-theatre")||l.hasClass("document-detail-wrap-description-popup"))&&(e.preventDefault(),l.closest("#activity-modal").find(".bb-modal-activity-header .bb-close-action-popup").trigger("click")),l.hasClass("pin-activity")||l.hasClass("unpin-activity")){if(e.preventDefault(),!m)return e;l.closest(".activity-item").addClass("loading-pin");var E="pin";l.hasClass("unpin-activity")&&(E="unpin"),d.ajax({action:"activity_update_pinned_post",id:m,pin_action:E},"activity").done(function(e){var t,a,i,o,d,s,n,c,r;l.closest(".activity-item").removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(t=l.closest("ul.activity-list"),a=l.closest(".buddypress-wrap:not(.bb-internal-model)").find("#activity-stream"),i=0<l.closest(".bb-media-model-wrapper").length,d=(o=a.children("ul.activity-list")).children("[data-bp-activity-id="+m+"]"),r="."+l.attr("class").split(" ").join("."),d=d.find(r),e.success&&((""===(r=bp.Nouveau.getStorage("bp-activity","scope"))||!1===r||"undefined"!==BP_Nouveau.is_send_ajax_request&&""===BP_Nouveau.is_send_ajax_request)&&q(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length&&(r=q(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope")),n=s=!1,c="",l.closest("li.activity-item").hasClass("groups")&&(n=!0,c=(c=l.closest("li.activity-item").attr("class").match(/group-\d+/))[0].replace("group-","")),a.hasClass("single-user")?s=!1:(a.hasClass("activity")&&"all"===r&&!n||a.hasClass("single-group"))&&(s=!0),"pin"===E?(s&&t.find("li.activity-item").removeClass("bb-pinned"),r="li.activity-item:not(.groups)",n&&!a.hasClass("single-group")?r="li.activity-item.group-"+c:n&&a.hasClass("single-group")&&(r="li.activity-item"),t.find(r).each(function(){var e=q(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),n?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),(v||i)&&0<o.length&&o.find(r).each(function(){var e=q(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),n?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),s&&l.closest("li.activity-item").addClass("bb-pinned"),l.addClass("unpin-activity"),l.removeClass("pin-activity"),l.closest("li.activity-item").hasClass("groups")?l.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):l.find("span").html(BP_Nouveau.activity.strings.unpinPost),(v||i)&&0<d.length&&(d.addClass("unpin-activity"),d.removeClass("pin-activity"),d.closest("li.activity-item").hasClass("groups")?d.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):d.find("span").html(BP_Nouveau.activity.strings.unpinPost))):"unpin"===E&&(l.closest("li.activity-item").removeClass("bb-pinned"),l.addClass("pin-activity"),l.removeClass("unpin-activity"),l.closest("li.activity-item").hasClass("groups")?l.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):l.find("span").html(BP_Nouveau.activity.strings.pinPost),v||i)&&0<d.length&&(d.addClass("pin-activity"),d.removeClass("unpin-activity"),d.closest("li.activity-item").hasClass("groups")?d.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):d.find("span").html(BP_Nouveau.activity.strings.pinPost)),s)&&(v||i?void 0!==bp.Nouveau.Activity.activityPinHasUpdates&&(bp.Nouveau.Activity.activityPinHasUpdates=!0):(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities())),q(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0]),v)&&(void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0),void 0!==bp.Nouveau.Activity.activityPinHasUpdates)&&(bp.Nouveau.Activity.activityPinHasUpdates=!0)}).fail(function(){l.closest(".activity-item").removeClass("loading-pin"),q(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(l.hasClass("bb-icon-bell-slash")||l.hasClass("bb-icon-bell")){if(e.preventDefault(),!m)return e;l.closest(".activity-item").addClass("loading-mute");var D="mute";l.hasClass("bb-icon-bell")&&(D="unmute"),d.ajax({action:"toggle_activity_notification_status",id:m,notification_toggle_action:D},"activity").done(function(e){l.closest(".activity-item").removeClass("loading-mute"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&("mute"===D?(l.closest("li.activity-item").addClass("bb-muted"),l.removeClass("bb-icon-bell-slash"),l.addClass("bb-icon-bell"),l.attr("title",BP_Nouveau.activity.strings.unmuteNotification),l.find("span").html(BP_Nouveau.activity.strings.unmuteNotification)):"unmute"===D&&(l.closest("li.activity-item").removeClass("bb-muted"),l.removeClass("bb-icon-bell"),l.addClass("bb-icon-bell-slash"),l.attr("title",BP_Nouveau.activity.strings.muteNotification),l.find("span").html(BP_Nouveau.activity.strings.muteNotification)),void 0!==bp.Nouveau.Activity.activityHasUpdates)&&(bp.Nouveau.Activity.activityHasUpdates=!0),q(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0])),v&&(bp.Nouveau.Activity.activityPinHasUpdates=!0),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=m}).fail(function(){l.closest(".activity-item").removeClass("loading-pin"),q(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(l.hasClass("close-activity-comment")||l.hasClass("unclose-activity-comment")){if(e.preventDefault(),!m)return e;l.closest(".activity-item").addClass("loading-pin");var Q="close_comments";l.hasClass("unclose-activity-comment")&&(Q="unclose_comments"),d.ajax({action:"activity_update_close_comments",id:m,close_comments_action:Q},"activity").done(function(e){var t;l.closest(".activity-item").removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&(t=q("#activity-stream > .activity-list").find("[data-bp-activity-id="+m+"]"),l.closest(".activity-item").find(".bb-activity-closed-comments-notice").remove(),"close_comments"===Q?(l.closest("li.activity-item").addClass("bb-closed-comments"),0<l.closest("#activity-modal").length&&l.closest("#activity-modal").addClass("bb-closed-comments"),l.addClass("unclose-activity-comment"),l.removeClass("close-activity-comment"),l.find("span").html(BP_Nouveau.activity.strings.uncloseComments),l.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),l.closest(".activity-item").find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"),0<l.parents(".bb-media-model-wrapper").length&&0<t.length&&(t.addClass("bb-closed-comments"),t.find(".bb-activity-more-options .close-activity-comment span").html(BP_Nouveau.activity.strings.uncloseComments),t.find(".bb-activity-more-options .close-activity-comment").addClass("unclose-activity-comment").removeClass("close-activity-comment"),t.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),t.find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"))):"unclose_comments"===Q&&(l.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").show(),l.closest("li.activity-item").removeClass("bb-closed-comments"),0<l.closest("#activity-modal").length&&l.closest("#activity-modal").removeClass("bb-closed-comments"),l.addClass("close-activity-comment"),l.removeClass("unclose-activity-comment"),l.find("span").html(BP_Nouveau.activity.strings.closeComments),0<l.parents(".bb-media-model-wrapper").length)&&0<t.length&&(t.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),t.removeClass("bb-closed-comments"),t.find(".bb-activity-more-options .unclose-activity-comment span").html(BP_Nouveau.activity.strings.closeComments),t.find(".bb-activity-more-options .unclose-activity-comment").addClass("close-activity-comment").removeClass("unclose-activity-comment"),t.find(".bb-activity-closed-comments-notice").html("")),void 0!==bp.Nouveau.Activity.activityHasUpdates)&&(bp.Nouveau.Activity.activityHasUpdates=!0),q(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0]))}).fail(function(){l.closest(".activity-item").removeClass("loading-pin"),q(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.closeCommentsError+"</div>","error",null,!0])})}},commentFormAction:function(e){var t,a;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0!==e.altKey&&!0!==e.metaKey&&"TEXTAREA"===t.tagName&&q(t).hasClass("ac-input")?void(27===(a=e.keyCode||e.which)&&!1===e.ctrlKey?"TEXTAREA"===t.tagName&&q(t).closest("form").slideUp(200):e.ctrlKey&&13===a&&q(t).val()&&q(t).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||q(t).hasClass("privacy-wrap")||q(t).parent().hasClass("privacy-wrap")?e:void q("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e,t=q(".load-more:visible").last(),a=q(window);t.closest(".activity-list").length&&t.get(0)&&!t.data("bp-autoloaded")&&(e=t.offset().top-50,a.scrollTop()+a.height()>e)&&(t.data("bp-autoloaded",1),t.find("a").text(BP_Nouveau.activity.strings.loadingMore),t.find("a").trigger("click"))},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),q("#ac-reply-post-media-uploader-"+e).html(""),q("#ac-reply-post-media-uploader-1-"+e).html("")),this.dropzone_media=[],q("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),q("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),q("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],q("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),q("#ac-reply-document-button-"+e).removeClass("active")},destroyCommentVideoUploader:function(e){_.isNull(this.dropzone_video_obj)||(this.dropzone_video_obj.destroy(),q("#ac-reply-post-video-uploader-"+e).html("")),this.dropzone_video=[],q("#ac-reply-post-video-uploader-"+e).removeClass("open").addClass("closed"),q("#ac-reply-video-button-"+e).removeClass("active")},resetGifPicker:function(e){q("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open").empty(),q("#ac-reply-gif-button-"+e).removeClass("active"),q(".gif-media-search-dropdown-standalone").removeClass("open").empty(),_.isUndefined(this.models[e])||(this.models[e].set("gif_data",{}),q("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsMediaUploader:function(e){var t,c=this,o=q(e.currentTarget),a=o.data("ac-id"),a=o.closest(".bp-ac-form-container").find("#ac-reply-post-media-uploader-"+a),i=0<o.closest("#activity-modal").length?"#activity-modal ":"";e.preventDefault(),a.hasClass("open")&&!e.isCustomEvent?(a.trigger("click"),a.removeClass("open").addClass("closed")):(t=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"",void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},c.dropzone_obj instanceof Dropzone&&c.dropzone_obj.destroy(),c.dropzone_obj=new Dropzone(i+"#ac-reply-post-media-uploader-"+o.data("ac-id"),t),c.dropzone_obj.on("addedfile",function(e){e.media_edit_data&&(c.dropzone_media.push(e.media_edit_data),(e=o.parents(".ac-reply-toolbar")).find(".ac-reply-media-button"))&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),c.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var a=o.parents(".ac-reply-toolbar"),i=o.closest(".ac-form");bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),i.addClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),c.dropzone_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),c.dropzone_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=q(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,c.dropzone_media.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(c.dropzone_obj.files)||0!==c.dropzone_obj.files.length||q(c.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),c.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),c.dropzone_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?q(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&q(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(a=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(a),a.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),c.dropzone_obj.on("removedfile",function(e){if(c.dropzone_media.length)for(var t in c.dropzone_media)if(e.upload.uuid==c.dropzone_media[t].uuid){void 0===c.dropzone_media[t].saved||c.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(c.dropzone_media[t].id),c.dropzone_media.splice(t,1);break}var a,i;_.isNull(c.dropzone_obj)||_.isNull(c.dropzone_obj.files)||0!==c.dropzone_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),q(c.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),c.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),c.dropzone_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),a.removeClass("closed").addClass("open")):(c.dropzone_obj&&void 0!==c.dropzone_obj&&c.dropzone_obj.destroy(),c.dropzone_media=[],a.html(""),a.addClass("closed").removeClass("open"))),i=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentDocumentUploader(i),this.destroyCommentVideoUploader(i),t=q(e.currentTarget).data("ac-id"),this.resetGifPicker(t),e.isCustomEvent||q(o).closest(".bp-ac-form-container").find(".dropzone.media-dropzone").trigger("click"))},openCommentsDocumentUploader:function(e){var c=this,o=q(e.currentTarget),t=o.data("ac-id"),t=o.closest(".bp-ac-form-container").find("#ac-reply-post-document-uploader-"+t),a=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),q(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(t.hasClass("open")&&!e.isCustomEvent)return void t.trigger("click")}else q(e.currentTarget).toggleClass("active");var i=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(i={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:i,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation},c.dropzone_document_obj=new Dropzone(a+"#ac-reply-post-document-uploader-"+o.data("ac-id"),i),c.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&c.dropzone_document.push(e.document_edit_data);var t=e.upload.filename,t=t.substr(t.lastIndexOf(".")+1),e=(q(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+t),o.parents(".ac-reply-toolbar"));e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),c.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);a=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),c.dropzone_document_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),c.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),c.dropzone_document_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=q(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,c.dropzone_document.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(c.dropzone_document_obj.files)||0!==c.dropzone_document_obj.files.length||q(c.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),c.dropzone_document_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?q(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&q(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(a=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(a),a.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),c.dropzone_document_obj.on("removedfile",function(e){if(c.dropzone_document.length)for(var t in c.dropzone_document)if(e.upload.uuid==c.dropzone_document[t].uuid){void 0===c.dropzone_document[t].saved||c.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(c.dropzone_document[t].id),c.dropzone_document.splice(t,1);break}var a,i;_.isNull(c.dropzone_document_obj)||_.isNull(c.dropzone_document_obj.files)||0!==c.dropzone_document_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),q(c.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),c.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),c.dropzone_document_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),t.removeClass("closed").addClass("open")):(c.dropzone_document_obj&&c.dropzone_document_obj.destroy(),c.dropzone_document=[],t.html(""),t.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentMediaUploader(a),this.destroyCommentVideoUploader(a),i=q(e.currentTarget).data("ac-id");this.resetGifPicker(i),e.isCustomEvent||q(o).closest(".bp-ac-form-container").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var c=this,o=q(e.currentTarget),t=o.data("ac-id"),t=o.closest(".bp-ac-form-container").find("#ac-reply-post-video-uploader-"+t),a=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),q(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(t.hasClass("open")&&!e.isCustomEvent)return void t.trigger("click")}else q(e.currentTarget).toggleClass("active");var i=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(i={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:i,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},c.dropzone_video_obj=new Dropzone(a+"#ac-reply-post-video-uploader-"+o.data("ac-id"),i),c.dropzone_video_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);a=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),c.dropzone_video_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.video.empty_video_type):t()}),c.dropzone_video_obj.on("addedfile",function(e){var t;e.video_edit_data&&(c.dropzone_video.push(e.video_edit_data),(t=o.parents(".ac-reply-toolbar")).find(".ac-reply-video-button"))&&t.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),e.dataURL&&e.video_edit_data.thumb.length?(q(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' " />'),q(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),c.dropzone_video_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),c.dropzone_video_obj.on("success",function(e,t){if(100===e.upload.progress&&(q(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,q(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),q(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=q(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,t.data.group_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,t.data.saved=!1,t.data.js_preview=q(e.previewElement).find(".dz-video-thumbnail img").attr("src"),c.dropzone_video.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(c.dropzone_video_obj.files)||0!==c.dropzone_video_obj.files.length||q(c.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),c.dropzone_video_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?q(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&q(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(a=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(a),a.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),c.dropzone_video_obj.on("removedfile",function(e){if(c.dropzone_video.length)for(var t in c.dropzone_video)if(e.upload.uuid==c.dropzone_video[t].uuid){void 0===c.dropzone_video[t].saved||c.dropzone_video[t].saved||bp.Nouveau.Media.removeAttachment(c.dropzone_video[t].id),c.dropzone_video.splice(t,1);break}var a,i;_.isNull(c.dropzone_video_obj)||_.isNull(c.dropzone_video_obj.files)||0!==c.dropzone_video_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),q(c.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),c.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),c.dropzone_video_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),t.removeClass("closed").addClass("open")):(c.dropzone_video_obj&&c.dropzone_video_obj.destroy(),c.dropzone_video=[],t.html(""),t.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a),i=q(e.currentTarget).data("ac-id");this.resetGifPicker(i),e.isCustomEvent||q(o).closest(".bp-ac-form-container").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var t,e=e.currentTarget,a=0<q(e).closest("#activity-modal").length,i=a?"#activity-modal ":"",o=a,d=a?q(".gif-media-search-dropdown-standalone"):q(e).next(),s=e.id.match(/\d+$/)[0],i=q(i+"#ac-reply-post-gif-"+s),n=q(window).scrollTop(),c=q(e).offset(),r=Math.round(c.top),c=Math.round(c.left),l=(d.is(":empty")&&(t=new bp.Models.ACReply,l=new bp.Views.GifMediaSearchDropdown({model:t,standalone:o}),o=new bp.Views.ActivityAttachedGifPreview({model:t,standalone:o}),d.html(l.render().el),i.html(o.render().el),this.models[s]=t),q(e).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container")),i=(q(e).hasClass("active")&&l.length&&""==q.trim(l.html())?q(e).removeClass("active"):q(e).addClass("active"),d.toggleClass("open"),c+d.width()-70),o=(2<q(e).parents("li").length&&(i=c+d.width()-110),"translate("+(i=1<q(e).closest(".post-elements-buttons-item").index()?c+d.width()-180:i)+"px, "+(r-n-5)+"px)  translate(-100%, -100%)");a&&d.css("transform",o),this.destroyCommentMediaUploader(s),this.destroyCommentDocumentUploader(s),this.destroyCommentVideoUploader(s)},toggleMultiMediaOptions:function(e,t,a){var i,o;_.isUndefined(BP_Nouveau.media)||(o=i="",a?(i=(t=q(t||a)).closest(".activity-modal").find(".activity-item"),o=t.closest(".activity-modal").find(".activity-item").data("bp-activity"),e=q(a)):(i=t.closest(".activity-item"),o=t.closest(".activity-item").data("bp-activity")),t.closest("li").data("bp-activity-comment")&&(o=t.closest("li").data("bp-activity-comment")),t.closest("li").hasClass("groups")||i.hasClass("groups")?(_.isUndefined(o.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o.group_video)?!1===BP_Nouveau.media.group_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===o.group_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isUndefined(o)||_.isNull(o)||_.isUndefined(o.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o)||_.isNull(o)||_.isUndefined(o.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===o.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(o)||_.isNull(o)||_.isUndefined(o.profile_video)?!1===BP_Nouveau.media.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===o.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")))},fixAtWhoActivity:function(){q(".acomment-content, .activity-content").each(function(){for(var e=q(this).find("span.atwho-query"),t=0;t<e.length;t++)q(e[t]).replaceWith(e[t].innerText)})},navigateToSpecificComment:function(){setTimeout(function(){var e,t;window.location.hash&&(e=window.location.hash,t=0!==q("#wpadminbar").length?q("#wpadminbar").innerHeight():0,0<q(e).length)&&q("html, body").animate({scrollTop:parseInt(q(e).offset().top)-(80+t)},0)},200)},createThumbnailFromUrl:function(t){var a=this;a.dropzone_obj.createThumbnailFromUrl(t,a.dropzone_obj.options.thumbnailWidth,a.dropzone_obj.options.thumbnailHeight,a.dropzone_obj.options.thumbnailMethod,!0,function(e){a.dropzone_obj.emit("thumbnail",t,e),a.dropzone_obj.emit("complete",t)})},editActivityCommentForm:function(e,t){var a,i,o=e.find('input[name="comment_form_id"]').val(),d=e.find("#ac-reply-toolbar-"+o),s=e.find('input[name="ac_form_submit"]'),n=this,c=(e.find("#ac-input-"+o).html(t.content),s.attr("data-add-edit-label"));if(s.attr("data-add-edit-label",s.val()).val(c),void 0!==t.media&&0<t.media.length){d.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentDocumentUploader(d),n.disabledCommentVideoUploader(d),n.disabledCommentGifPicker(d);for(var r=t.media.length,l=0;l<r;l++){var m={},m=0<parseInt(t.id)?{id:t.media[l].attachment_id,media_id:t.media[l].id,name:t.media[l].name,thumb:t.media[l].thumb,url:t.media[l].url,uuid:t.media[l].attachment_id,menu_order:t.media[l].menu_order,album_id:t.media[l].album_id,group_id:t.media[l].group_id,saved:!0}:{id:t.media[l].id,name:t.media[l].name,thumb:t.media[l].thumb,url:t.media[l].url,uuid:t.media[l].id,menu_order:t.media[l].menu_order,album_id:t.media[l].album_id,group_id:t.media[l].group_id,saved:!1};m={name:t.media[l].name,accepted:!0,kind:"image",upload:{filename:t.media[l].name,uuid:t.media[l].attachment_id},dataURL:t.media[l].url,id:t.media[l].attachment_id,media_edit_data:m},n.dropzone_obj&&(n.dropzone_obj.files.push(m),n.dropzone_obj.emit("addedfile",m),BP_Nouveau.is_as3cf_active,"1"===BP_Nouveau.is_as3cf_active?(q(n.dropzone_obj.files[l].previewElement).find("img").attr("src",t.media[l].thumb),n.dropzone_obj.emit("thumbnail",t.media[l].thumb),n.dropzone_obj.emit("complete",m)):n.createThumbnailFromUrl(m),n.dropzone_obj.emit("dz-success"),n.dropzone_obj.emit("dz-complete"))}}if(void 0!==t.document&&0<t.document.length){d.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentMediaUploader(d),n.disabledCommentVideoUploader(d),n.disabledCommentGifPicker(d);for(var p=t.document.length,v=0;v<p;v++){var u={},u=0<parseInt(t.id)?{id:t.document[v].doc_id,name:t.document[v].full_name,full_name:t.document[v].full_name,type:"document",url:t.document[v].url,size:t.document[v].size,uuid:t.document[v].doc_id,document_id:t.document[v].id,menu_order:t.document[v].menu_order,folder_id:t.document[v].folder_id,group_id:t.document[v].group_id,saved:!0,svg_icon:_.isUndefined(t.document[v].svg_icon)?"":t.document[v].svg_icon}:{id:t.document[v].id,name:t.document[v].full_name,full_name:t.document[v].full_name,type:"document",url:t.document[v].url,size:t.document[v].size,uuid:t.document[v].id,menu_order:t.document[v].menu_order,folder_id:t.document[v].folder_id,group_id:t.document[v].group_id,saved:!1,svg_icon:_.isUndefined(t.document[v].svg_icon)?"":t.document[v].svg_icon};u={name:t.document[v].full_name,size:t.document[v].size,accepted:!0,kind:"file",upload:{filename:t.document[v].full_name,uuid:t.document[v].doc_id},dataURL:t.document[v].url,id:t.document[v].doc_id,document_edit_data:u,svg_icon:_.isUndefined(t.document[v].svg_icon)?"":t.document[v].svg_icon},n.dropzone_document_obj&&(n.dropzone_document_obj.files.push(u),n.dropzone_document_obj.emit("addedfile",u),n.dropzone_document_obj.emit("complete",u))}}if(void 0!==t.video&&0<t.video.length){d.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),n.disabledCommentMediaUploader(d),n.disabledCommentDocumentUploader(d),n.disabledCommentGifPicker(d);for(var b=t.video.length,y=0;y<b;y++){var f={},f=0<parseInt(t.id)?{id:t.video[y].vid_id,name:t.video[y].name,type:"video",thumb:t.video[y].thumb,url:t.video[y].url,size:t.video[y].size,uuid:t.video[y].vid_id,video_id:t.video[y].id,menu_order:t.video[y].menu_order,album_id:t.video[y].album_id,group_id:t.video[y].group_id,saved:!0}:{id:t.video[y].id,name:t.video[y].name,type:"video",thumb:t.video[y].thumb,url:t.video[y].url,size:t.video[y].size,uuid:t.video[y].id,menu_order:t.video[y].menu_order,album_id:t.video[y].album_id,group_id:t.video[y].group_id,saved:!1};f={name:t.video[y].name,size:t.video[y].size,accepted:!0,kind:"file",upload:{filename:t.video[y].name,uuid:t.video[y].vid_id},dataURL:t.video[y].url,id:t.video[y].vid_id,video_edit_data:f},console.log(f),console.log(n.dropzone_video_obj),n.dropzone_video_obj&&(n.dropzone_video_obj.files.push(f),n.dropzone_video_obj.emit("addedfile",f),n.dropzone_video_obj.emit("complete",f))}}void 0!==t.gif&&0<Object.keys(t.gif).length&&(s=d.find(".ac-reply-gif-button").next(),c=0<e.closest("#activity-modal").length,c=q((c?"#activity-modal ":"")+"#ac-reply-post-gif-"+o),d.find(".ac-reply-gif-button").trigger("click"),n.disabledCommentMediaUploader(d),n.disabledCommentDocumentUploader(d),n.disabledCommentVideoUploader(d),d=new bp.Models.ACReply,a=new bp.Views.GifMediaSearchDropdown({model:d}),i=new bp.Views.ActivityAttachedGifPreview({model:d}),a.model.set("gif_data",t.gif),s.html(a.render().el),c.html(i.render().el),this.models[o]=d),void 0===t.media&&void 0===t.document&&void 0===t.video&&void 0===t.gif&&e.find(".ac-reply-toolbar .post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e,t){var a,i,o;t=void 0!==t?t:"",!e.hasClass("acomment-edit")&&"hardReset"!==t||(t=e.find('input[name="comment_form_id"]').val(),a=e.attr("data-item-id"),o=q('[data-bp-activity-comment-id="'+a+'"]'),i=e.find('input[name="ac_form_submit"]'),o.find("#acomment-display-"+a).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),o=i.attr("data-add-edit-label"),i.attr("data-add-edit-label",i.val()).val(o),e.find(".post-elements-buttons-item").removeClass("disable"),e.find(".post-elements-buttons-item .toolbar-button").removeClass("active"),e.find("#ac-input-"+t).html(""),e.removeClass("has-content has-gif has-media"),this.destroyCommentMediaUploader(t),this.destroyCommentDocumentUploader(t),this.destroyCommentVideoUploader(t),this.resetGifPicker(t))},reinitializeActivityCommentForm:function(e){var t=e.find('input[name="comment_form_id"]').val(),a=e.find('input[name="ac_form_submit"]'),i=(e.hasClass("acomment-edit")&&(i=e.attr("data-item-id"),q('[data-bp-activity-comment-id="'+i+'"]').find("#acomment-display-"+i).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id")),a.attr("data-add-edit-label"));a.attr("data-add-edit-label",a.val()).val(i),e.find("#ac-input-"+t).html(""),e.removeClass("has-content has-gif has-media"),q(".bb-modal-activity-footer").addClass("active").append(e),this.destroyCommentMediaUploader(t),this.destroyCommentDocumentUploader(t),this.destroyCommentVideoUploader(t),this.resetGifPicker(t)},disabledCommentMediaUploader:function(e){e.find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentDocumentUploader:function(e){e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentVideoUploader:function(e){e.find(".ac-reply-video-button")&&e.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentGifPicker:function(e){e.find(".ac-reply-gif-button")&&e.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")},validateCommentContent:function(e){var t=e.html(),t=(t=q.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," ");""!==e.text().trim()||0<=t.indexOf("emojioneemoji")||e.closest("form").hasClass("acomment-edit")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},ReactionStatePopupTab:function(e){e.preventDefault(),q(this).closest(".activity-state-popup").find(".activity-state-popup_tab_panel li a").removeClass("active"),q(this).addClass("active"),q(this).closest(".activity-state-popup").find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),q(this).closest(".activity-state-popup").find("."+q(this).data("tab")).addClass("active")},closeActivityState:function(){q(".activity-state-popup").hide().removeClass("active")},listenCommentInput:function(e){var t,a;0<e.length&&(e=e.get(0),t=q(e).attr("id")+(q(e).closest(".bb-media-model-inner").length?"-theater":""),-1===q.inArray(t,this.InitiatedCommentForms)||q(e).closest("form").hasClass("events-initiated")||(a=this.InitiatedCommentForms.indexOf(t),this.InitiatedCommentForms.splice(a,1)),-1!=q.inArray(t,this.InitiatedCommentForms)||q(e).closest("form").hasClass("events-initiated")||(e.addEventListener("paste",function(e){e.preventDefault();e=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),e.addEventListener("input",function(e){var t=jQuery(e.currentTarget).html(),t=q.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));t=t.replace(/&nbsp;/g," "),""!==jQuery(e.currentTarget).text().trim()||0<=t.indexOf("emojioneemoji")?jQuery(e.currentTarget).closest("form").addClass("has-content"):jQuery(e.currentTarget).closest("form").removeClass("has-content")}),q(e).closest("form").addClass("events-initiated"),this.InitiatedCommentForms.push(t)))},activityRootComment:function(e){var e=q(e.currentTarget).closest("#activity-modal"),t=e.find(".activity-item").data("bp-activity-id"),a=e.find("#ac-form-"+t);bp.Nouveau.Activity.resetActivityCommentForm(a,"hardReset"),e.find(".acomment-display").removeClass("display-focus"),e.find(".comment-item").removeClass("comment-item-focus"),e.find(".bb-modal-activity-footer").addClass("active").append(a),a.addClass("root"),a.find("#ac-input-"+t).focus(),bp.Nouveau.Activity.clearFeedbackNotice(a)},clearFeedbackNotice:function(e){e.find(".bp-ac-form-container").find(".bp-feedback").length&&e.find(".bp-ac-form-container").find(".bp-feedback").remove()},launchActivityPopup:function(e,t){var a=q("#activity-"+e),i=q(".bb-activity-model-wrapper"),o=a[0].outerHTML,t='[data-parent_comment_id="'+t+'"]',d=a.data("activity-popup-title");bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null,bp.Nouveau.Activity.activityPinHasUpdates=!1,i.closest("body").addClass("acomments-modal-open"),i.show(),i.find("ul.activity-list").html(o),i.find(".bb-modal-activity-header h2").text(d);i.find(".bb-activity-video-elem").each(function(e,t){var o=q(t);o.find("video").each(function(e,t){var t=q(t),a=t.attr("id")+Math.floor(1e4*Math.random()),i=(t.attr("id",a),o.find(".video-action-wrap"));t.insertAfter(i),o.find(".video-js").remove(),t.addClass("video-js"),videojs(a,{controls:!0,aspectRatio:"16:9",fluid:!0,playbackRates:[.5,1,1.5,2],fullscreenToggle:!1})})}),a.hasClass("bb-closed-comments")&&i.find("#activity-modal").addClass("bb-closed-comments");o=i.find("#ac-form-"+e),i.find(".acomment-display").removeClass("display-focus"),i.find(".comment-item").removeClass("comment-item-focus"),i.find(".bb-modal-activity-footer").addClass("active").append(o),o.removeClass("not-initialized").addClass("root"),o.find("#ac-input-"+e).focus(),bp.Nouveau.Activity.clearFeedbackNotice(o),o.removeClass("events-initiated"),d=i.find(".bb-modal-activity-footer").find(".ac-input[contenteditable]");bp.Nouveau.Activity.listenCommentInput(d),i.find(".bb-activity-more-options-wrap .bb-activity-more-options-action, .bb-pin-action_button, .bb-mute-action_button").attr("data-balloon-pos","left"),i.find(".privacy-wrap").attr("data-bp-tooltip-pos","right"),i.find(t).children(".acomments-view-more").first().trigger("click"),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#activity-modal ",e),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp(),bp.Nouveau.Activity.toggleMultiMediaOptions(o,"",".bb-modal-activity-footer")},viewMoreComments:function(e){e.preventDefault();var t,a=q(e.currentTarget).parent(),i=q(e.currentTarget),o=q(a).data("activity_id"),d=q(e.currentTarget).closest(".activity-comments"),s=q(e.currentTarget).closest(".activity-item"),n=q(a).data("parent_comment_id"),c="",a=(i.addClass("loading").removeClass("acomments-view-more--hide"),d.addClass("active"),s.addClass("active"),i.html('<div id="bp-ajax-loader"><div class="bb-activity-placeholder bb-activity-tiny-placeholder"><div class="bb-activity-placeholder_head"><div class="bb-activity-placeholder_avatar bb-bg-animation bb-loading-bg"></div><div class="bb-activity-placeholder_details"><div class="bb-activity-placeholder_title bb-bg-animation bb-loading-bg"></div><div class="bb-activity-placeholder_description bb-bg-animation bb-loading-bg"></div></div></div></div></div>'),{action:"activity_loadmore_comments",activity_id:o,parent_comment_id:n,offset:q(e.currentTarget).parents(".activity-comments").find('ul[data-parent_comment_id ="'+n+'"] > li.comment-item:not(.bb-recent-comment)').length,activity_type_is_blog:1<q(e.currentTarget).parents(".entry-content").length});0<q(e.currentTarget).prev("li.activity-comment").length&&(t=q(e.currentTarget).prev("li.activity-comment").data("bp-timestamp"),a.last_comment_timestamp=t,c=q(e.currentTarget).prev("li.activity-comment").data("bp-activity-comment-id"),a.last_comment_id=c),bp.Nouveau.ajax(a,"activity").done(function(e){var t,a;!1===e.success?(i.html("<p class='error'>"+e.data.message+"</p>").removeClass("acomments-view-more--hide"),d.removeClass("active"),s.removeClass("active")):void 0!==e.data&&void 0!==e.data.comments&&(t=q(".bb-internal-model .activity-comments").find("[data-activity_id='"+o+"'][data-parent_comment_id='"+n+"']"),e=q(q.parseHTML(e.data.comments)),0<t.length&&0<e.length&&(e.each(function(){var e;"LI"===this.nodeName&&"undefined"!==this.id&&""!==this.id&&(e=this.id,0<(e=t.children("#"+e)).length)&&e.remove()}),void 0!==c&&""!==c?0<(a=t.find("li.activity-comment[data-bp-activity-comment-id='"+c+"']")).length?a.after(e):t.append(e):0<t.children(".activity-comment.comment-item").length?t.children(".activity-comment.comment-item").first().before(e):t.html(e),setTimeout(function(){jQuery(window).scroll()},200)),i.remove(),d.removeClass("active"),s.removeClass("active"),i.hasClass("acomments-view-more--root")||q(".bb-modal-activity-body").scrollTo("#acomment-"+n,500,{offset:0,easing:"swing"}),void 0!==bp.Nouveau&&(bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()),t.find(".bb-activity-more-options-wrap").find(".bb-activity-more-options-action").attr("data-balloon-pos","left"))}).fail(function(e){i.html("<p class='error'>"+e.statusText+"</p>").removeClass("acomments-view-more--hide"),d.removeClass("active"),s.removeClass("active")})},autoloadMoreComments:function(){var e,t,a,i,o;0<q(".bb-activity-model-wrapper").length&&"none"!==q(".bb-activity-model-wrapper").css("display")&&(e=q(".bb-modal-activity-body .activity-comments > ul > li.acomments-view-more:not(.loading), .bb-modal-activity-body .activity-comments .activity-actions > ul > li.acomments-view-more:not(.loading)"),t=q(".bb-activity-model-wrapper .bb-modal-activity-body"),o=q(".bb-activity-model-wrapper .bb-modal-activity-body").find(".activity-comments:not(.active)"),0<e.length&&0<t.length&&0<o.length&&(o=q(e).offset().top,i=(a=q(t).scrollTop())+q(t).height(),(o=o-q(t).offset().top+a)<i)&&o+q(e).outerHeight()>a&&q(e).trigger("click").addClass("loading"),setTimeout(function(){jQuery(window).scroll()},200))},activitySyncOnModalClose:function(e,t){e.preventDefault();var e=(q(e.currentTarget).is(document)?q(".bb-activity-model-wrapper"):q(e.currentTarget).parents(".bb-activity-model-wrapper")).find("ul.activity-list > li").data("bp-activity-id"),t=void 0!==t?t:e,a=q("#activity-stream li.activity-item[data-bp-activity-id="+t+"]");void 0!==bp.Nouveau.Activity.activityPinHasUpdates&&bp.Nouveau.Activity.activityPinHasUpdates?(0<a.length&&a.addClass("activity-sync"),bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities()):0<a.length&&bp.Nouveau.Activity.activityHasUpdates&&(a.addClass("activity-sync"),bp.Nouveau.ajax({action:"activity_sync_from_modal",activity_id:t},"activity").done(function(e){!1!==e.success&&void 0!==e.data&&void 0!==e.data.activity&&(a.replaceWith(q.parseHTML(e.data.activity)),jQuery(window).scroll(),bp.Nouveau.Activity.activityPinHasUpdates)&&(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities())}).fail(function(e){console.error("Request failed:",e)})),bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.activityPinHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null},discardGifEmojiPicker:function(){var e=q("#activity-modal > .bb-modal-activity-body .activity-item").data("bp-activity-id");0<q("#activity-modal").length&&0<q(".emojionearea-theatre.show").length&&q(".bb-activity-model-wrapper #ac-input-"+e).data("emojioneArea").hidePicker(),0<q("#activity-modal").length&&0<q(".gif-media-search-dropdown-standalone.open").length&&(q(".gif-media-search-dropdown-standalone").removeClass("open"),q("#activity-modal").find(".ac-reply-gif-button").removeClass("active"))},initializeEmojioneArea:function(e,a,i){q.fn.emojioneArea&&q(a+"#ac-input-"+i).emojioneArea({standalone:!0,hideSource:!1,container:a+"#ac-reply-emoji-button-"+i,detachPicker:!!e,containerPicker:e?".emojionearea-theatre":null,autocomplete:!1,pickerPosition:"top",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){q(a+"#ac-input-"+i)[0].emojioneArea.hidePicker();var e=q(a+"#ac-form-"+i+" #ac-input-"+i),t=e.html(),t=q.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));t=t.replace(/&nbsp;/g," "),""!==e.text()||0<=t.indexOf("emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},picker_show:function(){q(this.button[0]).closest(".post-emoji").addClass("active"),q(".emojionearea-theatre").removeClass("hide").addClass("show")},picker_hide:function(){q(this.button[0]).closest(".post-emoji").removeClass("active"),q(".emojionearea-theatre").removeClass("show").addClass("hide")}}})},openActivityFilter:function(e){e.preventDefault(),q(".bb-subnav-filters-container:not(.bb-subnav-filters-search)").removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false");e=q(e.currentTarget).parent(".bb-subnav-filters-container");e.addClass("active").find(".subnav-filters-opener").attr("aria-expanded","true"),e.find('input[type="search"]').length&&e.find('input[type="search"]').focus()},closeActivityFilter:function(e){q(e.target).closest(".bb-subnav-filters-container").length||q.each(q(".bb-subnav-filters-container"),function(){(!q(this).hasClass("bb-subnav-filters-search")||""===q(this).find('input[name="activity_search"]').val())&&q(this).removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false")})},filterActivity:function(e){e.preventDefault();var e=q(e.currentTarget),t=e.closest(".bb-subnav-filters-container"),t=(e.parent().addClass("selected").siblings().removeClass("selected"),t.removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false"),t.find(".subnav-filters-opener .selected").text(e.text()),bp.Nouveau.Activity.current_page=1,bp.Nouveau.objectNavParent),a="activity",i=q("#buddypress").find('[data-bp-filter="'+a+'"]').first().val(),o="",d="",s="",n="",c=!1,r=!1,t=(q(t+" [data-bp-object].selected").length&&(o=q(t+" [data-bp-object].selected").data("bp-scope"),e.closest("#bb-subnav-filter-show").length)&&(c=!0,q("body").hasClass("my-activity"))&&(r=!(c=!1)),q('#buddypress [data-bp-search="'+a+'"] input[type=search]').length&&(d=q('#buddypress [data-bp-search="'+a+'"] input[type=search]').val()),q(t+" [data-bp-order]").length&&(s=q(t+' [data-bp-order="'+a+'"].selected').data("bp-orderby")),bp.Nouveau.getStorage("bp-"+a)),a=(void 0!==t.extras&&(n=t.extras),bp.Nouveau.Activity.heartbeat_data.last_recorded=0,{object:a,scope:o,filter:i,search_terms:d,extras:n,order_by:s,save_scope:c,event_element:e});r&&(a.user_timeline=!0),t.topic_id&&(a.topic_id=t.topic_id),bp.Nouveau.objectRequest(a)}},bp.Nouveau.Activity.start())})((bp,jQuery));