window.bp=window.bp||{},function(g){var e,s,f,n,C,l,w,t,d,r,c,m;"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),s=(e=BP_Nouveau).ajaxurl,f=e.media,n=e.is_send_ajax_request,C=e.activity,l=e.newest,w=e.show_x_comments,t=e.confirm,d=e.nonces,r=e.document,c=e.video,m=e.is_as3cf_active,bp.Nouveau.Activity={start:function(){bp.Nouveau.Activity.LocalizeActivityVars=e,this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(g(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:g(document).prop("title")},void 0!==window.Dropzone&&void 0!==f&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:s,timeout:108e5,dictFileTooBig:f.dictFileTooBig,dictDefaultMessage:f.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==f.maxFiles?f.maxFiles:10,maxFilesize:void 0!==f.max_upload_size?f.max_upload_size:2,dictMaxFilesExceeded:f.media_dict_file_exceeded,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==f.max_upload_size?f.max_upload_size:2},void 0!==f.dropzone_options&&Object.assign(this.dropzone_options,f.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[],this.activityHasUpdates=!1,this.activityPinHasUpdates=!1},addListeners:function(){var e=g("body"),t=g("#buddypress"),a=g(document),i=g("#activity-modal > .bb-modal-activity-body");e.hasClass("activity-singular")||t.on("bp_heartbeat_send",this.heartbeatSend.bind(this)),t.on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),t.find('[data-bp-list="activity"]:not( #bb-schedule-posts_modal [data-bp-list="activity"] )').on("click","li.load-newest, li.bb-rl-load-more",this.injectActivities.bind(this)),t.on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),g("#bb-rl-activity-stream").on("click",".acomments-view-more",this.showActivity),e.on("click",".bb-close-action-popup",this.closeActivity),a.on("activityModalOpened",function(e,t){var i=t.activityId;a.on("click",function(e){!(0<g("#activity-modal:visible").length&&0===g("#bb-rl-activity-form-placeholder:visible").length)||g(e.target).closest("#activity-modal").length||g(e.target).closest(".bb-rl-gif-media-search-dropdown-standalone").length||g(e.target).closest(".emojionearea-theatre").length||g(e.target).hasClass("dz-hidden-input")||(this.closeActivity(e),this.activitySyncOnModalClose(e,i))}.bind(this))}.bind(this));e='[data-bp-list="activity"], #activity-modal, #bb-media-model-container .bb-rl-activity-list';t.find(e).on("click",".bb-rl-activity-item",bp.Nouveau,this.activityActions.bind(this)),t.find(e).on("click",".bb-rl-activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),t.find(e).on("click",".bb-rl-activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),t.find(e).on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),g("#bb-media-model-container .bb-rl-activity-list").on("click",".bb-rl-activity-item",bp.Nouveau,this.activityActions.bind(this)),g(".bb-activity-model-wrapper").on("click",".ac-form-placeholder",bp.Nouveau,this.activityRootComment.bind(this)),a.keydown(this.commentFormAction),a.click(this.togglePopupDropdown);t.find('[data-bp-list="activity"], #bb-media-model-container .bb-rl-activity-list, #activity-modal .bb-rl-activity-list, .bb-modal-activity-footer').on("click",".ac-reply-media-button, .ac-reply-document-button, .ac-reply-video-button, .ac-reply-gif-button",function(e){g(e.target).hasClass("ac-reply-media-button")?this.openCommentsMediaUploader(e):g(e.target).hasClass("ac-reply-document-button")?this.openCommentsDocumentUploader(e):g(e.target).hasClass("ac-reply-video-button")?this.openCommentsVideoUploader(e):g(e.target).hasClass("ac-reply-gif-button")&&this.openGifPicker(e)}.bind(this)),a.on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),a.on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(C.params.autoload)||g(window).scroll(this.loadMoreActivities),g(".bb-activity-model-wrapper, .bb-media-model-wrapper").on("click",".acomments-view-more",this.viewMoreComments.bind(this)),a.on("click","#bb-rl-activity-stream .bb-rl-activity-comments .view-more-comments, #bb-rl-activity-stream .activity-state-comments > .comments-count",function(e){e.preventDefault(),g(this).parents("li.bb-rl-activity-item").find(".bb-rl-activity-comments > ul > li.acomments-view-more, .bb-rl-activity-comments > .activity-actions > ul > li.acomments-view-more").trigger("click")}),i.on("scroll",this.autoloadMoreComments.bind(this)),i.on("scroll",this.discardGifEmojiPicker.bind(this)),g(".bb-activity-model-wrapper .bb-model-close-button").on("click",this.activitySyncOnModalClose.bind(this));function o(){g(".ac-form.not-initialized").each(function(){var e=g(this),t=e.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(e,t)})}"1"===n?t.on("bp_ajax_request",'[data-bp-list="activity"]',function(){setTimeout(o,1e3)}):setTimeout(o,1e3)},heartbeatSend:function(e,t){var i=g("#buddypress [data-bp-list] [data-bp-activity-id]"),a=i.not(".bb-pinned").first();this.heartbeat_data.first_recorded=a.data("bp-timestamp")||0;i=i.first().data("bp-timestamp")||0;i>this.heartbeat_data.first_recorded&&(this.heartbeat_data.first_recorded=i),(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),t.bp_activity_last_recorded=this.heartbeat_data.last_recorded;i=g("#buddypress .dir-search input[type=search]");i.length&&(t.bp_activity_last_recorded_search_terms=i.val()),g.extend(t,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,t){var i,a,o,n=bp.Nouveau.objects,s=bp.Nouveau.getStorage("bp-activity","scope"),d=this;void 0!==t&&t.bp_activity_newest_activities&&(i=t.bp_activity_newest_activities,this.heartbeat_data.newest=g.trim(i.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(i.last_recorded),o=g(this.heartbeat_data.newest).filter(".bb-rl-activity-item"),t=Number(o.length),n.push("mentions"),"all"===s?(g.each(o,function(e,i){i=g(i),g.each(n,function(e,t){-1!==g.inArray("bp-my-"+t,i.get(0).classList)&&(void 0===d.heartbeat_data.highlights[t]?d.heartbeat_data.highlights[t]=[i.data("bp-activity-id")]:-1===g.inArray(i.data("bp-activity-id"),d.heartbeat_data.highlights[t])&&d.heartbeat_data.highlights[t].push(i.data("bp-activity-id")))})}),a=new RegExp("bp-my-("+n.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(a,""),g(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(t)):(this.heartbeat_data.highlights[s]=[],g.each(o,function(e,t){d.heartbeat_data.highlights[s].push(g(t).data("bp-activity-id"))})),g.each(n,function(e,t){var i;void 0!==d.heartbeat_data.highlights[t]&&d.heartbeat_data.highlights[t].length&&(i=0,"mentions"===t&&(i=d.mentions_count),g(bp.Nouveau.objectNavParent+' [data-bp-scope="'+t+'"]').find("a span").html(Number(d.heartbeat_data.highlights[t].length)+i))}),n.pop(),g(document).prop("title","("+t+") "+this.heartbeat_data.document_title),a=(i=g('#buddypress [data-bp-list="activity"]')).find(".load-newest a"),i.first().hasClass("load-newest")?(o=a.html(),a.html(o.replace(/([0-9]+)/,t))):i.find("ul.bb-rl-activity-list").prepend('<li class="load-newest"><a href="#newest">'+l+" ("+t+")</a></li>"),i.find("li.load-newest").trigger("click"),i.trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp())},injectActivities:function(e){var t,i,a,o,n,s=bp.Nouveau.getStorage("bp-activity"),d=s.scope||null,s=s.filter||null;g(e.currentTarget).hasClass("load-newest")?(e.preventDefault(),g(e.currentTarget).remove(),a=g.parseHTML(this.heartbeat_data.newest),g.each(a,function(e,t){"LI"!==t.nodeName||!g(t).hasClass("just-posted")||(t=g("#"+g(t).prop("id"))).length&&t.remove()}),(0<(a=(n=g(e.delegateTarget).find(".bb-rl-activity-list")).find(".bb-rl-activity-item").first()).length&&a.hasClass("bb-pinned")?g(a).after(this.heartbeat_data.newest):n.prepend(this.heartbeat_data.newest)).find("li.bb-rl-activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===d&&g(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===d&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),g(bp.Nouveau.objectNavParent+' [data-bp-scope="'+d+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[d]&&(this.heartbeat_data.highlights[d]=[]),setTimeout(function(){g(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+d+"_activity")},3e3),g(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()):g(e.currentTarget).hasClass("bb-rl-load-more")&&(t=Number(this.current_page)+1,i=this,a="",e.preventDefault(),(o=g(e.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],g(e.delegateTarget).children(".just-posted").each(function(){i.just_posted.push(g(this).data("bp-activity-id"))}),(n=g("#buddypress .dir-search input[type=search]")).length&&(a=n.val()),bp.Nouveau.objectRequest({object:"activity",scope:d,filter:s,search_terms:a,page:t,method:"append",exclude_just_posted:this.just_posted.join(","),target:'#buddypress [data-bp-list]:not( #bb-schedule-posts_modal [data-bp-list="activity"] ) ul.bb-rl-list'}).done(function(e){!0===e.success&&(o.remove(),i.current_page=t,jQuery(window).scroll())})),g(".bb-rl-activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide()},hideComments:function(e){var i,a,o,e=g(e.target).find(".bb-rl-activity-comments");e.length&&e.each(function(e,t){o=g(t).children("ul").not(".conflict-activity-ul-li-comment"),(a=g(o).find("li").not(g(".document-action-class, .media-action-class, .video-action-class"))).length&&(g("body").hasClass("activity-singular")&&""!==window.location.hash&&g(window.location.hash).length&&0!==g(window.location.hash).closest(".bb-rl-activity-comments").length||(i=g(t).closest(".bb-rl-activity-item"),g("#acomment-comment-"+i.data("bp-activity-id")+" span.comment-count").html(),a.each(function(e,t){if(e<a.length-4){if(e||g(t).parent("ul").before('<div class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+i.prop("id")+'/show-all/">'+w+"</button></div>"),window.location.hash&&"#"+g(t).attr("id")===window.location.hash)return g(t).parents("li.comment-item").show(),!1;g(t).addClass("bp-hidden").hide()}}),g(o).children(".bp-hidden").length===g(o).children("li").length-1&&g(o).find("li.show-all").length&&g(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle()))})},showActivity:function(e){e.preventDefault();var t=g(e.currentTarget).parent(),i=t.data("parent_comment_id"),t=g(t).data("activity_id");g(document).trigger("activityModalOpened",{activityId:t}),g(e.currentTarget).parents(".bb-rl-activity-comments").find(".ac-form").each(function(){var e=g(this),t=g(this).closest(".bb-rl-activity-comments"),i=g(this).closest(".comment-item");e.find(".bb-rl-post-elements-buttons-item.bb-rl-post-emoji").removeClass("active").empty(""),bp.Nouveau.Activity.resetActivityCommentForm(e,"hardReset"),t.append(e),i.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),i.removeClass("bb-rl-comment-item-focus")}),bp.Nouveau.Activity.launchActivityPopup(t,i)},closeActivity:function(e){e.preventDefault();var t=g(e.target).closest(".bb-activity-model-wrapper"),i=t.find(".bb-modal-activity-footer"),a=t.find(".bb-rl-activity-item").data("bp-activity-id"),e=t.find("#ac-form-"+a);e.length&&bp.Nouveau.Activity.reinitializeActivityCommentForm(e),_.isUndefined(f)||_.isUndefined(f.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!1,"",a),t.find("#activity-modal").removeClass("bb-closed-comments"),t.closest("body").removeClass("acomments-modal-open"),t.hide(),t.find("ul.bb-rl-activity-list").empty(),i.removeClass("active"),i.find("form.ac-form").remove()},scopeLoaded:function(e,i){this.current_page=1;var a=g("#buddypress #bb-rl-activity-stream");"mentions"===i.scope&&void 0!==i.response.new_mentions?(g.each(i.response.new_mentions,function(e,t){a.find('[data-bp-activity-id="'+t+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[i.scope]&&this.heartbeat_data.highlights[i.scope].length&&g.each(this.heartbeat_data.highlights[i.scope],function(e,t){a.find('[data-bp-activity-id="'+t+'"]').length&&a.find('[data-bp-activity-id="'+t+'"]').addClass("newest_"+i.scope+"_activity")}),this.heartbeat_data.newest="",g.each(g(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,t){"0"===g(t).html()&&g(t).html("")}),void 0!==this.heartbeat_data.highlights[i.scope]&&(this.heartbeat_data.highlights[i.scope]=[]),g(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){g("#buddypress #bb-rl-activity-stream .bb-rl-activity-item").removeClass("newest_"+i.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){var e,t;!_.isUndefined(C.params.is_activity_edit)&&0<C.params.is_activity_edit&&((t=g("#bb-rl-activity-"+C.params.is_activity_edit)).length&&(e=t.data("bp-activity"),t=""!==t.data("link-url")?t.data("link-url"):null,_.isUndefined(e)||bp.Nouveau.Activity.postForm.displayEditActivityForm(e,t)))},activityPrivacyChange:function(e){var t=e.data,o=g(e.target),n=g(e.currentTarget).closest(".bb-rl-activity-item"),s=n.data("bp-activity-id");e.preventDefault();var d=o.data("value");if(void 0===d||""===g.trim(d))return!1;n.find(".privacy").addClass("loading"),t.ajax({action:"activity_update_privacy",id:s,privacy:d},"activity").done(function(e){var t,i,a;n.find(".privacy").removeClass("loading"),!0===e.success&&(a=n.find(".privacy"),n.find(".bb-rl-activity-privacy li").removeClass("selected"),n.find(".bb-rl-privacy-wrap").attr("data-bp-tooltip",o.text()),o.addClass("selected"),a.removeClass("public loggedin onlyme friends").addClass(d),void 0!==e&&void 0!==e.data&&void 0!==e.data.video_symlink&&(i=(t=g(".document-description-wrap")).find(".bb-open-document-theatre"),a=g(".document-detail-wrap.document-detail-wrap-description-popup"),t.length&&i.length&&i.attr({"data-video-preview":e.data.video_symlink,"data-extension":e.data.extension}),t.length&&a.length&&a.attr({"data-video-preview":e.data.video_symlink,"data-extension":e.data.extension}),"undefined"!=typeof videojs&&e.data.video_js_id&&videojs(e.data.video_js_id).src({type:e.data.video_extension,src:e.data.video_symlink})),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=s)})},activityPrivacyRedirect:function(e){var t=g(e.target);e.preventDefault();t=t.data("value");if(void 0===t||""===g.trim(t))return!1;window.location.href=t},togglePrivacyDropdown:function(e){var t=g(e.currentTarget).closest(".bb-rl-activity-item");e.preventDefault();t=t.find(".bb-rl-activity-privacy");g("ul.bb-rl-activity-privacy").not(t).removeClass("bb-open"),t.toggleClass("bb-open")},activityActions:function(e){var t=e.data,i=g(e.target),a=g(e.currentTarget),o=a.data("bp-activity-id"),n=g(e.delegateTarget),s=a.find(".activity-state"),d=a.find(".comments-count"),l=this,r=g("body"),c=0<i.closest("#activity-modal").length,m=0<i.closest(".bb-internal-model").length;c&&(s=a.closest("#activity-modal").find(".activity-state"),d=a.closest("#activity-modal").find(".comments-count"));var p=0;!(i=g(i).is("span")||g(i).is("i")||g(i).is("img")?g(i).closest("a"):i).parent(".ac-emotion_btn")||i.hasClass("fav")||i.hasClass("unfav")||(p=i.parents(".ac-emotion_item").attr("data-reaction-id")),(i.hasClass("fav")||i.hasClass("unfav")||0<p)&&l.handleFavoriteUnfavorite({event:e,parent:t,target:i,reactionId:p,activityState:s,bodyElem:r,stream:n,activityItem:a}),(i.hasClass("delete-activity")||i.hasClass("acomment-delete")||i.hasClass("spam-activity")||i.hasClass("spam-activity-comment"))&&l.deleteActivity({event:e,parent:t,target:i,activityState:s,activityItem:a,commentsText:d,activityId:o}),i.closest("span").hasClass("activity-read-more")&&l.readMoreActivity({event:e,target:i,activityId:o}),i.hasClass("ac-form")&&i.hasClass("not-initialized")&&i.closest(".bb-rl-activity-item").find(".acomment-reply").eq(0).trigger("click"),(i.hasClass("activity-state-comments")||i.hasClass("acomment-reply")||i.parent().hasClass("acomment-reply")||i.hasClass("acomment-edit"))&&l.displayingTheCommentForm({event:e,target:i,activityId:o,isInsideModal:c,isInsideMediaTheatre:m,self:l}),i.hasClass("activity-state-no-comments")&&e.preventDefault(),i.hasClass("ac-reply-cancel")&&((m=g(i).closest(".ac-form")).addClass("not-initialized"),g(".acomment-reply").attr("aria-expanded","false"),["media","document"].forEach(function(e){l.destroyUploader(e,o)}),l.resetActivityCommentForm(m),e.preventDefault()),"ac_form_submit"===i.prop("name")&&l.submitActivityComment({event:e,parent:t,target:i,activityId:o,isInsideModal:c,activityState:s,commentsText:d,activityItem:a,self:l}),i.hasClass("edit")&&i.hasClass("edit-activity")&&(e.preventDefault(),d=a.data("bp-activity"),a=""!==a.data("link-url")?a.data("link-url"):null,void 0!==d&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(d,a),g("#bp-nouveau-activity-form").toggleClass("group-activity",i.closest("li").hasClass("groups")),void 0!==bp.Nouveau.Media&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&g(".bb-close-media-theatre, .bb-close-document-theatre").trigger("click"))),c&&(i.hasClass("bb-open-media-theatre")||i.hasClass("bb-open-video-theatre")||i.hasClass("bb-open-document-theatre")||i.hasClass("document-detail-wrap-description-popup"))&&(e.preventDefault(),i.closest("#activity-modal").find(".bb-modal-activity-header .bb-close-action-popup").trigger("click")),(i.hasClass("pin-activity")||i.hasClass("unpin-activity"))&&l.pinUnpinActivity({event:e,activityId:o,parent:t,target:i,isInsideModal:c}),(i.hasClass("bb-icon-bell-slash")||i.hasClass("bb-icon-bell"))&&l.muteUnmuteNotifications({event:e,activityId:o,parent:t,target:i,isInsideModal:c}),(i.hasClass("close-activity-comment")||i.hasClass("unclose-activity-comment"))&&l.onOffComment({event:e,activityId:o,parent:t,target:i,isInsideModal:c})},commentFormAction:function(e){var t,i;return 3===(t=(e=e||window.event).target||e.srcElement).nodeType&&(t=t.parentNode),!0!==e.altKey&&!0!==e.metaKey&&"TEXTAREA"===t.tagName&&g(t).hasClass("ac-input")?void(27===(i=e.keyCode||e.which)&&!1===e.ctrlKey?g(t).closest("form").slideUp(200):e.ctrlKey&&13===i&&g(t).val()&&g(t).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var t;return 3===(t=(e=e||window.event).target||e.srcElement).nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||g(t).closest(".bb-rl-privacy-wrap").length?e:void g("ul.bb-rl-activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e,t=g(".bb-rl-load-more:visible").last(),i=g(window);0!==t.length&&t.closest(".bb-rl-activity-list").length&&!0!==t.data("bp-autoloaded")&&(e=t.offset().top-50,i.scrollTop()+i.height()>e&&(t.data("bp-autoloaded",1),t.find("a").text(C.strings.loadingMore),t.find("a").trigger("click")))},openCommentsMediaUploader:function(e){var l=this,o=g(e.currentTarget),t=o.data("ac-id"),i=o.closest(".bp-ac-form-container").find("#ac-reply-post-media-uploader-"+t),a=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),i.hasClass("open")&&!e.isCustomEvent)return i.trigger("click"),void i.removeClass("open").addClass("closed");var t=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"";void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t={url:s,timeout:108e5,dictFileTooBig:f.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:f.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==f.maxFiles?f.maxFiles:10,maxFilesize:void 0!==f.max_upload_size?f.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:f.media_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==f.max_upload_size?f.max_upload_size:2},l.dropzone_obj instanceof Dropzone&&l.dropzone_obj.destroy(),l.dropzone_obj=new Dropzone(a+"#ac-reply-post-media-uploader-"+o.data("ac-id"),t),l.dropzone_obj.on("addedfile",function(e){e.media_edit_data&&(l.dropzone_media.push(e.media_edit_data),(e=o.parents(".ac-reply-toolbar")).find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active"))}),l.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",d.media);var a=o.parents(".ac-reply-toolbar"),i=o.closest(".ac-form");bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),i.addClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),l.dropzone_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),l.dropzone_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=g(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==f&&void 0!==f.album_id&&f.album_id,t.data.group_id=void 0!==f&&void 0!==f.group_id&&f.group_id,t.data.saved=!1,l.dropzone_media.push(t.data),e.previewElement.classList.add("dz-success");var i,a,o,n,s,d=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=n[a],s.push(i.textContent=d);return _.isNull(l.dropzone_obj.files)||0!==l.dropzone_obj.files.length||g(l.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),l.dropzone_obj.on("accept",function(e,t){0===e.size?t(f.empty_document_type):t()}),l.dropzone_obj.on("error",function(e,t){var i;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?g(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&g(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(i=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(i),i.find(".ac-reply-content").after('<div class="bb-rl-notice bb-rl-notice--error">'+t+"</div>"),this.removeFile(e),i.removeClass("media-uploading"))}),l.dropzone_obj.on("removedfile",function(e){if(l.dropzone_media.length)for(var t in l.dropzone_media)if(e.upload.uuid===l.dropzone_media[t].uuid){void 0===l.dropzone_media[t].saved||l.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(l.dropzone_media[t].id),l.dropzone_media.splice(t,1);break}var i,a;_.isNull(l.dropzone_obj)||_.isNull(l.dropzone_obj.files)||0!==l.dropzone_obj.files.length?o.closest(".ac-form").addClass("has-content"):(i=o.parents(".ac-reply-toolbar"),(a=o.closest(".ac-form")).removeClass("has-media"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").removeClass("no-click").find(".bb-rl-toolbar-button").removeClass("active"),g(l.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),l.validateCommentContent(a.find(".ac-textarea").children(".ac-input")))}),l.dropzone_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),i.removeClass("closed").addClass("open")):(l.dropzone_obj&&void 0!==l.dropzone_obj&&l.dropzone_obj.destroy(),l.dropzone_media=[],i.html(""),i.addClass("closed").removeClass("open")));var n=e.currentTarget.id.match(/\d+$/)[0];["document","video"].forEach(function(e){l.destroyUploader(e,n)});i=g(e.currentTarget).data("ac-id");this.resetGifPicker(i),e.isCustomEvent||g(o).closest(".bp-ac-form-container").find(".dropzone.media-dropzone").trigger("click")},openCommentsDocumentUploader:function(e){var l=this,o=g(e.currentTarget),t=o.data("ac-id"),i=o.closest(".bp-ac-form-container").find("#ac-reply-post-document-uploader-"+t),a=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),g(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(i.hasClass("open")&&!e.isCustomEvent)return void i.trigger("click")}else g(e.currentTarget).toggleClass("active");var t=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t={url:s,timeout:108e5,dictFileTooBig:f.dictFileTooBig,acceptedFiles:f.document_type,createImageThumbnails:!1,dictDefaultMessage:f.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==r.maxFiles?r.maxFiles:10,maxFilesize:void 0!==r.max_upload_size?r.max_upload_size:2,dictInvalidFileType:r.dictInvalidFileType,dictMaxFilesExceeded:f.document_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation},l.dropzone_document_obj=new Dropzone(a+"#ac-reply-post-document-uploader-"+o.data("ac-id"),t),l.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&l.dropzone_document.push(e.document_edit_data);var t=e.upload.filename,t=t.substr(t.lastIndexOf(".")+1);g(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+t);t=o.parents(".ac-reply-toolbar");t.find(".ac-reply-document-button")&&t.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active")}),l.dropzone_document_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",d.media);i=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),l.dropzone_document_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),l.dropzone_document_obj.on("accept",function(e,t){0===e.size?t(f.empty_document_type):t()}),l.dropzone_document_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=g(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==f&&void 0!==f.album_id&&f.album_id,t.data.group_id=void 0!==f&&void 0!==f.group_id&&f.group_id,t.data.saved=!1,l.dropzone_document.push(t.data),e.previewElement.classList.add("dz-success");var i,a,o,n,s,d=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=n[a],s.push(i.textContent=d);return _.isNull(l.dropzone_document_obj.files)||0!==l.dropzone_document_obj.files.length||g(l.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),l.dropzone_document_obj.on("error",function(e,t){var i;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?g(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&g(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(i=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(i),i.find(".ac-reply-content").after('<div class="bb-rl-notice bb-rl-notice--error">'+t+"</div>"),this.removeFile(e),i.removeClass("media-uploading"))}),l.dropzone_document_obj.on("removedfile",function(e){if(l.dropzone_document.length)for(var t in l.dropzone_document)if(e.upload.uuid===l.dropzone_document[t].uuid){void 0===l.dropzone_document[t].saved||l.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(l.dropzone_document[t].id),l.dropzone_document.splice(t,1);break}var i,a;_.isNull(l.dropzone_document_obj)||_.isNull(l.dropzone_document_obj.files)||0!==l.dropzone_document_obj.files.length?o.closest(".ac-form").addClass("has-content"):(i=o.parents(".ac-reply-toolbar"),(a=o.closest(".ac-form")).removeClass("has-media"),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").removeClass("no-click").find(".bb-rl-toolbar-button").removeClass("active"),g(l.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),l.validateCommentContent(a.find(".ac-textarea").children(".ac-input")))}),l.dropzone_document_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),i.removeClass("closed").addClass("open")):(l.dropzone_document_obj&&l.dropzone_document_obj.destroy(),l.dropzone_document=[],i.html(""),i.addClass("closed").removeClass("open")));var n=e.currentTarget.id.match(/\d+$/)[0];["media","video"].forEach(function(e){l.destroyUploader(e,n)});i=g(e.currentTarget).data("ac-id");this.resetGifPicker(i),e.isCustomEvent||g(o).closest(".bp-ac-form-container").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var l=this,o=g(e.currentTarget),t=o.data("ac-id"),i=o.closest(".bp-ac-form-container").find("#ac-reply-post-video-uploader-"+t),a=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),g(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(i.hasClass("open")&&!e.isCustomEvent)return void i.trigger("click")}else g(e.currentTarget).toggleClass("active");var t=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t={url:s,timeout:108e5,dictFileTooBig:c.dictFileTooBig,acceptedFiles:c.video_type,createImageThumbnails:!1,dictDefaultMessage:c.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==c.maxFiles?c.maxFiles:10,maxFilesize:void 0!==c.max_upload_size?c.max_upload_size:2,dictInvalidFileType:c.dictInvalidFileType,dictMaxFilesExceeded:c.video_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:c.dictCancelUploadConfirmation},l.dropzone_video_obj=new Dropzone(a+"#ac-reply-post-video-uploader-"+o.data("ac-id"),t),l.dropzone_video_obj.on("sending",function(e,t,i){i.append("action","video_upload"),i.append("_wpnonce",d.video);i=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),l.dropzone_video_obj.on("accept",function(e,t){0===e.size?t(c.empty_video_type):t()}),l.dropzone_video_obj.on("addedfile",function(e){var t;e.video_edit_data&&(l.dropzone_video.push(e.video_edit_data),(t=o.parents(".ac-reply-toolbar")).find(".ac-reply-video-button")&&t.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".bb-rl-toolbar-button").addClass("active")),e.dataURL&&e.video_edit_data.thumb.length?(g(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' "  alt=""/>'),g(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),l.dropzone_video_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),l.dropzone_video_obj.on("success",function(e,t){if(100===e.upload.progress&&(g(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,g(e.previewElement).find(".dz-progress-count").text("100% "+c.i18n_strings.video_uploaded_text),g(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=g(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==c&&void 0!==c.album_id&&c.album_id,t.data.group_id=void 0!==c&&void 0!==c.group_id&&c.group_id,t.data.saved=!1,t.data.js_preview=g(e.previewElement).find(".dz-video-thumbnail img").attr("src"),l.dropzone_video.push(t.data),e.previewElement.classList.add("dz-success");var i,a,o,n,s,d=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=n[a],s.push(i.textContent=d);return _.isNull(l.dropzone_video_obj.files)||0!==l.dropzone_video_obj.files.length||g(l.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),l.dropzone_video_obj.on("error",function(e,t){var i;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?g(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&g(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(i=o.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(i),i.find(".ac-reply-content").after('<div class="bb-rl-notice bb-rl-notice--error">'+t+"</div>"),this.removeFile(e),i.removeClass("media-uploading"))}),l.dropzone_video_obj.on("removedfile",function(e){if(l.dropzone_video.length)for(var t in l.dropzone_video)if(e.upload.uuid===l.dropzone_video[t].uuid){void 0===l.dropzone_video[t].saved||l.dropzone_video[t].saved||bp.Nouveau.Media.removeAttachment(l.dropzone_video[t].id),l.dropzone_video.splice(t,1);break}var i,a;_.isNull(l.dropzone_video_obj)||_.isNull(l.dropzone_video_obj.files)||0!==l.dropzone_video_obj.files.length?o.closest(".ac-form").addClass("has-content"):(i=o.parents(".ac-reply-toolbar"),(a=o.closest(".ac-form")).removeClass("has-media"),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".bb-rl-post-elements-buttons-item").removeClass("no-click").find(".bb-rl-toolbar-button").removeClass("active"),g(l.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),l.validateCommentContent(a.find(".ac-textarea").children(".ac-input")))}),l.dropzone_video_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),i.removeClass("closed").addClass("open")):(l.dropzone_video_obj&&l.dropzone_video_obj.destroy(),l.dropzone_video=[],i.html(""),i.addClass("closed").removeClass("open")));var n=e.currentTarget.id.match(/\d+$/)[0];["media","video"].forEach(function(e){l.destroyUploader(e,n)});i=g(e.currentTarget).data("ac-id");this.resetGifPicker(i),e.isCustomEvent||g(o).closest(".bp-ac-form-container").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var t=e.currentTarget,i=0<g(t).closest("#activity-modal").length,a=i?"#activity-modal ":"",o=i,n=i?g(".bb-rl-gif-media-search-dropdown-standalone"):g(t).next(),s=t.id.match(/\d+$/)[0],d=g(a+"#ac-reply-post-gif-"+s),l=g(window).scrollTop(),r=g(t).offset(),e=Math.round(r.top),a=Math.round(r.left);n.is(":empty")&&(c=new bp.Models.ACReply,r=new bp.Views.GifMediaSearchDropdown({model:c,standalone:o}),o=new bp.Views.ActivityAttachedGifPreview({model:c,standalone:o}),n.html(r.render().el),d.html(o.render().el),this.models[s]=c);var c=g(t).parents(".ac-textarea ").find(".ac-reply-attachments .bb-rl-activity-attached-gif-container");g(t).hasClass("active")&&c.length&&""===g.trim(c.html())?g(t).removeClass("active"):g(t).addClass("active"),n.toggleClass("open");c=a+n.width()-70;2<g(t).parents("li").length&&(c=a+n.width()-110),1<g(t).closest(".bb-rl-post-elements-buttons-item").index()&&(c=a+n.width()-180),i&&n.css("transform","translate("+c+"px, "+(e-l-5)+"px)  translate(-100%, -100%)");var m=this;["media","document","video"].forEach(function(e){m.destroyUploader(e,s)})},toggleMultiMediaOptions:function(e,t,i){var a,o;_.isUndefined(f)||(i?(o=(t=g(t||i)).closest(".activity-modal").find(".bb-rl-activity-item"),a=t.closest(".activity-modal").find(".bb-rl-activity-item").data("bp-activity"),e=g(i)):(o=t.closest(".bb-rl-activity-item"),a=t.closest(".bb-rl-activity-item").data("bp-activity")),(i=t.closest("li").data("bp-activity-comment"))&&(a=i),i=function(e,t){return a&&!_.isUndefined(a[e])?a[e]:!1===f[e]?f[e]:t},t.closest("li").hasClass("groups")||o.hasClass("groups")?(o={group_media:i("group_media",!1),group_document:i("group_document",!1),group_video:i("group_video",!1),gif:f.gif.groups,emoji:f.emoji.groups},this.applyMediaSettings(e,o)):(i={profile_media:i("profile_media",!1),profile_document:i("profile_document",!1),profile_video:i("profile_video",!1),gif:f.gif.profile,emoji:f.emoji.profile},this.applyMediaSettings(e,i)))},applyMediaSettings:function(e,t){e.find(".ac-reply-toolbar .bb-rl-post-media.bb-rl-media-support").toggle(t.group_media||t.profile_media).parent(".ac-reply-toolbar").toggleClass("bb-rl-post-media-disabled",!(t.group_media||t.profile_media)),e.find(".ac-reply-toolbar .bb-rl-post-media.bb-rl-document-support").toggle(t.group_document||t.profile_document).parent(".ac-reply-toolbar").toggleClass("bb-rl-post-media-disabled",!(t.group_document||t.profile_document)),e.find(".ac-reply-toolbar .bb-rl-post-video.bb-rl-video-support").toggle(t.group_video||t.profile_video).parent(".ac-reply-toolbar").toggleClass("post-video-disabled",!(t.group_video||t.profile_video)),e.find(".ac-reply-toolbar .bb-rl-post-gif").toggle(!1!==t.gif).parent(".ac-reply-toolbar").toggleClass("post-gif-disabled",!1===t.gif),e.find(".ac-reply-toolbar .bb-rl-post-emoji").toggle(!1!==t.emoji).parent(".ac-reply-toolbar").toggleClass("post-emoji-disabled",!1===t.emoji)},fixAtWhoActivity:function(){g(".bb-rl-acomment-content, .bb-rl-activity-content").each(function(){for(var e=g(this).find("span.atwho-query"),t=e.length,i=0;i<t;i++)g(e[i]).replaceWith(e[i].innerText)})},navigateToSpecificComment:function(){setTimeout(function(){var e,t=window.location.hash;t&&(e=t,t=0!==(t=g("#wpadminbar")).length?t.innerHeight():0,0<g(e).length&&g("html, body").animate({scrollTop:parseInt(g(e).offset().top)-(80+t)},0))},200)},editActivityCommentForm:function(e,t){var i=e.find('input[name="comment_form_id"]').val(),a=e.find("#ac-reply-toolbar-"+i),o=e.find('input[name="ac_form_submit"]'),n=this;e.find("#ac-input-"+i).html(t.content);var s=o.attr("data-add-edit-label");o.attr("data-add-edit-label",o.val()).val(s);var d,l,r;void 0!==t.media&&0<t.media.length&&(a.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),[".ac-reply-document-button",".ac-reply-video-button",".ac-reply-gif-button"].forEach(function(e){n.disabledCommentUploader(a,e)}),n.injectFiles({toolbarDiv:a,commonData:t.media,id:t.id,self:this,fileType:"media",buttonClass:".ac-reply-media-button",dropzoneObj:n.dropzone_obj})),void 0!==t.document&&0<t.document.length&&(a.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),[".ac-reply-media-button",".ac-reply-video-button",".ac-reply-gif-button"].forEach(function(e){n.disabledCommentUploader(a,e)}),n.injectFiles({toolbarDiv:a,commonData:t.document,id:t.id,self:this,fileType:"document",buttonClass:".ac-reply-document-button",dropzoneObj:n.dropzone_document_obj})),void 0!==t.video&&0<t.video.length&&(a.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),[".ac-reply-media-button",".ac-reply-document-button",".ac-reply-gif-button"].forEach(function(e){n.disabledCommentUploader(a,e)}),n.injectFiles({toolbarDiv:a,commonData:t.video,id:t.id,self:this,fileType:"video",buttonClass:".ac-reply-video-button",dropzoneObj:n.dropzone_video_obj})),void 0!==t.gif&&0<Object.keys(t.gif).length&&(d=a.find(".ac-reply-gif-button").next(),r=0<e.closest("#activity-modal").length,l=g((r?"#activity-modal ":"")+"#ac-reply-post-gif-"+i),a.find(".ac-reply-gif-button").trigger("click"),[".ac-reply-media-button",".ac-reply-document-button",".ac-reply-video-button"].forEach(function(e){n.disabledCommentUploader(a,e)}),o=new bp.Models.ACReply,s=new bp.Views.GifMediaSearchDropdown({model:o}),r=new bp.Views.ActivityAttachedGifPreview({model:o}),s.model.set("gif_data",t.gif),d.html(s.render().el),l.html(r.render().el),this.models[i]=o),void 0===t.media&&void 0===t.document&&void 0===t.video&&void 0===t.gif&&e.find(".ac-reply-toolbar .bb-rl-post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e,t){var i,a,o,n;t=void 0!==t?t:"",!e.hasClass("acomment-edit")&&"hardReset"!==t||(i=e.find('input[name="comment_form_id"]').val(),o=e.attr("data-item-id"),a=g('[data-bp-activity-comment-id="'+o+'"]'),t=e.find('input[name="ac_form_submit"]'),a.find("#bb-rl-acomment-display-"+o).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),o=t.attr("data-add-edit-label"),t.attr("data-add-edit-label",t.val()).val(o),e.find(".bb-rl-post-elements-buttons-item").removeClass("disable"),e.find(".bb-rl-post-elements-buttons-item .bb-rl-toolbar-button").removeClass("active"),e.find("#ac-input-"+i).html(""),e.removeClass("has-content has-gif has-media"),n=this,["media","document","video","gif"].forEach(function(e){n.destroyUploader(e,i)}))},reinitializeActivityCommentForm:function(e){var t=e.find('input[name="comment_form_id"]').val(),i=e.find('input[name="ac_form_submit"]');e.hasClass("acomment-edit")&&(a=e.attr("data-item-id"),g('[data-bp-activity-comment-id="'+a+'"]').find("#bb-rl-acomment-display-"+a).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"));var a=i.attr("data-add-edit-label");i.attr("data-add-edit-label",i.val()).val(a),e.find("#ac-input-"+t).html(""),e.removeClass("has-content has-gif has-media"),g(".bb-modal-activity-footer").addClass("active").append(e);var o=this;["media","document","video","gif"].forEach(function(e){o.destroyUploader(e,t)})},disabledCommentUploader:function(e,t,i){i=i||"";var t=e.find(t);0<t.length&&(t=t.parents(".bb-rl-post-elements-buttons-item"),i?t.addClass(i):t.addClass("disable"))},validateCommentContent:function(e){var t=e.html(),i=(i=g.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),t=e.text().trim(),e=e.closest("form");""!==t||0<=i.indexOf("bb-rl-emojioneemoji")||e.hasClass("acomment-edit")?e.addClass("has-content"):e.removeClass("has-content")},ReactionStatePopupTab:function(e){e.preventDefault();e=g(this).closest(".activity-state-popup");e.find(".activity-state-popup_tab_panel li a").removeClass("active"),g(this).addClass("active"),e.find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),e.find("."+g(this).data("tab")).addClass("active")},closeActivityState:function(){g(".activity-state-popup").hide().removeClass("active")},listenCommentInput:function(e){var t,i;0<e.length&&(t=e.get(0),i=g(t).attr("id")+(g(t).closest(".bb-media-model-inner").length?"-theater":""),-1===g.inArray(i,this.InitiatedCommentForms)||g(t).closest("form").hasClass("events-initiated")||(e=this.InitiatedCommentForms.indexOf(i),this.InitiatedCommentForms.splice(e,1)),-1!==g.inArray(i,this.InitiatedCommentForms)||g(t).closest("form").hasClass("events-initiated")||(t.addEventListener("paste",function(e){e.preventDefault();e=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),t.addEventListener("input",function(e){var t=g(e.currentTarget).html(),t=g.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));t=t.replace(/&nbsp;/g," "),""!==g(e.currentTarget).text().trim()||0<=t.indexOf("bb-rl-emojioneemoji")?g(e.currentTarget).closest("form").addClass("has-content"):g(e.currentTarget).closest("form").removeClass("has-content")}),g(t).closest("form").addClass("events-initiated"),this.InitiatedCommentForms.push(i)))},activityRootComment:function(e){var t=g(e.currentTarget).closest("#activity-modal"),i=t.find(".bb-rl-activity-item").data("bp-activity-id"),e=t.find("#ac-form-"+i);bp.Nouveau.Activity.resetActivityCommentForm(e,"hardReset"),t.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),t.find(".comment-item").removeClass("bb-rl-comment-item-focus"),t.find(".bb-modal-activity-footer").addClass("active").append(e),e.addClass("root"),e.find("#ac-input-"+i).focus(),bp.Nouveau.Activity.clearFeedbackNotice(e)},clearFeedbackNotice:function(e){e=e.find(".bp-ac-form-container .bp-feedback");e.length&&e.remove()},launchActivityPopup:function(e,t){var i=g("#bb-rl-activity-"+e),a=g(".bb-activity-model-wrapper"),o=i[0].outerHTML,n='[data-parent_comment_id="'+t+'"]',t=i.data("activity-popup-title");bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null,bp.Nouveau.Activity.activityPinHasUpdates=!1,a.closest("body").addClass("acomments-modal-open"),a.show(),a.find("ul.bb-rl-activity-list").html(o),a.find(".bb-modal-activity-header h2").text(t),a.find(".bb-activity-video-elem").each(function(e,t){var o=g(t);o.find("video").each(function(e,t){var i=g(t),a=i.attr("id")+Math.floor(1e4*Math.random());i.attr("id",a);t=o.find(".video-action-wrap");i.insertAfter(t),o.find(".video-js").remove(),i.addClass("video-js"),videojs(a,{controls:!0,aspectRatio:"16:9",fluid:!0,playbackRates:[.5,1,1.5,2],fullscreenToggle:!1})})}),i.hasClass("bb-closed-comments")&&a.find("#activity-modal").addClass("bb-closed-comments");t=a.find("#ac-form-"+e);a.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),a.find(".comment-item").removeClass("bb-rl-comment-item-focus"),a.find(".bb-modal-activity-footer").addClass("active").append(t),t.removeClass("not-initialized").addClass("root").find("#ac-input-"+e).focus(),bp.Nouveau.Activity.clearFeedbackNotice(t),t.removeClass("events-initiated");i=a.find(".bb-modal-activity-footer").find(".ac-input[contenteditable]");bp.Nouveau.Activity.listenCommentInput(i),a.find(".bb-activity-more-options-wrap .bb-activity-more-options-action, .bb-rl-pin-action_button, .bb-rl-mute-action_button").attr("data-balloon-pos","left"),a.find(".bb-rl-privacy-wrap").attr("data-bp-tooltip-pos","right"),a.find(n).children(".acomments-view-more").first().trigger("click"),_.isUndefined(f)||_.isUndefined(f.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#activity-modal ",e),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp(),bp.Nouveau.Activity.toggleMultiMediaOptions(t,"",".bb-modal-activity-footer")},viewMoreComments:function(e){e.preventDefault();var a=g(e.currentTarget),t=a.parent(),o=g(t).data("activity_id"),n=a.closest(".bb-rl-activity-comments"),s=a.closest(".bb-rl-activity-item"),d=g(t).data("parent_comment_id"),l="";a.addClass("loading").removeClass("acomments-view-more--hide"),n.addClass("active"),s.addClass("active"),a.html('<div id="bb-rl-ajax-loader"><div class="bb-rl-activity-placeholder bb-activity-tiny-placeholder"><div class="bb-rl-activity-placeholder_head"><div class="bb-rl-activity-placeholder_avatar bb-rl-bg-animation bb-rl-loading-bg"></div><div class="bb-rl-activity-placeholder_details"><div class="bb-rl-activity-placeholder_title bb-rl-bg-animation bb-rl-loading-bg"></div><div class="bb-rl-activity-placeholder_description bb-rl-bg-animation bb-rl-loading-bg"></div></div></div></div></div>');e={action:"activity_loadmore_comments",activity_id:o,parent_comment_id:d,offset:a.parents(".bb-rl-activity-comments").find('ul[data-parent_comment_id ="'+d+'"] > li.comment-item:not(.bb-recent-comment)').length,activity_type_is_blog:1<a.parents(".entry-content").length};0<a.prev("li.bb-rl-activity-comment").length&&(t=a.prev("li.bb-rl-activity-comment").data("bp-timestamp"),e.last_comment_timestamp=t,l=a.prev("li.bb-rl-activity-comment").data("bp-activity-comment-id"),e.last_comment_id=l),bp.Nouveau.ajax(e,"activity").done(function(e){return!1===e.success?(a.html("<p class='error'>"+e.data.message+"</p>").removeClass("acomments-view-more--hide"),n.removeClass("active"),void s.removeClass("active")):void(void 0!==e.data&&void 0!==e.data.comments&&(t=g(".bb-internal-model .bb-rl-activity-comments").find("[data-activity_id='"+o+"'][data-parent_comment_id='"+d+"']"),i=g(g.parseHTML(e.data.comments)),0<t.length&&0<i.length&&(i.each(function(){var e;"LI"===this.nodeName&&"undefined"!==this.id&&""!==this.id&&(e=this.id,0<(e=t.children("#"+e)).length&&e.remove())}),void 0!==l&&""!==l?0<(e=t.find("li.bb-rl-activity-comment[data-bp-activity-comment-id='"+l+"']")).length?e.after(i):t.append(i):0<t.children(".bb-rl-activity-comment.comment-item").length?t.children(".bb-rl-activity-comment.comment-item").first().before(i):t.html(i),setTimeout(function(){jQuery(window).scroll()},200)),a.remove(),n.removeClass("active"),s.removeClass("active"),a.hasClass("acomments-view-more--root")||g(".bb-modal-activity-body").scrollTo("#bb-rl-acomment-"+d,500,{offset:0,easing:"swing"}),void 0!==bp.Nouveau&&(bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()),t.find(".bb-activity-more-options-wrap").find(".bb-activity-more-options-action").attr("data-balloon-pos","left")));var t,i}).fail(function(e){a.html("<p class='error'>"+e.statusText+"</p>").removeClass("acomments-view-more--hide"),n.removeClass("active"),s.removeClass("active")})},autoloadMoreComments:function(){var e,t,i,a,o=g(".bb-activity-model-wrapper");0<o.length&&"none"!==o.css("display")&&(e=g(".bb-modal-activity-body .bb-rl-activity-comments > ul > li.acomments-view-more:not(.loading), .bb-modal-activity-body .bb-rl-activity-comments .activity-actions > ul > li.acomments-view-more:not(.loading)"),i=(a=o.find(".bb-modal-activity-body")).find(".bb-rl-activity-comments:not(.active)"),0<e.length&&0<a.length&&0<i.length&&(t=g(e).offset().top,i=(o=g(a).scrollTop())+g(a).height(),(a=t-g(a).offset().top+o)<i&&a+g(e).outerHeight()>o&&g(e).trigger("click").addClass("loading")),setTimeout(function(){jQuery(window).scroll()},200))},activitySyncOnModalClose:function(e,t){e.preventDefault();var e=g(e.currentTarget),e=(e.is(document)?g(".bb-activity-model-wrapper"):e.parents(".bb-activity-model-wrapper")).find("ul.bb-rl-activity-list > li").data("bp-activity-id"),e=void 0!==t?t:e,i=g("#bb-rl-activity-stream li.bb-rl-activity-item[data-bp-activity-id="+e+"]");0<i.length&&bp.Nouveau.Activity.activityHasUpdates&&(i.addClass("activity-sync"),bp.Nouveau.ajax({action:"activity_sync_from_modal",activity_id:e},"activity").done(function(e){!1!==e.success&&void 0!==e.data&&void 0!==e.data.activity&&(i.replaceWith(g.parseHTML(e.data.activity)),jQuery(window).scroll(),bp.Nouveau.Activity.activityPinHasUpdates&&bp.Nouveau.refreshActivities())}).fail(function(e){console.error("Request failed:",e)})),bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null},discardGifEmojiPicker:function(){var e=g("#activity-modal"),t=e.find(".bb-modal-activity-body .bb-rl-activity-item").data("bp-activity-id");0<e.length&&0<g(".emojionearea-theatre.show").length&&g(".bb-activity-model-wrapper #ac-input-"+t).data("emojioneArea").hidePicker();t=g(".bb-rl-gif-media-search-dropdown-standalone.open");0<e.length&&0<t.length&&(t.removeClass("open"),e.find(".ac-reply-gif-button").removeClass("active"))},initializeEmojioneArea:function(e,i,a){g.fn.emojioneArea&&g(i+"#ac-input-"+a).emojioneArea({standalone:!0,hideSource:!1,container:i+"#ac-reply-emoji-button-"+a,detachPicker:!!e,containerPicker:e?".emojionearea-theatre":null,autocomplete:!1,pickerPosition:"top",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){g(i+"#ac-input-"+a)[0].emojioneArea.hidePicker();var e=g(i+"#ac-form-"+a+" #ac-input-"+a),t=e.html(),t=g.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));t=t.replace(/&nbsp;/g," "),""!==e.text()||0<=t.indexOf("bb-rl-emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},picker_show:function(){g(this.button[0]).closest(".bb-rl-post-emoji").addClass("active"),g(".emojionearea-theatre").removeClass("hide").addClass("show")},picker_hide:function(){g(this.button[0]).closest(".bb-rl-post-emoji").removeClass("active"),g(".emojionearea-theatre").removeClass("show").addClass("hide")}}})},injectFiles:function(e){var t=e.commonData,o=e.id,n=e.fileType,s=e.dropzoneObj,d=e.draftData||!1;t.forEach(function(e,t){var i;0<parseInt(o,10)?(i={id:e.attachment_id||e.doc_id||e.vid_id,name:e.name||e.full_name,saved:!0,group_id:e.group_id||0,menu_order:e.menu_order||0,uuid:e.attachment_id||e.doc_id||e.vid_id,url:e.url,type:n},"media"===n?(i.media_id=e.id,i.thumb=e.thumb||"",i.album_id=e.album_id||0):"document"===n?(i.document_id=e.id,i.size=e.size||0,i.full_name=e.full_name||e.name,i.folder_id=e.folder_id||0,i.svg_icon=e.svg_icon||""):"video"===n&&(i.video_id=e.id,i.thumb=e.thumb||"",i.size=e.size||0,i.album_id=e.album_id||0)):(i={id:e.id||e.doc_id||e.vid_id,name:e.name||e.full_name,saved:!1,group_id:e.group_id||0,menu_order:e.menu_order||0,uuid:e.id||e.doc_id||e.vid_id,url:e.url,type:n},"media"===n?(i.thumb=e.thumb||"",i.album_id=e.album_id||0):"document"===n?(i.size=e.size||0,i.full_name=e.full_name||e.name,i.folder_id=e.folder_id||0,i.svg_icon=e.svg_icon||""):"video"===n&&(i.thumb=e.thumb||"",i.album_id=e.album_id||0,i.size=e.size||0));var a={name:e.name||e.full_name||e.title,size:e.size||0,accepted:!0,kind:"media"===n?"image":"file",upload:{filename:e.name||e.full_name||e.title,uuid:e.attachment_id||e.doc_id||e.vid_id},dataURL:e.url,id:e.attachment_id||e.doc_id||e.vid_id};"media"===n?a.media_edit_data=i:"document"===n?(a.document_edit_data=i,a.svg_icon=_.isUndefined(e.svg_icon)?"":e.svg_icon):"video"===n&&(a.video_edit_data=i),s&&(s.files.push(a),s.emit("addedfile",a),"media"===n&&(void 0!==m&&"1"===m?(g(s.files[t].previewElement).find("img").attr("src",e.thumb),s.emit("thumbnail",e.thumb)):bp.Readylaunch.Utilities.createThumbnailFromUrl(a,s)),s.emit("complete",a),"media"===n&&!0===d&&(s.emit("dz-success"),s.emit("dz-complete")))})},destroyUploader:function(e,t){var i=this,a={media:{obj:i.dropzone_obj,dropzone:i.dropzone_media,uploaderId:"#ac-reply-post-media-uploader-",buttonId:"#ac-reply-media-button-",additionalIds:["#ac-reply-post-media-uploader-1-"]},document:{obj:i.dropzone_document_obj,dropzone:i.dropzone_document,uploaderId:"#ac-reply-post-document-uploader-",buttonId:"#ac-reply-document-button-"},video:{obj:i.dropzone_video_obj,dropzone:i.dropzone_video,uploaderId:"#ac-reply-post-video-uploader-",buttonId:"#ac-reply-video-button-"},gif:{buttonId:"#ac-reply-gif-button-",dropdownClass:".bb-rl-gif-media-search-dropdown",standaloneClass:".bb-rl-gif-media-search-dropdown-standalone",modelProperty:"gif_data",containerId:"#ac-reply-post-gif-"}}[e];a&&("gif"!==e&&(i=a.obj,_.isNull(i)||(i.destroy(),g(a.uploaderId+t).html(""),a.additionalIds&&a.additionalIds.forEach(function(e){g(e+t).html("")})),a.dropzone=[],g(a.uploaderId+t).removeClass("open").addClass("closed")),g(a.buttonId+t).removeClass("active"),"gif"===e&&(g(a.buttonId+t).closest(".bb-rl-post-gif").find(a.dropdownClass).removeClass("open").empty(),g(a.standaloneClass).removeClass("open").empty(),_.isUndefined(this.models[t])||(this.models[t].set(a.modelProperty,{}),g(a.containerId+t).find(".bb-rl-activity-attached-gif-container").removeAttr("style"))))},handleFavoriteUnfavorite:function(e){var t=e.event;t.preventDefault();var a,o,n,s,d=e.parent,l=e.target,i=e.reactionId,r=e.activityState,c=e.bodyElem,m=e.stream,p=e.activityItem;c.hasClass("bb-is-mobile")&&c.hasClass("bb-reactions-mode")&&0===l.closest(".ac-emotion_btn").length&&!0!==t.customTriggered||(l=!g(l).is("a")?g(l).closest("a"):l).hasClass("loading")||(l.addClass("loading"),a=l.hasClass("fav")?"fav":"unfav",o=!0,e="activity",c=l.parents(".bb-rl-acomment-display").first(),t=l.attr("data-reacted-id"),0<i&&(a="fav"),l.parent(".ac-emotion_btn")&&(t=l.parents(".bp-generic-meta").find(".unfav").attr("data-reacted-id")),"fav"!==a||parseInt(i)!==parseInt(t)?(0<c.length&&(o=!1,e="activity_comment"),s=(n=o?l.parents(".bb-rl-activity-item"):l.parents(".bb-rl-activity-comment").first()).data(o?"bp-activity-id":"bp-activity-comment-id"),e={action:"activity_mark_"+a,reaction_id:i,item_id:s,item_type:e},d.ajax(e,"activity").done(function(i){if(!1===i.success)return l.removeClass("loading"),void alert(i.data);l.fadeOut(200,function(){var e=g(this),t="false"===e.attr("aria-pressed")?"true":"false";e.attr("aria-pressed",t),void 0!==i.data.reaction_count&&((t=o?n.find(".bb-rl-activity-content .activity-state-reactions"):n.find("#bb-rl-acomment-display-"+s+" .bb-rl-comment-reactions .activity-state-reactions")).length?t.replaceWith(i.data.reaction_count):(o?n.find(".bb-rl-activity-content .activity-state"):n.find("#bb-rl-acomment-display-"+s+" .bb-rl-comment-reactions")).prepend(i.data.reaction_count),r.toggleClass("has-likes",""!==i.data.reaction_count)),i.data.reaction_button&&(o?n.find(".bp-generic-meta a.bp-like-button:first"):n.find("#bb-rl-acomment-display-"+s+" .bp-generic-meta a.bp-like-button")).replaceWith(i.data.reaction_button),n.find(".ac-emotions_list").removeClass("active"),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=s,e.fadeIn(200),l.removeClass("loading")});var e;g(o?".activity[data-bp-activity-id="+s+"] > .bb-rl-activity-content":".bb-rl-activity-comment[data-bp-activity-comment-id="+s+"] > .bb-rl-acomment-display > .bb-rl-acomment_inner").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"),"fav"===a?void 0===i.data.directory_tab||""===i.data.directory_tab||g(d.objectNavParent+' [data-bp-scope="favorites"]').length||g(d.objectNavParent+' [data-bp-scope="all"]').after(i.data.directory_tab):"unfav"===a&&((e=g('[data-bp-user-scope="favorites"]').hasClass("selected")||g(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&p.remove(),void 0!==i.data.no_favorite&&(g(d.objectNavParent+' [data-bp-scope="all"]').length&&g(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?g(d.objectNavParent+' [data-bp-scope="favorites"]').remove():e&&m.append(i.data.no_favorite)))}).fail(function(){l.removeClass("loading")})):l.removeClass("loading"))},deleteActivity:function(e){e.event.preventDefault();var n,s,d,l=e.parent,r=e.target,c=e.activityState,m=e.activityItem,p=e.commentsText,b=e.activityId,v=r.closest("[data-bp-activity-comment-id]"),u=v.data("bp-activity-comment-id"),f=0,h=r.closest(".bb-rl-activity-comments");if(h.addClass("active"),void 0!==t&&!1===window.confirm(t))return!1;r.addClass("loading");var y={action:"delete_activity",id:b,_wpnonce:l.getLinkParams(r.prop("href"),"_wpnonce"),is_single:r.closest("[data-bp-single]").length};(r.hasClass("spam-activity")||r.hasClass("spam-activity-comment"))&&(y.action="bp_spam_activity"),n=m,u&&(delete y.is_single,y.id=u,y.is_comment=!0,n=v),l.ajax(y,"activity").done(function(e){if(r.removeClass("loading"),!1===e.success)n.append(e.data.feedback),n.find(".bp-feedback").hide().fadeIn(300);else{var t,i=n.closest(".has-child-comments");n.hasClass("has-child-comments")&&(t=n.closest("ul").closest("li"));var a,o=i.find("> ul");if(e.data.redirect)return window.location.href=e.data.redirect;e.data.parent_activity_id&&e.data.activity&&g("body:not(.activity-singular) #buddypress #bb-rl-activity-stream ul.bb-rl-activity-list li#bb-rl-activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),u&&(f=1,a=v.find(".acomments-view-more").data("child-count"),m.append(v.find("form")),v.find("li.comment-item").each(function(){f+=1}),f+=void 0!==a?parseFloat(a):0,d=c.find("span.comments-count"),s=d.text().length?d.text().match(/\d+/)[0]:0,s=Number(s-f),p.length?(a=1<s?C.strings.commentsLabel:C.strings.commentLabel,p.text(a.replace("%d",s))):d.parent(".has-comments").removeClass("has-comments"),(d=m.find("li.show-all a")).length&&d.html(w.replace("%d",s)),0===s&&(m.removeClass("has-comments"),c.removeClass("has-comments"),p.empty())),n.slideUp(300,function(){n.remove(),0===o.find("li").length&&i.removeClass("has-child-comments"),void 0!==t&&""===t.find("> ul").html().trim()&&t.removeClass("has-child-comments")}),u||m.data("bp-timestamp")!==l.Activity.heartbeat_data.last_recorded||(l.Activity.heartbeat_data.newest="",l.Activity.heartbeat_data.last_recorded=0),g(document).trigger("bp_activity_ajax_delete_request",g.extend(y,{response:e})),g(document).trigger("bp_activity_ajax_delete_request_video",g.extend(y,{response:e})),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=b}h.removeClass("active")})},readMoreActivity:function(e){var t=e.event;t.preventDefault();var i=e.target,a=null,o=e.activityId,n=i.closest("div");if(g(n).hasClass("bb-rl-activity-inner")?a=o:g(n).hasClass("bb-rl-acomment-content")&&(a=i.closest("li").data("bp-activity-comment-id")),!a)return t;var t=e.parent,s=e.activityItem,d=i.closest("span");g(d).addClass("loading"),t.ajax({action:"get_single_activity_content",id:a},"activity").done(function(e){"object"!=typeof e&&0<i.closest("div").find(".bb-activity-media-wrap").length&&(e=JSON.parse(e)),g(d).removeClass("loading");var t=n.parent().find(".bp-feedback");t.length&&t.remove(),!1===e.success?(n.after(e.data.feedback),n.parent().find(".bp-feedback").hide().fadeIn(300)):((t=g(n).children()).filter(".bb-poll-view").length?(t.not(".bb-poll-view").remove(),g(n).prepend(e.data.contents).slideDown(300)):g(n).html(e.data.contents).slideDown(300),jQuery(window).scroll(),s.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+a))))})},displayingTheCommentForm:function(e){var t,i,a,o,n,s,d,l,r,c,m,p,b,v=e.event,u=e.target;u.parents(".bb-rl-activity-item").hasClass("bb-closed-comments")?v.preventDefault():(t=e.activityId,i=e.isInsideModal,d=e.isInsideMediaTheatre,c=t,o=e.self,s=g("#activity-modal"),l=g(".bb-internal-model"),n=i?(p=s.find("#ac-form-"+t),a=s.find(".bb-modal-activity-footer"),"#activity-modal "):d?(p=l.find("#ac-form-"+t),".bb-internal-model "):(p=g("#ac-form-"+t),a=g('[data-bp-activity-id="'+c+'"] .bb-rl-activity-comments'),""),b=!1,(e=u.closest(".bb-media-model-container")).length&&(p=e.find("#ac-form-"+t),a=e.find('[data-bp-activity-id="'+c+'"] .bb-rl-activity-comments')),(e=u.closest(".bb-rl-activity-item")).hasClass("has-comments")||e.addClass("has-comments"),v.preventDefault(),o.resetActivityCommentForm(p,"hardReset"),(v=u.closest("li")).data("bp-activity-comment-id")&&(c=v.data("bp-activity-comment-id")),v.data("bp-activity-comment")&&(b=v.data("bp-activity-comment")),this.toggleMultiMediaOptions(p,u),p.removeClass("root"),g(".ac-form").addClass("not-initialized").find(".ac-input:not(.emojionearea)").html(""),bp.Nouveau.Activity.clearFeedbackNotice(p),p.children("div").each(function(e,t){g(t).hasClass("error")&&g(t).remove()}),u.hasClass("acomment-edit")&&!_.isNull(b)?((v=g(n+'[data-bp-activity-comment-id="'+c+'"]')).find("#bb-rl-acomment-display-"+c).addClass("bp-hide"),v.find("#bb-rl-acomment-edit-form-"+c).append(p),p.addClass("acomment-edit").attr("data-item-id",c),o.validateCommentContent(p.find(".ac-textarea").children(".ac-input")),o.editActivityCommentForm(p,b),i&&g(".bb-modal-activity-footer").removeClass("active")):(m=g(".bb-modal-activity-footer"),c===t?(i&&(m.addClass("active"),s.find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus bb-rl-comment-item-focus")),a.append(p),p.addClass("root"),a.find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus bb-rl-comment-item-focus")):i?(m.removeClass("active"),s.find('[data-bp-activity-comment-id="'+c+'"]').append(p)):(d?l.find('[data-bp-activity-comment-id="'+c+'"]'):g('[data-bp-activity-comment-id="'+c+'"]')).append(p)),p.removeClass("not-initialized"),s=(m=p.find(".bb-rl-post-elements-buttons-item.post-emoji")).prevAll().not(":hidden").length+1,m.attr("data-nth-child",s),l=(d=p.find(".bb-rl-post-elements-buttons-item.bb-rl-post-gif")).prevAll().not(":hidden").length+1,d.attr("data-nth-child",l),c=p.find(".ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(c),u.attr("aria-expanded","true"),u.closest(".bb-rl-activity-comments").find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus").removeClass("bb-rl-comment-item-focus"),u.closest(".bb-rl-acomment-display").addClass("bb-rl-display-focus"),u.closest(".comment-item").addClass("bb-rl-comment-item-focus"),m=_.isNull(b)?"":b.nickname,s=_.isNull(b)?"":b.user_id,d='<span class="atwho-inserted" data-atwho-at-query="@" contenteditable="false">@'+m+"</span>&nbsp;",l=_.isUndefined(C.params.user_id)?"":C.params.user_id,m={offset:-(g(window).height()/2-75),easing:"swing"},r=c.get(0),jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=300<jQuery(window).height()?200:100;jQuery("html, body").animate({scrollTop:jQuery(r).offset().top-e},500)},500):(i?g(".bb-modal-activity-body"):g).scrollTo(p,500,m),g(n+"#ac-form-"+t+" #ac-input-"+t).focus(),c=g(n+"#ac-input-"+t),_.isUndefined(f)||_.isUndefined(f.emoji)||void 0!==c.data("emojioneArea")||(m=c.html(),bp.Nouveau.Activity.initializeEmojioneArea(i,n,t),u.hasClass("acomment-edit")&&!_.isNull(b)&&c.html(m)),u.hasClass("acomment-edit")||u.hasClass("button")||u.hasClass("activity-state-comments")||l===s||(c.html(d),p.addClass("has-content")),void 0===window.getSelection||void 0===document.createRange||_.isNull(b)||((p=document.createRange()).selectNodeContents(c[0]),p.collapse(!1),(b=window.getSelection()).removeAllRanges(),b.addRange(p)),_.isUndefined(window.MediumEditor)||c.hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(c[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1})))},submitActivityComment:function(e){var n,s,t=e.event,i=e.parent,d=e.target,l=e.activityId,r=e.isInsideModal,c=e.activityState,m=e.commentsText,p=e.activityItem,b=e.self;d.prop("disabled",!0);var v=d.closest(".bb-rl-activity-comments");v.addClass("active");var u=d.closest("form"),e=l;t.preventDefault();t=d.closest("li");t.data("bp-activity-comment-id")&&(e=t.data("bp-activity-comment-id")),(s=g(u).find(".ac-input").first()).find("span.atwho-query").each(function(){g(this).replaceWith(this.innerText)}),s.find("img.emoji").each(function(){g(this).addClass("emojioneemoji").attr("data-emoji-char",g(this).attr("alt")).removeClass("emoji")}),s.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),void 0===l&&0<d.parents(".bb-modal-activity-footer").length&&(e=l=d.parents("form.ac-form").find("input[name=comment_form_id]").val()),d.parent().addClass("loading").prop("disabled",!0),s.addClass("loading").prop("disabled",!0);t=s[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""),e={action:"new_activity_comment",_wpnonce_new_activity_comment:g("#_wpnonce_new_activity_comment").val(),comment_id:e,form_id:l,content:t},t=g("#_bp_as_nonce_"+l).val();t&&(e["_bp_as_nonce_"+l]=t),this.dropzone_media.length&&(e.media=this.dropzone_media),this.dropzone_document.length&&(e.document=this.dropzone_document),this.dropzone_video.length&&(e.video=this.dropzone_video,_.isEmpty(e.content)&&(e.content="&#8203;")),_.isUndefined(this.models[l])||(n=this.models[l],e.gif_data=this.models[l].get("gif_data")),e.content=e.content.replace(/&nbsp;/g," "),u.hasClass("acomment-edit")&&(e.edit_comment=!0);var f=0<d.closest(".bb-modal-activity-footer").length;i.ajax(e,"activity").done(function(e){var i,t,a,o;d.parent().removeClass("loading"),s.removeClass("loading"),g(".acomment-reply").attr("aria-expanded","false"),!1===e.success?u.append(g(e.data.feedback).hide().fadeIn(200)):(t=0<d.closest(".elementor-activity-item").length,a=u.prev().hasClass("activity-actions"),t=t&&a?u.parent().find(".activity-actions"):u.parent(),a=g.trim(e.data.contents),t.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),t.find(".comment-item").removeClass("bb-rl-comment-item-focus"),t.addClass("has-child-comments"),e=u.find('input[name="comment_form_id"]').val(),r?(g("#activity-modal").find(".bb-modal-activity-footer").append(u).addClass("active"),u.removeClass("has-content").addClass("root")):(u.addClass("not-initialized").removeClass("has-content has-gif has-media"),u.closest(".bb-rl-activity-comments").append(u)),u.find("#ac-input-"+e).html(""),u.hasClass("acomment-edit")?(o=u.attr("data-item-id"),u.closest(".bb-rl-activity-comments").append(u),(r?g("#activity-modal").find("li#bb-rl-acomment-"+o):g("li#bb-rl-acomment-"+o)).replaceWith(a)):(0===t.children("ul").length&&t[t.hasClass("bb-rl-activity-comments")?"prepend":"append"]("<ul></ul>"),(f?u.closest("#activity-modal").find(".bb-modal-activity-body .bb-rl-activity-comments, .bb-modal-activity-body .bb-rl-activity-comments .activity-actions"):t).children("ul").append(g(a).hide().fadeIn(200)),g(u).find(".ac-input").first().html(""),t.parent().addClass("has-comments comments-loaded"),c.addClass("has-comments")),u.removeClass("acomment-edit"),i=u.find(".ac-reply-content"),[".ac-reply-media-button",".ac-reply-document-button",".ac-reply-video-button",".ac-reply-gif-button"].forEach(function(e){var t=i.find(".ac-reply-toolbar "+e);0<t.length&&("ac-reply-gif-button"===e&&t.removeClass("active"),t.parents(".bb-rl-post-elements-buttons-item").removeClass("disable no-click"))}),jQuery(window).scroll(),u.hasClass("acomment-edit")||(a=(o=c.find("span.comments-count")).text().length?o.text().match(/\d+/)[0]:0,a=Number(a)+1,m.length&&(t=1<a?C.strings.commentsLabel:C.strings.commentLabel,m.text(t.replace("%d",a||1))),o.parent(":not( .has-comments )").addClass("has-comments"),(o=g(p).find(".show-all a"))&&o.html(w.replace("%d",a))),[b.dropzone_media,b.dropzone_document,b.dropzone_video].forEach(function(e){e&&0<e.length&&e.forEach(function(e){e.saved=!0})}),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=l),_.isUndefined(n)||(n.set("gif_data",{}),g("#ac-reply-post-gif-"+l).find(".bb-rl-activity-attached-gif-container").removeAttr("style")),["media","document","video"].forEach(function(e){b.destroyUploader(e,l)}),d.prop("disabled",!1),s.prop("disabled",!1),v.removeClass("active"),bp.Nouveau.Activity.clearFeedbackNotice(u)}).fail(function(e){d.parent().removeClass("loading"),d.prop("disabled",!1),bp.Nouveau.Activity.clearFeedbackNotice(u);e=0===e.readyState?C.strings.commentPostError:e.responseJSON&&e.responseJSON.message?e.responseJSON.message:e.statusText;u.find(".ac-reply-content").after('<div class="bb-rl-notice bb-rl-notice--error">'+e+"</div>")})},pinUnpinActivity:function(e){var t=e.event,i=e.activityId;if(t.preventDefault(),!i)return t;var t=e.parent,r=e.target,c=e.isInsideModal,m=r.closest(".bb-rl-activity-item");m.addClass("loading-pin");var p=r.hasClass("unpin-activity")?"unpin":"pin";t.ajax({action:"activity_update_pinned_post",id:i,pin_action:p},"activity").done(function(e){var t,i,a,o,n,s,d,l;m.removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(t=r.closest("ul.bb-rl-activity-list"),i=c?r.closest(".buddypress-wrap").find("#bb-rl-activity-stream"):r.closest("#bb-rl-activity-stream"),e.success&&(a=bp.Nouveau.getStorage("bp-activity","scope"),o=!1,d="",(n=m.hasClass("groups"))&&(d=(s=m.attr("class").match(/group-\d+/))?s[0].replace("group-",""):""),i.hasClass("single-user")?o=!1:(i.hasClass("activity")&&"all"===a&&!n||i.hasClass("single-group"))&&(o=!0),"pin"==p?(o&&t.find("li.bb-rl-activity-item").removeClass("bb-pinned"),l=n&&!i.hasClass("single-group")?"li.bb-rl-activity-item.group-"+d:"li.bb-rl-activity-item",t.find(l).each(function(){var e=g(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity");var t=n?C.strings.pinGroupPost:C.strings.pinPost;e.find("span").html(t)}),o&&m.addClass("bb-pinned"),r.addClass("unpin-activity").removeClass("pin-activity"),l=n?C.strings.unpinGroupPost:C.strings.unpinPost,r.find("span").html(l)):"unpin"==p&&(m.removeClass("bb-pinned"),r.addClass("pin-activity").removeClass("unpin-activity"),l=n?C.strings.pinGroupPost:C.strings.pinPost,r.find("span").html(l)),"all"===a&&o&&(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities())),g(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0]))}).fail(function(){r.closest(".bb-rl-activity-item").removeClass("loading-pin"),g(document).trigger("bb_trigger_toast_message",["","<div>"+C.strings.pinPostError+"</div>","error",null,!0])})},muteUnmuteNotifications:function(e){var t=e.event,i=e.parent,a=e.target,o=e.activityId,n=e.isInsideModal;if(a.hasClass("bb-icon-bell-slash")||a.hasClass("bb-icon-bell")){if(t.preventDefault(),!o)return t;var s=a.closest(".bb-rl-activity-item");s.addClass("loading-mute");var d=a.hasClass("bb-icon-bell")?"unmute":"mute";i.ajax({action:"toggle_activity_notification_status",id:o,notification_toggle_action:d},"activity").done(function(e){var t;s.removeClass("loading-mute"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&("mute"==d?(t=C.strings.unmuteNotification,s.addClass("bb-muted"),a.removeClass("bb-icon-bell-slash"),a.addClass("bb-icon-bell"),a.attr("title",t),a.find("span").html(t)):"unmute"==d&&(t=C.strings.muteNotification,s.removeClass("bb-muted"),a.removeClass("bb-icon-bell"),a.addClass("bb-icon-bell-slash"),a.attr("title",t),a.find("span").html(t)),void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0)),g(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0])),n&&(bp.Nouveau.Activity.activityPinHasUpdates=!0),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=o}).fail(function(){a.closest(".bb-rl-activity-item").removeClass("loading-pin"),g(document).trigger("bb_trigger_toast_message",["","<div>"+C.strings.pinPostError+"</div>","error",null,!0])})}},onOffComment:function(e){var t=e.event,i=e.target,a=e.parent,o=e.activityId;if(t.preventDefault(),!o)return t;var n=i.closest(".bb-rl-activity-item");n.addClass("loading-pin");var s=i.hasClass("unclose-activity-comment")?"unclose_comments":"close_comments";a.ajax({action:"activity_update_close_comments",id:o,close_comments_action:s},"activity").done(function(e){var t;n.removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&(t=g("#bb-rl-activity-stream > .bb-rl-activity-list").find("[data-bp-activity-id="+o+"]"),n.find(".bb-activity-closed-comments-notice").remove(),"close_comments"==s?(n.addClass("bb-closed-comments"),0<n.closest("#activity-modal").length&&n.closest("#activity-modal").addClass("bb-closed-comments"),i.addClass("unclose-activity-comment").removeClass("close-activity-comment"),i.find("span").html(C.strings.uncloseComments),n.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),n.find(".bb-rl-activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"),0<i.parents(".bb-media-model-wrapper").length&&0<t.length&&(t.addClass("bb-closed-comments"),t.find(".bb-activity-more-options .close-activity-comment span").html(C.strings.uncloseComments),t.find(".bb-activity-more-options .close-activity-comment").addClass("unclose-activity-comment").removeClass("close-activity-comment"),t.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),t.find(".bb-rl-activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"))):"unclose_comments"==s&&(n.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),n.removeClass("bb-closed-comments"),0<n.closest("#activity-modal").length&&n.closest("#activity-modal").removeClass("bb-closed-comments"),i.addClass("close-activity-comment").removeClass("unclose-activity-comment"),i.find("span").html(C.strings.closeComments),0<i.parents(".bb-media-model-wrapper").length&&0<t.length&&(t.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),t.removeClass("bb-closed-comments"),t.find(".bb-activity-more-options .unclose-activity-comment span").html(C.strings.closeComments),t.find(".bb-activity-more-options .unclose-activity-comment").addClass("close-activity-comment").removeClass("unclose-activity-comment"),t.find(".bb-activity-closed-comments-notice").html(""))),void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0)),g(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0]))}).fail(function(){i.closest(".bb-rl-activity-item").removeClass("loading-pin"),g(document).trigger("bb_trigger_toast_message",["","<div>"+C.strings.closeCommentsError+"</div>","error",null,!0])})}},bp.Nouveau.Activity.start())}((bp,jQuery));