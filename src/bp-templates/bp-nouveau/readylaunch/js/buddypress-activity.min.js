window.bp=window.bp||{},(I=>{var t,e,u,s,T,r,P,a;"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),t=BP_Nouveau,e=t.ajaxurl,u=t.media,s=t.is_send_ajax_request,T=t.activity,r=t.newest,P=t.show_x_comments,a=t.confirm,bp.Nouveau.Activity={start:function(){bp.Nouveau.Activity.LocalizeActivityVars=t,this.setupGlobals(),this.addListeners()},invokeMediaFn:function(t){void 0!==bp.Nouveau.Media&&"function"==typeof bp.Nouveau.Media[t]&&bp.Nouveau.Media[t]()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(I(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:I(document).prop("title")},void 0!==window.Dropzone&&void 0!==u&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:e,timeout:108e5,dictFileTooBig:u.dictFileTooBig,dictDefaultMessage:u.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==u.maxFiles?u.maxFiles:10,maxFilesize:void 0!==u.max_upload_size?u.max_upload_size:2,dictMaxFilesExceeded:u.media_dict_file_exceeded,dictCancelUploadConfirmation:u.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==u.max_upload_size?u.max_upload_size:2},void 0!==u.dropzone_options)&&Object.assign(this.dropzone_options,u.dropzone_options),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[],this.activityHasUpdates=!1,this.activityPinHasUpdates=!1,I(".activity-topic-selector").length&&I(".activity-head-bar").length&&!I(".activity-topic-selector").parent().hasClass("bb-rl-activity-filters-container")&&(I(".activity-topic-selector, .activity-topic-selector + .subnav-filters, .activity-topic-selector + .subnav-filters + .activity-head-bar").wrapAll('<div class="bb-rl-activity-filters-container"></div>'),I('<div class="bb-rl-activity-filters-separator"></div>').insertAfter(".activity-topic-selector"))},addListeners:function(){function t(){I(".ac-form.not-initialized").each(function(){var t=I(this),e=t.find(".ac-textarea");bp.Nouveau.Activity.toggleMultiMediaOptions(t,e)})}var e=I("body"),a=I("#buddypress"),i=I(document),o=I("#bb-rl-activity-modal > .bb-rl-modal-activity-body"),e=(e.hasClass("activity-singular")||a.on("bp_heartbeat_send",this.heartbeatSend.bind(this)),a.on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),a.find('[data-bp-list="activity"]:not( #bb-schedule-posts_modal [data-bp-list="activity"] )').on("click","li.load-newest, li.bb-rl-load-more",this.injectActivities.bind(this)),a.on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),I("#bb-rl-activity-stream").on("click",".acomments-view-more",this.showActivity),e.on("click",".bb-rl-close-action-popup",this.closeActivity),i.on("activityModalOpened",function(t,e){var a=e.activityId;i.on("click",function(t){!(0<I("#bb-rl-activity-modal:visible").length&&0===I("#bb-rl-activity-form-placeholder:visible").length)||I(t.target).closest("#bb-rl-activity-modal").length||I(t.target).closest(".bb-rl-gif-media-search-dropdown-standalone").length||I(t.target).closest(".bb-rl-emojionearea-theatre").length||I(t.target).hasClass("dz-hidden-input")||(this.closeActivity(t),this.activitySyncOnModalClose(t,a))}.bind(this))}.bind(this)),'[data-bp-list="activity"], #bb-rl-activity-modal, #bb-rl-media-model-container .bb-rl-activity-list');a.find(e).on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),a.find(e).on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),a.find(e).on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),a.find(e).on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),I("#bb-rl-media-model-container .bb-rl-activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),I(".bb-rl-activity-model-wrapper").on("click",".bb-rl-ac-form-placeholder",bp.Nouveau,this.activityRootComment.bind(this)),i.keydown(this.commentFormAction),i.click(this.togglePopupDropdown),I('#buddypress [data-bp-list="activity"], #bb-rl-media-model-container .bb-rl-activity-list, #activity-modal .bb-rl-activity-list, .bb-rl-modal-activity-footer').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),a.find('[data-bp-list="activity"], #bb-rl-media-model-container .bb-rl-activity-list, #bb-rl-activity-modal .bb-rl-activity-list, .bb-rl-modal-activity-footer').on("click",".bb-rl-ac-reply-media-button, .bb-rl-ac-reply-document-button, .bb-rl-ac-reply-video-button, .bb-rl-ac-reply-gif-button",function(t){var e=I(t.currentTarget);e.hasClass("bb-rl-ac-reply-media-button")?this.openCommentsMediaUploader(t):e.hasClass("bb-rl-ac-reply-document-button")?this.openCommentsDocumentUploader(t):e.hasClass("bb-rl-ac-reply-video-button")?this.openCommentsVideoUploader(t):e.hasClass("bb-rl-ac-reply-gif-button")&&this.openGifPicker(t)}.bind(this)),i.on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),i.on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(T.params.autoload)||I(window).scroll(this.loadMoreActivities),I(document).on("click",".bb-subnav-filters-container .subnav-filters-opener",this.openActivityFilter.bind(this)),I(document).on("click",this.closeActivityFilter.bind(this)),I(document).on("click",".bb-subnav-filters-container .subnav-filters-modal a",this.filterActivity.bind(this)),I(".bb-rl-activity-model-wrapper, .bb-rl-media-model-wrapper").on("click",".acomments-view-more",this.viewMoreComments.bind(this)),i.on("click","#bb-rl-activity-stream .bb-rl-activity-comments .view-more-comments",function(t){t.preventDefault(),I(this).parents("li.activity-item").find(".bb-rl-activity-comments > ul > li.acomments-view-more, .bb-rl-activity-comments > .activity-actions > ul > li.acomments-view-more").trigger("click")}),i.on("click","#bb-rl-activity-stream .activity-state-comments > .comments-count, #bb-rl-activity-stream .groups-meta > .generic-button .acomment-reply, #bb-rl-activity-stream .activity-meta > .generic-button .acomment-reply",function(t){t.preventDefault();var t=I(this).closest(".activity-item"),e=t.data("bp-activity-id");""===t.find(".bb-rl-activity-comments > ul").html()&&bp.Nouveau.Activity.launchActivityPopup(e,"")}),o.on("scroll",this.autoloadMoreComments.bind(this)),o.on("scroll",this.discardGifEmojiPicker.bind(this)),I(".bb-rl-activity-model-wrapper .bb-rl-model-close-button").on("click",this.activitySyncOnModalClose.bind(this));"1"===s?a.on("bp_ajax_request",'[data-bp-list="activity"]',function(){setTimeout(t,1e3)}):setTimeout(t,1e3),bp.Nouveau.wrapNavigation(".activity-topic-selector ul",120,!0)},openActivityFilter:function(t){t.preventDefault(),I(".bb-subnav-filters-container:not(.bb-subnav-filters-search)").removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false");t=I(t.currentTarget).parent(".bb-subnav-filters-container");t.addClass("active").find(".subnav-filters-opener").attr("aria-expanded","true"),t.find('input[type="search"]').length&&t.find('input[type="search"]').focus()},closeActivityFilter:function(t){I(t.target).closest(".bb-subnav-filters-container").length||I.each(I(".bb-subnav-filters-container"),function(){(!I(this).hasClass("bb-subnav-filters-search")||""===I(this).find('input[name="activity_search"]').val())&&I(this).removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false")})},filterActivity:function(t){t.preventDefault();var t=I(t.currentTarget),e=t.closest(".bb-subnav-filters-container"),a=(t.parent().addClass("selected").siblings().removeClass("selected"),e.removeClass("active").find(".subnav-filters-opener").attr("aria-expanded","false"),t.parent().data("filter-label")),e=(e.find(".subnav-filters-opener .selected").text(a||t.text()),bp.Nouveau.Activity.current_page=1,bp.Nouveau.objectNavParent),a="activity",i=I("#buddypress").find('[data-bp-filter="'+a+'"]').first().val(),o="",s="",n="",d="",l=!1,r=!1,c=(I(e+" [data-bp-object].selected").length&&(o=I(e+" [data-bp-object].selected").data("bp-scope"),t.closest("#bb-subnav-filter-show").length)&&(l=!0,I("body").hasClass("my-activity"))&&(r=!(l=!1)),I('#buddypress [data-bp-search="'+a+'"] input[type=search]')),c=(c.length&&(s=c.val()),I(e+" [data-bp-order]").length&&(n=I(e+' [data-bp-order="'+a+'"].selected').data("bp-orderby")),bp.Nouveau.getStorage("bp-"+a)),e=(void 0!==c.extras&&(d=c.extras),bp.Nouveau.Activity.heartbeat_data.last_recorded=0,{object:a,scope:o,filter:i,search_terms:s,extras:d,order_by:n,save_scope:l,event_element:t});r&&(e.user_timeline=!0),bp.Nouveau.objectRequest(e)},heartbeatSend:function(t,e){var a,i=I("#buddypress [data-bp-list] [data-bp-activity-id]"),o=i.not(".bb-pinned").first(),s=(this.heartbeat_data.first_recorded=o.data("bp-timestamp")||0,I(bp.Nouveau.objectNavParent+" [data-bp-orderby=date_updated].selected").length?void 0!==(o=I("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first()).data("bb-updated-timestamp")?this.heartbeat_data.first_recorded=o.data("bb-updated-timestamp"):o.length&&void 0!==o.data("bp-activity").date_updated&&""!==o.data("bp-activity").date_updated?(s=o.data("bp-activity").date_updated,s=new Date(s.replace(" ","T")+"Z"),this.heartbeat_data.first_recorded=s.getTime()/1e3):this.heartbeat_data.first_recorded=o.data("bp-timestamp")||0:this.heartbeat_data.first_recorded=I("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first().data("bp-timestamp")||0,i.first().data("bp-timestamp")||0),o=(s>this.heartbeat_data.first_recorded&&(this.heartbeat_data.first_recorded=s),(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),e.bp_activity_last_recorded=this.heartbeat_data.last_recorded,I("#buddypress .activity-head-bar .activity-search input[type=search]"));o.length&&(e.bp_activity_last_recorded_search_terms=o.val()),I.extend(e,{bp_heartbeat:((i=I("body.my-activity:not(.activity-singular)")).length?a=bp.Nouveau.getStorage("bp-user-activity")||{scope:"just-me"}:(a=bp.Nouveau.getStorage("bp-activity")||{scope:"all"},I("body.activity.buddypress.groups.single-item").length&&(a.scope="all")),I(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length&&(s=I(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope"),void 0!==a.scope&&a.scope===s||(a.scope=s,"undefined"!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request&&(i.length?bp.Nouveau.setStorage("bp-user-activity","scope",s):bp.Nouveau.setStorage("bp-activity","scope",s)))),I(bp.Nouveau.objectNavParent+" [data-bp-order].selected").length&&(a.order_by=I(bp.Nouveau.objectNavParent+" [data-bp-order].selected").data("bp-orderby")),(i=bp.Nouveau.getStorage("bp-activity","topic_id"))&&(e.bp_heartbeat=e.bp_heartbeat||{},e.bp_heartbeat.topic_id=i),a)})},heartbeatTick:function(t,e){var a,i,o,s=bp.Nouveau.objects,n=bp.Nouveau.getStorage("bp-activity","scope"),d=this,l=bp.Nouveau.getStorage("bp-activity","topic_id");void 0!==e&&e.bp_activity_newest_activities&&(e=e.bp_activity_newest_activities,this.heartbeat_data.newest=I.trim(e.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(e.last_recorded),e=I(this.heartbeat_data.newest).filter(".activity-item"),l&&(a=(e=e.filter(function(){var t=this.dataset.bpActivity?JSON.parse(this.dataset.bpActivity):null,t=t&&void 0!==t.topic_id?t.topic_id:null;return t&&parseInt(t)===parseInt(l)})).length),a=Number(e.length),s.push("mentions"),"all"===n?(I.each(e,function(t,a){a=I(a),I.each(s,function(t,e){-1!==I.inArray("bp-my-"+e,a.get(0).classList)&&(void 0===d.heartbeat_data.highlights[e]?d.heartbeat_data.highlights[e]=[a.data("bp-activity-id")]:-1===I.inArray(a.data("bp-activity-id"),d.heartbeat_data.highlights[e])&&d.heartbeat_data.highlights[e].push(a.data("bp-activity-id")))})}),i=new RegExp("bp-my-("+s.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(i,""),I(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(a)):(this.heartbeat_data.highlights[n]=[],I.each(e,function(t,e){d.heartbeat_data.highlights[n].push(I(e).data("bp-activity-id"))})),I.each(s,function(t,e){var a;void 0!==d.heartbeat_data.highlights[e]&&d.heartbeat_data.highlights[e].length&&(a=0,"mentions"===e&&(a=d.mentions_count),I(bp.Nouveau.objectNavParent+' [data-bp-scope="'+e+'"]').find("a span").html(Number(d.heartbeat_data.highlights[e].length)+a))}),s.pop(),I(document).prop("title","("+a+") "+this.heartbeat_data.document_title),e=(i=I('#buddypress [data-bp-list="activity"]')).find(".load-newest a"),i.first().hasClass("load-newest")?(o=e.html(),e.html(o.replace(/([0-9]+)/,a))):i.find("ul.bb-rl-activity-list").prepend('<li class="load-newest"><a href="#newest">'+r+" ("+a+")</a></li>"),i.find("li.load-newest").trigger("click"),i.trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau)&&bp.Nouveau.reportPopUp()},injectActivities:function(t){var e,a,i,o,s,n=I("body.my-activity:not(.activity-singular)").length?bp.Nouveau.getStorage("bp-user-activity"):bp.Nouveau.getStorage("bp-activity"),d=n.scope||null,n=n.filter||null;I(t.currentTarget).hasClass("load-newest")?(t.preventDefault(),I(t.currentTarget).remove(),s=I.parseHTML(this.heartbeat_data.newest),I.each(s,function(t,e){"LI"===e.nodeName&&I(e).hasClass("just-posted")&&(e=I("#"+I(e).prop("id"))).length&&e.remove()}),(0<(i=(s=I(t.delegateTarget).find(".bb-rl-activity-list")).find(".activity-item").first()).length&&i.hasClass("bb-pinned")?I(i).after(this.heartbeat_data.newest):s.prepend(this.heartbeat_data.newest)).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===d&&I(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===d&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),I(bp.Nouveau.objectNavParent+' [data-bp-scope="'+d+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[d]&&(this.heartbeat_data.highlights[d]=[]),setTimeout(function(){I(t.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+d+"_activity")},3e3),I(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()):I(t.currentTarget).hasClass("bb-rl-load-more")&&(e=Number(this.current_page)+1,a=this,i="",t.preventDefault(),(o=I(t.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],I(t.delegateTarget).children(".just-posted").each(function(){a.just_posted.push(I(this).data("bp-activity-id"))}),(s=I("#buddypress .activity-search.bp-search input[type=search]")).length&&(i=s.val()),bp.Nouveau.objectRequest({object:"activity",scope:d,filter:n,search_terms:i,page:e,method:"append",exclude_just_posted:this.just_posted.join(","),target:'#buddypress [data-bp-list]:not( #bb-schedule-posts_modal [data-bp-list="activity"] ) ul.bb-rl-list'}).done(function(t){!0===t.success&&(o.remove(),a.current_page=e,jQuery(window).scroll())})),I(".activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide()},hideComments:function(t){var a,i,o,t=I(t.target).find(".bb-rl-activity-comments");t.length&&t.each(function(t,e){o=I(e).children("ul").not(".bb-rl-conflict-activity-ul-li-comment"),!(i=I(o).find("li").not(I(".bb-rl-document-action-class, .bb-rl-media-action-class, .bb-rl-video-action-class"))).length||I("body").hasClass("activity-singular")&&""!==window.location.hash&&I(window.location.hash).length&&0!==I(window.location.hash).closest(".bb-rl-activity-comments").length||(a=I(e).closest(".activity-item"),I("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),i.each(function(t,e){if(t<i.length-4){if(t||I(e).parent("ul").before('<div class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+P+"</button></div>"),window.location.hash&&"#"+I(e).attr("id")===window.location.hash)return I(e).parents("li.comment-item").show(),!1;I(e).addClass("bp-hidden").hide()}}),I(o).children(".bp-hidden").length===I(o).children("li").length-1&&I(o).find("li.show-all").length&&I(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showActivity:function(t){t.preventDefault();var e=I(t.currentTarget).parent(),a=e.data("parent_comment_id"),e=I(e).data("activity_id");I(document).trigger("activityModalOpened",{activityId:e}),I(t.currentTarget).parents(".bb-rl-activity-comments").find(".ac-form").each(function(){var t=I(this),e=I(this).closest(".bb-rl-activity-comments"),a=I(this).closest(".comment-item");t.find(".bb-rl-post-elements-buttons-item.bb-rl-post-emoji").removeClass("active").empty(""),bp.Nouveau.Activity.resetActivityCommentForm(t,"hardReset"),e.append(t),a.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),a.removeClass("bb-rl-comment-item-focus")}),bp.Nouveau.Activity.launchActivityPopup(e,a)},closeActivity:function(t){t.preventDefault();var t=I(t.target).closest(".bb-rl-activity-model-wrapper"),e=t.find(".bb-rl-modal-activity-footer"),a=t.find(".activity-item").data("bp-activity-id"),i=t.find("#ac-form-"+a),i=(i.length&&bp.Nouveau.Activity.reinitializeActivityCommentForm(i),_.isUndefined(u)||_.isUndefined(u.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!1,"",a),a&&bp.Nouveau.Activity.cleanupEmojiEventHandlers(a),I(".bb-rl-emojionearea-theatre"));i.length&&(i.find(".emojionearea-picker").remove(),i.removeClass("show hide").addClass("hide")),t.find("#bb-rl-activity-modal").removeClass("bb-closed-comments"),t.closest("body").removeClass("acomments-modal-open"),t.hide(),t.find("ul.bb-rl-activity-list").empty(),e.removeClass("active"),e.find("form.ac-form").remove(),I("li#bb-rl-activity-"+a).removeClass("has-comments")},scopeLoaded:function(t,a){this.current_page=1;var i=I("#buddypress #bb-rl-activity-stream");"mentions"===a.scope&&void 0!==a.response.new_mentions?(I.each(a.response.new_mentions,function(t,e){i.find('[data-bp-activity-id="'+e+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&I.each(this.heartbeat_data.highlights[a.scope],function(t,e){i.find('[data-bp-activity-id="'+e+'"]').length&&i.find('[data-bp-activity-id="'+e+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",I.each(I(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(t,e){"0"===I(e).html()&&I(e).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),I(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){I("#buddypress #bb-rl-activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),setTimeout(function(){void 0!==bp.Nouveau.Media&&"function"==typeof bp.Nouveau.Media.autoPlayGifVideos&&bp.Nouveau.Media.autoPlayGifVideos()},200),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){var t,e;!_.isUndefined(T.params.is_activity_edit)&&0<T.params.is_activity_edit&&(e=I("#bb-rl-activity-"+T.params.is_activity_edit)).length&&(t=e.data("bp-activity"),e=""!==e.data("link-url")?e.data("link-url"):null,_.isUndefined(t)||bp.Nouveau.Activity.postForm.displayEditActivityForm(t,e))},activityPrivacyChange:function(t){var e=t.data,o=I(t.target),s=I(t.currentTarget).closest(".activity-item"),n=s.data("bp-activity-id"),d=(t.preventDefault(),o.data("value"));if(void 0===d||""===I.trim(d))return!1;s.find(".privacy").addClass("loading"),e.ajax({action:"activity_update_privacy",id:n,privacy:d},"activity").done(function(t){var e,a,i;s.find(".privacy").removeClass("loading"),!0===t.success&&(e=s.find(".privacy"),s.find(".activity-privacy li").removeClass("selected"),s.find(".privacy-wrap").attr("data-bp-tooltip",o.text()),o.addClass("selected"),e.removeClass("public loggedin onlyme friends").addClass(d),void 0!==t&&void 0!==t.data&&void 0!==t.data.video_symlink&&(a=(e=I(".bb-rl-document-description-wrap")).find(".bb-rl-open-document-theatre"),i=I(".bb-rl-document-detail-wrap.bb-rl-document-detail-wrap-description-popup"),e.length&&a.length&&a.attr({"data-video-preview":t.data.video_symlink,"data-extension":t.data.extension}),e.length&&i.length&&i.attr({"data-video-preview":t.data.video_symlink,"data-extension":t.data.extension}),"undefined"!=typeof videojs)&&t.data.video_js_id&&videojs(t.data.video_js_id).src({type:t.data.video_extension,src:t.data.video_symlink}),void 0!==t&&void 0!==t.data&&void 0!==t.data.edited_text&&""!==t.data.edited_text&&(s.find(".activity-date span.bb-activity-edited-text").length?s.find(".activity-date span.bb-activity-edited-text").replaceWith(t.data.edited_text):s.find(".activity-date").append(t.data.edited_text)),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=n)})},activityPrivacyRedirect:function(t){var e=I(t.target),t=(t.preventDefault(),e.data("value"));if(void 0===t||""===I.trim(t))return!1;window.location.href=t},togglePrivacyDropdown:function(t){var e=I(t.currentTarget).closest(".activity-item"),t=(t.preventDefault(),e.find(".activity-privacy"));I("ul.activity-privacy").not(t).removeClass("bb-open"),t.toggleClass("bb-open")},activityActions:function(t){var e=t.data,a=I(t.target),i=I(t.currentTarget),o=i.data("bp-activity-id"),s=I(t.delegateTarget),n=i.find(".activity-state"),d=i.find(".comments-count"),l="",r=this,c=I("body"),m=0<a.closest("#bb-rl-activity-modal").length,b=0<a.closest(".bb-rl-internal-model").length,p=(m&&(n=i.closest("#bb-rl-activity-modal").find(".activity-state"),d=i.closest("#bb-rl-activity-modal").find(".comments-count"),l=i.closest("#bb-rl-activity-modal").find(".acomments-count")),0),p=(!(a=I(a).is("span")||I(a).is("i")||I(a).is("img")?I(a).closest("a"):a).parent(".ac-emotion_btn")||a.hasClass("fav")||a.hasClass("unfav")||(p=a.parents(".ac-emotion_item").attr("data-reaction-id")),(a.hasClass("fav")||a.hasClass("unfav")||0<p)&&r.handleFavoriteUnfavorite({event:t,parent:e,target:a,reactionId:p,activityState:n,bodyElem:c,stream:s,activityItem:i}),(a.hasClass("delete-activity")||a.hasClass("acomment-delete")||a.hasClass("spam-activity")||a.hasClass("spam-activity-comment"))&&r.deleteActivity({event:t,parent:e,target:a,activityState:n,activityItem:i,commentsText:d,repliesText:l,activityId:o}),a.closest("span").hasClass("activity-read-more")&&r.readMoreActivity({event:t,target:a,activityId:o,parent:e,activityItem:i}),a.hasClass("ac-form")&&a.hasClass("not-initialized")&&a.closest(".activity-item").find(".acomment-reply").eq(0).trigger("click"),a.closest("#bb-rl-activity-modal").find(".activity-state-comments"));if((a.hasClass("activity-state-comments")&&(0<p.length||""!==a.closest(".activity-item").find(".bb-rl-activity-comments > ul").html())||a.hasClass("acomment-reply")||a.parent().hasClass("acomment-reply")||a.hasClass("acomment-edit"))&&r.displayingTheCommentForm({event:t,target:a,activityId:o,isInsideModal:m,isInsideMediaTheatre:b,self:r}),a.hasClass("activity-state-no-comments")&&t.preventDefault(),a.hasClass("ac-reply-cancel")&&((c=I(a).closest(".ac-form")).addClass("not-initialized"),I(".acomment-reply").attr("aria-expanded","false"),["media","document"].forEach(function(t){r.destroyUploader(t,o)}),c.closest("li.comment-item").length?r.activityRootComment(t):r.resetActivityCommentForm(c,"hardReset"),t.preventDefault()),"ac_form_submit"===a.prop("name")){if(a.prop("disabled"))return void t.preventDefault();r.submitActivityComment({event:t,parent:e,target:a,activityId:o,isInsideModal:m,activityState:n,commentsText:d,activityItem:i,self:r})}a.hasClass("edit")&&a.hasClass("edit-activity")&&(t.preventDefault(),s=i.data("bp-activity"),l=""!==i.data("link-url")?i.data("link-url"):null,void 0!==s)&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(s,l),I("#bb-rl-activity-form").toggleClass("group-activity",a.closest("li").hasClass("groups")),void 0!==bp.Nouveau.Media)&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&I(".bb-rl-close-media-theatre, .bb-close-document-theatre").trigger("click"),m&&(a.hasClass("bb-rl-open-media-theatre")||a.hasClass("bb-open-video-theatre")||a.hasClass("bb-rl-open-document-theatre")||a.hasClass("bb-rl-document-detail-wrap-description-popup")||a.hasClass("bb-rl-document-description-wrap"))&&(t.preventDefault(),a.closest("#bb-rl-activity-modal").find(".bb-rl-modal-activity-header .bb-rl-close-action-popup").trigger("click")),(a.hasClass("pin-activity")||a.hasClass("unpin-activity"))&&r.pinUnpinActivity({event:t,activityId:o,parent:e,target:a,isInsideModal:m}),(a.hasClass("bb-icon-bell-slash")||a.hasClass("bb-icon-bell"))&&r.muteUnmuteNotifications({event:t,activityId:o,parent:e,target:a,isInsideModal:m}),(a.hasClass("close-activity-comment")||a.hasClass("unclose-activity-comment"))&&r.onOffComment({event:t,activityId:o,parent:e,target:a,isInsideModal:m})},commentFormAction:function(t){var e,a;return 3===(e=(t=t||window.event).target||t.srcElement).nodeType&&(e=e.parentNode),!0!==t.altKey&&!0!==t.metaKey&&"TEXTAREA"===e.tagName&&I(e).hasClass("ac-input")?void(27===(a=t.keyCode||t.which)&&!1===t.ctrlKey?I(e).closest("form").slideUp(200):t.ctrlKey&&13===a&&I(e).val()&&I(e).closest("form").find("[type=submit]").first().trigger("click")):t},togglePopupDropdown:function(t){var e;return 3===(e=(t=t||window.event).target||t.srcElement).nodeType&&(e=e.parentNode),!0===t.altKey||!0===t.metaKey||I(e).closest(".privacy-wrap").length?t:void I("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var t,e=I(".bb-rl-load-more:visible").last(),a=I(window);0!==e.length&&e.closest(".bb-rl-activity-list").length&&!0!==e.data("bp-autoloaded")&&(t=e.offset().top-50,a.scrollTop()+a.height()>t)&&(e.data("bp-autoloaded",1),e.find("a").text(T.strings.loadingMore),e.find("a").trigger("click"))},openCommentsMediaUploader:function(t){var e,a,i=this,o=I(t.currentTarget),s=o.data("ac-id"),s=o.closest(".bb-rl-ac-form-container").find("#bb-rl-ac-reply-post-media-uploader-"+s),n=0<o.closest("#bb-rl-activity-modal").length?"#bb-rl-activity-modal ":"";t.preventDefault(),s.hasClass("open")&&!t.isCustomEvent?(s.trigger("click"),s.removeClass("open").addClass("closed")):(e=document.getElementsByClassName("bb-rl-ac-reply-post-default-template").length?document.getElementsByClassName("bb-rl-ac-reply-post-default-template")[0].innerHTML:"",void 0!==window.Dropzone&&s.length&&(s.hasClass("closed")?(e=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:"",acceptedFiles:"image/*",maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:e,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation}),i.dropzone_obj instanceof Dropzone&&i.dropzone_obj.destroy(),i.dropzone_obj=new Dropzone(n+"#bb-rl-ac-reply-post-media-uploader-"+o.data("ac-id"),e),i.setupDropzoneEventHandlers({self:i,dropzoneObj:i.dropzone_obj,dropzoneDataObj:i.dropzone_media,target:o,type:"media"}),s.removeClass("closed").addClass("open")):(i.dropzone_obj&&void 0!==i.dropzone_obj&&i.dropzone_obj.destroy(),i.dropzone_media=[],s.html(""),s.addClass("closed").removeClass("open"))),a=t.currentTarget.id.match(/\d+$/)[0],["document","video","gif"].forEach(function(t){i.destroyUploader(t,a)}),t.isCustomEvent||I(o).closest(".bb-rl-ac-form-container").find(".dropzone.media-dropzone").trigger("click"))},openCommentsDocumentUploader:function(t){var e,a,i=this,o=I(t.currentTarget),s=o.data("ac-id"),s=o.closest(".bb-rl-ac-form-container").find("#bb-rl-ac-reply-post-document-uploader-"+s),n=0<o.closest("#bb-rl-activity-modal").length?"#bb-rl-activity-modal ":"";t.preventDefault(),s.hasClass("open")&&!t.isCustomEvent?(s.trigger("click"),s.removeClass("open").addClass("closed")):(e=document.getElementsByClassName("bb-rl-ac-reply-post-document-template").length?document.getElementsByClassName("bb-rl-ac-reply-post-document-template")[0].innerHTML:"",void 0!==window.Dropzone&&s.length&&(s.hasClass("closed")?(e=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.video_type,createImageThumbnails:!1,dictDefaultMessage:"",maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation}),i.dropzone_document_obj=new Dropzone(n+"#bb-rl-ac-reply-post-document-uploader-"+o.data("ac-id"),e),i.setupDropzoneEventHandlers({self:i,dropzoneObj:i.dropzone_document_obj,dropzoneDataObj:i.dropzone_document,target:o,type:"document"}),s.removeClass("closed").addClass("open")):(i.dropzone_document_obj&&i.dropzone_document_obj.destroy(),i.dropzone_document=[],s.html(""),s.addClass("closed").removeClass("open"))),a=t.currentTarget.id.match(/\d+$/)[0],["media","video","gif"].forEach(function(t){i.destroyUploader(t,a)}),t.isCustomEvent||I(o).closest(".bb-rl-ac-form-container").find(".dropzone.document-dropzone").trigger("click"))},openCommentsVideoUploader:function(t){var e,a,i=this,o=I(t.currentTarget),s=o.data("ac-id"),s=o.closest(".bb-rl-ac-form-container").find("#bb-rl-ac-reply-post-video-uploader-"+s),n=0<o.closest("#bb-rl-activity-modal").length?"#bb-rl-activity-modal ":"";t.preventDefault(),s.hasClass("open")&&!t.isCustomEvent?(s.trigger("click"),s.removeClass("open").addClass("closed")):(e=document.getElementsByClassName("bb-rl-ac-reply-post-video-template").length?document.getElementsByClassName("bb-rl-ac-reply-post-video-template")[0].innerHTML:"",void 0!==window.Dropzone&&s.length&&(s.hasClass("closed")?(e=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:"",maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation}),i.dropzone_video_obj=new Dropzone(n+"#bb-rl-ac-reply-post-video-uploader-"+o.data("ac-id"),e),i.setupDropzoneEventHandlers({self:i,dropzoneObj:i.dropzone_video_obj,dropzoneDataObj:i.dropzone_video,target:o,type:"video"}),s.removeClass("closed").addClass("open")):(i.dropzone_video_obj&&i.dropzone_video_obj.destroy(),i.dropzone_video=[],s.html(""),s.addClass("closed").removeClass("open"))),a=t.currentTarget.id.match(/\d+$/)[0],["media","document","gif"].forEach(function(t){i.destroyUploader(t,a)}),t.isCustomEvent||I(o).closest(".bb-rl-ac-form-container").find(".dropzone.video-dropzone").trigger("click"))},openGifPicker:function(t){t.preventDefault();var e,t=t.currentTarget,a=0<I(t).closest("#bb-rl-activity-modal").length,i=a?"#bb-rl-activity-modal ":"",o=a,s=a?I(".bb-rl-gif-media-search-dropdown-standalone"):I(t).next(),n=t.id.match(/\d+$/)[0],i=I(i+"#bb-rl-ac-reply-post-gif-"+n),d=I(window).scrollTop(),l=I(t).offset(),r=Math.round(l.top),l=Math.round(l.left),c=(s.is(":empty")&&(e=new bp.Models.ACReply,c=new bp.Views.GifMediaSearchDropdown({model:e,standalone:o}),o=new bp.Views.ActivityAttachedGifPreview({model:e,standalone:o}),s.html(c.render().el),i.html(o.render().el),this.models[n]=e),I(t).parents("form").find(".bb-rl-ac-reply-attachments .bb-rl-activity-attached-gif-container")),i=(I(t).hasClass("active")&&c.length&&""===I.trim(c.html())?I(t).removeClass("active"):I(t).addClass("active"),s.toggleClass("open"),l+s.width()-70),o=(2<I(t).parents("li").length&&(i=l+s.width()-110),"translate("+(i=1<I(t).closest(".bb-rl-post-elements-buttons-item").index()?l+s.width()-180:i)+"px, "+(r-d-5)+"px)  translate(-100%, -100%)"),m=(a&&s.css("transform",o),this);["media","document","video"].forEach(function(t){m.destroyUploader(t,n)})},toggleMultiMediaOptions:function(t,e,a){var i,o,s,n;_.isUndefined(u)||(a?(n=(e=I(e||a)).closest(".bb-rl-activity-modal").find(".activity-item"),i=e.closest(".bb-rl-activity-modal").find(".activity-item").data("bp-activity"),o=n.data("bp-activity"),t=I(a)):(n=e.closest(".activity-item"),i=e.closest(".activity-item").data("bp-activity"),o=n.data("bp-activity")),(a=e.closest("li").data("bp-activity-comment"))&&(i=a),a=function(t,e){return i&&!_.isUndefined(i[t])?i[t]:!1===u[t]?u[t]:e},s=function(t,e){return i&&!_.isUndefined(i[t])&&o&&!_.isUndefined(o[t])?i[t]&&o[t]:!1===u[t]?u[t]:e},e.closest("li").hasClass("groups")||n.hasClass("groups")?(e={group_media:s("group_media",!1),group_document:s("group_document",!1),group_video:s("group_video",!1),gif:u.gif.groups,emoji:u.emoji.groups},this.applyMediaSettings(t,e)):(n={profile_media:a("profile_media",!1),profile_document:a("profile_document",!1),profile_video:a("profile_video",!1),gif:u.gif.profile,emoji:u.emoji.profile},this.applyMediaSettings(t,n)))},applyMediaSettings:function(t,e){var a=t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-media.bb-rl-media-support"),i=a.parent(".bb-rl-ac-reply-toolbar"),a=(e.group_media||e.profile_media?(a.show(),i.removeClass("bb-rl-post-media-disabled")):(a.hide(),i.addClass("bb-rl-post-media-disabled")),t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-media.bb-rl-document-support")),i=a.parent(".bb-rl-ac-reply-toolbar"),a=(e.group_document||e.profile_document?(a.show(),i.removeClass("bb-rl-post-media-disabled")):(a.hide(),i.addClass("bb-rl-post-media-disabled")),t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-video.bb-rl-video-support")),i=a.parent(".bb-rl-ac-reply-toolbar"),a=(e.group_video||e.profile_video?(a.show(),i.removeClass("post-video-disabled")):(a.hide(),i.addClass("post-video-disabled")),t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-gif")),i=a.parent(".bb-rl-ac-reply-toolbar"),a=(!1!==e.gif?(a.show(),i.removeClass("post-gif-disabled")):(a.hide(),i.addClass("post-gif-disabled")),t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-emoji")),i=a.parent(".bb-rl-ac-reply-toolbar");!1!==e.emoji?(a.show(),i.removeClass("post-emoji-disabled")):(a.hide(),i.addClass("post-emoji-disabled"))},fixAtWhoActivity:function(){I(".bb-rl-acomment-content, .bb-rl-activity-content").each(function(){for(var t=I(this).find("span.atwho-query"),e=t.length,a=0;a<e;a++)I(t[a]).replaceWith(t[a].innerText)})},navigateToSpecificComment:function(){setTimeout(function(){var t,e=window.location.hash;e&&(e=e,t=0!==(t=I("#wpadminbar")).length?t.innerHeight():0,0<I(e).length)&&I("html, body").animate({scrollTop:parseInt(I(e).offset().top)-(80+t)},0)},200)},editActivityCommentForm:function(t,e){var a,i,o,s,n,d=t.find('input[name="comment_form_id"]').val(),l=t.find("#bb-rl-ac-reply-toolbar-"+d),r=this;t.find("#ac-input-"+d).html(e.content);void 0!==e.media&&0<e.media.length&&(l.find(".bb-rl-ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),[".bb-rl-ac-reply-document-button",".bb-rl-ac-reply-video-button",".bb-rl-ac-reply-gif-button"].forEach(function(t){r.disabledCommentUploader(l,t)}),bp.Readylaunch.Utilities.injectFiles({toolbarDiv:l,commonData:e.media,id:e.id,self:this,fileType:"media",buttonClass:".bb-rl-ac-reply-media-button",dropzoneObj:r.dropzone_obj})),void 0!==e.document&&0<e.document.length&&(l.find(".bb-rl-ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),[".bb-rl-ac-reply-media-button",".bb-rl-ac-reply-video-button",".bb-rl-ac-reply-gif-button"].forEach(function(t){r.disabledCommentUploader(l,t)}),bp.Readylaunch.Utilities.injectFiles({toolbarDiv:l,commonData:e.document,id:e.id,self:this,fileType:"document",buttonClass:".bb-rl-ac-reply-document-button",dropzoneObj:r.dropzone_document_obj})),void 0!==e.video&&0<e.video.length&&(l.find(".bb-rl-ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),[".bb-rl-ac-reply-media-button",".bb-rl-ac-reply-document-button",".bb-rl-ac-reply-gif-button"].forEach(function(t){r.disabledCommentUploader(l,t)}),bp.Readylaunch.Utilities.injectFiles({toolbarDiv:l,commonData:e.video,id:e.id,self:this,fileType:"video",buttonClass:".bb-rl-ac-reply-video-button",dropzoneObj:r.dropzone_video_obj})),void 0!==e.gif&&0<Object.keys(e.gif).length&&(a=l.find(".bb-rl-ac-reply-gif-button").next(),i=0<t.closest("#bb-rl-activity-modal").length,i=I((i?"#bb-rl-activity-modal ":"")+"#bb-rl-ac-reply-post-gif-"+d),l.find(".bb-rl-ac-reply-gif-button").trigger("click"),[".bb-rl-ac-reply-media-button",".bb-rl-ac-reply-document-button",".bb-rl-ac-reply-video-button"].forEach(function(t){r.disabledCommentUploader(l,t)}),o=new bp.Models.ACReply,s=new bp.Views.GifMediaSearchDropdown({model:o}),n=new bp.Views.ActivityAttachedGifPreview({model:o}),s.model.set("gif_data",e.gif),a.html(s.render().el),i.html(n.render().el),this.models[d]=o),void 0===e.media&&void 0===e.document&&void 0===e.video&&void 0===e.gif&&t.find(".bb-rl-ac-reply-toolbar .bb-rl-post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(t,e){var a,i;e=void 0!==e?e:"",!t.hasClass("acomment-edit")&&"hardReset"!==e||(a=t.find('input[name="comment_form_id"]').val(),e=t.attr("data-item-id"),I('[data-bp-activity-comment-id="'+e+'"]').find("#bb-rl-acomment-display-"+e).removeClass("bp-hide"),t.removeClass("acomment-edit").removeAttr("data-item-id"),t.find(".bb-rl-post-elements-buttons-item").removeClass("disable"),t.find(".bb-rl-post-elements-buttons-item .bb-rl-toolbar-button").removeClass("active"),t.find("#ac-input-"+a).html(""),t.removeClass("has-content has-gif has-media"),i=this,["media","document","video","gif"].forEach(function(t){i.destroyUploader(t,a)}))},reinitializeActivityCommentForm:function(t){var e,a=t.find('input[name="comment_form_id"]').val(),i=(t.hasClass("acomment-edit")&&(e=t.attr("data-item-id"),I('[data-bp-activity-comment-id="'+e+'"]').find("#bb-rl-acomment-display-"+e).removeClass("bp-hide"),t.removeClass("acomment-edit").removeAttr("data-item-id")),t.find("#ac-input-"+a).html(""),t.removeClass("has-content has-gif has-media"),I(".bb-rl-modal-activity-footer").addClass("active").append(t),this);["media","document","video","gif"].forEach(function(t){i.destroyUploader(t,a)})},disabledCommentUploader:function(t,e,a){a=a||"";t=t.find(e);0<t.length&&(e=t.parents(".bb-rl-post-elements-buttons-item"),a?e.addClass(a):e.addClass("disable"))},validateCommentContent:function(t){var e=t.html(),e=(e=I.trim(e.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),a=t.text().trim(),t=t.closest("form");""!==a||0<=e.indexOf("bb-rl-emojioneemoji")||t.hasClass("acomment-edit")?t.addClass("has-content"):t.removeClass("has-content")},ReactionStatePopupTab:function(t){t.preventDefault();t=I(this).closest(".activity-state-popup");t.find(".activity-state-popup_tab_panel li a").removeClass("active"),I(this).addClass("active"),t.find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),t.find("."+I(this).data("tab")).addClass("active")},closeActivityState:function(){I(".activity-state-popup").hide().removeClass("active")},listenCommentInput:function(t){var e,a;0<t.length&&(t=t.get(0),e=I(t).attr("id")+(I(t).closest(".bb-rl-media-model-inner").length?"-theater":""),-1===I.inArray(e,this.InitiatedCommentForms)||I(t).closest("form").hasClass("events-initiated")||(a=this.InitiatedCommentForms.indexOf(e),this.InitiatedCommentForms.splice(a,1)),-1!==I.inArray(e,this.InitiatedCommentForms)||I(t).closest("form").hasClass("events-initiated")||(t.addEventListener("paste",function(t){t.preventDefault();t=t.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),t.addEventListener("input",function(t){var e=I(t.currentTarget).html(),e=I.trim(e.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));e=e.replace(/&nbsp;/g," "),""!==I(t.currentTarget).text().trim()||0<=e.indexOf("bb-rl-emojioneemoji")?I(t.currentTarget).closest("form").addClass("has-content"):I(t.currentTarget).closest("form").removeClass("has-content")}),I(t).closest("form").addClass("events-initiated"),this.InitiatedCommentForms.push(e)))},activityRootComment:function(t){var t=I(t.currentTarget).closest("#bb-rl-activity-modal"),e=t.find(".activity-item").data("bp-activity-id"),a=t.find("#ac-form-"+e);bp.Nouveau.Activity.resetActivityCommentForm(a,"hardReset"),t.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),t.find(".comment-item").removeClass("bb-rl-comment-item-focus"),t.find(".bb-rl-modal-activity-footer").addClass("active").append(a),a.addClass("root"),a.find("#ac-input-"+e).focus(),a.find(".bb-rl-ac-reply-content .ac-input").attr("data-placeholder",T.strings.commentPlaceholder),a.find('input[name="ac_form_submit"]').val(T.strings.commentButtonText),bp.Nouveau.Activity.clearFeedbackNotice(a)},clearFeedbackNotice:function(t){t=t.find(".bb-rl-ac-form-container .bp-feedback");t.length&&t.remove()},launchActivityPopup:function(t,e){var a=I("#bb-rl-activity-"+t),i=I(".bb-rl-activity-model-wrapper"),o=a[0].outerHTML,e='[data-parent_comment_id="'+e+'"]',s=a.data("activity-popup-title");bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null,bp.Nouveau.Activity.activityPinHasUpdates=!1,i.closest("body").addClass("acomments-modal-open"),i.show(),i.find("ul.bb-rl-activity-list").html(o),i.find(".bb-rl-modal-activity-header h2").text(s),0<i.find(".activity-state-comments .comments-count").data("comments-count")?bp.Nouveau.Activity.initialLoadComment({activityID:t,parentID:t,modal:i}):i.find("#bb-rl-activity-"+t).hasClass("has-comments")||i.find("#bb-rl-activity-"+t).addClass("has-comments");i.find(".bb-rl-activity-video-elem").each(function(t,e){var o=I(e);o.find("video").each(function(t,e){var e=I(e),a=e.attr("id")+Math.floor(1e4*Math.random()),i=(e.attr("id",a),o.find(".bb-rl-more_dropdown-wrap"));0<i.length?e.insertAfter(i):e.prependTo(o),o.find(".video-js").not(e).remove(),e.removeClass("vjs-initialized"),e.addClass("video-js"),videojs(a,{controls:!0,aspectRatio:"16:9",fluid:!0,playbackRates:[.5,1,1.5,2],fullscreenToggle:!1})})}),a.hasClass("bb-closed-comments")&&i.find("#bb-rl-activity-modal").addClass("bb-closed-comments");o=i.find("#ac-form-"+t),i.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),i.find(".comment-item").removeClass("bb-rl-comment-item-focus"),i.find(".bb-rl-modal-activity-footer").addClass("active").append(o),o.removeClass("not-initialized").addClass("root").find("#ac-input-"+t).focus(),bp.Nouveau.Activity.clearFeedbackNotice(o),o.removeClass("events-initiated"),s=i.find(".bb-rl-modal-activity-footer .ac-form").find(".ac-input[contenteditable]");bp.Nouveau.Activity.listenCommentInput(s),i.find(".bb-activity-more-options-wrap .bb-activity-more-options-action, .bb-rl-pin-action_button, .bb-rl-mute-action_button").attr("data-balloon-pos","left"),i.find(".privacy-wrap").attr("data-bp-tooltip-pos","right"),i.find(e).children(".acomments-view-more").first().trigger("click"),_.isUndefined(u)||_.isUndefined(u.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#bb-rl-activity-modal ",t),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp(),bp.Nouveau.Activity.toggleMultiMediaOptions(o,"",".bb-rl-modal-activity-footer"),setTimeout(function(){bp.Nouveau.Activity.invokeMediaFn("autoPlayGifVideos")},500),i.find(".bb-rl-modal-activity-body").hasClass("bb-rl-modal-activity-body-scroll-event-initiated")||(i.find(".bb-rl-modal-activity-body").on("scroll",function(){var t=I(this);Math.ceil(t.scrollTop()+t.innerHeight()+1)>=t.prop("scrollHeight")?i.addClass("bb-rl-modal-activity-body-scrolled-to-bottom"):i.removeClass("bb-rl-modal-activity-body-scrolled-to-bottom")}),i.find(".bb-rl-modal-activity-body").addClass("bb-rl-modal-activity-body-scroll-event-initiated"))},initialLoadComment:function(t){this.loadMoreComments({target:t.modal.find(".bb-rl-activity-comments"),activityId:t.activityID,parentCommentId:t.parentID||0,isModal:!0})},viewMoreComments:function(t){t.preventDefault();var t=I(t.currentTarget),e=t.parent();this.loadMoreComments({target:t,currentTargetList:t.parent(),activityId:I(e).data("activity_id"),commentsList:t.closest(".bb-rl-activity-comments"),commentsActivityItem:t.closest(".activity-item"),parentCommentId:I(e).data("parent_comment_id"),lastCommentTimestamp:t.prev("li.activity-comment").data("bp-timestamp"),addAfterListItemId:"",lastCommentId:t.prev("li.activity-comment").data("bp-activity-comment-id"),isModal:!1})},autoloadMoreComments:function(){var t,e,a,i,o=I(".bb-rl-activity-model-wrapper");0<o.length&&"none"!==o.css("display")&&(t=I(".bb-rl-modal-activity-body .bb-rl-activity-comments > ul > li.acomments-view-more:not(.loading), .bb-rl-modal-activity-body .bb-rl-activity-comments .activity-actions > ul > li.acomments-view-more:not(.loading)"),i=(o=o.find(".bb-rl-modal-activity-body")).find(".bb-rl-activity-comments:not(.active)"),0<t.length&&0<o.length&&0<i.length&&(i=I(t).offset().top,a=(e=I(o).scrollTop())+I(o).height(),(i=i-I(o).offset().top+e)<a)&&i+I(t).outerHeight()>e&&I(t).trigger("click").addClass("loading"),setTimeout(function(){jQuery(window).scroll()},200))},activitySyncOnModalClose:function(t,e){t.preventDefault();var t=I(t.currentTarget),t=t.is(document)?I(".bb-rl-activity-model-wrapper"):t.parents(".bb-rl-activity-model-wrapper"),t=t.find("ul.bb-rl-activity-list > li").data("bp-activity-id"),e=void 0!==e?e:t,a=I("#bb-rl-activity-stream li.activity-item[data-bp-activity-id="+e+"]");0<a.length&&bp.Nouveau.Activity.activityHasUpdates&&(a.addClass("activity-sync"),bp.Nouveau.ajax({action:"activity_sync_from_modal",activity_id:e},"activity").done(function(t){!1!==t.success&&void 0!==t.data&&void 0!==t.data.activity&&(a.replaceWith(I.parseHTML(t.data.activity)),jQuery(window).scroll(),bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities())}).fail(function(t){console.error("Request failed:",t)})),bp.Nouveau.Activity.activityHasUpdates=!1,bp.Nouveau.Activity.currentActivityId=null},discardGifEmojiPicker:function(){var t=I("#bb-rl-activity-modal"),e=t.find(".bb-rl-modal-activity-body .activity-item").data("bp-activity-id"),e=(0<t.length&&0<I(".bb-rl-emojionearea-theatre.show").length&&I(".bb-rl-activity-model-wrapper #ac-input-"+e).data("emojioneArea").hidePicker(),I(".bb-rl-gif-media-search-dropdown-standalone.open"));0<t.length&&0<e.length&&(e.removeClass("open"),t.find(".bb-rl-ac-reply-gif-button").removeClass("active"))},initializeEmojioneArea:function(t,s,n){var e;I.fn.emojioneArea&&(I(s+"#ac-input-"+n).emojioneArea({standalone:!0,hideSource:!1,container:s+"#bb-rl-ac-reply-emoji-button-"+n,detachPicker:!!t,containerPicker:t?".bb-rl-emojionearea-theatre":null,autocomplete:!1,pickerPosition:"top",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){I(s+"#ac-input-"+n)[0].emojioneArea.hidePicker();var t=I(s+"#ac-form-"+n+" #ac-input-"+n),e=t.html(),e=I.trim(e.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));e=e.replace(/&nbsp;/g," "),""!==t.text()||0<=e.indexOf("emojioneemoji")?t.closest("form").addClass("has-content"):t.closest("form").removeClass("has-content")},picker_show:function(){I(this.button[0]).closest(".bb-rl-post-emoji").addClass("active"),I(".bb-rl-emojionearea-theatre").removeClass("hide").addClass("show")},picker_hide:function(){I(this.button[0]).closest(".bb-rl-post-emoji").removeClass("active"),I(".bb-rl-emojionearea-theatre").removeClass("show").addClass("hide")}}}),t)&&((t=(t=I(s).closest(".modal, .bb-modal, .bb-rl-modal, .activity-modal, .activity-theatre, .bb-rl-screen-content")).length?t:I(s)).on("click"+(e=".bb-rl-emoji-"+n),"#bb-rl-ac-reply-emoji-button-"+n,function(e){var t,a,i,o=I(s+"#ac-input-"+n).data("emojioneArea");o&&(a=(t=I(".bb-rl-emojionearea-theatre")).find(".emojionearea-picker"),t.hasClass("show")&&!a.hasClass("hidden")?(o.hidePicker(),t.removeClass("show").addClass("hide"),a.addClass("hidden")):(1<(a=t.find(".emojionearea-picker")).length&&a.remove(),o.showPicker(),t.removeClass("hide").addClass("show"),(i=t.find(".emojionearea-picker")).addClass("hidden"),setTimeout(function(){var t=e.clientX;i.length&&(i.css("transform","translate("+(t+30)+"px, "+(e.clientY-20)+"px) translate(-100%, -100%)"),i.removeClass("hidden"))},50)))}),t.data("emoji-event-namespace-"+n,e))},cleanupEmojiEventHandlers:function(a){I(".modal, .bb-modal, .bb-rl-modal, .activity-modal, .activity-theatre, .bb-rl-screen-content").each(function(){var t=I(this),e=t.data("emoji-event-namespace-"+a);e&&(t.off(e),t.removeData("emoji-event-namespace-"+a))})},destroyUploader:function(t,e){var a,i=this,i={media:{obj:i.dropzone_obj,dropzone:i.dropzone_media,uploaderId:"#bb-rl-ac-reply-post-media-uploader-",buttonId:"#bb-rl-ac-reply-media-button-",additionalIds:["#bb-rl-ac-reply-post-media-uploader-1-"]},document:{obj:i.dropzone_document_obj,dropzone:i.dropzone_document,uploaderId:"#bb-rl-ac-reply-post-document-uploader-",buttonId:"#bb-rl-ac-reply-document-button-"},video:{obj:i.dropzone_video_obj,dropzone:i.dropzone_video,uploaderId:"#bb-rl-ac-reply-post-video-uploader-",buttonId:"#bb-rl-ac-reply-video-button-"},gif:{buttonId:"#bb-rl-ac-reply-gif-button-",dropdownClass:".bb-rl-gif-media-search-dropdown",standaloneClass:".bb-rl-gif-media-search-dropdown-standalone",modelProperty:"gif_data",containerId:"#bb-rl-ac-reply-post-gif-"}}[t];i&&("gif"!==t&&(a=i.obj,_.isNull(a)||(a.destroy(),I(i.uploaderId+e).html(""),i.additionalIds&&i.additionalIds.forEach(function(t){I(t+e).html("")})),i.dropzone=[],I(i.uploaderId+e).removeClass("open").addClass("closed")),I(i.buttonId+e).removeClass("active"),"gif"===t)&&(I(i.buttonId+e).closest(".bb-rl-post-gif").find(i.dropdownClass).removeClass("open").empty(),I(i.standaloneClass).removeClass("open").empty(),_.isUndefined(this.models[e])||(this.models[e].set(i.modelProperty,{}),I(i.containerId+e).find(".bb-rl-activity-attached-gif-container").removeAttr("style")))},handleFavoriteUnfavorite:function(t){var e,i,o,s,a=t.event,n=(a.preventDefault(),t.parent),d=t.target,l=t.reactionId,r=t.activityState,c=t.bodyElem,m=t.stream,b=t.activityItem;c.hasClass("bb-is-mobile")&&c.hasClass("bb-reactions-mode")&&0===d.closest(".ac-emotion_btn").length&&!0!==a.customTriggered||(d=I(d).is("a")?d:I(d).closest("a")).hasClass("loading")||(d.addClass("loading"),e=d.hasClass("fav")?"fav":"unfav",i=!0,t="activity",c=d.parents(".bb-rl-acomment-display").first(),a=d.attr("data-reacted-id"),0<l&&(e="fav"),d.parent(".ac-emotion_btn")&&(a=d.parents(".bp-generic-meta").find(".unfav").attr("data-reacted-id")),"fav"===e&&parseInt(l)===parseInt(a)?d.removeClass("loading"):(0<c.length&&(i=!1,t="activity_comment"),s=(o=i?d.parents(".activity-item"):d.parents(".activity-comment").first()).data(i?"bp-activity-id":"bp-activity-comment-id"),a={action:"activity_mark_"+e,reaction_id:l,item_id:s,item_type:t},n.ajax(a,"activity").done(function(a){var t;!1===a.success?(d.removeClass("loading"),alert(a.data)):(d.fadeOut(200,function(){var t=I(this),e="false"===t.attr("data-pressed")?"true":"false";t.attr("data-pressed",e),void 0!==a.data.reaction_count&&((e=i?o.find(".bb-rl-activity-content .activity-state-reactions"):o.find("#bb-rl-acomment-display-"+s+" .bb-rl-comment-reactions .activity-state-reactions")).length?e.replaceWith(a.data.reaction_count):(i?o.find(".bb-rl-activity-content .activity-state"):o.find("#bb-rl-acomment-display-"+s+" .bb-rl-comment-reactions")).prepend(a.data.reaction_count),r.toggleClass("has-likes",""!==a.data.reaction_count)),a.data.reaction_button&&(i?o.find(".bp-generic-meta a.bp-like-button:first"):o.find("#bb-rl-acomment-display-"+s+" .bp-generic-meta a.bp-like-button")).replaceWith(a.data.reaction_button),o.find(".ac-emotions_list").removeClass("active"),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=s,t.fadeIn(200),d.removeClass("loading")}),I(i?".activity[data-bp-activity-id="+s+"] > .bb-rl-activity-content":".activity-comment[data-bp-activity-comment-id="+s+"] > .bb-rl-acomment-display > .bb-rl-acomment_inner").find(".activity-state-reactions").parent().addClass("bb-has-reaction_update"),"fav"===e?void 0===a.data.directory_tab||""===a.data.directory_tab||I(n.objectNavParent+' [data-bp-scope="favorites"]').length||I(n.objectNavParent+' [data-bp-scope="all"]').after(a.data.directory_tab):"unfav"===e&&((t=I('[data-bp-user-scope="favorites"]').hasClass("selected")||I(n.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&b.remove(),void 0!==a.data.no_favorite)&&(I(n.objectNavParent+' [data-bp-scope="all"]').length&&I(n.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?I(n.objectNavParent+' [data-bp-scope="favorites"]').remove():t&&m.append(a.data.no_favorite)))}).fail(function(){d.removeClass("loading")})))},deleteActivity:function(t){t.event.preventDefault();var b,p,v,u=t.parent,y=t.target,h=t.activityState,f=t.activityItem,g=t.commentsText,_=t.activityId,C=y.closest("[data-bp-activity-comment-id]"),w=C.data("bp-activity-comment-id"),N=0,j=y.closest(".bb-rl-activity-comments");if(j.addClass("active"),void 0!==a&&!1===window.confirm(a))return!1;y.addClass("loading");var A={action:"delete_activity",id:_,_wpnonce:u.getLinkParams(y.prop("href"),"_wpnonce"),is_single:y.closest("[data-bp-single]").length};(y.hasClass("spam-activity")||y.hasClass("spam-activity-comment"))&&(A.action="bp_spam_activity"),b=f,w&&(delete A.is_single,A.id=w,A.is_comment=!0,b=C),u.ajax(A,"activity").done(function(t){if(y.removeClass("loading"),!1===t.success)b.append(t.data.feedback),b.find(".bp-feedback").hide().fadeIn(300);else{var e,a=b.closest(".has-child-comments"),i=(b.hasClass("has-child-comments")&&(e=b.closest("ul").closest("li")),a.find("> ul"));if(t.data.redirect)return window.location.href=t.data.redirect;if(t.data.parent_activity_id&&t.data.activity&&I("body:not(.activity-singular) #buddypress #bb-rl-activity-stream ul.bb-rl-activity-list li#bb-rl-activity-"+t.data.parent_activity_id).replaceWith(t.data.activity),w){N=1;for(var o=C.find(".acomments-view-more").data("child-count"),o=(f.append(C.find("form")),C.find("li.comment-item").each(function(){N+=1}),N+=void 0!==o?parseFloat(o):0,v=h.find("span.comments-count"),p=v.text().length?v.text().match(/\d+/)[0]:0,p=Number(p-N),g.length?(o=1<p?T.strings.commentsLabel:T.strings.commentLabel,g.text(o.replace("%d",p)),v.attr("data-comments-count",p)):v.parent(".has-comments").removeClass("has-comments"),C.closest(".activity-comment")),s={},n=1,d=(C.hasClass("has-child-comments")&&(n=(n+=C.find(".acomments-view-more").data("child-count")||0)+C.find(".activity-comment:visible").length),o);d.length;){var l=d.data("bp-activity-comment-id");if(s[l])break;s[l]=!0;var r,c,l=d.find(".bb-rl-comment-reactions").first(),m=l.find(".acomments-count");m.length&&(c=parseInt(m.attr("data-comments-count")),isNaN(c)&&(c=(r=m.text().match(/\d+/))?parseInt(r[0]):0),0===(r=Math.max(0,c-n))?l.find(".activity-state-comments").remove():(c=(1<r?T.strings.repliesLabel:T.strings.replyLabel).replace("%d",r),m.attr("data-comments-count",r).text(c))),d=d.parent().closest(".activity-comment")}(v=f.find("li.show-all a")).length&&v.html(P.replace("%d",p)),0===p&&(f.removeClass("has-comments"),h.removeClass("has-comments"),g.empty())}b.slideUp(300,function(){var t;b.remove(),0===i.find("li").length&&a.removeClass("has-child-comments"),void 0!==e&&e.length&&(t=e.find("> ul")).length&&(t=t.html())&&""===t.trim()&&e.removeClass("has-child-comments")}),w||f.data("bp-timestamp")!==u.Activity.heartbeat_data.last_recorded||(u.Activity.heartbeat_data.newest="",u.Activity.heartbeat_data.last_recorded=0),I(document).trigger("bp_activity_ajax_delete_request",I.extend(A,{response:t})),I(document).trigger("bp_activity_ajax_delete_request_video",I.extend(A,{response:t})),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=_}j.removeClass("active")})},readMoreActivity:function(t){var e=t.event,a=(e.preventDefault(),t.target),i=null,o=t.activityId,s=a.closest("div");if(I(s).hasClass("bb-rl-activity-inner")?i=o:I(s).hasClass("bb-rl-acomment-content")&&(i=a.closest("li").data("bp-activity-comment-id")),!i)return e;var o=t.parent,n=t.activityItem,d=a.closest("span");I(d).addClass("loading"),o.ajax({action:"get_single_activity_content",id:i},"activity").done(function(t){"object"!=typeof t&&0<a.closest("div").find(".bb-activity-media-wrap").length&&(t=JSON.parse(t)),I(d).removeClass("loading");var e=s.parent().find(".bp-feedback");e.length&&e.remove(),!1===t.success?(s.after(t.data.feedback),s.parent().find(".bp-feedback").hide().fadeIn(300)):(((e=I(s).children()).filter(".bb-poll-view").length?(e.not(".bb-poll-view").remove(),I(s).prepend(t.data.contents)):I(s).html(t.data.contents)).slideDown(300),jQuery(window).scroll(),n.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB)&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+i)))})},displayingTheCommentForm:function(t){var e,a,i,o,s,n,d,l,r,c,m,b,p=t.event,v=t.target;v.parents(".activity-item").hasClass("bb-closed-comments")?p.preventDefault():(n=t.activityId,a=t.isInsideModal,i=t.isInsideMediaTheatre,m=n,t=t.self,d=I("#bb-rl-activity-modal"),c=I(".bb-rl-internal-model"),o=a?(e=d.find("#ac-form-"+n),l=d.find(".bb-rl-modal-activity-footer"),"#bb-rl-activity-modal "):i?(e=c.find("#ac-form-"+n),".bb-rl-internal-model "):(e=I("#ac-form-"+n),l=I('[data-bp-activity-id="'+m+'"] .bb-rl-activity-comments'),""),s=!1,(b=v.closest(".bb-rl-media-model-container")).length&&(e=b.find("#ac-form-"+n),l=b.find('[data-bp-activity-id="'+m+'"] .bb-rl-activity-comments')),(b=v.closest(".activity-item")).hasClass("has-comments")||b.addClass("has-comments"),p.preventDefault(),t.resetActivityCommentForm(e,"hardReset"),(b=v.closest("li")).data("bp-activity-comment-id")&&(m=b.data("bp-activity-comment-id")),b.data("bp-activity-comment")&&(s=b.data("bp-activity-comment")),this.toggleMultiMediaOptions(e,v),e.removeClass("root"),I(".ac-form").addClass("not-initialized").find(".ac-input:not(.emojionearea)").html(""),bp.Nouveau.Activity.clearFeedbackNotice(e),e.children("div").each(function(t,e){I(e).hasClass("error")&&I(e).remove()}),v.hasClass("acomment-edit")&&!_.isNull(s)?((p=I(o+'[data-bp-activity-comment-id="'+m+'"]')).find("#bb-rl-acomment-display-"+m).addClass("bp-hide"),p.find("#bb-rl-acomment-edit-form-"+m).append(e),e.addClass("acomment-edit").attr("data-item-id",m),t.validateCommentContent(e.find(".ac-textarea").children(".ac-input")),t.editActivityCommentForm(e,s),a&&I(".bb-rl-modal-activity-footer").removeClass("active")):(b=I(".bb-rl-modal-activity-footer"),m===n?(a&&(b.addClass("active"),d.find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus bb-rl-comment-item-focus")),l.append(e),e.addClass("root"),l.find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus bb-rl-comment-item-focus")):(p=a?d:i?c:I(document),t=(t=BP_Nouveau.activity&&BP_Nouveau.activity.params&&BP_Nouveau.activity.params.comment_threading)&&t.enabled?parseInt(t.max_depth,10)<=(l=p.find('[data-bp-activity-comment-id="'+m+'"]')).parents(".bb-rl-activity-comments > ul li.comment-item").length+1&&(d=l.parent().closest("li.comment-item")).length&&(c=d.children("ul").children("li.comment-item")).length?c.last():l:p.find('[data-bp-activity-comment-id="'+m+'"]'),a&&b.removeClass("active"),t.append(e))),d=e.find('input[name="ac_form_submit"]'),c=!1,(0<v.children(".acomments-count").length||v.hasClass("acomment-reply"))&&n!==m?c=!0:v.hasClass("acomment-edit")&&(c=(n=v.closest(".comment-item").parent().data("activity_id"))!==v.closest(".comment-item").parent().data("parent_comment_id")),c?(d.val(T.strings.replyButtonText),e.find(".bb-rl-ac-reply-content .ac-input").attr("data-placeholder",T.strings.replyPlaceholder)):(d.val(T.strings.commentButtonText),e.find(".bb-rl-ac-reply-content .ac-input").attr("data-placeholder",T.strings.commentPlaceholder)),e.removeClass("not-initialized"),p=(l=e.find(".bb-rl-post-elements-buttons-item.post-emoji")).prevAll().not(":hidden").length+1,l.attr("data-nth-child",p),t=(b=e.find(".bb-rl-post-elements-buttons-item.bb-rl-post-gif")).prevAll().not(":hidden").length+1,b.attr("data-nth-child",t),m=e.find(".ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(m),v.attr("aria-expanded","true"),v.closest(".bb-rl-activity-comments").find(".bb-rl-acomment-display, .comment-item").removeClass("bb-rl-display-focus").removeClass("bb-rl-comment-item-focus"),v.closest(".bb-rl-acomment-display").addClass("bb-rl-display-focus"),v.closest(".comment-item").addClass("bb-rl-comment-item-focus"),c=_.isNull(s)?"":s.nickname,d=_.isNull(s)?"":s.user_id,l="",_.isUndefined(c)||(l='<span class="atwho-inserted" data-atwho-at-query="@" contenteditable="false">@'+c+"</span>&nbsp;"),p=_.isUndefined(T.params.user_id)?"":T.params.user_id,b={offset:-(I(window).height()/2-75),easing:"swing"},r=m.get(0),jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var t,e,a=300<jQuery(window).height()?200:100;i?(t=I(".bb-media-info-section"),e=jQuery(r).offset().top-t.offset().top,t.animate({scrollTop:e-a},500)):jQuery("html, body").animate({scrollTop:jQuery(r).offset().top-a},500)},500):(a?I(".bb-rl-modal-activity-body"):i?I(".bb-media-info-section"):I).scrollTo(e,500,b),I(o+"#ac-form-"+n+" #ac-input-"+n).focus(),t=I(o+"#ac-input-"+n),_.isUndefined(u)||_.isUndefined(u.emoji)||void 0!==t.data("emojioneArea")||(c=t.html(),bp.Nouveau.Activity.initializeEmojioneArea(a,o,n),v.hasClass("acomment-edit")&&!_.isNull(s)&&t.html(c)),""===l||v.hasClass("acomment-edit")||v.hasClass("button")||v.hasClass("activity-state-comments")||p===d||(t.html(l),e.addClass("has-content")),void 0!==window.getSelection&&void 0!==document.createRange&&!_.isNull(s)&&0<t.length&&t[0]&&t[0].nodeType===Node.ELEMENT_NODE&&((m=document.createRange()).selectNodeContents(t[0]),m.collapse(!1),(b=window.getSelection()).removeAllRanges(),b.addRange(m)),_.isUndefined(window.MediumEditor)||t.hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(t[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1})))},submitActivityComment:function(t){var p,v,e=t.event,a=t.parent,u=t.target,y=t.activityId,h=t.isInsideModal,f=t.activityState,g=t.commentsText,C=t.activityItem,w=t.self,N=(u.prop("disabled",!0),u.closest(".bb-rl-activity-comments")),j=(N.addClass("active"),u.closest("form")),A=y,t=(e.preventDefault(),u.closest("li")),e=(t.data("bp-activity-comment-id")&&(A=t.data("bp-activity-comment-id")),(v=I(j).find(".ac-input").first()).find("span.atwho-query").each(function(){I(this).replaceWith(this.innerText)}),v.find("img.emoji").each(function(){I(this).addClass("emojioneemoji").attr("data-emoji-char",I(this).attr("alt")).removeClass("emoji")}),v.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),void 0===y&&0<u.parents(".bb-rl-modal-activity-footer").length&&(y=u.parents("form.ac-form").find("input[name=comment_form_id]").val(),A=y),u.parent().addClass("loading").prop("disabled",!0),v.addClass("loading").prop("disabled",!0),v[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"")),x={action:"new_activity_comment",_wpnonce_new_activity_comment:I("#_wpnonce_new_activity_comment").val(),comment_id:A,form_id:y,content:e},t=I("#_bp_as_nonce_"+y).val(),z=(t&&(x["_bp_as_nonce_"+y]=t),this.dropzone_media.length&&(x.media=this.dropzone_media),this.dropzone_document.length&&(x.document=this.dropzone_document),this.dropzone_video.length&&(x.video=this.dropzone_video,_.isEmpty(x.content))&&(x.content="&#8203;"),_.isUndefined(this.models[y])||(p=this.models[y],x.gif_data=this.models[y].get("gif_data")),x.content=x.content.replace(/&nbsp;/g," "),j.hasClass("acomment-edit")&&(x.edit_comment=!0),0<u.closest(".bb-rl-modal-activity-footer").length);a.ajax(x,"activity").done(function(t){if(u.parent().removeClass("loading"),v.removeClass("loading"),I(".acomment-reply").attr("aria-expanded","false"),!1===t.success)j.append(I(t.data.feedback).hide().fadeIn(200));else{var e,a=0<u.closest(".elementor-activity-item").length,i=j.prev().hasClass("activity-actions"),o=t.data.parent_id?parseInt(t.data.parent_id,10):null,s=(o&&o!==parseInt(A,10)?(s=I(h?"#bb-rl-activity-modal":document),o===parseInt(y,10)?!(e=s.find('[data-bp-activity-id="'+y+'"] .bb-rl-activity-comments')).length&&h&&(e=s.find(".bb-rl-activity-comments")):e=s.find('[data-bp-activity-comment-id="'+o+'"]')):e=a&&i?j.parent().find(".activity-actions"):j.parent(),I.trim(t.data.contents)),o=(e.find(".bb-rl-acomment-display").removeClass("bb-rl-display-focus"),e.find(".comment-item").removeClass("bb-rl-comment-item-focus"),e.addClass("has-child-comments"),j.find('input[name="comment_form_id"]').val()),n=(h?(I("#bb-rl-activity-modal").find(".bb-rl-modal-activity-footer").append(j).addClass("active"),j.removeClass("has-content").addClass("root")):(j.addClass("not-initialized").removeClass("has-content has-gif has-media"),j.closest(".bb-rl-activity-comments").append(j)),j.find("#ac-input-"+o).html(""),j.hasClass("acomment-edit")?(a=j.attr("data-item-id"),j.closest(".bb-rl-activity-comments").append(j),(h?I("#bb-rl-activity-modal").find("li#bb-rl-acomment-"+a):I("li#bb-rl-acomment-"+a)).replaceWith(s)):(0===e.children("ul").length&&e[e.hasClass("bb-rl-activity-comments")?"prepend":"append"]("<ul></ul>"),(z?j.closest("#bb-rl-activity-modal").find(".bb-rl-modal-activity-body .bb-rl-activity-comments, .bb-rl-modal-activity-body .bb-rl-activity-comments .activity-actions"):e).children("ul").append(I(s).hide().fadeIn(200)),I(j).find(".ac-input").first().html(""),e.parent().addClass("has-comments comments-loaded"),f.addClass("has-comments")),j.removeClass("acomment-edit"),j.find(".bb-rl-ac-reply-content"));if([".bb-rl-ac-reply-media-button",".bb-rl-ac-reply-document-button",".bb-rl-ac-reply-video-button",".bb-rl-ac-reply-gif-button"].forEach(function(t){var e=n.find(".bb-rl-ac-reply-toolbar "+t);0<e.length&&("bb-rl-ac-reply-gif-button"===t&&e.removeClass("active"),e.parents(".bb-rl-post-elements-buttons-item").removeClass("disable no-click"))}),jQuery(window).scroll(),bp.Nouveau.Activity.invokeMediaFn("autoPlayGifVideos"),!j.hasClass("acomment-edit")){i=f.find("span.comments-count"),t=i.text().length?i.text().match(/\d+/)[0]:0,t=Number(t)+1,a=(g.length&&(o=1<t?T.strings.commentsLabel:T.strings.commentLabel,g.text(o.replace("%d",t||1)),i.attr("data-comments-count",t)),x.comment_id);if(a)for(var d=I("#bb-rl-acomment-"+a),l={};d.length;){var r=d.data("bp-activity-comment-id");if(l[r])break;l[r]=!0;var c,r=d.find(".bb-rl-comment-reactions").first(),m=r.find(".acomments-count"),b=0,b=1<(c=(b=m.length&&(b=parseInt(m.attr("data-comments-count")),isNaN(b))?(c=m.text().match(/\d+/))?parseInt(c[0]):0:b)+1)?T.strings.repliesLabel:T.strings.replyLabel;m.length?m.attr("data-comments-count",c).text(b.replace("%d",c)):r.append('<a href="#" class="activity-state-comments has-comments"><span class="acomments-count" data-comments-count="1">'+T.strings.replyLabel.replace("%d",1)+"</span></a>"),d.addClass("has-child-comments"),d=d.parent().closest(".activity-comment")}i.parent(":not( .has-comments )").addClass("has-comments");s=I(C).find(".show-all a");s&&s.html(P.replace("%d",t))}[w.dropzone_media,w.dropzone_document,w.dropzone_video].forEach(function(t){t&&0<t.length&&t.forEach(function(t){t.saved=!0})}),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=y}_.isUndefined(p)||(p.set("gif_data",{}),I("#bb-rl-ac-reply-post-gif-"+y).find(".bb-rl-activity-attached-gif-container").removeAttr("style")),["media","document","video"].forEach(function(t){w.destroyUploader(t,y)}),u.prop("disabled",!1),v.prop("disabled",!1),N.removeClass("active"),bp.Nouveau.Activity.clearFeedbackNotice(j)}).fail(function(t){u.parent().removeClass("loading"),u.prop("disabled",!1),bp.Nouveau.Activity.clearFeedbackNotice(j);t=0===t.readyState?T.strings.commentPostError:t.responseJSON&&t.responseJSON.message?t.responseJSON.message:t.statusText;j.find(".bb-rl-ac-reply-content").after('<div class="bb-rl-notice bb-rl-notice--error">'+t+"</div>")})},pinUnpinActivity:function(t){var e=t.event,a=t.activityId;if(e.preventDefault(),!a)return e;var e=t.parent,l=t.target,r=t.isInsideModal,c=l.closest(".activity-item"),m=(c.addClass("loading-pin"),l.hasClass("unpin-activity")?"unpin":"pin");e.ajax({action:"activity_update_pinned_post",id:a,pin_action:m},"activity").done(function(t){var e,a,i,o,s,n,d;c.removeClass("loading-pin"),void 0!==(t="object"!=typeof t?JSON.parse(t):t).data&&void 0!==t.data.feedback&&(e=l.closest("ul.bb-rl-activity-list"),d=r?l.closest(".bb-rl-wrap").find("#bb-rl-activity-stream"):l.closest("#bb-rl-activity-stream"),t.success&&((""===(n=bp.Nouveau.getStorage("bp-activity","scope"))||!1===n||"undefined"!==BP_Nouveau.is_send_ajax_request&&""===BP_Nouveau.is_send_ajax_request)&&I(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").length&&(n=I(bp.Nouveau.objectNavParent+" #bb-subnav-filter-show [data-bp-scope].selected").data("bp-scope")),a=!1,o="",(i=c.hasClass("groups"))&&(o=(s=c.attr("class").match(/group-\d+/))?s[0].replace("group-",""):""),d.hasClass("single-user")?a=!1:(d.hasClass("activity")&&"all"===n&&!i||d.hasClass("single-group"))&&(a=!0),"pin"==m?(a&&e.find("li.activity-item").removeClass("bb-pinned"),s=i&&!d.hasClass("single-group")?"li.activity-item.group-"+o:"li.activity-item",e.find(s).each(function(){var t=I(this).find(".unpin-activity"),e=(t.removeClass("unpin-activity").addClass("pin-activity"),i?T.strings.pinGroupPost:T.strings.pinPost);t.find("span").html(e)}),a&&c.addClass("bb-pinned"),l.addClass("unpin-activity").removeClass("pin-activity"),n=i?T.strings.unpinGroupPost:T.strings.unpinPost,l.find("span").html(n)):"unpin"==m&&(c.removeClass("bb-pinned"),l.addClass("pin-activity").removeClass("unpin-activity"),d=i?T.strings.pinGroupPost:T.strings.pinPost,l.find("span").html(d)),a)&&(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities()),I(document).trigger("bb_trigger_toast_message",["","<div>"+t.data.feedback+"</div>","success",null,!0]),r)&&(void 0!==bp.Nouveau.Activity.activityHasUpdates&&(bp.Nouveau.Activity.activityHasUpdates=!0),void 0!==bp.Nouveau.Activity.activityPinHasUpdates)&&(bp.Nouveau.Activity.activityPinHasUpdates=!0)}).fail(function(){l.closest(".activity-item").removeClass("loading-pin"),I(document).trigger("bb_trigger_toast_message",["","<div>"+T.strings.pinPostError+"</div>","error",null,!0])})},muteUnmuteNotifications:function(t){var e=t.event,a=t.parent,i=t.target,o=t.activityId,s=t.isInsideModal;if(i.hasClass("bb-icon-bell-slash")||i.hasClass("bb-icon-bell")){if(e.preventDefault(),!o)return e;var n=i.closest(".activity-item"),d=(n.addClass("loading-mute"),i.hasClass("bb-icon-bell")?"unmute":"mute");a.ajax({action:"toggle_activity_notification_status",id:o,notification_toggle_action:d},"activity").done(function(t){var e;n.removeClass("loading-mute"),void 0!==(t="object"!=typeof t?JSON.parse(t):t).data&&void 0!==t.data.feedback&&(t.success&&("mute"==d?(e=T.strings.unmuteNotification,n.addClass("bb-muted"),i.removeClass("bb-icon-bell-slash"),i.addClass("bb-icon-bell"),i.attr("title",e),i.find("span").html(e)):"unmute"==d&&(e=T.strings.muteNotification,n.removeClass("bb-muted"),i.removeClass("bb-icon-bell"),i.addClass("bb-icon-bell-slash"),i.attr("title",e),i.find("span").html(e)),void 0!==bp.Nouveau.Activity.activityHasUpdates)&&(bp.Nouveau.Activity.activityHasUpdates=!0),I(document).trigger("bb_trigger_toast_message",["","<div>"+t.data.feedback+"</div>","success",null,!0])),s&&(bp.Nouveau.Activity.activityPinHasUpdates=!0),bp.Nouveau.Activity.activityHasUpdates=!0,bp.Nouveau.Activity.currentActivityId=o}).fail(function(){i.closest(".activity-item").removeClass("loading-pin"),I(document).trigger("bb_trigger_toast_message",["","<div>"+T.strings.pinPostError+"</div>","error",null,!0])})}},onOffComment:function(t){var e=t.event,a=t.target,i=t.parent,o=t.activityId;if(e.preventDefault(),!o)return e;var s=a.closest(".activity-item"),n=(s.addClass("loading-pin"),a.hasClass("unclose-activity-comment")?"unclose_comments":"close_comments");i.ajax({action:"activity_update_close_comments",id:o,close_comments_action:n},"activity").done(function(t){var e;s.removeClass("loading-pin"),void 0!==(t="object"!=typeof t?JSON.parse(t):t).data&&void 0!==t.data.feedback&&(t.success&&(e=I("#bb-rl-activity-stream > .bb-rl-activity-list").find("[data-bp-activity-id="+o+"]"),s.find(".bb-rl-activity-closed-comments-notice").remove(),"close_comments"==n?(s.addClass("bb-closed-comments"),0<s.closest("#bb-rl-activity-modal").length&&s.closest("#bb-rl-activity-modal").addClass("bb-closed-comments"),a.addClass("unclose-activity-comment").removeClass("close-activity-comment"),a.find("span").html(T.strings.uncloseComments),s.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),s.find(".bb-rl-activity-comments").after('<div class="bb-rl-activity-closed-comments-notice">'+t.data.feedback+"</div>"),0<a.parents(".bb-rl-media-model-wrapper").length&&0<e.length&&(e.addClass("bb-closed-comments"),e.find(".bb-activity-more-options .close-activity-comment span").html(T.strings.uncloseComments),e.find(".bb-activity-more-options .close-activity-comment").addClass("unclose-activity-comment").removeClass("close-activity-comment"),e.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),e.find(".bb-rl-activity-comments").after('<div class="bb-rl-activity-closed-comments-notice">'+t.data.feedback+"</div>"))):"unclose_comments"==n&&(s.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),s.removeClass("bb-closed-comments"),0<s.closest("#bb-rl-activity-modal").length&&s.closest("#bb-rl-activity-modal").removeClass("bb-closed-comments"),a.addClass("close-activity-comment").removeClass("unclose-activity-comment"),a.find("span").html(T.strings.closeComments),0<a.parents(".bb-rl-media-model-wrapper").length)&&0<e.length&&(e.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),e.removeClass("bb-closed-comments"),e.find(".bb-activity-more-options .unclose-activity-comment span").html(T.strings.closeComments),e.find(".bb-activity-more-options .unclose-activity-comment").addClass("close-activity-comment").removeClass("unclose-activity-comment"),e.find(".bb-rl-activity-closed-comments-notice").html("")),void 0!==bp.Nouveau.Activity.activityHasUpdates)&&(bp.Nouveau.Activity.activityHasUpdates=!0),I(document).trigger("bb_trigger_toast_message",["","<div>"+t.data.feedback+"</div>",t.success?"success":"error",null,!0]))}).fail(function(){a.closest(".activity-item").removeClass("loading-pin"),I(document).trigger("bb_trigger_toast_message",["","<div>"+T.strings.closeCommentsError+"</div>","error",null,!0])})},setupDropzoneEventHandlers:function(t){var o=t.self,c=t.dropzoneObj,s=t.target,m=t.type,b=t.dropzoneDataObj;c.on("addedfile",function(t){var e;t[m+"_edit_data"]&&(b.push(t[m+"_edit_data"]),"document"===m&&(e=(e=t.upload.filename).substr(e.lastIndexOf(".")+1),I(t.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+e)),(e=s.parents(".bb-rl-ac-reply-toolbar")).find(".bb-rl-ac-reply-"+m+"-button"))&&e.find(".bb-rl-ac-reply-"+m+"-button").parents(".bb-rl-post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),"video"===m&&(t.dataURL&&t.video_edit_data.thumb.length?(I(t.previewElement).find(".dz-image").prepend('<img src=" '+t.video_edit_data.thumb+' "  alt=""/>'),I(t.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(t,".dz-image"))}),c.on("sending",function(t,e,a){a.append("action","document"===m?m+"_"+m+"_upload":m+"_upload");var i="document"===m?"media":m,o=(a.append("_wpnonce",BP_Nouveau.nonces[i]),s.parents(".bb-rl-ac-reply-toolbar"));s.closest(".ac-form").addClass("has-media"),["media","document","video","gif"].forEach(function(t){var e;o.find(".bb-rl-ac-reply-"+t+"-button")&&(e=o.find(".bb-rl-ac-reply-"+t+"-button").parents(".bb-rl-post-elements-buttons-item"),m===t?e.addClass("no-click").find(".toolbar-button").addClass("active"):e.addClass("disable"))}),this.element.classList.remove("files-uploaded")}),c.on("uploadprogress",function(t){s.closest(".ac-form").addClass("media-uploading");var e=I(t.previewElement).find(".dz-progress-ring circle")[0],a=2*e.r.baseVal.value*Math.PI;e.style.strokeDasharray=a+" "+a,e.style.strokeDashoffset=a-t.upload.progress.toFixed(0)/100*a,I(t.previewElement).find(".dz-progress [data-dz-progress]").text(t.upload.progress.toFixed(0)+"%")}),c.on("success",function(t,e){var a,i;if("document"===m&&(a=(a=t.upload.filename).substr(a.lastIndexOf(".")+1),i=_.isUndefined(e.data.svg_icon)?"":e.data.svg_icon,a=_.isEmpty(i)?"bb-icon-file-"+a:i,I(t.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").length)&&I(t.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").removeClass("bb-icons-rl-file").addClass(a),e.data.id)return t.id=e.id,e.data.uuid=t.upload.uuid,e.data.menu_order=I(t.previewElement).closest(".dropzone").find(t.previewElement).index()-1,i="document"===m?"media":m,e.data.album_id=void 0!==BP_Nouveau[i]&&void 0!==BP_Nouveau[i].album_id&&BP_Nouveau[i].album_id,e.data.group_id=void 0!==BP_Nouveau[i]&&void 0!==BP_Nouveau[i].group_id&&BP_Nouveau[i].group_id,e.data.saved=!1,b.push(e.data),t.previewElement.classList.add("dz-success");var o,s,n,d,l,r=e.data.feedback;for(t.previewElement.classList.add("dz-error"),l=[],s=0,n=(d=t.previewElement.querySelectorAll("[data-dz-errormessage]")).length;s<n;s++)o=d[s],l.push(o.textContent=r);return _.isNull(c.files)||0!==c.files.length||I(c.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),l}),c.on("accept",function(t,e){0===t.size?e(BP_Nouveau["document"===m?"media":m]["video"===m?"empty_"+m+"_type":"empty_document_type"]):e()}),c.on("error",function(t,e){var a;t.accepted?void 0!==e&&void 0!==e.data&&void 0!==e.data.feedback?I(t.previewElement).find(".dz-error-message span").text(e.data.feedback):"error"===t.status&&t.xhr&&0===t.xhr.status&&I(t.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(a=s.closest(".ac-form"),bp.Nouveau.Activity.clearFeedbackNotice(a),a.find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+e+"</div>"),this.removeFile(t),a.removeClass("media-uploading"))}),c.on("removedfile",function(t){if(b.length)for(var e in b)if(t.upload.uuid===b[e].uuid){void 0===b[e].saved||b[e].saved||bp.Nouveau.Media.removeAttachment(b[e].id),b.splice(e,1);break}var a,i;_.isNull(c)||_.isNull(c.files)||0!==c.files.length?s.closest(".ac-form").addClass("has-content"):(a=s.parents(".bb-rl-ac-reply-toolbar"),(i=s.closest(".ac-form")).removeClass("has-media"),["media","document","video","gif"].forEach(function(t){var e;a.find(".bb-rl-ac-reply-"+t+"-button")&&(e=a.find(".bb-rl-ac-reply-"+t+"-button").parents(".bb-rl-post-elements-buttons-item"),m===t?e.removeClass("no-click").find(".toolbar-button").removeClass("active"):e.removeClass("disable"))}),I(c.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),o.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),c.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(s.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))})},loadMoreComments:function(t){var o=I.extend({},{target:null,activityId:null,parentCommentId:0,isModal:!1,lastCommentId:"",lastCommentTimestamp:""},t),s=o.target,t=(s.addClass("loading"),o.isModal||(o.commentsList.addClass("active"),o.commentsActivityItem.addClass("active")),s.html('<div id="bb-rl-ajax-loader"><div class="bb-rl-activity-placeholder bb-activity-tiny-placeholder"><div class="bb-rl-activity-placeholder_head"><div class="bb-rl-activity-placeholder_avatar bb-rl-bg-animation bb-rl-loading-bg"></div><div class="bb-rl-activity-placeholder_details"><div class="bb-rl-activity-placeholder_title bb-rl-bg-animation bb-rl-loading-bg"></div><div class="bb-rl-activity-placeholder_description bb-rl-bg-animation bb-rl-loading-bg"></div></div></div></div></div>'),{action:o.isModal?"bb_rl_activity_loadmore_comments":"activity_loadmore_comments",activity_id:o.activityId,parent_comment_id:o.parentCommentId,offset:o.isModal?0:s.parents(".bb-rl-activity-comments").find('ul[data-parent_comment_id ="'+o.parentCommentId+'"] > li.comment-item:not(.bb-recent-comment)').length,activity_type_is_blog:1<s.parents(".entry-content").length});o.lastCommentTimestamp&&(t.last_comment_timestamp=o.lastCommentTimestamp),o.lastCommentId&&(t.last_comment_id=o.lastCommentId),bp.Nouveau.ajax(t,"activity").done(function(t){var e,a,i;!1===t.success?(s.html("<p class='error'>"+t.data.message+"</p>").removeClass("acomments-view-more--hide"),o.isModal||(o.commentsList.removeClass("active"),o.commentsActivityItem.removeClass("active"))):void 0!==t.data&&void 0!==t.data.comments&&((i=s.closest(".activity-item")).hasClass("has-comments")||i.addClass("has-comments"),i=I(".bb-rl-internal-model .bb-rl-activity-comments"),e=o.isModal?i:i.find("[data-activity_id='"+o.activityId+"'][data-parent_comment_id='"+o.parentCommentId+"']"),i=I(I.parseHTML(t.data.comments)),0<e.length&&0<i.length&&(i.each(function(){var t;"LI"===this.nodeName&&"undefined"!==this.id&&""!==this.id&&(t=this.id,0<(t=e.children("#"+t)).length)&&t.remove()}),o.isModal?e.html(i):o.lastCommentId?0<(a=e.find("li.activity-comment[data-bp-activity-comment-id='"+o.lastCommentId+"']")).length?a.after(i):e.append(i):0<e.children(".activity-comment.comment-item").length?e.children(".activity-comment.comment-item").first().before(i):e.html(i),setTimeout(function(){jQuery(window).scroll(),bp.Nouveau.Activity.invokeMediaFn("autoPlayGifVideos")},200),s.hasClass("acomments-view-more--root")||I(".bb-rl-modal-activity-body").scrollTo("#bb-rl-acomment-"+o.parentCommentId,500,{offset:0,easing:"swing"}),void 0!==bp.Nouveau&&(bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()),e.find(".bb-activity-more-options-wrap").find(".bb-activity-more-options-action").attr("data-balloon-pos","left")),o.isModal||(s.remove(),o.commentsList.removeClass("active"),o.commentsActivityItem.removeClass("active")),void 0!==t.data.comment_form)&&((a=I(".bb-rl-internal-model .bb-rl-modal-activity-footer")).find(".bb-rl-ac-form-placeholder").after(t.data.comment_form),a.find("#ac-form-"+o.activityId).removeClass("not-initialized").addClass("root events-initiated").find("#ac-input-"+o.activityId).focus(),i=a.find("#ac-form-"+o.activityId),bp.Nouveau.Activity.clearFeedbackNotice(i),i.removeClass("events-initiated"),t=a.find(".ac-form .ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(t),bp.Nouveau.Activity.toggleMultiMediaOptions(i,"",".bb-rl-modal-activity-footer"),_.isUndefined(u)||_.isUndefined(u.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#bb-rl-activity-modal ",o.activityId))}).fail(function(t){s.html("<p class='error'>"+t.statusText+"</p>").removeClass("acomments-view-more--hide"),o.isModal||(o.commentsList.removeClass("active"),o.commentsActivityItem.removeClass("active"))})}},bp.Nouveau.Activity.start())})((bp,jQuery));