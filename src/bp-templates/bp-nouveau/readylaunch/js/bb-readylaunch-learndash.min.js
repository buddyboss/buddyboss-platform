(n=>{var s={init:function(){this.switchLdGridList(),this.setupCourseItemEvents(),this.setupCourseFilters(),this.setupSidebarToggle(),this.setupCourseCardPopups(),this.addEvents(),this.autoExpandCurrentLesson()},addEvents:function(){n(document).on("click",".bb-rl-ld-lesson-list .ld-expand-button",this.handleLessonExpand),n(document).on("click",".bb-rl-course-content-header .ld-expand-button",this.handleAllLessonsExpand),n(document).on("click",".bb-rl-video-play-overlay",this.handleVideoPlayOverlay)},handleLessonExpand:function(e){e.preventDefault();var e=n(this).closest(".ld-item-list-item"),t=e.find(".ld-item-list-item-expanded");e.find(".ld-item-list-item-preview:has(.ld-expand-button)").toggleClass("ld-expanded"),t.toggleClass("ld-expanded").slideToggle(300)},handleAllLessonsExpand:function(e){e.preventDefault(),n(this).toggleClass("ld-expanded"),n(this).hasClass("ld-expanded")?n(this).find(".ld-text").text(n(this).data("ld-collapse-text")):n(this).find(".ld-text").text(n(this).data("ld-expand-text"));var e=n(this).closest(".bb-rl-course-content-header").next(".ld-lesson-list").find(".ld-item-list-item"),t=e.find(".ld-item-list-item-expanded");e.find(".ld-item-list-item-preview:has(.ld-expand-button)").toggleClass("ld-expanded"),t.toggleClass("ld-expanded").slideToggle(300)},handleVideoPlayOverlay:function(e){e.preventDefault();var t,e=n(this),o=e.closest(".bb-rl-course-figure"),e=e.closest(".bb-rl-video-preview-container").find(".bb-rl-video-embed-container");o.length&&o.addClass("video-active"),e.length&&(o=e.find("iframe")).length&&((e=o.attr("src"))&&-1!==e.indexOf("youtube.com")?(t=-1!==e.indexOf("?")?"&":"?",o.attr("src",e+t+"autoplay=1&mute=1")):e&&-1!==e.indexOf("vimeo.com")&&(t=-1!==e.indexOf("?")?"&":"?",o.attr("src",e+t+"autoplay=1&muted=1")))},switchLdGridList:function(){var o=n(".bb-rl-courses-grid");n(document).on("click",".bb-rl-grid-filters .layout-view-course:not(.active)",function(e){var t;e.preventDefault(),void 0!==n(this).parent().attr("data-view")&&"ld-course"===n(this).parent().attr("data-view")&&(s.ajax_request&&s.ajax_request.abort(),e=n(this).closest(".bb-rl-container"),t=n(this).closest(".bb-rl-grid-filters"),o=e.find(".bb-rl-courses-grid"),n(this).hasClass("layout-list-view")?(t.find(".layout-view-course").removeClass("active"),o.removeClass("grid"),n(this).addClass("active"),o.addClass("list"),s.ajax_request=n.ajax({method:"POST",url:bbReadylaunchLearnDash.ajaxurl,nonce:bbReadylaunchLearnDash.nonce_list_grid,data:"action=bb_rl_lms_save_view&option=bb_layout_view&object="+n(this).parent().attr("data-view")+"&type=list&nonce="+bbReadylaunchLearnDash.nonce_list_grid,success:function(){}})):(t.find(".layout-view-course").removeClass("active"),o.removeClass("list"),n(this).addClass("active"),o.addClass("grid"),s.ajax_request=n.ajax({method:"POST",url:bbReadylaunchLearnDash.ajaxurl,nonce:bbReadylaunchLearnDash.nonce_list_grid,data:"action=bb_rl_lms_save_view&option=bb_layout_view&object="+n(this).parent().attr("data-view")+"&type=grid&nonce="+bbReadylaunchLearnDash.nonce_list_grid,success:function(){}})))})},setupCourseItemEvents:function(){n(".bb-course-item").on({mouseenter:function(){n(this).addClass("hover")},mouseleave:function(){n(this).removeClass("hover")}})},setupCourseFilters:function(){var t=this;n("#ld-course-cats").on("change",function(){t.filterCourses()}),n("#ld-course-instructors").on("change",function(){t.filterCourses()}),n("#ld-course-orderby").on("change",function(){t.filterCourses()}),n("#bb-courses-search-form").on("submit",function(e){e.preventDefault(),t.filterCourses()})},filterCourses:function(){var s=n(".bb-rl-courses-list"),e=n("#ld-course-cats").val(),t=n("#ld-course-instructors").val(),o=n("#ld-course-orderby").val(),a=(s.addClass("loading"),[]),r=(o&&a.push("orderby="+encodeURIComponent(o)),e&&a.push("categories="+encodeURIComponent(e)),t&&a.push("instructors="+encodeURIComponent(t)),bbReadylaunchLearnDash.courses_url+(a.length?"?"+a.join("&"):"")),i=n(".bb-rl-grid-filters .layout-view.active").data("view");n.get(r,function(e){var e=n("<div>").html(e),t=e.find(".bb-rl-courses-list").html(),o=e.find(".bb-rl-heading-count").text(),e=e.find(".bb-rl-course-pagination").html();(s.length?s:n(".bb-rl-courses-list")).html(t),n(".bb-rl-heading-count").text(o),n(".bb-rl-course-pagination").html(e),s.find(".bb-rl-courses-grid").addClass(i),s.removeClass("loading"),window.history.replaceState({},"",r)})},setupSidebarToggle:function(){n(".bb-course-sidebar-toggle").on("click",function(e){e.preventDefault(),n(".bb-learndash-sidebar").toggleClass("active"),n("body").toggleClass("bb-sidebar-open")}),n(document).on("click",function(e){n(e.target).closest(".bb-learndash-sidebar, .bb-course-sidebar-toggle").length||(n(".bb-learndash-sidebar").removeClass("active"),n("body").removeClass("bb-sidebar-open"))})},setupCourseCardPopups:function(){var s=this;n(".bb-rl-course-card .bb-rl-course-title a").on({mouseenter:function(){var e=n(this).closest(".bb-rl-course-card"),t=e.find(".bb-rl-course-card-popup"),o=e.data("hoverTimeout");o&&(clearTimeout(o),e.removeData("hoverTimeout")),n(".bb-rl-course-card.bb-rl-card-popup-active").not(e).each(function(){var e=n(this),t=e.data("hoverTimeout");t&&(clearTimeout(t),e.removeData("hoverTimeout")),e.removeClass("bb-rl-card-popup-active")}),e.addClass("bb-rl-card-popup-active"),t.length&&s.positionCoursePopup(e,t)},mouseleave:function(){var e=n(this).closest(".bb-rl-course-card"),t=e.data("hoverTimeout"),t=(t&&clearTimeout(t),setTimeout(function(){e.removeClass("bb-rl-card-popup-active"),e.removeData("hoverTimeout")},300));e.data("hoverTimeout",t)}}),n(document).on({mouseenter:function(){var e=n(this).closest(".bb-rl-course-card"),t=e.data("hoverTimeout");t&&(clearTimeout(t),e.removeData("hoverTimeout"))},mouseleave:function(){var e=n(this).closest(".bb-rl-course-card"),t=e.data("hoverTimeout"),t=(t&&clearTimeout(t),setTimeout(function(){e.removeClass("bb-rl-card-popup-active"),e.removeData("hoverTimeout")},300));e.data("hoverTimeout",t)}},".bb-rl-course-card-popup"),n(window).on("resize",function(){n(".bb-rl-course-card .bb-rl-course-title a:hover").each(function(){var e=n(this).closest(".bb-rl-course-card"),t=e.find(".bb-rl-course-card-popup");t.length&&s.positionCoursePopup(e,t)})})},positionCoursePopup:function(e,t){var o;n(window).width()<=768?t.removeClass("bb-rl-popup-left bb-rl-popup-right bb-rl-popup-top bb-rl-popup-bottom"):(o=e.closest(".bb-rl-courses-grid").hasClass("list"),t.removeClass("bb-rl-popup-left bb-rl-popup-right bb-rl-popup-top bb-rl-popup-bottom"),o?this.positionPopupVertical(e,t):this.positionPopupHorizontal(e,t))},positionPopupHorizontal:function(e,t){var e=e[0].getBoundingClientRect(),o=n(window).width()-e.right,e=e.left;316<=o||!(316<=e)&&e<=o?t.addClass("bb-rl-popup-right"):t.addClass("bb-rl-popup-left")},positionPopupVertical:function(e,t){var e=e[0].getBoundingClientRect(),o=n(window).height(),s=e.top,o=o-e.bottom;270<=s||!(270<=o)&&o<=s?t.addClass("bb-rl-popup-top"):t.addClass("bb-rl-popup-bottom"),t.css("transform","")},autoExpandCurrentLesson:function(){n(".ld-item-list-item.bb-rl-current-lesson .ld-expand-button").each(function(){n(this).trigger("click")})}};n(document).ready(function(){s.ajax_request=null,s.init()})})(jQuery);