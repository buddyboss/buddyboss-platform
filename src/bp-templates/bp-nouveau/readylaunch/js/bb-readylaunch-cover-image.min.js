window.bp=window.bp||{},function(i){"undefined"!=typeof BP_Uploader&&(bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.CoverImage={start:function(){this.views=new Backbone.Collection,this.warning=null,this.Attachment=new Backbone.Model,this.uploaderView(),i(document).on("click",".bb-rl-remove-cover-button",function(e){e.preventDefault();e=new Backbone.Model(_.pick(BP_Uploader.settings.defaults.multipart_params.bp_params,["object","item_id","nonces"]));bp.CoverImage.deleteCoverImage(e)})},uploaderView:function(){bp.Uploader.filesQueue.on("add",this.uploadProgress,this);var e=new bp.Views.Uploader;this.views.add({id:"upload",view:e}),e.inject(".bp-cover-image")},uploadProgress:function(){var e=new bp.Views.coverImageUploadProgress({collection:bp.Uploader.filesQueue});_.isUndefined(this.views.get("status"))?this.views.add({id:"status",view:e}):this.views.set({id:"status",view:e}),e.inject(".bp-cover-image-status-progress")},deleteCoverImage:function(r){var t=this;bp.ajax.post("bp_cover_image_delete",{json:!0,item_id:r.get("item_id"),object:r.get("object"),nonce:r.get("nonces").remove}).done(function(e){var a=new bp.Views.CoverImageStatus({value:BP_Uploader.strings.feedback_messages[e.feedback_code],type:"success"});t.views.add({id:"status",view:a}),a.inject(".bp-cover-image-status"),""===e.reset_url?(i("#header-cover-image").css({"background-image":"none"}),i(".group-create #header-cover-image").css({display:"none"})):i("#header-cover-image").css({"background-image":"url( "+e.reset_url+" )"}),i("#header-cover-image").removeClass("has-default").addClass(BP_Uploader.settings.defaults.multipart_params.bp_params.has_default_class),i("#header-cover-image .header-cover-img").remove(),i("#header-cover-image  .position-change-cover-image").remove(),BP_Uploader.settings.defaults.multipart_params.bp_params.has_cover_image=!1,t.Attachment.set(_.extend(_.pick(r.attributes,["object","item_id"]),{url:e.reset_url,action:"deleted"})),i(".bb-rl-cover-preview img").attr("src",""),i(".bb-rl-cover-container").removeClass("bb-rl-cover-container--has-cover").addClass("bb-rl-cover-container--no-cover"),i(".bp-cover-image-status-progress").empty()}).fail(function(e){var a=BP_Uploader.strings.default_error;_.isUndefined(e)||(a=BP_Uploader.strings.feedback_messages[e.feedback_code]);a=new bp.Views.CoverImageStatus({value:a,type:"error"});t.views.add({id:"status",view:a}),a.inject(".bp-cover-image-status")})}},bp.Views.coverImageUploadProgress=bp.Views.uploaderStatus.extend({className:"files",initialize:function(){bp.Views.uploaderStatus.prototype.initialize.apply(this,arguments),this.collection.on("change:url",this.uploadResult,this)},uploadResult:function(e){var a;_.isUndefined(e.get("url"))||(a=BP_Uploader.strings.feedback_messages[1],new bp.Views.CoverImageStatus({value:a,type:"success"}).inject(".bp-cover-image-status"),i("#header-cover-image .header-cover-img").length?i("#header-cover-image .header-cover-img").prop("src",e.get("url")):i("#header-cover-image").prepend('<img src="'+e.get("url")+'" class="header-cover-img" />'),i("#header-cover-image .header-cover-reposition-wrap .guillotine-window img").length&&(a=i("#header-cover-image .header-cover-reposition-wrap .guillotine-window img"),i("#header-cover-image .header-cover-reposition-wrap .guillotine-window").remove(),i("#header-cover-image .header-cover-reposition-wrap").append(a)),i("#header-cover-image .header-cover-reposition-wrap img").prop("src",e.get("url")),i("#header-cover-image").removeClass("has-position").find(".header-cover-img").removeAttr("data-top").removeAttr("style"),i(".group-create #header-cover-image").css({"background-image":"url( "+e.get("url")+" )",display:"block"}),bp.CoverImage.Attachment.set(_.extend(_.pick(BP_Uploader.settings.defaults.multipart_params.bp_params,["object","item_id"]),{url:e.get("url"),action:"uploaded"})),i(".bb-rl-cover-preview img").attr("src",e.get("url")),i(".bb-rl-cover-container").removeClass("bb-rl-cover-container--no-cover").addClass("bb-rl-cover-container--has-cover"),i(".bp-cover-image-status-progress").empty())}}),bp.Views.CoverImageStatus=bp.View.extend({tagName:"p",className:"updated",id:"bp-cover-image-feedback",initialize:function(){this.el.className+=" "+this.options.type,this.value=this.options.value},render:function(){return this.$el.html(this.value),this}}),bp.Views.DeleteCoverImage=bp.View.extend({tagName:"div",id:"bp-delete-cover-image-container",template:bp.template("bp-cover-image-delete"),events:{"click #bp-delete-cover-image":"deleteCoverImage"},deleteCoverImage:function(e){e.preventDefault(),bp.CoverImage.deleteCoverImage(this.model)}}),bp.CoverImage.start())}((bp,jQuery));