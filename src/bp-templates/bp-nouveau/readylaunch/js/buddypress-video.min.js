window.bp=window.bp||{},function(p){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=p("body");this.thumbnail_xhr=null,this.thumbnail_interval=null,this.thumbnail_max_interval=6,this.current_page=1,this.video_dropzone_obj=null,this.video_thumb_dropzone_obj=[],this.dropzone_video=[],this.dropzone_video_thumb=[],this.video_album_id=void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,!this.video_album_id&&0<parseInt(BP_Nouveau.media.current_album)&&(this.video_album_id=parseInt(BP_Nouveau.media.current_album)),this.video_group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1);e=document.getElementsByClassName("uploader-post-video-template").length?document.getElementsByClassName("uploader-post-video-template")[0].innerHTML:"";this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,previewTemplate:e,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},this.videoThumbnailOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,dictDefaultMessage:BP_Nouveau.video.dropzone_video_thumbnail_message,acceptedFiles:"image/jpeg,image/png",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:1,thumbnailMethod:"contain",thumbnailWidth:null,thumbnailHeight:"300",maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.video.thumb_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},void 0!==BP_Nouveau.video.dropzone_options&&Object.assign(this.options,BP_Nouveau.video.dropzone_options)},addListeners:function(){var e=p(".bp-nouveau");p(document).on("click","#bp-add-video",this.openUploader.bind(this)),p(document).on("click",".bb-rl-video-thumbnail-submit",this.submitVideoThumbnail.bind(this)),p(document).on("click",".ac-video-thumbnail-edit",this.openEditThumbnailUploader.bind(this)),p(document).on("click",".bb-rl-video-thumbnail-uploader-close",this.closeEditThumbnailUploader.bind(this)),p(document).on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),p(document).on("click","#bp-video-submit",this.submitVideo.bind(this)),p(document).on("click",".bp-video-uploader .modal-container .bb-field-uploader-actions",this.uploadVideoNavigate.bind(this)),p(document).on("click",".bb-activity-video-elem .video-action-wrap .video-action_more, #video-stream.video .bb-item-thumb .video-action-wrap .video-action_more, #media-stream.media .bb-video-thumb .video-action-wrap .video-action_more, .bb-activity-video-elem .video-action-wrap .video-action_list li a, .bb-media-model-container .activity-list .video-action-wrap.item-action-wrap > a, .bb-media-model-container .activity-list .video-action-wrap.item-action-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),p(document).on("click",".activity .bb-rl-video-move-activity, #media-stream .bb-rl-video-move-activity, #video-stream .bb-rl-video-move-activity",this.moveVideoIntoAlbum.bind(this)),p(document).on("click",".bb-rl-video-open-create-popup-album",this.createAlbumInPopup.bind(this)),p(document).on("click",".bb-rl-ac-video-close-button",this.closeVideoMove.bind(this)),p(document).on("click",".ac-video-move",this.openVideoMove.bind(this)),p(document).on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),p(document).on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this)),p(document).on("click",".video-action_list .video-file-delete, #bb-delete-video",this.deleteVideo.bind(this)),p(document).on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom .bb-rl-close-thumbnail-custom",this.deleteVideoThumb.bind(this)),p('#buddypress [data-bp-list="video"]').on("bp_ajax_request",this.bp_ajax_video_request),e.on("click","#bb-create-video-album",this.openCreateVideoAlbumModal.bind(this)),e.on("click","#bp-video-create-album-close",this.closeCreateVideoAlbumModal.bind(this)),p(document).on("click","#bp-video-create-album-submit",this.saveAlbum.bind(this)),p('.bp-nouveau [data-bp-list="video"]').on("click","li.load-more",this.injectVideos.bind(this)),p(document).on("click",".bb-rl-video-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this))},submitVideoThumbnail:function(t){var o=this,a=p(t.currentTarget);if(t.preventDefault(),a.hasClass("saving")||a.hasClass("is-disabled"))return!1;a.addClass("saving");var d=p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-edit-thumbnail-hidden-video-id").val(),e=p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-edit-thumbnail-hidden-attachment-id").val(),i=p('.bb-rl-video-thumbnail-uploader.opened-edit-thumbnail input[type="radio"]:checked').val(),i={action:"video_thumbnail_save",_wpnonce:BP_Nouveau.nonces.video,video_thumbnail:o.dropzone_video_thumb,video_id:d,video_attachment_id:e,video_default_id:i};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){if(e.success){p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+d+'"]').find("img").length&&p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",e.data.thumbnail),p('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+d+'"]').find("img").length&&p('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find(".vjs-poster").length&&(p('.bb-activity-video-elem .video-js[data-id="'+d+'"]').attr("poster",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find("video").attr("poster",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),p('.bb-activity-video-elem .video-js[data-id="'+d+'"]').find(".vjs-poster img").attr("src",e.data.thumbnail)),p("#theatre-video-"+d).length&&(p("#theatre-video-"+d).attr("poster",e.data.thumbnail),p("#theatre-video-"+d).find("video").attr("poster",e.data.thumbnail),p("#theatre-video-"+d).find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+d+'"]').find("img").attr("src",e.data.thumbnail));for(var i=0;i<o.dropzone_video_thumb.length;i++)o.dropzone_video_thumb[i].saved=!0;e.data.video_attachments&&p('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+e.data.video_attachment_id+'"]').attr("data-video-attachments",e.data.video_attachments),-1===e.data.thumbnail.toLowerCase().indexOf("video-placeholder.jpg")&&(p('.bb-activity-video-elem[data-id="'+d+'"]').removeClass("has-no-thumbnail"),p('a.bb-rl-video-cover-wrap[data-id="'+d+'"]').parent().removeClass("has-no-thumbnail")),o.closeEditThumbnailUploader(t)}a.removeClass("saving")}})},uploadVideoNavigate:function(e){e.preventDefault();var e=p(e.currentTarget),i=p(e).closest("#bp-video-uploader");p(e).hasClass("bb-field-uploader-next")?(i.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),i.find("#bp-video-submit, #bp-video-prev, .bb-rl-video-open-create-popup-album.create-album, #bb-video-privacy").show(),0!==Number(p(i).find(".bb-rl-album-selected-id"))&&p(i).find(".location-album-list li.is_active").length&&p(i).find(".location-album-list").scrollTop(p(i).find(".location-album-list li.is_active").offset().top-p(i).find(".location-album-list").offset().top),p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||p('<span class="more_options">...</span>').insertAfter(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))})):(p(e).hide(),i.find("#bp-video-prev, .bb-rl-video-open-create-popup-album").hide(),i.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),i.closest("#bp-media-single-folder").length&&p("#bb-video-privacy").hide())},videoActivityActionButton:function(e){e.preventDefault(),p(e.currentTarget).closest(".bb-activity-video-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-video-elem").removeClass("is-visible"),p(e.currentTarget).closest(".bb-activity-video-elem").find(".bb_more_dropdown").toggleClass("open").closest(".activity-item").siblings().find(".bb-activity-video-elem .bb_more_dropdown").removeClass("open"),p("body").addClass("video_more_option_open"),p(e.currentTarget).closest(".bb-activity-video-elem").length<1&&(p(e.currentTarget).closest(".bb-video-thumb").toggleClass("is-visible").parent().siblings().find(".bb-video-thumb").removeClass("is-visible"),p(e.currentTarget).closest(".bb-video-thumb").find(".bb_more_dropdown").toggleClass("open").closest(".bb-video-thumb").parent().siblings().find(".bb_more_dropdown").removeClass("open")),p(e.currentTarget).closest(".bb-media-model-container").length&&p(e.currentTarget).closest(".video-action-wrap").toggleClass("is-visible").find(".bb_more_dropdown").toggleClass("open"),"a"!=e.currentTarget.tagName.toLowerCase()||p(e.currentTarget).hasClass("video-action_more")||(p(e.currentTarget).closest(".bb-activity-video-elem").removeClass("is-visible").find(".bb_more_dropdown").removeClass("open"),p(e.currentTarget).closest(".bb-item-thumb").removeClass("is-visible"),p("body").removeClass("video_more_option_open"))},toggleSelectAllVideo:function(e){e.preventDefault(),p(e.currentTarget).hasClass("selected")?(p(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllVideo(e)):(p(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllVideo(e)),p(e.currentTarget).toggleClass("selected")},selectAllVideo:function(e){e.preventDefault(),p("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){p(this).prop("checked",!0),p(this).closest(".bb-item-thumb").addClass("selected"),p(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllVideo:function(e){e.preventDefault(),p("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){p(this).prop("checked",!1),p(this).closest(".bb-item-thumb").removeClass("selected"),p(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var e=e.currentTarget;p(e).is(":checked")?(p(e).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),p(e).closest(".bb-item-thumb").addClass("selected")):(p(e).closest(".bb-item-thumb").removeClass("selected"),p(e).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),(e=p(".bp-nouveau #bb-select-deselect-all-video")).hasClass("selected")&&e.removeClass("selected"))},submitVideo:function(a){var e,d=this,n=p(a.currentTarget),i=p("#bb-video-privacy");if(a.preventDefault(),n.hasClass("saving"))return!1;if(n.addClass("saving"),"bp-video-dropzone-content"===d.current_tab){var t=p("#bp-video-post-content").val(),o=p(a.currentTarget).closest(".open-popup").find(".bb-rl-album-selected-id").val();if(o.length&&0<parseInt(o))for(var l=0;l<d.dropzone_video.length;l++)d.dropzone_video[l].album_id=o;else o=d.album_id;t={action:"video_save",_wpnonce:BP_Nouveau.nonces.video,videos:d.dropzone_video,content:t,album_id:o,group_id:d.video_group_id,privacy:i.val()},p("#bp-video-dropzone-content .bp-feedback").remove(),p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){if(e.success){var i,t;p("#bp-media-single-album").length?(p("#media-stream ul.media-list").length||(p("#media-stream").html(p("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),p(".bb-videos-actions").show(),p(".bb-photos-actions").length&&p(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",e.data.video,"prepend")):(p("#video-stream ul.video-list").length||(p("#video-stream .bp-feedback").remove(),p("#video-stream").append('<ul class="video-list item-list bp-list bb-video-list grid"></ul>'),p(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend")),e.data.video_personal_count&&(p("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").length?p("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count):((t=document.createElement("span")).setAttribute("class","count"),i=document.createTextNode(e.data.video_personal_count),t.appendChild(i),p("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a").append(t))),e.data.video_group_count&&(p("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").length?p("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count):((i=document.createElement("span")).setAttribute("class","count"),t=document.createTextNode(e.data.video_group_count),i.appendChild(t),p("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a").append(i))),"yes"===BP_Nouveau.video.is_video_directory&&(p("#buddypress").find(".video-type-navs ul.video-nav li#video-all a span.count").text(e.data.video_all_count),p("#buddypress").find(".video-type-navs ul.video-nav li#video-personal a span.count").text(e.data.video_personal_count),p("#buddypress").find(".video-type-navs ul.video-nav li#video-groups a span.count").text(e.data.video_group_count));for(var o=0;o<d.dropzone_video.length;o++)d.dropzone_video[o].saved=!0;d.closeUploader(a),jQuery(window).scroll()}else p("#bp-video-dropzone-content").prepend(e.data.feedback);n.removeClass("saving")}})}else"bp-existing-video-content"===d.current_tab?(e=[],p('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){e.push(p(this).val())}),t={action:"video_move_to_album",_wpnonce:BP_Nouveau.nonces.video,medias:e,album_id:d.video_album_id,group_id:d.video_group_id},p("#bp-existing-video-content .bp-feedback").remove(),p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){e.success?(p("#video-stream ul.media-list").length||p("#video-stream").html(p("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),0<p(".bb-video-actions").length&&p(".bb-video-actions").show(),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"),p('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){p(this).closest("li").data("id")===p(this).val()&&p(this).closest("li").remove()}),jQuery(window).scroll(),d.closeUploader(a)):p("#bp-existing-video-content").prepend(e.data.feedback),n.removeClass("saving")}})):d.current_tab||(d.closeUploader(a),n.removeClass("saving"))},clearFolderLocationUI:function(e){e=jQuery(e.currentTarget).closest(".bb-rl-has-folderlocationUI");0<e.length&&(e.find(".bb-rl-location-album-list-wrap-main .bb-rl-location-album-list-wrap .location-album-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),e.find(".bb-rl-location-album-list-wrap-main .bb-rl-location-album-list-wrap .location-album-list li").show().children("span, i").show(),e.find(".location-folder-title").text(BP_Nouveau.video.target_text),e.find(".location-folder-back").hide().closest(".bb-rl-has-folderlocationUI").find(".bb-rl-folder-selected-id").val("0"),e.find(".ac_document_search_folder").val(""),e.find(".bb-model-header h4 span").text("..."),e.find(".bb_rl_ac_document_search_folder_list ul").html("").parent().hide().siblings(".bb-rl-location-album-list-wrap").find(".location-album-list").show())},openUploader:function(e){var i,o,t=this;e.preventDefault(),this.moveToIdPopup=BP_Nouveau.video.move_to_id_popup,this.moveToTypePopup=BP_Nouveau.video.current_type,void 0!==window.Dropzone&&p("div.video-uploader-wrapper #video-uploader").length&&(p("#bp-video-uploader").show(),p("#bp-video-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(i="#bp-video-uploader.bp-video-uploader",0!==Number(p(i).find(".bb-rl-album-selected-id").data("value"))?(o=p(i).find(".bb-rl-album-selected-id").data("value"),p(i).find("#bb-video-privacy").prop("disabled",!0)):o=0,""!==this.moveToIdPopup&&p.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){p(document).find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(p(document).find(".open-popup .bb-rl-location-album-list-wrap").hide(),p(document).find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").show()):(p(document).find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),p(document).find(".open-popup .bb-rl-location-album-list-wrap").show()),!1===e.data.create_album?p(document).find(".open-popup .bb-rl-video-open-create-popup-album").removeClass("create-album"):p(document).find(".open-popup .bb-rl-video-open-create-popup-album").addClass("create-album"),p(document).find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),p(document).find(".open-popup .bb-rl-album-create-from").val("profile"),p(i).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),p(i).find(".bb-rl-location-album-list-wrap").append(e.data.html),p(i).find('ul.location-album-list span[data-id="'+o+'"]').trigger("click"),p(i).find(".bb-rl-album-selected-id").val(o)}})),p(document).on("click",i+" .location-album-list li span",function(e){var i;e.preventDefault(),p(this).parent().hasClass("is_active")||(0!=p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+p(this).attr("id")+'">'+p(this).text()+"</span>"),p(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),o==p(e.currentTarget).data("id")?p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").hasClass("is-disabled")||(p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val(p(e.currentTarget).data("id")),i=p(e.currentTarget).closest("#bp-video-uploader").find("#bb-video-privacy"),0!==Number(p(e.currentTarget).data("id"))?(i.find("option").removeAttr("selected"),i.val(p(e.currentTarget).parent().data("privacy")),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1))))}),p(document).on("click",i+" .breadcrumb .item > span",function(e){var i,t;p(this).hasClass("is-disabled")||(p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val(0),p(e.currentTarget).closest(".bb-rl-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),o==p(e.currentTarget).data("id")?p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),i=p(e.currentTarget).closest("#bp-video-uploader").find("#bb-video-privacy"),t=p(e.currentTarget).closest("#bp-video-uploader").find(".location-album-list li.is_active").data("privacy"),0!==Number(p(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val())?(i.find("option").removeAttr("selected"),i.val(void 0===t?"public":t),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1)))}),t.video_dropzone_obj=new Dropzone("div.video-uploader-wrapper #video-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(e){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3),e.dataURL||bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?p(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&p(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".media-error-popup").length||p("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("queuecomplete",function(){p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("uploadprogress",function(e){var i=p(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t;var o=t-e.upload.progress.toFixed(0)/100*t;e.upload.progress<=99?(p(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),i.style.strokeDashoffset=o):100===e.upload.progress&&(i.style.strokeDashoffset=t-.99*t,p(e.previewElement).find(".dz-progress-count").text("99% "+BP_Nouveau.video.i18n_strings.video_uploaded_text))}),t.video_dropzone_obj.on("success",function(e,i){100===e.upload.progress&&(p(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,p(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),p(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.js_preview=p(e.previewElement).find(".dz-video-thumbnail img").attr("src"),i.data.saved=!1,t.dropzone_video.push(i.data)):(jQuery(".media-error-popup").length||p("body").append('<div id="bp-video-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),p(".bb-field-steps-1 #bp-video-next, #bp-video-submit").show(),p(".modal-container").addClass("modal-container--alert"),p(".bb-field-steps-1").addClass("controls-added"),p("#bp-video-submit").show(),p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeVideoAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(p("#bp-video-uploader-modal-status-text").text(""),p("#bp-video-next").hide(),p(".bb-field-steps-1").removeClass("controls-added"),p("#bp-video-submit").hide(),p(".modal-container").removeClass("modal-container--alert"))}))},openEditThumbnailUploader:function(e){var t=this;e.preventDefault();var o,i=p(e.currentTarget),a=i.attr("data-parent-activity-id"),d=i.attr("data-video-attachment-id"),n=i.attr("data-video-attachments"),l=i.attr("data-video-id"),i="";0<p(e.currentTarget).closest(".activity-inner").length?i=p(e.currentTarget).closest(".activity-inner"):0<p("#bp-media-single-album").length?i=p("#bp-media-single-album").find("#media-stream").parent():0<p(e.currentTarget).closest("#bb-media-model-container").length&&0<p(e.currentTarget).closest(".bb-video-container.bb-media-container.group-video").length?i=p(e.currentTarget).closest(".bb-video-container.bb-media-container.group-video"):0<p(e.currentTarget).closest("#bb-media-model-container").length&&0<p(e.currentTarget).closest(".bb-media-model-wrapper.video-theatre").siblings("#video-stream").length?i=p(e.currentTarget).closest(".bb-media-model-wrapper.video-theatre").parent():0<p(e.currentTarget).closest("#video-stream.video").length?i=p(e.currentTarget).closest("#video-stream.video").parent():0<p(e.currentTarget).closest("#bb-media-model-container").length?i=p("ul.activity-list li#activity-"+a).find(".activity-inner"):0<p(e.currentTarget).closest("#media-stream.media").length?i=p(e.currentTarget).closest("#media-stream.media").parent():0<p(e.currentTarget).closest(".forums-video-wrap").length?i=p(e.currentTarget).closest(".forums-video-wrap"):0<p(e.currentTarget).closest(".comment-item").length&&(i=p(e.currentTarget).closest(".comment-item")),p(i).find(".bb-rl-video-thumbnail-uploader").addClass("opened-edit-thumbnail").show(),p(i).find(".bb-rl-video-thumbnail-uploader").removeClass("no_generated_thumb"),p(document).on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated .bb-action-check-wrap",function(){p(this).closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled")}),p(document).on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail:not(.generating_thumb) .bb-rl-video-thumb-list li",function(e){e.preventDefault(),p(this).find("input.bb-rl-custom-check").prop("checked")||(p(this).find("input.bb-rl-custom-check").prop("checked",!0),p(this).closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled"))}),p(document).on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content",function(e){p(e.target).hasClass("bb-rl-custom-check")||p(e.target).hasClass("bb-icon-l")||p(e.target).hasClass("dz-remove")||p(e.target).hasClass("dz-clickable")||p(e.target).hasClass("bb-rl-close-thumbnail-custom")||p(this).find(".bb-rl-video-thumbnail-custom").hasClass("is_hidden")||!p(this).find("input.bb-rl-custom-check").prop("checked")&&p(e.target).closest(".bb-rl-video-thumbnail-dropzone-content").hasClass("has_image")&&(p(this).find("input.bb-rl-custom-check").prop("checked",!0),p(this).closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled"))}),p(document).on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom .bb-rl-close-thumbnail-custom",function(){p(this).siblings("img").attr("src","").parent().hide(),p(this).closest(".bb-rl-video-thumbnail-content").find(".bb-rl-video-thumbnail-uploader-wrapper").show(),p(this).closest(".bb-rl-video-thumbnail-custom").siblings(".bb-action-check-wrap").find("input").prop("checked")&&(p(this).closest(".bb-rl-video-thumbnail-custom").siblings(".bb-action-check-wrap").find("input").prop("checked",!1),p(this).closest(".bb-rl-video-thumbnail-dropzone-content").find(".bb-rl-video-thumbnail-submit").addClass("is-disabled")),p(this).closest(".bb-rl-video-thumbnail-custom").addClass("is_hidden"),p(this).closest(".bb-rl-video-thumbnail-dropzone-content").removeClass("has_image")}),void 0!==window.Dropzone&&p("div.bb-rl-video-thumbnail-uploader.opened-edit-thumbnail div.bb-rl-video-thumbnail-uploader-wrapper .bb-rl-video-thumbnail-uploader-dropzone-select").length&&(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-edit-thumbnail-hidden-video-id").val(l),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-edit-thumbnail-hidden-attachment-id").val(d),e=document.getElementsByClassName("bb-rl-uploader-post-video-thumbnail-template").length?document.getElementsByClassName("bb-rl-uploader-post-video-thumbnail-template")[0].innerHTML:"",t.videoThumbnailOptions.previewTemplate=e,t.videoThumbnailOptions.thumbnailMethod="contain",t.videoThumbnailOptions.thumbnailWidth=null,t.videoThumbnailOptions.thumbnailHeight="300",t.video_thumb_dropzone_obj=new Dropzone("div.bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-dropzone-select",t.videoThumbnailOptions),t.video_thumb_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_thumbnail_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_thumb_dropzone_obj.on("addedfile",function(e){e.video_thumbnail_edit_data?(t.dropzone_video_thumb.push(e.video_thumbnail_edit_data),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-wrapper .dropzone.dz-clickable").addClass("dz-max-files-reached"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").show()):setTimeout(function(){t.video_thumb_dropzone_obj.getAcceptedFiles().length&&p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_thumb_dropzone_obj.on("uploadprogress",function(e){var i=p(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t;t=(i.style.strokeDashoffset=t)-e.upload.progress.toFixed(0)/100*t;i.style.strokeDashoffset=t}),t.video_thumb_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?p(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&p(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".media-error-popup").length||p("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup video-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").hide())}),t.video_thumb_dropzone_obj.on("queuecomplete",function(){p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb)}),t.video_thumb_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,i.data.js_preview=p(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video_thumb.push(i.data)):(jQuery(".media-error-popup").length||p("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-submit").removeClass("is-disabled"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content").addClass("has_image"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-rl-custom-check").prop("checked",!0),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-rl-video-thumbnail-custom.is_hidden").removeClass("is_hidden")}),t.video_thumb_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video_thumb.length)for(var i in t.dropzone_video_thumb)if(e.upload.uuid==t.dropzone_video_thumb[i].uuid){void 0===t.dropzone_video_thumb[i].saved||t.dropzone_video_thumb[i].saved||t.removeVideoThumbnailAttachment(t.dropzone_video_thumb[i].id),t.dropzone_video_thumb.splice(i,1);break}t.video_thumb_dropzone_obj.getAcceptedFiles().length?p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show():(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-status-text").text(""),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-submit").addClass("is-disabled"),p(".bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap input:checked")&&(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap input").prop("checked",!1),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content").removeClass("has_image"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").hide(),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content .bb-rl-video-thumbnail-custom img").attr("src","").parent().hide()))}),void 0!==n&&(o="",void 0!==(n=JSON.parse(n)).default_images?(p.each(n.default_images,function(e,i){var t="";void 0!==n.selected_id&&void 0!==n.selected_id.id&&i.id==n.selected_id.id&&(t='checked="checked"'),void 0!==i.url&&(o+='<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3">',o+='<div class="">',o+="<input "+t+' id="bb-video-'+i.id+'" class="bb-rl-custom-check" type="radio" value="'+i.id+'" name="bb-video-thumbnail-select" />',o+='<label class="bp-tooltip" data-bp-tooltip-pos="up" data-bp-tooltip="Select" for="bb-video-'+i.id+'"><span class="bb-icon-l bb-icon-check"></span></label>',o+='<a class="" href="#">',o+='<img src="'+i.url+'" class=""/>',o+="</a>",o+="</div>",o+="</li>")}),""!=o&&(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").removeClass("loading"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").html(o),p(".bb-rl-video-thumbnail-uploader").removeClass("generating_thumb"),n.default_images.length<2&&BP_Nouveau.video.is_ffpmeg_installed&&(p(".bb-rl-video-thumbnail-uploader").addClass("generating_thumb"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-spinner bb-icon-l animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-spinner bb-icon-l animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>")))):p(i).find(".bb-rl-video-thumbnail-uploader").addClass("no_generated_thumb"),void 0!==n.preview&&void 0!==n.preview.dropzone&&1==n.preview.dropzone&&(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom").show(),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom img").attr("src",n.preview.url),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content").addClass("has_image"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content").find("input").prop("checked",!0),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-wrapper").hide(),p("#bb_rl_custom_image_ele").find("input").attr("id","bb-video-"+n.preview.attachment_id),p("#bb_rl_custom_image_ele").find("label").attr("for","bb-video-"+n.preview.attachment_id),p("#bb_rl_custom_image_ele").find("input").val(n.preview.attachment_id),void 0!==n.selected_id&&n.preview.attachment_id==n.selected_id.id&&p("#bb_rl_custom_image_ele").find("input").attr("checked","checked")),void 0!==n.selected_id&&p(i).find(".bb-rl-video-thumbnail-uploader #bb-video-"+n.selected_id.id).prop("checked",!0)),l={action:"video_get_edit_thumbnail_data",_wpnonce:BP_Nouveau.nonces.video,attachment_id:d,video_id:l},BP_Nouveau.video.is_ffpmeg_installed&&(void 0===n.default_images||n.default_images.length<2)?(this.thumbnail_xhr&&this.thumbnail_xhr.abort(),p(".bb-rl-video-thumbnail-uploader").addClass("generating_thumb").removeClass("no_generated_thumb"),this.getEditVideoThumbnail(l),this.thumbnail_interval=setInterval(bp.Nouveau.Video.getEditVideoThumbnail,6e3,l)):(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").removeClass("loading"),p(".bb-rl-video-thumbnail-uploader").removeClass("generating_thumb")))},getEditVideoThumbnail:function(e){0===bp.Nouveau.Video.thumbnail_max_interval&&clearTimeout(bp.Nouveau.Video.thumbnail_interval),bp.Nouveau.Video.thumbnail_xhr=p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,cache:!1,success:function(e){var i;e.success?(bp.Nouveau.Video.thumbnail_max_interval--,"yes"===e.data.ffmpeg_generated&&clearTimeout(bp.Nouveau.Video.thumbnail_interval),i=p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list"),e.data.default_images&&(i.html(""),i.html(e.data.default_images)),e.data.ffmpeg_generated&&"no"===e.data.ffmpeg_generated&&i.html(""),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list li").length<2?(p(".bb-rl-video-thumbnail-uploader").addClass("generating_thumb").removeClass("no_generated_thumb"),0===p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list li.bb_rl_thumb_loader").length&&(p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-l bb-icon-spinner animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-l bb-icon-spinner animate-spin"></i><span>'+BP_Nouveau.video.generating_thumb+"</span></div></li>"))):0===p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list li.bb_rl_thumb_loader").length&&p(".bb-rl-video-thumbnail-uploader").removeClass("generating_thumb no_generated_thumb")):clearTimeout(bp.Nouveau.Video.thumbnail_interval)},error:function(){clearTimeout(bp.Nouveau.Video.thumbnail_interval)}})},createThumbnailFromUrl:function(i){var t=this;t.video_thumb_dropzone_obj.createThumbnailFromUrl(i,t.video_thumb_dropzone_obj.options.thumbnailWidth,t.video_thumb_dropzone_obj.options.thumbnailHeight,t.video_thumb_dropzone_obj.options.thumbnailMethod,!0,function(e){t.video_thumb_dropzone_obj.emit("thumbnail",i,e),t.video_thumb_dropzone_obj.emit("complete",i)})},closeEditThumbnailUploader:function(e){e.preventDefault(),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload_thumb),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-modal-status-text").text(""),p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-uploader-wrapper .bb-rl-video-thumbnail-uploader-dropzone-select").html(""),this.video_thumb_dropzone_obj.destroy(),this.dropzone_video_thumb=[],p(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail").hide(),p(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").addClass("is-disabled"),p(".bb-rl-video-thumbnail-uploader").removeClass("opened-edit-thumbnail"),p(window).scroll(),clearTimeout(bp.Nouveau.Video.thumbnail_interval)},openAlbumUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&p("div#video-album-uploader").length&&(p("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div#video-album-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",BP_Nouveau.nonces.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?p(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&p(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):(jQuery(".media-error-popup").length||p("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("queuecomplete",function(){p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,i.data.js_preview=p(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video.push(i.data)):(jQuery(".media-error-popup").length||p("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),p("#bp-video-submit").show(),p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.uploading+"..."),p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid==t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeVideoAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?p("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.video.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(p("#bp-video-uploader-modal-status-text").text(""),p("#bp-video-submit").hide())}))},removeVideoAttachment:function(e){e={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e})},removeVideoThumbnailAttachment:function(e){e={action:"video_thumbnail_delete_attachment",_wpnonce:BP_Nouveau.nonces.video,id:e};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e})},closeUploader:function(e){e.preventDefault(),p("#bp-video-uploader").hide(),p("#bp-video-uploader-modal-title").text(BP_Nouveau.video.i18n_strings.upload),p("#bp-video-uploader-modal-status-text").text(""),this.video_dropzone_obj&&this.video_dropzone_obj.destroy(),this.dropzone_video=[],p("#bp-video-post-content").val("");var i=p(e.target).closest("#bp-video-uploader");p(".bb-rl-close-create-popup-album").trigger("click"),p(".bb-rl-close-create-popup-folder").trigger("click"),i.find('.bb-rl-breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),i.find(".bb-field-steps").length&&(i.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),i.find(".bb-field-steps-1 #bp-video-next").hide(),i.find(".bb-field-steps-1").removeClass("controls-added"),i.find("#bp-video-prev, #bp-video-submit, .bb-rl-video-open-create-popup-album, .bb-rl-create-popup-album-wrap").hide()),this.clearFolderLocationUI(e)},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1},deleteVideo:function(e){var d=this,n=p(e.currentTarget);e.preventDefault();var l,r=[],s=p("#buddypress"),e=n.attr("data-type"),b=n.data("item-from"),u=n.data("root-parent-activity-id"),c="";if("video"===e&&!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;if(n.hasClass("bb-delete")){if(!confirm(BP_Nouveau.video.i18n_strings.video_delete_confirm))return!1;s.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){p(this).closest(".bb-video-thumb").addClass("loading deleting"),r.push(p(this).val())})}if(l=n.data("parent-activity-id"),b&&b.length&&"activity"===b&&0==r.length&&(c=n.attr("data-item-id"),r.push(c)),0==r.length&&r.push(n.data("item-id")),0==r.length)return!1;n.prop("disabled",!0),p("#buddypress #video-stream.video .bp-feedback").remove();e={action:"video_delete",_wpnonce:BP_Nouveau.nonces.video,video:r,activity_id:l,from_where:b};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){var i,t,o,a;b&&b.length&&"activity"===b?e.success&&(p.each(r,function(e,i){p('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+i+'"]').length&&p('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+i+'"]').remove(),p("body .bb-activity-video-elem."+i).length&&p("body .bb-activity-video-elem."+i).remove()}),0==p('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"] .activity-content .activity-inner .bb-activity-video-elem').length&&p('#activity-stream ul.activity-list li[data-bp-activity-id="'+l+'"]').remove(),!0===e.data.delete_activity?(p("body #buddypress .activity-list li#activity-"+l).remove(),p("body .bb-activity-video-elem.video-activity."+c).remove(),p("body .activity-comments li#acomment-"+l).remove(),u&&p(".activity-list").length&&(0===(o=p(".activity-list li#activity-"+u+" .activity-comments > ul > li").length)?(p(".activity-list li#activity-"+u+" .activity-comments ul").remove(),(i=p(".activity-list li#activity-"+u+" .activity-state .activity-state-comments .comments-count")).length&&(t=BP_Nouveau.activity.strings.commentLabel,i.text(t.replace("%d",0))),p(".activity-list li#activity-"+u+" .activity-content .activity-state").removeClass("has-comments")):(a=parseInt(o),(t=p(".activity-list li#activity-"+u+" .activity-state .activity-state-comments .comments-count")).length&&(o=1<a?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,t.text(o.replace("%d",a)))))):p("body #buddypress .activity-list li#activity-"+l).replaceWith(e.data.activity_content)):b&&b.length&&"video"===b?e.success&&("yes"===BP_Nouveau.video.is_video_directory?"personal"===(a=bp.Nouveau.getStorage("bp-video").scope)?(p(document).find("li#video-personal a").trigger("click"),p(document).find("li#video-personal").trigger("click")):"groups"===a?(p(document).find("li#video-groups a").trigger("click"),p(document).find("li#video-groups").trigger("click")):(p(document).find("li#video-all a").trigger("click"),p(document).find("li#video-all").trigger("click")):(e.data.video_personal_count&&p("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),e.data.video_group_count&&p("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count),0!==e.data.video_html_content.length?0===parseInt(e.data.video_personal_count)?(p(".bb-videos-actions").hide(),p("#video-stream").html(e.data.video_html_content)):s.find(".video-list:not(.existing-video-list)").html(e.data.video_html_content):0!==e.data.group_video_html_content.length?0===parseInt(e.data.video_group_count)?(p(".bb-videos-actions").hide(),p("#video-stream").html(e.data.group_video_html_content)):s.find(".video-list:not(.existing-video-list)").html(e.data.group_video_html_content):p.each(r,function(e,i){p('#video-stream ul.video-list li[data-id="'+i+'"]').length&&p('#video-stream ul.video-list li[data-id="'+i+'"]').remove(),d.video_album_id&&p('#media-stream ul.media-list li[data-id="'+i+'"]').length&&p('#media-stream ul.media-list li[data-id="'+i+'"]').remove()}))):(setTimeout(function(){n.prop("disabled",!1)},500),e.success?(void 0!==e.data&&void 0!==e.data.video_personal_count&&p("#buddypress").find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),void 0!==e.data&&void 0!==e.data.video_group_count&&p("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count),0!==e.data.video_html_content.length?0===parseInt(e.data.video_personal_count)?(p(".bb-videos-actions").hide(),p("#video-stream").html(e.data.video_html_content)):s.find(".video-list:not(.existing-video-list)").html(e.data.video_html_content):0!==e.data.group_video_html_content.length?0===parseInt(e.data.video_group_count)?(p(".bb-videos-actions").hide(),p("#video-stream").html(e.data.group_video_html_content)):s.find(".video-list:not(.existing-video-list)").html(e.data.group_video_html_content):s.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){p(this).closest("li").remove()})):p("#buddypress #video-stream.video").prepend(e.data.feedback));e=p(".bp-nouveau #bb-select-deselect-all-video");e.hasClass("selected")&&e.removeClass("selected"),jQuery(window).scroll()}})},bp_ajax_video_request:function(e,i){void 0!==BP_Nouveau.video.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0===parseInt(i.response.scopes.groups)?p(".bb-videos-actions").hide():BP_Nouveau.video.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0!==parseInt(i.response.scopes.groups)?p(".bb-videos-actions").show():void 0!==i&&void 0!==i.response.scopes.personal&&0===parseInt(i.response.scopes.personal)?p(".bb-videos-actions").hide():void 0!==i&&void 0!==i.response.scopes.personal&&0!==parseInt(i.response.scopes.personal)&&p(".bb-videos-actions").show()},deleteVideoThumb:function(e){var i=p(e.currentTarget);e.preventDefault();var t=p(".bb-rl-video-edit-thumbnail-hidden-video-id").val(),o=p(".bb-rl-video-edit-thumbnail-hidden-attachment-id").val(),i=i.closest(".bb-dropzone-wrap").find("input").val();p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_thumbnail_delete",_wpnonce:BP_Nouveau.nonces.video,video_id:t,attachment_id:o,video_attachment_id:i},success:function(e){e.data.video_attachments&&p('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+o+'"]').attr("data-video-attachments",e.data.video_attachments),e.data.thumbnail_id&&0!==e.data.thumbnail_id&&p("#bb-video-"+e.data.thumbnail_id).length&&(p("#bb-video-"+e.data.thumbnail_id).prop("checked",!0),p(".bb-rl-video-thumbnail-submit").removeClass("is-disabled")),e.data.thumbnail&&(p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+t+'"]').find("img").length&&p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+t+'"]').find("img").attr("src",e.data.thumbnail),p('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+t+'"]').find("img").length&&p('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+t+'"]').find("img").attr("src",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+t+'"]').find(".vjs-poster").length&&(p('.bb-activity-video-elem .video-js[data-id="'+t+'"]').attr("poster",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+t+'"]').find("video").attr("poster",e.data.thumbnail),p('.bb-activity-video-elem .video-js[data-id="'+t+'"]').find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")')),p("#theatre-video-"+t).length&&(p("#theatre-video-"+t).attr("poster",e.data.thumbnail),p("#theatre-video-"+t).find("video").attr("poster",e.data.thumbnail),p("#theatre-video-"+t).find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),p('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+t+'"]').find("img").attr("src",e.data.thumbnail)))}})},openCreateVideoAlbumModal:function(e){e.preventDefault(),this.openAlbumUploader(e),p("#bp-video-create-album").show()},closeCreateVideoAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),p("#bp-video-create-album").hide(),p("#bb-album-title").val("").removeClass("error")},saveAlbum:function(i){var t=p(i.currentTarget),o=this,a=p("#bb-album-title"),d=p("#bb-rl-album-privacy");if(t.hasClass("saving"))return!1;if(i.preventDefault(),""===p.trim(a.val()))return a.addClass("error"),!1;if(a.removeClass("error"),!o.group_id&&""===p.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.addClass("saving"),t.attr("disabled",!0);var e={action:"video_album_save",_wpnonce:BP_Nouveau.nonces.video,title:a.val(),videos:o.dropzone_video,privacy:d.val()};o.album_id&&(e.album_id=o.album_id),o.group_id&&(e.group_id=o.group_id),p("#bp-media-single-album .bp-feedback").remove(),p("#bb-rl-media-create-album-popup .bp-feedback").remove(),p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){setTimeout(function(){t.removeClass("saving"),t.prop("disabled",!1)},500),e.success?o.album_id?(p("#bp-single-album-title").text(a.val()),p("#bb-rl-album-privacy").val(d.val()),o.cancelEditAlbumTitle(i)):(p("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):o.album_id?p("#bp-media-single-album").prepend(e.data.feedback):p("#bb-rl-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},injectVideos:function(i){var t,o,e=bp.Nouveau.getStorage("bp-video"),a=e.scope||null,d=e.filter||null;p(i.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,o=this,e="",i.preventDefault(),p(i.currentTarget).find("a").first().addClass("loading"),p("#buddypress .dir-search input[type=search]").length&&(e=p("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"video",scope:a,filter:d,search_terms:e,page:t,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(p(i.currentTarget).remove(),o.current_page=t,jQuery(window).scroll())}))},openVideoMove:function(e){var i,t,o,a;e.preventDefault(),this.moveToIdPopup=p(e.currentTarget).attr("id"),this.moveToTypePopup=p(e.currentTarget).attr("data-type"),0<p(e.currentTarget).closest(".activity-inner").length?i=p(e.currentTarget).closest(".activity-inner"):0<p(e.currentTarget).closest("#media-stream.media").length?i=p(e.currentTarget).closest("#media-stream.media"):0<p(e.currentTarget).closest("#video-stream.video").length?i=p(e.currentTarget).closest("#video-stream.video"):0<p(e.currentTarget).closest(".comment-item").length&&(i=p(e.currentTarget).closest(".comment-item")),p(i).find(".bb-rl-video-move-file").addClass("open").show(),o=p(e.currentTarget).closest(".video-action-wrap").siblings("a").data("id"),t=p(e.currentTarget).closest(".video-action-wrap").siblings("a").data("album-id"),void 0===o&&(o=p(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("id"),t=p(e.currentTarget).closest(".video-action-wrap").siblings("div.video-js").data("album-id")),i.find(".bb-rl-video-move").attr("id",o),i.find(".bb-model-footer .bb-rl-video-move").addClass("is-disabled"),a=p(e.currentTarget).closest(".video-action_list").closest("li.comment-item").length?"#"+p(e.currentTarget).closest(".video-action_list").closest("li").attr("id")+".comment-item .bb-rl-video-move-file":"#"+p(e.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bb-rl-video-move-file",p(a).find(".bb-rl-document-move").attr("id",p(e.currentTarget).closest(".bb-rl-document-activity").attr("data-id")),(0<p(e.currentTarget).closest(".media-list").length||0<p(e.currentTarget).closest(".video-list").length)&&(a=".bb-rl-video-move-file"),"group"===this.moveToTypePopup?p(document).find(".bb-rl-location-album-list-wrap h4").show():p(document).find(".bb-rl-location-album-list-wrap h4").hide(),p(a).addClass("open-popup"),p(a).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),p(a).find(".bb-rl-location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>');var d=t,n=this.moveToTypePopup;""!==this.moveToIdPopup&&p.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){p(document).find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-video").html(e.data.first_span_text),""===e.data.html?(p(document).find(".open-popup .bb-rl-location-album-list-wrap").hide(),p(document).find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").show()):(p(document).find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),p(document).find(".open-popup .bb-rl-location-album-list-wrap").show()),"group"===n?(p(document).find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").hide(),p(document).find(".open-popup .bb-rl-album-create-from").val("group")):(p(document).find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),p(document).find(".open-popup .bb-rl-album-create-from").val("profile")),!1===e.data.create_album?(p(document).find(".open-popup .bb-rl-video-open-create-popup-album").removeClass("create-album"),p(document).find(".open-popup .bb-rl-video-open-create-popup-album").hide()):(p(document).find(".open-popup .bb-rl-video-open-create-popup-album").addClass("create-album"),p(document).find(".open-popup .bb-rl-video-open-create-popup-album").show()),p(a).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),p(a).find(".bb-rl-location-album-list-wrap").append(e.data.html),p(a).find("ul.location-album-list span#"+d).trigger("click")}}),p(document).on("click",a+" .location-album-list li span",function(e){var i;e.preventDefault(),p(this).parent().hasClass("is_active")||(0!=p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+p(this).attr("id")+'">'+p(this).text()+"</span>"),p(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),i=p(document).find('a.bb-rl-open-video-theatre[data-id="'+o+'"]').data("album-id"),Number(i)==Number(p(e.currentTarget).data("id"))?p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-model-footer .bb-rl-video-move").addClass("is-disabled"):p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-model-footer .bb-rl-video-move").removeClass("is-disabled"),p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-model-footer .bb-rl-video-move").hasClass("is-disabled")||p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-rl-album-selected-id").val(p(e.currentTarget).data("id")))}),p(document).on("click",a+" .breadcrumb .item > span",function(e){p(this).hasClass("is-disabled")||(p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-rl-album-selected-id").val(0),p(e.currentTarget).closest(".bb-rl-video-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&p(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),d==p(e.currentTarget).data("id")?p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-model-footer .bb-rl-video-move").addClass("is-disabled"):p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-model-footer .bb-rl-video-move").removeClass("is-disabled"))})},createAlbumInPopup:function(e){e.preventDefault();var i=parseInt(p(document).find(".open-popup .bb-rl-album-selected-id").val()),t=p(document).find(".open-popup .bb-rl-album-create-from").val();0<i?p(document).find(".open-popup .bb-rl-privacy-field-wrap-hide-show").hide():p(document).find(".open-popup .bb-rl-privacy-field-wrap-hide-show").show(),"group"===t?p(document).find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").hide():p(document).find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),p(".modal-container .bb-model-footer").hide(),p(".bb-field-wrap-search").hide(),p(".bb-rl-video-open-create-popup-album").hide(),p(".bb-rl-location-album-list-wrap-main").hide(),p(".bb-field-steps-2 #bp-media-prev").hide(),p(".bb-rl-create-popup-album-wrap").show(),p(e.currentTarget).closest(".bb-rl-has-folderlocationUI").find(".bb-model-header").children().hide(),p(e.currentTarget).closest(".bb-rl-has-folderlocationUI").find(".bb-model-header").append("<p>Create Album</p>"),p(".modal-container #bb-rl-folder-privacy").addClass("new-folder-create-privacy"),p(document).find(".open-popup .error").hide()},closeVideoMove:function(e){e.preventDefault(),0!=p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-rl-location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&p(e.currentTarget).closest(".bb-rl-video-move-file").find(".bb-rl-location-album-list-wrap .breadcrumb .item span:last-child").remove(),p(e.currentTarget).closest(".bb-rl-video-move-file").hide()},moveVideoIntoAlbum:function(e){var i=p(e.currentTarget);e.preventDefault();var t=i.attr("id"),o=i.closest(".bb-rl-video-move-file").find(".bb-rl-album-selected-id").val();if(""===t||""===o)return i.closest(".modal-container").find(".location-album-list").addClass("has-error"),!1;i.closest(".modal-container").find(".location-album-list").removeClass("has-error"),i.addClass("loading");var a=p(document).find('li.move_video a[data-video-id="'+t+'"]').attr("data-parent-activity-id"),e=parseInt(this.group_id);e||(e=!1,"group"===p(document).find('li.move_video a[data-video-id="'+t+'"]').attr("data-type")&&(e=p(document).find('li.move_video a[data-video-id="'+t+'"]').attr("id")));e={action:"video_move",_wpnonce:BP_Nouveau.nonces.video,video_id:t,album_id:o,group_id:e,activity_id:a};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?("yes"===BP_Nouveau.video.is_video_directory?"personal"===bp.Nouveau.getStorage("bp-video").scope?(p(document).find("li#video-personal a").trigger("click"),p(document).find("li#video-personal").trigger("click")):(p(document).find("li#video-all a").trigger("click"),p(document).find("li#video-all").trigger("click")):(0<parseInt(BP_Nouveau.video.current_album)?(p('#video-stream ul.video-list li[data-id="'+t+'"]').remove(),p('#media-stream ul.media-list li[data-id="'+t+'"]').remove()):p('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').length&&!p('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').parents().hasClass("bb-video-length-1")&&(p('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+t+'"]').remove(),a&&a.length&&(p('#activity-stream ul.activity-list li[data-bp-activity-id="'+a+'"] .activity-content .activity-inner .bb-activity-video-wrap').remove(),p('#activity-stream ul.activity-list li[data-bp-activity-id="'+a+'"] .activity-content .activity-inner').append(e.data.video_content),jQuery(window).scroll())),p(document).find(".open-popup .error").hide(),p(document).find(".open-popup .error").html(""),i.removeClass("loading"),p(document).removeClass("open-popup")),i.closest(".bb-rl-video-move-file").find(".bb-rl-ac-video-close-button").trigger("click"),p(document).find('a.bb-rl-open-video-theatre[data-id="'+t+'"]').data("album-id",o)):alert(e.data.feedback.replace("&#039;","'"))}})},submitCreateAlbumInPopup:function(e){e.preventDefault();var i=p(e.currentTarget).closest(".open-popup"),t=p(i).find(".bb-rl-video-create-popup-album-submit"),o=i.find(".bb-rl-album-selected-id").val();this.currentTargetParent=o=""===o?0:o;var a=this.currentTargetParent,d=0,n=p.trim(p(e.currentTarget).closest(".modal-container").find(".bb-rl-popup-on-fly-create-album-title").val()),l=p(e.currentTarget).closest(".modal-container").find(".bb-rl-popup-on-fly-create-album-title"),r="",s="",b=0;if("group"===this.moveToTypePopup?(r="grouponly",d=this.moveToIdPopup):(r=p(e.currentTarget).closest(".modal-container").find(".bb-rl-popup-on-fly-create-album #bb-rl-album-privacy").val(),s=p(e.currentTarget).closest(".modal-container").find(".bb-rl-popup-on-fly-create-album #bb-rl-album-privacy")),""===n)return alert(BP_Nouveau.media.create_album_error_title),!1;t.addClass("loading"),setTimeout(function(){var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:n,privacy:r,parent:a,group_id:d};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){e.success&&(i.find(".bb-rl-location-album-list-wrap .location-album-list").remove(),i.find(".bb-rl-location-album-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(i,e.data.album_id),b=e.data.album_id,""===e.data.tree_view?(i.find(".bb-rl-location-album-list-wrap").hide(),i.find(".bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").show()):(i.find(".bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),i.find(".bb-rl-location-album-list-wrap").show()),i.find("ul.location-album-list span#"+b).trigger("click"),i.find(".bb-model-footer").show(),i.find(".bb-field-wrap-search").show(),i.find(".bb-rl-video-open-create-popup-album").show(),i.find(".bb-rl-location-album-list-wrap-main").show(),i.find(".bb-rl-create-popup-album-wrap").hide(),i.find(".bb-field-steps-2 #bp-media-prev").show(),i.find(".bb-rl-album-selected-id").val(),i.find(".bb-rl-album-selected-id").val(b),i.find(".bb-model-header").children().show(),i.find(".bb-model-header p").hide(),l.val(""),""!==s&&s.val("public"),p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||p('<span class="more_options">...</span>').insertAfter(p(i).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),bp.Nouveau.Media.updateAlbumNavCount(e.data.album_count),t.removeClass("loading"))}}),this.currentTargetParent=b,i.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide(),i.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),i.find(".location-album-list li span.selected").removeClass("selected"),i.find(".location-album-list li.is_active").children("span").addClass("selected")},0)}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.current_video_index=0,this.is_open_video=!1,this.nextVideoLink=p(".bb-next-media"),this.previousVideoLink=p(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id},addListeners:function(){p(document).on("click",".bb-rl-open-video-theatre",this.openTheatre.bind(this)),p(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),p(document).on("click",".bb-prev-media",this.previous.bind(this)),p(document).on("click",".bb-next-media",this.next.bind(this)),p(document).on("click",".bp-add-video-activity-description",this.openVideoActivityDescription.bind(this)),p(document).on("click","#bp-activity-description-new-reset",this.closeVideoActivityDescription.bind(this)),p(document).on("keyup",".bp-edit-video-activity-description #add-activity-description",this.MediaActivityDescriptionUpdate.bind(this)),p(document).on("click","#bp-activity-description-new-submit",this.submitVideoActivityDescription.bind(this)),p(document).on("bp_activity_ajax_delete_request_video",this.videoActivityDeleted.bind(this))},openTheatre:function(e){e.preventDefault();var i=p(e.currentTarget),e=this;if(i.closest("#bp-existing-video-content").length)return!1;e.setupGlobals(),e.setVideos(i),i=i.data("id"),e.setCurrentVideo(i),e.showVideo(),e.navigationCommands(),void 0!==BP_Nouveau.activity&&e.current_video&&void 0!==e.current_video.activity_id&&0!=e.current_video.activity_id&&!e.current_video.is_forum&&"comment"!==e.current_video.privacy?e.getActivity():e.getVideosDescription(),p(".bb-media-model-wrapper.media").hide(),p(".bb-media-model-wrapper.document").hide(),p(".bb-media-model-wrapper.video").show(),e.is_open_video=!0},closeTheatre:function(e){e.preventDefault();e=p(e.currentTarget);if(p(e).closest(".bb-media-model-wrapper").hasClass("media-theatre")||p(e).closest(".bb-media-model-wrapper").hasClass("document-theatre"))return!1;p(".bb-media-model-wrapper.video .bb-media-section").find("video").length&&videojs(p(".bb-media-model-wrapper.video .bb-media-section").find("video").attr("id")).reset(),p(".bb-media-model-wrapper").hide(),this.is_open_video=!1,this.resetRemoveActivityCommentsData(),p(e).closest(".bb-media-model-wrapper").find("figure").removeClass("has-no-thumbnail"),this.current_video=!1},getVideosDescription:function(){var e=this;p(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),0!=e.activity_ajax&&e.activity_ajax.abort();var i=p('[data-bp-activity-id="'+e.current_video.activity_id+'"] .activity-comments');i.length&&(e.current_video.parent_activity_comments=!0,i.html("")),!0===e.current_video.parent_activity_comments&&p(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_video.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_video_description",id:e.current_video.id,attachment_id:e.current_video.attachment_id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&p(".bb-media-model-wrapper.video:visible").length?(p(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),p(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").attr("autoplay",!0),p(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),p(".bb-media-info-section:visible").show(),p(window).scroll()):p(".bb-media-info-section.media").hide()}})},setVideos:function(e){var i=p(".bb-rl-open-video-theatre"),t=0;if(void 0!==(i=p("body").hasClass("activity")?p(e).closest(".bb-activity-video-wrap").find(".bb-rl-open-video-theatre"):i))for(this.videos=[],t=0;t<i.length;t++){var o,a=p(i[t]);a.closest("#bp-existing-media-content").length||(o={id:a.data("id"),attachment:a.data("attachment-full"),activity_id:a.data("activity-id"),attachment_id:a.data("attachment-id"),privacy:a.data("privacy"),parent_activity_id:a.data("parent-activity-id"),album_id:a.data("album-id"),group_id:a.data("group-id"),is_forum:!1},a.closest(".forums-video-wrap").length&&(o.is_forum=!0),void 0!==o.privacy&&"message"==o.privacy?o.is_message=!0:o.is_message=!1,o.thumbnail_class="",(a.closest(".bb-activity-video-elem").hasClass("has-no-thumbnail")||a.closest(".bb-video-thumb").hasClass("has-no-thumbnail"))&&(o.thumbnail_class="has-no-thumbnail"),this.videos.push(o))}},setCurrentVideo:function(e){for(var i=this,t=0,t=0;t<i.videos.length;t++)if(e===i.videos[t].id){i.current_video=i.videos[t],i.current_index=t;break}},showVideo:function(){var e=this;if(void 0===e.current_video)return!1;p(".bb-media-model-wrapper.video .bb-media-section").find("figure").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>');var i,t=p(".bb-media-section .bb-media-privacy-wrap");t.length&&(t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.media-privacy").find("li[data-value="+e.current_video.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_video.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_video.activity_id&&0!=e.current_video.activity_id||e.group_id||e.current_video.is_forum||e.current_video.group_id||e.current_video.album_id||e.current_video.is_message)&&t.hide()),p(".bb-media-model-wrapper.video").find("figure").removeClass("has-no-thumbnail").addClass(e.current_video.thumbnail_class),e.navigationCommands()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.show()):0==e.current_index&&e.current_index==e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.hide()):e.current_index==e.videos.length-1?(e.previousVideoLink.show(),e.nextVideoLink.hide()):(e.previousVideoLink.show(),e.nextVideoLink.show())},next:function(e){e.preventDefault();var i=this;void 0!==i.videos[i.current_index+1]?(i.current_index=i.current_index+1,e=i.current_video.activity_id,i.current_video=i.videos[i.current_index],i.showVideo(),e!=i.current_video.activity_id&&"comment"!==i.current_video.privacy?i.getActivity():i.getVideosDescription()):i.nextLink.hide()},previous:function(e){e.preventDefault();var i=this;void 0!==i.videos[i.current_index-1]?(i.current_index=i.current_index-1,e=i.current_video.activity_id,i.current_video=i.videos[i.current_index],i.showVideo(),e!=i.current_video.activity_id&&"comment"!==i.current_video.privacy?i.getActivity():i.getVideosDescription()):i.previousLink.hide()},resetRemoveActivityCommentsData:function(){var e,i,t,o,a=this,d=p("#hidden_parent_id").val();void 0!==d&&(a.activity_ajax=p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_activity",reset_comment:!0,id:d,group_id:_.isUndefined(a.current_video.group_id)?0:a.current_video.group_id,video_id:_.isUndefined(a.current_video.id)?0:a.current_video.id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&(p("#activity-stream #activity-"+d+" .activity-comments").html(e.data.activity),jQuery(window).scroll(),bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup())}}),a=i=t=o=e=!1,(o=(t=p('.bb-media-model-wrapper.video [data-bp-activity-id="'+d+'"]')).find(".activity-state")).length&&(i=o.html(),a=o.attr("class"),o.remove(),(o=p('[data-bp-activity-id="'+d+'"] .activity-state')).length&&(o.html(i),o.attr("class",a))),(e=t.find(".activity-meta")).length&&(i=e.html(),a=e.attr("class"),e.remove(),(e=p('[data-bp-activity-id="'+d+'"] > .activity-meta')).length&&(e.html(i),e.attr("class",a))),t.remove(),p("#hidden_parent_id").length&&p("#hidden_parent_id").remove())},getActivity:function(){var e,i=this;p(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),void 0!==BP_Nouveau.activity&&i.current_video&&void 0!==i.current_video.activity_id&&0!=i.current_video.activity_id&&!i.current_video.is_forum?(0!=i.activity_ajax&&i.activity_ajax.abort(),p(".bb-media-info-section.media").show(),(e=p('[data-bp-activity-id="'+i.current_video.activity_id+'"] .activity-comments')).length&&(i.current_video.parent_activity_comments=!0,e.html("")),!0===i.current_video.parent_activity_comments&&p(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+i.current_video.activity_id+'" id="hidden_parent_id"/>'),i.activity_ajax=p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"video_get_activity",id:i.current_video.activity_id,group_id:_.isUndefined(i.current_video.group_id)?0:i.current_video.group_id,video_id:_.isUndefined(i.current_video.id)?0:i.current_video.id,nonce:BP_Nouveau.nonces.video},success:function(e){e.success&&p(".bb-media-model-wrapper.video:visible").length&&(p(".bb-media-model-wrapper.video .bb-media-section").find("figure").html(e.data.video_data),p(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").attr("autoplay",!0),p(".bb-media-model-wrapper.video .bb-media-section").find("figure").find("video").addClass("popup-video"),p(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity),p(".bb-media-info-section:visible").show(),jQuery(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},1e3))}})):p(".bb-media-info-section.media").hide()},openVideoActivityDescription:function(e){e.preventDefault();e=p(e.currentTarget);if(e.parents(".activity-video-description").find(".bp-edit-video-activity-description").length<1)return!1;e.parents(".activity-video-description").find(".bp-edit-video-activity-description").show().addClass("open"),e.parents(".activity-video-description").find(".bp-video-activity-description").hide(),e.hide()},closeVideoActivityDescription:function(e){e.preventDefault();var i=p(e.currentTarget);if(i.parents(".activity-video-description").length<1)return!1;e=i.parents(".activity-video-description").find("#add-activity-description").get(0).defaultValue;i.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),i.parents(".activity-video-description").find(".bp-video-activity-description").show(),i.parents(".activity-video-description").find("#add-activity-description").val(e),i.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open")},MediaActivityDescriptionUpdate:function(e){""!==p(e.currentTarget).val().trim()?p(e.currentTarget).closest(".bp-edit-video-activity-description").addClass("has-content"):p(e.currentTarget).closest(".bp-edit-video-activity-description").removeClass("has-content")},submitVideoActivityDescription:function(e){e.preventDefault();var i=p(e.currentTarget),t=i.parents(".activity-video-description"),e={action:"video_description_save",description:t.find("#add-activity-description").val(),attachment_id:t.find("#bp-attachment-id").val(),_wpnonce:BP_Nouveau.nonces.video};p.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,async:!1,success:function(e){e.success?(i.parents(".activity-video-description").find(".bp-video-activity-description").html(e.data.description).show(),i.parents(".activity-video-description").find(".bp-add-video-activity-description").show(),t.find("#add-activity-description").val(e.data.description),t.find("#add-activity-description").get(0).defaultValue=e.data.description,""==e.data.description?i.parents(".activity-video-description").find(".bp-add-video-activity-description").removeClass("show-edit").addClass("show-add"):i.parents(".activity-video-description").find(".bp-add-video-activity-description").addClass("show-edit").removeClass("show-add"),i.parents(".activity-video-description").find(".bp-edit-video-activity-description").hide().removeClass("open"),i.parents(".activity-video-description").find(".bp-video-activity-description").show(),i.parents(".activity-video-description").find(".bp-feedback.error").remove()):i.parents(".activity-video-description").prepend(e.data.feedback)}})},videoActivityDeleted:function(e,i){var t=this,o=0;if(t.is_open_video&&void 0!==i&&"delete_activity"===i.action&&t.current_video.activity_id==i.id){var a=p(document).find('[data-bp-list="video"] .bb-rl-open-video-theatre[data-id="'+t.current_video.id+'"]'),d=a.parents("ul");for(a.closest("li").remove(),0===d.find("li:not(.load-more)").length&&(0<p(".bb-videos-actions").length&&p(".bb-videos-actions").hide(),1===d.find("li.load-more").length&&location.reload()),p(document).find('[data-bp-list="activity"] .bb-rl-open-video-theatre[data-id="'+t.current_video.id+'"]').closest(".bb-activity-video-elem").remove(),o=0;o<t.videos.length;o++)if(t.videos[o].activity_id==i.id){t.videos.splice(o,1);break}0==t.current_index&&t.current_index!=t.videos.length?(t.current_index=-1,t.next(e)):0==t.current_index&&t.current_index==t.videos.length?(p(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+t.current_video.activity_id+'"]').remove(),t.closeTheatre(e)):t.current_index==t.videos.length?t.previous(e):(t.current_index=-1,t.next(e))}}},bp.Nouveau.Video.Theatre.start(),bp.Nouveau.Video.Player={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.player=[],this.playerTime=0,this.playerID="",bp.Nouveau.Video.Player.openPlayer(),p(window).on("scroll resize",function(){bp.Nouveau.Video.Player.openPlayer()})},addListeners:function(){p(document).on("click",".video-js",this.openPlayer.bind(this))},openPlayer:function(){var l=this.player;p(".video-js:not(.loaded)").each(function(){var i,e,t,o=this,a=p(this).attr("id"),d=p(this).attr("id");l[p(this).attr("id")]=videojs(o,{controlBar:{volumePanel:{inline:!1}}},function(){this.on("ended",function(){}),this.on("play",function(){p(".video-js").each(function(){d!==p(this).attr("id")&&this.player.pause()})})}),void 0!==l[a]&&0==p(this).find(".skip-back").length&&0==p(this).find(".skip-forward").length&&(l[a].seekButtons({forward:5,back:5}),setTimeout(function(){var e=p(o).parent();e.find(".vjs-control-bar > .vjs-seek-button.skip-back, .vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon-pos","up"),e.find(".vjs-control-bar > .vjs-seek-button.skip-back").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_skip_back_text),e.find(".vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_skip_forward_text)},0)),0<bp.Nouveau.Video.Player.playerTime&&p(this).attr("id")=="theatre-"+bp.Nouveau.Video.Player.playerID?(l[p(o).parent().attr("id")].currentTime(bp.Nouveau.Video.Player.playerTime),l[p(o).parent().attr("id")].play()):(bp.Nouveau.Video.Player.playerTime=0,bp.Nouveau.Video.Player.playerID=""),p(o).hasClass("single-activity-video")&&(i=p(this).attr("id"),l[p(this).attr("id")].controlBar.addChild("button").addClass("vjs-icon-square"),(e=p(this).find(".vjs-icon-square").addClass("enlarge_button")).attr("data-balloon-pos","up"),e.attr("data-balloon",BP_Nouveau.video.i18n_strings.video_enlarge_text),a=p(this).find(".vjs-error-display.vjs-modal-dialog"),t=p(this),e.on("click touchstart",function(){0<l[i].currentTime()&&(bp.Nouveau.Video.Player.playerTime=l[i].currentTime(),bp.Nouveau.Video.Player.playerID=p("#"+i).parent().find(".video-js video").attr("id")),l[i].pause(),p("#"+i).parent().find(".bb-rl-open-video-theatre").trigger("click")}),a.on("click",function(){p("#"+i).parent().find(".bb-rl-open-video-theatre").trigger("click")}),t.on("click",function(e){p(e.target).hasClass("video-js")&&(t.hasClass("vjs-paused")?l[i].play():l[i].pause())})),p(o).closest(".video-theatre").length&&((n=p(this).parent().find(".vjs-fullscreen-control")).attr("data-balloon-pos","up"),n.attr("data-balloon",BP_Nouveau.video.i18n_strings.video_fullscreen_text)),p(o).parent().find(".video-js").append('<div class="pcture-in-picture-notice">'+BP_Nouveau.video.i18n_strings.video_picture_in_text+"</div>"),p(o).parent().find(".vjs-control-bar > button, .vjs-control-bar > div").attr("data-balloon-pos","up");var n=p(o).parent();n.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_play_text),n.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon-pause",BP_Nouveau.video.i18n_strings.video_pause_text),n.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon-pos","right"),n.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_volume_text),n.find(".vjs-control-bar > .vjs-picture-in-picture-control").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_miniplayer_text),n.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon-pos","left"),n.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon",BP_Nouveau.video.i18n_strings.video_speed_text),p(this).addClass("loaded")})}},bp.Nouveau.Video.Player.start())}((bp,jQuery));