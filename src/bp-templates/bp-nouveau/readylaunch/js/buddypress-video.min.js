window.bp=window.bp||{},function(m){var e,c,h,f,g,y;"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},c=(e=BP_Nouveau).media,h=e.ajaxurl,f=e.video,g=e.nonces,y=e.activity,bp.Nouveau.Video={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=m("body");this.thumbnail_xhr=null,this.thumbnail_interval=null,this.thumbnail_max_interval=6,this.current_page=1,this.video_dropzone_obj=null,this.video_thumb_dropzone_obj=[],this.dropzone_video=[],this.dropzone_video_thumb=[],this.video_album_id=void 0!==f.album_id&&f.album_id,!this.video_album_id&&0<parseInt(c.current_album)&&(this.video_album_id=parseInt(c.current_album)),this.video_group_id=void 0!==f.group_id&&f.group_id,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-video-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1);e=document.getElementsByClassName("uploader-post-video-template").length?document.getElementsByClassName("uploader-post-video-template")[0].innerHTML:"";this.videoOptions={url:h,timeout:108e5,dictFileTooBig:f.dictFileTooBig,acceptedFiles:f.video_type,createImageThumbnails:!1,dictDefaultMessage:f.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==f.maxFiles?f.maxFiles:10,maxFilesize:void 0!==f.max_upload_size?f.max_upload_size:2,dictInvalidFileType:f.dictInvalidFileType,previewTemplate:e,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation},this.videoThumbnailOptions={url:h,timeout:108e5,dictFileTooBig:f.dictFileTooBig,dictDefaultMessage:f.dropzone_video_thumbnail_message,acceptedFiles:"image/jpeg,image/png",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:1,thumbnailMethod:"contain",thumbnailWidth:null,thumbnailHeight:"300",maxFilesize:void 0!==f.max_upload_size?f.max_upload_size:2,dictMaxFilesExceeded:f.thumb_dict_file_exceeded,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation},void 0!==f.dropzone_options&&Object.assign(this.options,f.dropzone_options)},addListeners:function(){var e=m(".bp-nouveau"),i=m(document);i.on("click","#bp-add-video",this.openUploader.bind(this)),i.on("click",".bb-rl-video-thumbnail-submit",this.submitVideoThumbnail.bind(this)),i.on("click",".bb-rl-ac-video-thumbnail-edit",this.openEditThumbnailUploader.bind(this)),i.on("click",".bb-rl-video-thumbnail-uploader-close",this.closeEditThumbnailUploader.bind(this)),i.on("click","#bp-video-uploader-close",this.closeUploader.bind(this)),i.on("click","#bp-video-submit",this.submitVideo.bind(this)),i.on("click",".bp-video-uploader .modal-container .bb-field-uploader-actions",this.uploadVideoNavigate.bind(this)),i.on("click",".bb-rl-more_dropdown-wrap .bb_rl_more_dropdown__action, .bb-rl-activity-video-elem .bb-rl-more_dropdown-wrap .video-action_list li a, .bb-rl-media-model-container .bb-rl-activity-list .bb-rl-more_dropdown-wrap > a, .bb-rl-media-model-container .bb-rl-activity-list .bb-rl-more_dropdown-wrap .video-action_list li a",this.videoActivityActionButton.bind(this)),i.on("click",".activity .bb-rl-video-move-activity, #media-stream .bb-rl-video-move-activity, #video-stream .bb-rl-video-move-activity",this.moveVideoIntoAlbum.bind(this)),i.on("click",".bb-rl-video-open-create-popup-album",this.createAlbumInPopup.bind(this)),i.on("click",".bb-rl-ac-video-close-button",this.closeVideoMove.bind(this)),i.on("click",".bb-rl-ac-video-move",this.openVideoMove.bind(this)),i.on("change",'.bb-video-check-wrap [name="bb-video-select"]',this.addSelectedClassToWrapper.bind(this)),i.on("click","#bb-select-deselect-all-video",this.toggleSelectAllVideo.bind(this)),i.on("click",".video-action_list .bb-rl-video-file-delete, #bb-delete-video",this.deleteVideo.bind(this)),i.on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom .bb-rl-close-thumbnail-custom",this.deleteVideoThumb.bind(this)),void 0!==BP_Nouveau.is_send_ajax_request&&"1"===BP_Nouveau.is_send_ajax_request?m('#buddypress [data-bp-list="video"]').on("bp_ajax_request",this.bp_ajax_video_request):this.bb_video_after_load(),e.on("click","#bb-create-video-album",this.openCreateVideoAlbumModal.bind(this)),e.on("click","#bp-video-create-album-close",this.closeCreateVideoAlbumModal.bind(this)),i.on("click","#bp-video-create-album-submit",this.saveAlbum.bind(this)),m('.bp-nouveau [data-bp-list="video"]').on("click","li.load-more",this.injectVideos.bind(this)),i.on("click",".bb-rl-video-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this))},submitVideoThumbnail:function(a){var d=this,n=m(a.currentTarget);if(a.preventDefault(),n.hasClass("saving")||n.hasClass("is-disabled"))return!1;n.addClass("saving");var e=m(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail"),l=e.find(".bb-rl-video-edit-thumbnail-hidden-video-id").val(),i=e.find(".bb-rl-video-edit-thumbnail-hidden-attachment-id").val(),e=e.find('input[type="radio"]:checked').val(),e={action:"video_thumbnail_save",_wpnonce:g.video,video_thumbnail:d.dropzone_video_thumb,video_id:l,video_attachment_id:i,video_default_id:e};m.ajax({type:"POST",url:h,data:e,success:function(e){var i,t,o;e.success&&(i=e.data.thumbnail,o=m('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+l+'"]'),(t=m('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+l+'"]')).find("img").length&&t.find("img").attr("src",i),o.find("img").length&&o.find("img").attr("src",i),(o=m('.bb-activity-video-elem .video-js[data-id="'+l+'"]')).length&&o.attr("poster",i).find("video").attr("poster",i).end().find(".vjs-poster").css("background-image",'url("'+i+'")').find("img").attr("src",i),(o=m("#bb-rl-theatre-video-"+l)).length&&(o.attr("poster",i).find("video").attr("poster",i).end().find(".vjs-poster").css("background-image",'url("'+i+'")'),t.find("img").attr("src",i)),d.dropzone_video_thumb.forEach(function(e){e.saved=!0}),e.data.video_attachments&&m('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+e.data.video_attachment_id+'"]').attr("data-video-attachments",e.data.video_attachments),-1===i.toLowerCase().indexOf("video-placeholder.jpg")&&(m('.bb-activity-video-elem[data-id="'+l+'"]').removeClass("has-no-thumbnail"),m('a.bb-rl-video-cover-wrap[data-id="'+l+'"]').parent().removeClass("has-no-thumbnail")),d.closeEditThumbnailUploader(a)),n.removeClass("saving")}})},uploadVideoNavigate:function(e){e.preventDefault();var i=m(e.currentTarget),e=m(i).closest("#bp-video-uploader"),t=e.find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb");m(i).hasClass("bb-field-uploader-next")?(e.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),e.find("#bp-video-submit, #bp-video-prev, .bb-rl-video-open-create-popup-album.create-album, #bb-video-privacy").show(),0!==Number(m(e).find(".bb-rl-album-selected-id"))&&m(e).find(".location-album-list li.is_active").length&&m(e).find(".location-album-list").scrollTop(m(e).find(".location-album-list li.is_active").offset().top-m(e).find(".location-album-list").offset().top),t.find(".item span:not(.hidden)").each(function(e){0<e&&t.find(".item").width()>t.width()&&(t.find(".item span.hidden").append(t.find(".item span").eq(2)),t.find(".item .more_options").length||m('<span class="more_options">...</span>').insertAfter(t.find(".item span").eq(0)))})):(m(i).hide(),e.find("#bp-video-prev, .bb-rl-video-open-create-popup-album").hide(),e.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),e.closest("#bp-media-single-folder").length&&m("#bb-video-privacy").hide())},videoActivityActionButton:function(e){e.preventDefault();var i,t=m(e.currentTarget),o=m("body"),a=t.closest(".bb-rl-activity-video-elem");a.toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-rl-activity-video-elem").removeClass("is-visible"),a.find(".bb_rl_more_dropdown").toggleClass("open").closest(".activity-item").siblings().find(".bb-rl-activity-video-elem .bb_rl_more_dropdown").removeClass("open"),o.addClass("video_more_option_open"),a.length<1&&((i=t.closest(".bb-video-thumb")).toggleClass("is-visible").parent().siblings().find(".bb-video-thumb").removeClass("is-visible"),i.find(".bb_rl_more_dropdown").toggleClass("open").closest(".bb-video-thumb").parent().siblings().find(".bb_rl_more_dropdown").removeClass("open")),t.closest(".bb-rl-media-model-container").length&&t.closest(".bb-rl-more_dropdown-wrap").toggleClass("is-visible").find(".bb_rl_more_dropdown").toggleClass("open"),"a"!==e.currentTarget.tagName.toLowerCase()||t.hasClass("bb_rl_more_dropdown__action")||(a.removeClass("is-visible").find(".bb_rl_more_dropdown").removeClass("open"),t.closest(".bb-item-thumb").removeClass("is-visible"),o.removeClass("video_more_option_open"))},toggleSelectAllVideo:function(e){e.preventDefault();var i=m(e.currentTarget),e=!i.hasClass("selected");this.setVideoSelectionState(e),m("#bb-delete-video").length&&(e?m("#bb-delete-video").removeAttr("disabled"):m("#bb-delete-video").attr("disabled","disabled")),i.toggleClass("selected",e).data("bp-tooltip",e?c.i18n_strings.unselectall:c.i18n_strings.selectall)},setVideoSelectionState:function(e){var i=!0===e;m("#buddypress").find("#video-stream li").find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){m(this).prop("checked",i),m(this).closest(".bb-item-thumb").toggleClass("selected",i),m(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i?c.i18n_strings.unselect:c.i18n_strings.select)})},addSelectedClassToWrapper:function(e){var e=e.currentTarget;m(e).is(":checked")?(m(e).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",c.i18n_strings.unselect),m(e).closest(".bb-item-thumb").addClass("selected"),m("#bb-delete-video").length&&m("#bb-delete-video").removeAttr("disabled")):(m(e).closest(".bb-item-thumb").removeClass("selected"),m(e).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",c.i18n_strings.select),(e=m(".bp-nouveau #bb-select-deselect-all-video")).hasClass("selected")&&e.removeClass("selected"),m("#bb-delete-video").length&&m("#bb-delete-video").attr("disabled","disabled"))},submitVideo:function(l){var s,e,r=this,b=m(l.currentTarget),i=m("#bb-video-privacy");if(l.preventDefault(),b.hasClass("saving"))return!1;if(b.addClass("saving"),"bp-video-dropzone-content"===r.current_tab){var t=m("#bp-video-post-content").val(),o=m(l.currentTarget).closest(".open-popup").find(".bb-rl-album-selected-id").val();if(o.length&&0<parseInt(o))for(var a=r.dropzone_video.length,d=0;d<a;d++)r.dropzone_video[d].album_id=o;else o=r.album_id;t={action:"video_save",_wpnonce:g.video,videos:r.dropzone_video,content:t,album_id:o,group_id:r.video_group_id,privacy:i.val()},m("#bp-video-dropzone-content .bp-feedback").remove(),m.ajax({type:"POST",url:h,data:t,success:function(e){if(e.success){var i=m("#video-stream ul.video-list");i.length||location.reload(!0),m("#bp-media-single-album").length?(m("#media-stream ul.media-list").length||(m("#media-stream").html(m("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),m(".bb-videos-actions").show(),(a=m(".bb-photos-actions")).length&&a.show()),bp.Nouveau.inject("#media-stream ul.media-list",e.data.video,"prepend")):(i.length||(m("#video-stream .bb-rl-media-none").remove(),m("#video-stream").append('<ul class="video-list item-list bp-list bb-video-list grid"></ul>'),m(".bb-videos-actions").show()),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"));var t,o,a=m("#buddypress");e.data.video_personal_count&&((i=a.find(".bp-wrap .users-nav ul li#video-personal-li a span.count")).length?i.text(e.data.video_personal_count):((t=document.createElement("span")).setAttribute("class","count"),o=document.createTextNode(e.data.video_personal_count),t.appendChild(o),a.find(".bp-wrap .users-nav ul li#video-personal-li a").append(t))),e.data.video_group_count&&(o=a.find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count"),0<a.find(".bb-item-count").length&&"yes"!==BP_Nouveau.video.is_video_directory?(s=BP_Nouveau.dir_labels.hasOwnProperty("video")?1===parseInt(e.data.video_group_count)?BP_Nouveau.dir_labels.video.singular:BP_Nouveau.dir_labels.video.plural:"",a.find(".bb-item-count").html('<span class="bb-count">'+e.data.video_group_count+"</span> "+s)):o.length?o.text(e.data.video_group_count):((t=document.createElement("span")).setAttribute("class","count"),o=document.createTextNode(e.data.video_group_count),t.appendChild(o),a.find(".bp-wrap .groups-nav ul li#videos-groups-li a").append(t))),"yes"===f.is_video_directory&&(a.find(".video-type-navs ul.video-nav li#video-all a span.count").text(e.data.video_all_count),a.find(".video-type-navs ul.video-nav li#video-personal a span.count").text(e.data.video_personal_count),a.find(".video-type-navs ul.video-nav li#video-groups a span.count").text(e.data.video_group_count));for(var d=r.dropzone_video.length,n=0;n<d;n++)r.dropzone_video[n].saved=!0;r.closeUploader(l),jQuery(window).scroll()}else m("#bp-video-dropzone-content").prepend(e.data.feedback);b.removeClass("saving")}})}else"bp-existing-video-content"===r.current_tab?(e=[],m('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){e.push(m(this).val())}),t={action:"video_move_to_album",_wpnonce:g.video,medias:e,album_id:r.video_album_id,group_id:r.video_group_id},m("#bp-existing-video-content .bp-feedback").remove(),m.ajax({type:"POST",url:h,data:t,success:function(e){var i;e.success?(m("#video-stream ul.media-list").length||m("#video-stream").html(m("<ul></ul>").addClass("video-list item-list bp-list bb-video-list grid")),0<(i=m(".bb-video-actions")).length&&i.show(),bp.Nouveau.inject("#video-stream ul.video-list",e.data.video,"prepend"),m('.bp-existing-video-wrap .bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){m(this).closest("li").data("id")===m(this).val()&&m(this).closest("li").remove()}),jQuery(window).scroll(),r.closeUploader(l)):m("#bp-existing-video-content").prepend(e.data.feedback),b.removeClass("saving")}})):r.current_tab||(r.closeUploader(l),b.removeClass("saving"))},clearFolderLocationUI:function(e){e=jQuery(e.currentTarget).closest(".bb-rl-has-folderlocationUI");0<e.length&&(e.find(".bb-rl-location-album-list-wrap-main .bb-rl-location-album-list-wrap .location-album-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),e.find(".bb-rl-location-album-list-wrap-main .bb-rl-location-album-list-wrap .location-album-list li").show().children("span, i").show(),e.find(".location-folder-title").text(f.target_text),e.find(".location-folder-back").hide().closest(".bb-rl-has-folderlocationUI").find(".bb-rl-folder-selected-id").val("0"),e.find(".ac_document_search_folder").val(""),e.find(".bb-model-header h4 span").text("..."),e.find(".bb_rl_ac_document_search_folder_list ul").html("").parent().hide().siblings(".bb-rl-location-album-list-wrap").find(".location-album-list").show())},openUploader:function(e){var a,i,t=this,o=m(document);e.preventDefault(),this.moveToIdPopup=f.move_to_id_popup,this.moveToTypePopup=f.current_type,void 0!==window.Dropzone&&m("div.video-uploader-wrapper #video-uploader").length&&((e=m("#bp-video-uploader")).show(),e.find(".bb-field-steps.bb-field-steps-2").length&&(e=m(i="#bp-video-uploader.bp-video-uploader").find(".bb-rl-album-selected-id").val(),0!==Number(e)?(a=e,m(i).find("#bb-video-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&m.ajax({url:h,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){o.find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(o.find(".open-popup .bb-rl-location-album-list-wrap").hide(),o.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").show()):(o.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),o.find(".open-popup .bb-rl-location-album-list-wrap").show()),!1===e.data.create_album?o.find(".open-popup .bb-rl-video-open-create-popup-album").removeClass("create-album"):o.find(".open-popup .bb-rl-video-open-create-popup-album").addClass("create-album"),o.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),o.find(".open-popup .bb-rl-album-create-from").val("profile"),m(i).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),m(i).find(".bb-rl-location-album-list-wrap").append(e.data.html),m(i).find('ul.location-album-list span[data-id="'+a+'"]').trigger("click"),m(i).find(".bb-rl-album-selected-id").val(a)}})),o.on("click",i+" .location-album-list li span",function(e){e.preventDefault();var i=m(e.currentTarget),t=i.closest(".bb-rl-field-wrap"),o=m(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child");m(this).parent().hasClass("is_active")||(0!==o.data("id")&&o.remove(),m(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+m(this).attr("id")+'">'+m(this).text()+"</span>"),m(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a===m(e.currentTarget).data("id")?t.find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):t.find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),t.find(".bb-model-footer .bb-rl-media-move").hasClass("is-disabled")||((t.length?t:i.closest(".bb-field-wrap")).find(".bb-rl-album-selected-id").val(m(e.currentTarget).data("id")),e=i.closest("#bp-video-uploader").find("#bb-video-privacy"),0!==Number(i.data("id"))?(e.find("option").removeAttr("selected"),e.val(i.parent().data("privacy")),e.prop("disabled",!0)):(e.find("option").removeAttr("selected"),e.val("public"),e.prop("disabled",!1))))}),o.on("click",i+" .breadcrumb .item > span",function(e){var i,t;m(this).hasClass("is-disabled")||(i=(t=m(e.currentTarget)).closest(".bb-rl-field-wrap"),e=this.closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child"),i.find(".bb-rl-album-selected-id").val(0),i.find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),e.hasClass("is-disabled")&&e.remove(),a===t.data("id")?i.find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):i.find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),e=t.closest("#bp-video-uploader").find("#bb-video-privacy"),t=t.closest("#bp-video-uploader").find(".location-album-list li.is_active").data("privacy"),0!==Number(i.find(".bb-rl-album-selected-id").val())?(e.find("option").removeAttr("selected"),e.val(void 0===t?"public":t),e.prop("disabled",!0)):(e.find("option").removeAttr("selected"),e.val("public"),e.prop("disabled",!1)))}),t.video_dropzone_obj=new Dropzone("div.video-uploader-wrapper #video-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",g.video)}),t.video_dropzone_obj.on("addedfile",function(e){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3),e.dataURL||bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?m(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&m(e.previewElement).find(".dz-error-message span").text(c.connection_lost_error):(jQuery(".media-error-popup").length||m("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("queuecomplete",function(){m("#bp-video-uploader-modal-title").text(f.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){m("#bp-video-uploader-modal-title").text(f.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("uploadprogress",function(e){var i=m(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t;var o=t-e.upload.progress.toFixed(0)/100*t;e.upload.progress<=99?(m(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+f.i18n_strings.video_uploaded_text),i.style.strokeDashoffset=o):100===e.upload.progress&&(i.style.strokeDashoffset=t-.99*t,m(e.previewElement).find(".dz-progress-count").text("99% "+f.i18n_strings.video_uploaded_text))}),t.video_dropzone_obj.on("success",function(e,i){100===e.upload.progress&&(m(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,m(e.previewElement).find(".dz-progress-count").text("100% "+f.i18n_strings.video_uploaded_text),m(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.js_preview=m(e.previewElement).find(".dz-video-thumbnail img").attr("src"),i.data.saved=!1,t.dropzone_video.push(i.data)):(jQuery(".media-error-popup").length||m("body").append('<div id="bp-video-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+c.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),m(".bb-field-steps-1 #bp-video-next, #bp-video-submit").show(),m(".modal-container").addClass("modal-container--alert"),m(".bb-field-steps-1").addClass("controls-added"),m("#bp-video-submit").show(),m("#bp-video-uploader-modal-title").text(f.i18n_strings.uploading+"..."),m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid===t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeVideoAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(m("#bp-video-uploader-modal-status-text").text(""),m("#bp-video-next").hide(),m(".bb-field-steps-1").removeClass("controls-added"),m("#bp-video-submit").hide(),m(".modal-container").removeClass("modal-container--alert"))}))},openEditThumbnailUploader:function(e){var t=this;e.preventDefault();var o,a,i=m(document),d=m(e.currentTarget),n=d.attr("data-parent-activity-id"),l=d.attr("data-video-attachment-id"),s=d.attr("data-video-attachments"),r=d.attr("data-video-id"),b=d.closest(".bb-rl-activity-inner, #video-stream.video, #media-stream.media, .forums-video-wrap, .comment-item");b.length||(0<(e=m("#bp-media-single-album")).length?b=e.find("#media-stream").parent():d.closest("#bb-rl-media-model-container").length&&(b=0<d.closest(".bb-video-container.bb-media-container.group-video").length?d.closest(".bb-video-container.bb-media-container.group-video"):0<d.closest(".bb-rl-media-model-wrapper.bb-rl-video-theatre").siblings("#video-stream").length?d.closest(".bb-rl-media-model-wrapper.bb-rl-video-theatre").parent():m("ul.bb-rl-activity-list li#activity-"+n).find(".bb-rl-activity-inner"))),b.find(".bb-rl-video-thumbnail-uploader").addClass("opened-edit-thumbnail").show().removeClass("no_generated_thumb"),i.on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-auto-generated .bb-action-check-wrap",function(){m(this).closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled")}),i.on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail:not(.generating_thumb) .bb-rl-video-thumb-list li",function(e){e.preventDefault();e=m(this).find("input.bb-rl-custom-check");!1===e.prop("checked")&&(e.prop("checked",!0),m(this).closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled"))}),i.on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-dropzone-content",function(e){var i=m(this),e=m(e.target);e.hasClass("bb-rl-custom-check")||e.hasClass("bb-icon-l")||e.hasClass("dz-remove")||e.hasClass("dz-clickable")||e.hasClass("bb-rl-close-thumbnail-custom")||i.find(".bb-rl-video-thumbnail-custom").hasClass("is_hidden")||!i.find("input.bb-rl-custom-check").prop("checked")&&e.closest(".bb-rl-video-thumbnail-dropzone-content").hasClass("has_image")&&(i.find("input.bb-rl-custom-check").prop("checked",!0),i.closest(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").removeClass("is-disabled"))}),i.on("click",".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail .bb-rl-video-thumbnail-custom .bb-rl-close-thumbnail-custom",function(){var e=m(this),i=e.closest(".bb-rl-video-thumbnail-custom");e.siblings("img").attr("src","").parent().hide(),i.closest(".bb-rl-video-thumbnail-content").find(".bb-rl-video-thumbnail-uploader-wrapper").show(),i.siblings(".bb-action-check-wrap").find("input").prop("checked")&&(i.siblings(".bb-action-check-wrap").find("input").prop("checked",!1),e.closest(".bb-rl-video-thumbnail-dropzone-content").find(".bb-rl-video-thumbnail-submit").addClass("is-disabled")),i.addClass("is_hidden"),e.closest(".bb-rl-video-thumbnail-dropzone-content").removeClass("has_image")}),void 0!==window.Dropzone&&m("div.bb-rl-video-thumbnail-uploader.opened-edit-thumbnail div.bb-rl-video-thumbnail-uploader-wrapper .bb-rl-video-thumbnail-uploader-dropzone-select").length&&(o=".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail",n=m(".bb-rl-video-thumbnail-uploader"),m(o+" .bb-rl-video-edit-thumbnail-hidden-video-id").val(r),m(o+" .bb-rl-video-edit-thumbnail-hidden-attachment-id").val(l),t.videoThumbnailOptions.previewTemplate=document.getElementsByClassName("bb-rl-uploader-post-video-thumbnail-template").length?document.getElementsByClassName("bb-rl-uploader-post-video-thumbnail-template")[0].innerHTML:"",t.videoThumbnailOptions.thumbnailMethod="contain",t.videoThumbnailOptions.thumbnailWidth=null,t.videoThumbnailOptions.thumbnailHeight="300",t.video_thumb_dropzone_obj=new Dropzone(o+" .bb-rl-video-thumbnail-uploader-dropzone-select",t.videoThumbnailOptions),t.video_thumb_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_thumbnail_upload"),t.append("_wpnonce",g.video)}),t.video_thumb_dropzone_obj.on("addedfile",function(e){e.video_thumbnail_edit_data?(t.dropzone_video_thumb.push(e.video_thumbnail_edit_data),m(o+" .bb-rl-video-thumbnail-uploader-wrapper .dropzone.dz-clickable").addClass("dz-max-files-reached"),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").show()):setTimeout(function(){t.video_thumb_dropzone_obj.getAcceptedFiles().length&&m(o+" .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_thumb_dropzone_obj.on("uploadprogress",function(e){var i=m(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t,i.style.strokeDashoffset=t,i.style.strokeDashoffset=t-e.upload.progress.toFixed(0)/100*t}),t.video_thumb_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?m(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&m(e.previewElement).find(".dz-error-message span").text(c.connection_lost_error):(jQuery(".media-error-popup").length||m("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup video-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+c.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").hide())}),t.video_thumb_dropzone_obj.on("queuecomplete",function(){m(o+" .bb-rl-video-thumbnail-uploader-modal-title").text(f.i18n_strings.upload_thumb)}),t.video_thumb_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,i.data.js_preview=m(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video_thumb.push(i.data)):(jQuery(".media-error-popup").length||m("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+c.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),m(o+" .bb-rl-video-thumbnail-submit").removeClass("is-disabled"),m(o+" .bb-rl-video-thumbnail-uploader-modal-title").text(f.i18n_strings.uploading+"..."),m(o+" .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)),m(o+" .bb-rl-video-thumbnail-dropzone-content").addClass("has_image"),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-rl-custom-check").prop("checked",!0),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-rl-video-thumbnail-custom.is_hidden").removeClass("is_hidden")}),t.video_thumb_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video_thumb.length)for(var i in t.dropzone_video_thumb)if(e.upload.uuid===t.dropzone_video_thumb[i].uuid){void 0===t.dropzone_video_thumb[i].saved||t.dropzone_video_thumb[i].saved||t.removeVideoThumbnailAttachment(t.dropzone_video_thumb[i].id),t.dropzone_video_thumb.splice(i,1);break}t.video_thumb_dropzone_obj.getAcceptedFiles().length?m(o+" .bb-rl-video-thumbnail-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video_thumb.length,t.video_thumb_dropzone_obj.getAcceptedFiles().length)).show():(m(o+" .bb-rl-video-thumbnail-uploader-modal-status-text").text(""),m(o+" .bb-rl-video-thumbnail-submit").addClass("is-disabled"),m(".bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap input:checked")&&(m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap input").prop("checked",!1),m(o+" .bb-rl-video-thumbnail-dropzone-content").removeClass("has_image"),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-action-check-wrap").hide(),m(o+" .bb-rl-video-thumbnail-dropzone-content .bb-rl-video-thumbnail-custom img").attr("src","").parent().hide()))}),void 0!==s&&(a="",void 0!==(s=JSON.parse(s)).default_images?(m.each(s.default_images,function(e,i){var t="";void 0!==s.selected_id&&void 0!==s.selected_id.id&&i.id===s.selected_id.id&&(t='checked="checked"'),void 0!==i.url&&(a+='<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3">',a+='<div class="">',a+="<input "+t+' id="bb-video-'+i.id+'" class="bb-rl-custom-check" type="radio" value="'+i.id+'" name="bb-video-thumbnail-select" />',a+='<label class="bp-tooltip" data-bp-tooltip-pos="up" data-bp-tooltip="Select" for="bb-video-'+i.id+'"><span class="bb-icon-l bb-icon-check"></span></label>',a+='<a class="" href="#">',a+='<img src="'+i.url+'" class="" alt=""/>',a+="</a>",a+="</div>",a+="</li>")}),""!==a&&(m(o+" .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").removeClass("loading"),m(o+" .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").html(a),n.removeClass("generating_thumb"),s.default_images.length<2&&f.is_ffpmeg_installed&&(n.addClass("generating_thumb"),m(o+" .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-spinner bb-icon-l animate-spin"></i><span>'+f.generating_thumb+"</span></div></li>"),m(o+" .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-spinner bb-icon-l animate-spin"></i><span>'+f.generating_thumb+"</span></div></li>")))):m(b).find(".bb-rl-video-thumbnail-uploader").addClass("no_generated_thumb"),void 0!==s.preview&&void 0!==s.preview.dropzone&&!0===s.preview.dropzone&&(m(o+" .bb-rl-video-thumbnail-custom").show(),m(o+" .bb-rl-video-thumbnail-custom img").attr("src",s.preview.url),m(o+" .bb-rl-video-thumbnail-dropzone-content").addClass("has_image"),m(o+" .bb-rl-video-thumbnail-dropzone-content").find("input").prop("checked",!0),m(o+" .bb-rl-video-thumbnail-uploader-wrapper").hide(),(i=m("#bb_rl_custom_image_ele")).find("input").attr("id","bb-video-"+s.preview.attachment_id),i.find("label").attr("for","bb-video-"+s.preview.attachment_id),i.find("input").val(s.preview.attachment_id),void 0!==s.selected_id&&s.preview.attachment_id===s.selected_id.id&&i.find("input").attr("checked","checked")),void 0!==s.selected_id&&m(b).find(".bb-rl-video-thumbnail-uploader #bb-video-"+s.selected_id.id).prop("checked",!0)),r={action:"video_get_edit_thumbnail_data",_wpnonce:g.video,attachment_id:l,video_id:r},f.is_ffpmeg_installed&&(void 0===s.default_images||s.default_images.length<2)?(this.thumbnail_xhr&&this.thumbnail_xhr.abort(),n.addClass("generating_thumb").removeClass("no_generated_thumb"),this.getEditVideoThumbnail(r),this.thumbnail_interval=setInterval(bp.Nouveau.Video.getEditVideoThumbnail,6e3,r)):(m(o+" .bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list").removeClass("loading"),n.removeClass("generating_thumb")))},getEditVideoThumbnail:function(e){0===bp.Nouveau.Video.thumbnail_max_interval&&clearTimeout(bp.Nouveau.Video.thumbnail_interval),bp.Nouveau.Video.thumbnail_xhr=m.ajax({type:"POST",url:h,data:e,cache:!1,success:function(e){var i,t,o;e.success?(bp.Nouveau.Video.thumbnail_max_interval--,"yes"===e.data.ffmpeg_generated&&clearTimeout(bp.Nouveau.Video.thumbnail_interval),t=(i=m(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail")).find(".bb-rl-video-thumbnail-auto-generated ul.bb-rl-video-thumb-list"),e.data.default_images&&(t.html(""),t.html(e.data.default_images)),e.data.ffmpeg_generated&&"no"===e.data.ffmpeg_generated&&t.html(""),o=t.find("li"),e=t.find("li.bb_rl_thumb_loader"),o.find("li").length<2?(i.addClass("generating_thumb").removeClass("no_generated_thumb"),0===e.length&&(t.append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-l bb-icon-spinner animate-spin"></i><span>'+f.generating_thumb+"</span></div></li>"),t.append('<li class="lg-grid-1-5 md-grid-1-3 sm-grid-1-3 bb_rl_thumb_loader"><div class="bb-rl-video-thumb-block"><i class="bb-icon-l bb-icon-spinner animate-spin"></i><span>'+f.generating_thumb+"</span></div></li>"))):0===e.length&&i.removeClass("generating_thumb no_generated_thumb")):clearTimeout(bp.Nouveau.Video.thumbnail_interval)},error:function(){clearTimeout(bp.Nouveau.Video.thumbnail_interval)}})},createThumbnailFromUrl:function(i){var t=this;t.video_thumb_dropzone_obj.createThumbnailFromUrl(i,t.video_thumb_dropzone_obj.options.thumbnailWidth,t.video_thumb_dropzone_obj.options.thumbnailHeight,t.video_thumb_dropzone_obj.options.thumbnailMethod,!0,function(e){t.video_thumb_dropzone_obj.emit("thumbnail",i,e),t.video_thumb_dropzone_obj.emit("complete",i)})},closeEditThumbnailUploader:function(e){e.preventDefault();e=m(".bb-rl-video-thumbnail-uploader.opened-edit-thumbnail");e.find(".bb-rl-video-thumbnail-uploader-modal-title").text(f.i18n_strings.upload_thumb),m(".bb-rl-video-thumbnail-uploader-modal-status-text").text(""),m(".bb-rl-video-thumbnail-uploader-wrapper .bb-rl-video-thumbnail-uploader-dropzone-select").html(""),this.video_thumb_dropzone_obj&&(this.video_thumb_dropzone_obj.destroy(),this.dropzone_video_thumb=[]),e.hide().removeClass("opened-edit-thumbnail"),m(".bb-rl-video-thumbnail-uploader").find(".bb-rl-video-thumbnail-submit").addClass("is-disabled"),m(window).scroll(),clearTimeout(bp.Nouveau.Video.thumbnail_interval)},openAlbumUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&m("div#video-album-uploader").length&&(m("#bp-video-uploader").show(),t.video_dropzone_obj=new Dropzone("div#video-album-uploader",t.videoOptions),t.video_dropzone_obj.on("sending",function(e,i,t){t.append("action","video_upload"),t.append("_wpnonce",g.video)}),t.video_dropzone_obj.on("addedfile",function(){setTimeout(function(){t.video_dropzone_obj.getAcceptedFiles().length&&m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.video_dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?m(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&m(e.previewElement).find(".dz-error-message span").text(c.connection_lost_error):(jQuery(".media-error-popup").length||m("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+c.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.video_dropzone_obj.on("queuecomplete",function(){m("#bp-video-uploader-modal-title").text(f.i18n_strings.upload)}),t.video_dropzone_obj.on("processing",function(){m("#bp-video-uploader-modal-title").text(f.i18n_strings.uploading+"...")}),t.video_dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_video.length,i.data.album_id=t.video_album_id,i.data.group_id=t.video_group_id,i.data.saved=!1,i.data.js_preview=m(e.previewElement).find(".dz-video-thumbnail img").attr("src"),t.dropzone_video.push(i.data)):(jQuery(".media-error-popup").length||m("body").append('<div id="bb-rl-video-move-popup" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+c.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-rl-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),m("#bp-video-submit").show(),m("#bp-video-uploader-modal-title").text(f.i18n_strings.uploading+"..."),m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show()}),t.video_dropzone_obj.on("removedfile",function(e){if(t.dropzone_video.length)for(var i in t.dropzone_video)if(e.upload.uuid===t.dropzone_video[i].uuid){void 0===t.dropzone_video[i].saved||t.dropzone_video[i].saved||t.removeVideoAttachment(t.dropzone_video[i].id),t.dropzone_video.splice(i,1);break}t.video_dropzone_obj.getAcceptedFiles().length?m("#bp-video-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_video.length,t.video_dropzone_obj.getAcceptedFiles().length)).show():(m("#bp-video-uploader-modal-status-text").text(""),m("#bp-video-submit").hide())}))},removeVideoAttachment:function(e){this.removeVideoAndThumbnailAttachment(e,"media",g.media)},removeVideoThumbnailAttachment:function(e){this.removeVideoAndThumbnailAttachment(e,"video_thumbnail",g.video)},closeUploader:function(e){e.preventDefault(),m("#bp-video-uploader").hide(),m("#bp-video-uploader-modal-title").text(f.i18n_strings.upload),m("#bp-video-uploader-modal-status-text").text(""),m("#bp-video-dropzone-content .bp-feedback").remove(),this.video_dropzone_obj&&this.video_dropzone_obj.destroy(),this.dropzone_video=[],m("#bp-video-post-content").val(""),m(".bb-rl-close-create-popup-album").trigger("click"),m(".bb-rl-close-create-popup-folder").trigger("click");var i=m(e.target).closest("#bp-video-uploader");i.find('.bb-rl-breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),i.find(".bb-field-steps").length&&(i.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),i.find(".bb-field-steps-1 #bp-video-next").hide(),i.find(".bb-field-steps-1").removeClass("controls-added"),i.find("#bp-video-prev, #bp-video-submit, .bb-rl-video-open-create-popup-album, .bb-rl-create-popup-album-wrap").hide()),this.clearFolderLocationUI(e)},toggle_video_uploader:function(){this.open_video_uploader()},open_video_uploader:function(){if(this.$el.find("#activity-post-media-uploader").hasClass("open"))return!1},deleteVideo:function(e){var n,l=this,s=m(e.currentTarget);e.preventDefault();var r,b=[],c=m("#buddypress"),e=s.attr("data-type"),p=s.data("item-from"),v=s.data("root-parent-activity-id"),u="";if("video"===e&&!confirm(f.i18n_strings.video_delete_confirm))return!1;if(s.hasClass("bb-delete")){if(!confirm(f.i18n_strings.video_delete_confirm))return!1;c.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){m(this).closest(".bb-video-thumb").addClass("loading deleting"),b.push(m(this).val())})}if(r=s.data("parent-activity-id"),p&&p.length&&"activity"===p&&0===b.length&&(u=s.attr("data-item-id"),b.push(u)),0===b.length&&b.push(s.data("item-id")),0===b.length)return!1;s.prop("disabled",!0),m("#buddypress #video-stream.video .bp-feedback").remove();e={action:"video_delete",_wpnonce:g.video,video:b,activity_id:r,from_where:p};m.ajax({type:"POST",url:h,data:e,success:function(e){var i,t,o,a,d;p&&p.length&&"activity"===p?e.success&&(m.each(b,function(e,i){var t=m('#activity-stream ul.bb-rl-activity-list li.activity .activity-content .activity-inner .bb-activity-video-wrap div[data-id="'+i+'"]');t.length&&t.remove();i=m("body .bb-activity-video-elem."+i);i.length&&i.remove()}),0===m('#activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+r+'"] .activity-content .activity-inner .bb-activity-video-elem').length&&m('#activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+r+'"]').remove(),!0===e.data.delete_activity?(m("body #buddypress .bb-rl-activity-list li#activity-"+r).remove(),m("body .bb-activity-video-elem.video-activity."+u).remove(),m("body .activity-comments li#acomment-"+r).remove(),v&&m(".bb-rl-activity-list").length&&(0===(o=m(".bb-rl-activity-list li#activity-"+v+" .activity-comments > ul > li").length)?(m(".bb-rl-activity-list li#activity-"+v+" .activity-comments ul").remove(),(i=m(".bb-rl-activity-list li#activity-"+v+" .activity-state .activity-state-comments .comments-count")).length&&(t=y.strings.commentLabel,i.text(t.replace("%d",0))),m(".bb-rl-activity-list li#activity-"+v+" .activity-content .activity-state").removeClass("has-comments")):(d=parseInt(o),(o=m(".bb-rl-activity-list li#activity-"+v+" .activity-state .activity-state-comments .comments-count")).length&&(a=1<d?y.strings.commentsLabel:y.strings.commentLabel,o.text(a.replace("%d",d)))))):m("body #buddypress .bb-rl-activity-list li#activity-"+r).replaceWith(e.data.activity_content)):p&&p.length&&"video"===p?e.success&&("yes"===f.is_video_directory?(a=bp.Nouveau.getStorage("bp-video").scope,d=m(document),("personal"===a?d.find('#bb-rl-video-scope-options option[data-bp-scope="personal"]'):"groups"===a?d.find('#bb-rl-video-scope-options option[data-bp-scope="groups"]'):d.find('#bb-rl-video-scope-options option[data-bp-scope="all"]')).prop("selected",!0),d.find("#bb-rl-video-scope-options").trigger("change")):(e.data.video_personal_count&&c.find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),void 0!==e.data&&void 0!==e.data.video_group_count&&(0<m("#buddypress .bb-item-count").length&&"yes"!==BP_Nouveau.video.is_video_directory?(n=BP_Nouveau.dir_labels.hasOwnProperty("video")?1===parseInt(e.data.video_group_count)?BP_Nouveau.dir_labels.video.singular:BP_Nouveau.dir_labels.video.plural:"",m("#buddypress .bb-item-count").html('<span class="bb-count">'+e.data.video_group_count+"</span> "+n)):m("#buddypress").find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count)),0!==e.data.video_html_content.length?0===parseInt(e.data.video_personal_count)?(m(".bb-videos-actions").hide(),m("#video-stream").html(e.data.video_html_content)):c.find(".video-list:not(.existing-video-list)").html(e.data.video_html_content):0!==e.data.group_video_html_content.length?0===parseInt(e.data.video_group_count)?(m(".bb-videos-actions").hide(),m("#video-stream").html(e.data.group_video_html_content)):c.find(".video-list:not(.existing-video-list)").html(e.data.group_video_html_content):m.each(b,function(e,i){var t=m('#video-stream ul.video-list li[data-id="'+i+'"]');t.length&&t.remove();i=m('#media-stream ul.media-list li[data-id="'+i+'"]');l.video_album_id&&i.length&&i.remove()}))):(setTimeout(function(){s.prop("disabled",!1)},500),e.success?(void 0!==e.data&&void 0!==e.data.video_personal_count&&c.find(".bp-wrap .users-nav ul li#video-personal-li a span.count").text(e.data.video_personal_count),void 0!==e.data&&void 0!==e.data.video_group_count&&c.find(".bp-wrap .groups-nav ul li#videos-groups-li a span.count").text(e.data.video_group_count),0!==e.data.video_html_content.length?0===parseInt(e.data.video_personal_count)?(m(".bb-videos-actions").hide(),m("#video-stream").html(e.data.video_html_content)):c.find(".video-list:not(.existing-video-list)").html(e.data.video_html_content):0!==e.data.group_video_html_content.length?0===parseInt(e.data.video_group_count)?(m(".bb-videos-actions").hide(),m("#video-stream").html(e.data.group_video_html_content)):c.find(".video-list:not(.existing-video-list)").html(e.data.group_video_html_content):c.find(".video-list:not(.existing-video-list)").find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){m(this).closest("li").remove()})):m("#buddypress #video-stream.video").prepend(e.data.feedback));e=m(".bp-nouveau #bb-select-deselect-all-video");e.hasClass("selected")&&e.removeClass("selected"),jQuery(window).scroll()}})},bp_ajax_video_request:function(e,i){void 0!==f.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0===parseInt(i.response.scopes.groups)?m(".bb-videos-actions").hide():f.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0!==parseInt(i.response.scopes.groups)?m(".bb-videos-actions").show():void 0!==i&&void 0!==i.response.scopes.personal&&0===parseInt(i.response.scopes.personal)?m(".bb-videos-actions").hide():void 0!==i&&void 0!==i.response.scopes.personal&&0!==parseInt(i.response.scopes.personal)&&m(".bb-videos-actions").show()},deleteVideoThumb:function(e){var i=m(e.currentTarget);e.preventDefault();var o=m(".bb-rl-video-edit-thumbnail-hidden-video-id").val(),a=m(".bb-rl-video-edit-thumbnail-hidden-attachment-id").val(),i=i.closest(".bb-dropzone-wrap").find("input").val();m.ajax({type:"POST",url:h,data:{action:"video_thumbnail_delete",_wpnonce:g.video,video_id:o,attachment_id:a,video_attachment_id:i},success:function(e){var i,t;e.data.video_attachments&&m('.video-action_list .edit_thumbnail_video a[data-video-attachment-id="'+a+'"]').attr("data-video-attachments",e.data.video_attachments),!e.data.thumbnail_id||0===e.data.thumbnail_id||(t=m("#bb-video-"+e.data.thumbnail_id)).length&&(t.prop("checked",!0),m(".bb-rl-video-thumbnail-submit").removeClass("is-disabled")),e.data.thumbnail&&((i=m('.bb-video-thumb a.bb-rl-video-cover-wrap[data-id="'+o+'"]')).find("img").length&&i.find("img").attr("src",e.data.thumbnail),(t=m('.bb-activity-video-elem a.bb-rl-video-cover-wrap[data-id="'+o+'"]')).find("img").length&&t.find("img").attr("src",e.data.thumbnail),(t=m('.bb-activity-video-elem .video-js[data-id="'+o+'"]')).find(".vjs-poster").length&&t.attr("poster",e.data.thumbnail).find("video").attr("poster",e.data.thumbnail).end().find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),(t=m("#bb-rl-theatre-video-"+o)).length&&(t.attr("poster",e.data.thumbnail).find("video").attr("poster",e.data.thumbnail).end().find(".vjs-poster").css("background-image",'url("'+e.data.thumbnail+'")'),i.find("img").attr("src",e.data.thumbnail)))}})},openCreateVideoAlbumModal:function(e){e.preventDefault(),this.openAlbumUploader(e),m("#bp-video-create-album").show()},closeCreateVideoAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),m("#bp-video-create-album").hide(),m("#bb-album-title").val("").removeClass("error")},saveAlbum:function(e){bp.Nouveau.Media.saveItem(e,"album","video")},injectVideos:function(e){bp.Nouveau.Media.injectAttachments(e,"video")},openVideoMove:function(e){e.preventDefault();var i=m(e.currentTarget),a=m(document),d=i.closest(".video-action-wrap").siblings("a, div.video-js").data("id"),t=i.closest(".video-action-wrap").siblings("a, div.video-js").data("album-id");this.moveToIdPopup=i.attr("id"),this.moveToTypePopup=i.attr("data-type"),(e=i.closest(".bb-rl-activity-inner, #media-stream.media, #video-stream.video, .comment-item")).find(".bb-rl-video-move-file").addClass("open").show(),e.find(".bb-rl-video-move").attr("id",d),e.find(".bb-rl-model-footer .bb-rl-video-move").addClass("is-disabled");var o=i.closest(".bb_rl_more_dropdown").closest("li.comment-item").length?"#"+i.closest(".bb_rl_more_dropdown").closest("li").attr("id")+".comment-item .bb-rl-video-move-file":"#"+i.closest("li.activity-item").attr("id")+" > .bb-rl-activity-content .bb-rl-video-move-file";m(o).find(".bb-rl-document-move").attr("id",i.closest(".bb-rl-document-activity").attr("data-id")),(0<i.closest(".media-list").length||0<i.closest(".video-list").length)&&(o=".bb-rl-video-move-file"),"group"===this.moveToTypePopup?a.find(".bb-rl-location-album-list-wrap h4").show():a.find(".bb-rl-location-album-list-wrap h4").hide(),m(o).addClass("open-popup"),m(o).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),m(o).find(".bb-rl-location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>');var n=t,l=this.moveToTypePopup;""!==this.moveToIdPopup&&m.ajax({url:h,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){var i=a.find(".open-popup");a.find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-video").html(e.data.first_span_text),i.find(".bb-rl-location-album-list-wrap").toggle(""!==e.data.html),i.find(".bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").toggle(""===e.data.html),"group"===l?(a.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").hide(),i.find(".bb-rl-album-create-from").val("group")):(a.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),i.find(".bb-rl-album-create-from").val("profile")),i.find(".bb-rl-video-open-create-popup-album").toggleClass("create-album",e.data.create_album).toggle(e.data.create_album),m(o).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),m(o).find(".bb-rl-location-album-list-wrap").append(e.data.html),m(o).find("ul.location-album-list span#"+n).trigger("click")}}),a.on("click",o+" .location-album-list li span",function(e){e.preventDefault();var i,t=m(e.currentTarget),o=m(e.currentTarget);t.parent().hasClass("is_active")||(0!==(i=t.closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child")).data("id")&&i.remove(),t.closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+t.attr("id")+'">'+t.text()+"</span>"),t.addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),e=a.find('a.bb-open-video-theatre[data-id="'+d+'"]').data("album-id"),t=(i=o.closest(".bb-rl-video-move-file")).find(".bb-rl-model-footer .bb-rl-video-move"),Number(e)===Number(o.data("id"))?t.addClass("is-disabled"):t.removeClass("is-disabled"),t.hasClass("is-disabled")||i.find(".bb-rl-album-selected-id").val(o.data("id")))}),a.on("click",o+" .breadcrumb .item > span",function(e){var i,t=m(e.currentTarget);t.hasClass("is-disabled")||((i=t.closest(".bb-rl-video-move-file")).find(".bb-rl-album-selected-id").val(0),i.find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),(e=t.closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child")).hasClass("is-disabled")&&e.remove(),i=i.find(".bb-rl-model-footer .bb-rl-video-move"),n===t.data("id")?i.addClass("is-disabled"):i.removeClass("is-disabled"))})},createAlbumInPopup:function(e){e.preventDefault(),bp.Nouveau.Media.createAlbumFolderInPopup(e,"video","album")},closeVideoMove:function(e){e.preventDefault();var i=m(e.currentTarget),e=i.closest(".bb-rl-video-move-file").find(".bb-rl-location-album-list-wrap .breadcrumb .item span:last-child");0!==e.data("id")&&e.remove(),i.closest(".bb-rl-video-move-file").hide()},moveVideoIntoAlbum:function(e){bp.Nouveau.Media.moveAttachments(e,"video","album")},submitCreateAlbumInPopup:function(e){e.preventDefault(),bp.Nouveau.Media.submitCreateFolderAlbumInPopup(e,"video","album")},bb_video_after_load:function(){m(".video-list.bb-video-list").children().length&&m(".bb-videos-actions").show()}},bp.Nouveau.Video.start(),bp.Nouveau.Video.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.videos=[],this.current_video=!1,this.is_open_video=!1,this.nextVideoLink=m(".bb-rl-next-media"),this.previousVideoLink=m(".bb-rl-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==f.group_id&&f.group_id},addListeners:function(){var e=m(document);e.on("click",".bb-open-video-theatre",this.openTheatre.bind(this)),e.on("click",".bb-rl-close-media-theatre",this.closeTheatre.bind(this)),e.on("click",".bb-rl-prev-media",this.previous.bind(this)),e.on("click",".bb-rl-next-media",this.next.bind(this)),e.on("click",".bp-add-video-activity-description",this.openVideoActivityDescription.bind(this)),e.on("click","#bp-activity-description-new-reset",this.closeVideoActivityDescription.bind(this)),e.on("keyup",".bp-edit-video-activity-description #add-activity-description",this.MediaActivityDescriptionUpdate.bind(this)),e.on("click","#bp-activity-description-new-submit",this.submitVideoActivityDescription.bind(this)),e.on("bp_activity_ajax_delete_request_video",this.videoActivityDeleted.bind(this)),e.on("click",".bb-rl-video-thumb",this.handleThumbnailClick.bind(this))},openTheatre:function(e){e.preventDefault();var i=m(e.currentTarget),t=this;if(i.closest("#bp-existing-video-content").length)return!1;this.current_activity_data=i.closest(".activity-item").data("bp-activity");var o=i.closest(".activity-item").data("activity-popup-title");t.setupGlobals(),t.setVideos(i),e=i.data("id"),t.setCurrentVideo(e),t.showVideo(),t.navigationCommands(),t.current_activity_data&&t.generateAndDisplayVideoThumbnails(i),m(".bb-rl-media-model-wrapper .bb-rl-media-model-header h2").text(o),void 0!==y&&t.current_video&&void 0!==t.current_video.activity_id&&0!==t.current_video.activity_id&&!t.current_video.is_forum&&"comment"!==t.current_video.privacy?t.getActivity():t.getVideosDescription(),m(".bb-rl-media-model-wrapper.media").hide(),m(".bb-rl-media-model-wrapper.document").hide(),m(".bb-rl-media-model-wrapper.video").show(),t.is_open_video=!0},closeTheatre:function(e){e.preventDefault();var i=m(e.currentTarget).closest(".bb-rl-media-model-wrapper");if(i.hasClass("bb-rl-media-theatre")||i.hasClass("bb-rl-document-theatre"))return!1;e=m(".bb-rl-media-model-wrapper.video .bb-rl-media-section").find("video");e.length&&videojs(e.attr("id")).reset(),m(".bb-rl-media-model-wrapper").hide(),this.is_open_video=!1,this.resetRemoveActivityCommentsData(),i.find("figure").removeClass("has-no-thumbnail"),this.current_video=!1},getVideosDescription:function(){var o=this;m(".bb-media-info-section .bb-rl-activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!==o.activity_ajax&&o.activity_ajax.abort();var e=m('[data-bp-activity-id="'+o.current_video.activity_id+'"] .activity-comments');e.length&&(o.current_video.parent_activity_comments=!0,e.html("")),!0===o.current_video.parent_activity_comments&&m(".bb-rl-media-model-wrapper:last").after('<input type="hidden" value="'+o.current_video.activity_id+'" id="hidden_parent_id"/>'),o.activity_ajax=m.ajax({type:"POST",url:h,data:{action:"video_get_video_description",id:o.current_video.id,attachment_id:o.current_video.attachment_id,nonce:g.video},success:function(e){var i,t=m(".bb-rl-media-model-wrapper.video");!0===e.success&&0<t.filter(":visible").length?((i=t.find(".bb-rl-media-section")).html(e.data.video_data),i.find("video").attr("autoplay",!0),m(".bb-media-info-section:visible .bb-rl-activity-list").removeClass("loading").html(e.data.description),m(".bb-media-info-section:visible").show(),o.updateTheaterHeaderTitle({wrapper:t,action:"video"}),m(window).scroll()):m(".bb-media-info-section.media").hide()}})},setVideos:function(e){var i=m(".bb-open-video-theatre"),t=0;if(void 0!==(i=m("body").hasClass("activity")?m(e).closest(".bb-activity-video-wrap").find(".bb-open-video-theatre"):i)){this.videos=[];for(var o=i.length,t=0;t<o;t++){var a,d=m(i[t]);d.closest("#bp-existing-media-content").length||(a={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),is_forum:!1},d.closest(".forums-video-wrap").length&&(a.is_forum=!0),a.is_message=void 0!==a.privacy&&"message"===a.privacy,a.thumbnail_class="",(d.closest(".bb-activity-video-elem").hasClass("has-no-thumbnail")||d.closest(".bb-video-thumb").hasClass("has-no-thumbnail"))&&(a.thumbnail_class="has-no-thumbnail"),this.videos.push(a))}}},setCurrentVideo:function(e){for(var i=this,t=i.videos.length,o=0;o<t;o++)if(e===i.videos[o].id){i.current_video=i.videos[o],i.current_index=o;break}},showVideo:function(){var e=this;if(void 0===e.current_video)return!1;m(".bb-rl-media-model-wrapper.video .bb-rl-media-section").find("figure").addClass("loading").html('<i class="bb-rl-loader"></i>');var i,t=m(".bb-rl-media-section .bb-media-privacy-wrap");t.length&&(t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.media-privacy").find("li[data-value="+e.current_video.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_video.privacy),(void 0!==y&&void 0!==e.current_video.activity_id&&0!==e.current_video.activity_id||e.group_id||e.current_video.is_forum||e.current_video.group_id||e.current_video.album_id||e.current_video.is_message)&&t.hide()),m(".bb-rl-media-model-wrapper.video").find("figure").removeClass("has-no-thumbnail").addClass(e.current_video.thumbnail_class),e.navigationCommands()},navigationCommands:function(){var e=this;0===e.current_index&&e.current_index!==e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.show()):0===e.current_index&&e.current_index===e.videos.length-1?(e.previousVideoLink.hide(),e.nextVideoLink.hide()):e.current_index===e.videos.length-1?(e.previousVideoLink.show(),e.nextVideoLink.hide()):(e.previousVideoLink.show(),e.nextVideoLink.show())},next:function(e){if(e.preventDefault(),m(e.currentTarget).closest(".bb-rl-internal-model").hasClass("media-video"))return!1;var i=this;i.current_activity_data&&i.videos[i.current_index+1]?i.updateVideoState(i.videos[i.current_index+1],m(".video.bb-rl-video-theatre .bb-rl-video-thumb").eq(i.current_index+1)):void 0!==i.videos[i.current_index+1]?(i.current_index=i.current_index+1,e=i.current_video.activity_id,i.current_video=i.videos[i.current_index],i.showVideo(),e!==i.current_video.activity_id&&"comment"!==i.current_video.privacy?i.getActivity():i.getVideosDescription()):i.nextLink.hide()},previous:function(e){if(e.preventDefault(),m(e.currentTarget).closest(".bb-rl-internal-model").hasClass("media-video"))return!1;var i=this;i.current_activity_data&&i.videos[i.current_index-1]?i.updateVideoState(i.videos[i.current_index-1],m(".video.bb-rl-video-theatre .bb-rl-video-thumb").eq(i.current_index-1)):void 0!==i.videos[i.current_index-1]?(i.current_index=i.current_index-1,e=i.current_video.activity_id,i.current_video=i.videos[i.current_index],i.showVideo(),e!==i.current_video.activity_id&&"comment"!==i.current_video.privacy?i.getActivity():i.getVideosDescription()):i.previousLink.hide()},generateAndDisplayVideoThumbnails:function(e){var i,t,o=this;o.current_activity_data=e.closest(".activity-item").data("bp-activity"),!o.current_activity_data||!o.current_activity_data.video||o.current_activity_data.video.length<=1||(i=o.current_activity_data.video.map(function(e){var i=e.thumb||BP_Nouveau.activity.strings.video_default_url;return'<div class="bb-rl-video-thumb'+(e.id===o.current_video.id?" active":"")+'" data-id="'+e.id+'" data-vid-id="'+e.vid_id+'" data-activity-id="'+e.activity_id+'"><img src="'+i+'" alt="'+(e.name||"")+'" data-video-url="'+e.url+'"/></div>'}).join(""),(e=(t=m(".video.bb-rl-video-theatre .bb-rl-media-section")).find(".bb-rl-video-thumb-list")).length?e.html(i):t.append('<div class="bb-rl-video-thumb-list">'+i+"</div>"))},updateVideoState:function(e,i,t){var o,a,d,n=this;i.hasClass("active")||((o=m(".bb-rl-media-model-wrapper.video .bb-rl-media-section").find("figure")).find(".video-js").hide(),o.addClass("loading").append('<i class="bb-rl-loader"></i>'),a="object"==typeof e?e.id:e,n.current_index=n.videos.findIndex(function(e){return e.id===a}),n.current_video="object"==typeof e?e:m.extend({},n.current_video,{id:a,activity_id:i.data("activity-id")}),n.nextVideoLink&&n.previousVideoLink&&(n.nextVideoLink.toggle(Boolean(n.videos[n.current_index+1])),n.previousVideoLink.toggle(Boolean(n.videos[n.current_index-1]))),m(".bb-rl-video-thumb").removeClass("active"),i.addClass("active"),void 0!==y&&n.current_video&&void 0!==n.current_video.activity_id&&0!==n.current_video.activity_id&&!n.current_video.is_forum&&"comment"!==n.current_video.privacy?n.getActivity():t||n.getVideosDescription(),d=n.activity_ajax.success,n.activity_ajax.success=function(e){var i;!e.success||(i=o.find(".video-js")).length&&i.one("loadeddata",function(){o.removeClass("loading").find(".bb-rl-loader").remove(),i.show()}).one("error",function(){o.removeClass("loading").find(".bb-rl-loader").remove()}),d&&d.apply(this,arguments)})},handleThumbnailClick:function(e){e.preventDefault();e=m(e.currentTarget);this.updateVideoState(e.data("id"),e,!0)},resetRemoveActivityCommentsData:function(){var e,i,t,o=this,a=m("#hidden_parent_id"),d=a.val();void 0!==d&&(o.activity_ajax=m.ajax({type:"POST",url:h,data:{action:"video_get_activity",reset_comment:!0,id:d,group_id:_.isUndefined(o.current_video.group_id)?0:o.current_video.group_id,video_id:_.isUndefined(o.current_video.id)?0:o.current_video.id,nonce:g.video},success:function(e){e.success&&(m("#activity-stream #activity-"+d+" .activity-comments").html(e.data.activity),jQuery(window).scroll(),bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup())}}),i=e=!1,(o=(t=m('.bb-rl-media-model-wrapper.video [data-bp-activity-id="'+d+'"]')).find(".activity-state")).length&&(e=o.html(),i=o.attr("class"),o.remove(),(o=m('[data-bp-activity-id="'+d+'"] .activity-state')).length&&(o.html(e),o.attr("class",i))),(o=t.find(".activity-meta")).length&&(e=o.html(),i=o.attr("class"),o.remove(),(o=m('[data-bp-activity-id="'+d+'"] > .activity-meta')).length&&(o.html(e),o.attr("class",i))),t.remove(),a.length&&a.remove())},getActivity:function(){var e,t=this;m(".bb-media-info-section .bb-rl-activity-list").addClass("loading").html('<i class="bb-rl-loader"></i>'),void 0!==y&&t.current_video&&void 0!==t.current_video.activity_id&&0!==t.current_video.activity_id&&!t.current_video.is_forum?(!1!==t.activity_ajax&&t.activity_ajax.abort(),m(".bb-media-info-section.media").show(),(e=m('[data-bp-activity-id="'+t.current_video.activity_id+'"] .activity-comments')).length&&(t.current_video.parent_activity_comments=!0,e.html("")),!0===t.current_video.parent_activity_comments&&m(".bb-rl-media-model-wrapper:last").after('<input type="hidden" value="'+t.current_video.activity_id+'" id="hidden_parent_id"/>'),t.activity_ajax=m.ajax({type:"POST",url:h,data:{action:"video_get_activity",id:t.current_video.activity_id,group_id:_.isUndefined(t.current_video.group_id)?0:t.current_video.group_id,video_id:_.isUndefined(t.current_video.id)?0:t.current_video.id,nonce:g.video},success:function(e){var i;e.success&&m(".bb-rl-media-model-wrapper.video:visible").length&&((i=m(".bb-rl-media-model-wrapper.video .bb-rl-media-section").find("figure")).html(e.data.video_data),i.find("video").attr("autoplay",!0),i.find("video").addClass("popup-video"),m(".bb-media-info-section:visible .bb-rl-activity-list").removeClass("loading").html(e.data.activity),void 0!==e.data.comment_form&&void 0!==bp.Nouveau.Activity&&(m(".bb-media-info-section:visible .bb-rl-activity-list .bb-rl-activity-comments ul:first").after(e.data.comment_form),m(".bb-media-info-section:visible").find("#ac-form-"+t.current_video.activity_id).removeClass("not-initialized").addClass("root events-initiated").find("#ac-input-"+t.current_video.activity_id).focus(),e=m(".bb-media-info-section:visible").find("#ac-form-"+t.current_video.activity_id),bp.Nouveau.Activity.clearFeedbackNotice(e),e.removeClass("events-initiated"),e=m(".bb-media-info-section:visible").find(".ac-form .ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(e),_.isUndefined(c)||_.isUndefined(c.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#bb-rl-activity-modal ",t.current_video.activity_id)),m(".bb-media-info-section:visible").show(),m(".bb-media-info-section:visible").find(".bb-activity-more-options-action").attr("data-balloon-pos","left"),jQuery(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},1e3))}})):m(".bb-media-info-section.media").hide()},openVideoActivityDescription:function(e){e.preventDefault();var i=m(e.currentTarget),t=i.parents(".activity-video-description"),e=t.find(".bp-edit-video-activity-description");if(e.length<1)return!1;e.show().addClass("open"),t.find(".bp-video-activity-description").hide(),i.hide()},closeVideoActivityDescription:function(e){e.preventDefault();var i=m(e.currentTarget).parents(".activity-video-description");if(i.length<1)return!1;e=i.find("#add-activity-description").get(0).defaultValue;i.find(".bp-add-video-activity-description").show(),i.find(".bp-video-activity-description").show(),i.find("#add-activity-description").val(e),i.find(".bp-edit-video-activity-description").hide().removeClass("open")},MediaActivityDescriptionUpdate:function(e){e=m(e.currentTarget);""!==e.val().trim()?e.closest(".bp-edit-video-activity-description").addClass("has-content"):e.closest(".bp-edit-video-activity-description").removeClass("has-content")},submitVideoActivityDescription:function(e){e.preventDefault();var o=m(e.currentTarget).parents(".activity-video-description"),a=o.find("#add-activity-description"),e={action:"video_description_save",description:a.val(),attachment_id:o.find("#bp-attachment-id").val(),_wpnonce:g.video};m.ajax({type:"POST",url:h,data:e,async:!1,success:function(e){var i,t;e.success?(i=o.find(".bp-add-video-activity-description"),(t=o.find(".bp-video-activity-description")).html(e.data.description).show(),i.show(),a.val(e.data.description),a.get(0).defaultValue=e.data.description,""===e.data.description?i.removeClass("show-edit").addClass("show-add"):i.addClass("show-edit").removeClass("show-add"),o.find(".bp-edit-video-activity-description").hide().removeClass("open"),t.show(),o.find(".bp-feedback.error").remove()):o.prepend(e.data.feedback)}})},videoActivityDeleted:function(e,i){var t=this,o=0,a=m(document);if(t.is_open_video&&void 0!==i&&"delete_activity"===i.action&&t.current_video.activity_id===i.id){var d=a.find('[data-bp-list="video"] .bb-open-video-theatre[data-id="'+t.current_video.id+'"]'),n=d.parents("ul");d.closest("li").remove(),0===n.find("li:not(.load-more)").length&&(0<(d=m(".bb-videos-actions")).length&&d.hide(),1===n.find("li.load-more").length&&location.reload()),a.find('[data-bp-list="activity"] .bb-open-video-theatre[data-id="'+t.current_video.id+'"]').closest(".bb-activity-video-elem").remove();for(var l=t.videos.length,o=0;o<l;o++)if(t.videos[o].activity_id===i.id){t.videos.splice(o,1);break}0===t.current_index&&t.current_index!==t.videos.length?(t.current_index=-1,t.next(e)):0===t.current_index&&t.current_index===t.videos.length?(a.find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+t.current_video.activity_id+'"]').remove(),t.closeTheatre(e)):t.current_index===t.videos.length?t.previous(e):(t.current_index=-1,t.next(e))}},updateTheaterHeaderTitle:function(e){var i=e.wrapper,e=e.action,i=i.find(".activity-item");!i.find(".bb-rl-activity-header").length||(i=i.find(".bb-rl-activity-header a").first()).length&&(i=i.text()+c.i18n_strings.theater_title,m(".bb-rl-"+e+"-model-wrapper .bb-rl-media-model-header h2").text(i))}},bp.Nouveau.Video.Theatre.start(),bp.Nouveau.Video.Player={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.player=[],this.playerTime=0,this.playerID="",bp.Nouveau.Video.Player.openPlayer(),m(window).on("scroll resize",function(){bp.Nouveau.Video.Player.openPlayer()})},addListeners:function(){m(document).on("click",".video-js",this.openPlayer.bind(this))},openPlayer:function(){var s=this.player;m(".video-js:not(.loaded)").each(function(){var i,e,t,o,a=this,d=m(this).attr("id"),n=m(this).attr("id");s[m(this).attr("id")]=videojs(a,{controlBar:{volumePanel:{inline:!1}}},function(){this.on("ended",function(){}),this.on("play",function(){m(".video-js").each(function(){var e=m(this),i=e.attr("id");i===n||e.hasClass("vjs-error")||(i=videojs.getPlayer(i))&&i.pause()})})}),void 0===s[d]||0!==m(this).find(".skip-back").length||0!==m(this).find(".skip-forward").length||m("body").hasClass("messages")||(s[d].seekButtons({forward:5,back:5}),setTimeout(function(){var e=m(a).parent();e.find(".vjs-control-bar > .vjs-seek-button.skip-back, .vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon-pos","up"),e.find(".vjs-control-bar > .vjs-seek-button.skip-back").attr("data-balloon",f.i18n_strings.video_skip_back_text),e.find(".vjs-control-bar > .vjs-seek-button.skip-forward").attr("data-balloon",f.i18n_strings.video_skip_forward_text)},0)),0<bp.Nouveau.Video.Player.playerTime&&m(this).attr("id")==="theatre-"+bp.Nouveau.Video.Player.playerID?(s[m(a).parent().attr("id")].currentTime(bp.Nouveau.Video.Player.playerTime),s[m(a).parent().attr("id")].play()):(bp.Nouveau.Video.Player.playerTime=0,bp.Nouveau.Video.Player.playerID=""),(m(a).hasClass("bb-rl-single-activity-video")||m(a).hasClass("single-activity-video"))&&(i=m(this).attr("id"),s[m(this).attr("id")].controlBar.addChild("button").addClass("vjs-icon-square"),(e=m(this).find(".vjs-icon-square").addClass("enlarge_button")).attr("data-balloon-pos","left"),e.attr("data-balloon",f.i18n_strings.video_enlarge_text),d=m(this).find(".vjs-error-display.vjs-modal-dialog"),t=m(this),o=m("#"+i),e.on("click touchstart",function(){0<s[i].currentTime()&&(bp.Nouveau.Video.Player.playerTime=s[i].currentTime(),bp.Nouveau.Video.Player.playerID=o.parent().find(".video-js video").attr("id")),s[i].pause();var e=o.parent().find(".bb-open-video-theatre");e.length&&e.trigger("click")}),d.on("click",function(){o.parent().find(".bb-open-video-theatre").trigger("click")}),t.on("click",function(e){m(e.target).hasClass("video-js")&&(t.hasClass("vjs-paused")?s[i].play():s[i].pause())})),m(a).closest(".bb-rl-video-theatre").length&&((l=m(this).parent().find(".vjs-fullscreen-control")).attr("data-balloon-pos","up"),l.attr("data-balloon",f.i18n_strings.video_fullscreen_text)),m(a).parent().find(".video-js").append('<div class="pcture-in-picture-notice">'+f.i18n_strings.video_picture_in_text+"</div>"),m(a).parent().find(".vjs-control-bar > button, .vjs-control-bar > div").attr("data-balloon-pos","up");var l=m(a).parent();l.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon",f.i18n_strings.video_play_text),l.find(".vjs-control-bar > .vjs-play-control").attr("data-balloon-pause",f.i18n_strings.video_pause_text),l.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon-pos","right"),l.find(".vjs-control-bar > .vjs-volume-panel").attr("data-balloon",f.i18n_strings.video_volume_text),l.find(".vjs-control-bar > .vjs-picture-in-picture-control").attr("data-balloon",f.i18n_strings.video_miniplayer_text),l.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon-pos","left"),l.find(".vjs-control-bar > .vjs-playback-rate").attr("data-balloon",f.i18n_strings.video_speed_text),m(this).addClass("loaded")})},removeVideoAndThumbnailAttachment:function(e,i,t){m.ajax({type:"POST",url:h,data:{action:i+"_delete_attachment",_wpnonce:t,id:e}})}},bp.Nouveau.Video.Player.start())}((bp,jQuery));