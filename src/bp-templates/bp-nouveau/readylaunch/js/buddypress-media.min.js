window.bp=window.bp||{},(h=>{var e,g,n,y,u,r,w,s,t;"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},g=(e=BP_Nouveau).media,n=e.document,y=e.ajaxurl,u=e.video,r=e.is_send_ajax_request,w=e.nonces,s=e.activity,t=void 0!==window.BP_Forums_Nouveau&&(window.BP_Forums_Nouveau.media,1)?window.BP_Forums_Nouveau.media:{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=h("body"),e=(this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-dropzone-content",this.sort_by="",this.order_by="",this.currentTargetParent=g.current_folder,this.moveToIdPopup=g.move_to_id_popup,this.moveToTypePopup=g.current_type,this.privacySelectorSelect="",this.privacySelectorSpan="",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:""),e=(this.documentOptions=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:g.dictFileTooBig,acceptedFiles:g.document_type,createImageThumbnails:!1,dictDefaultMessage:g.dropzone_document_message,maxFiles:void 0!==n.maxFiles?n.maxFiles:10,maxFilesize:void 0!==n.max_upload_size?n.max_upload_size:2,dictInvalidFileType:n.dictInvalidFileType,dictMaxFilesExceeded:g.document_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:g.dictCancelUploadConfirmation}),document.getElementsByClassName("forum-post-video-template").length?document.getElementsByClassName("forum-post-video-template")[0].innerHTML:"");this.videoOptions=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:u.dictFileTooBig,acceptedFiles:u.video_type,createImageThumbnails:!1,dictDefaultMessage:u.dropzone_video_message,maxFiles:void 0!==u.maxFiles?u.maxFiles:10,maxFilesize:void 0!==u.max_upload_size?u.max_upload_size:2,dictInvalidFileType:u.dictInvalidFileType,dictMaxFilesExceeded:u.video_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:u.dictCancelUploadConfirmation}),h("#bp-media-uploader").hasClass("bp-media-document-uploader")?(e=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"",this.options=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:g.dictFileTooBig,acceptedFiles:g.document_type,createImageThumbnails:!1,dictDefaultMessage:g.dropzone_document_message,maxFiles:void 0!==n.maxFiles?n.maxFiles:10,maxFilesize:void 0!==n.max_upload_size?n.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:g.document_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:g.dictCancelUploadConfirmation})):(e=document.getElementsByClassName("forum-post-media-template").length?document.getElementsByClassName("forum-post-media-template")[0].innerHTML:"",this.options=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:g.dictFileTooBig,dictDefaultMessage:g.dropzone_media_message,acceptedFiles:"image/*",maxFiles:void 0!==g.maxFiles?g.maxFiles:10,maxFilesize:void 0!==g.max_upload_size?g.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:g.media_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:g.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==g.max_upload_size?g.max_upload_size:2})),void 0!==g.dropzone_options&&Object.assign(this.options,g.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==g.album_id&&g.album_id,this.current_folder=void 0!==g.current_folder&&g.current_folder,this.current_group_id=void 0!==g.current_group_id&&g.current_group_id,this.group_id=void 0!==g.group_id&&g.group_id,this.bbp_is_reply_edit=void 0!==t.bbp_is_reply_edit&&t.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==t.bbp_is_topic_edit&&t.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==t.bbp_is_forum_edit&&t.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==t.reply_edit_media?t.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==t.reply_edit_document?t.reply_edit_document:[],this.bbp_reply_edit_video=void 0!==t.reply_edit_video?t.reply_edit_video:[],this.bbp_topic_edit_media=void 0!==t.topic_edit_media?t.topic_edit_media:[],this.bbp_topic_edit_video=void 0!==t.topic_edit_video?t.topic_edit_video:[],this.bbp_topic_edit_document=void 0!==t.topic_edit_document?t.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==t.forum_edit_media?t.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==t.forum_edit_document?t.forum_edit_document:[],this.bbp_forum_edit_video=void 0!==t.forum_edit_video?t.forum_edit_video:[],this.bbp_reply_edit_gif_data=void 0!==t.reply_edit_gif_data?t.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==t.topic_edit_gif_data?t.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==t.forum_edit_gif_data?t.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1,this.reply_topic_allow_delete_media=!1,this.reply_topic_display_post="edit",bp.Nouveau.Media.documentCodeMirror(),h(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var e=h(".bp-nouveau"),t=h(".bp-existing-media-wrap"),i=h(document),a=h(".buddypress.groups.messages"),e=(e.on("click","#bp-add-media",this.openUploader.bind(this)),e.on("click","#bp-add-document",this.openDocumentUploader.bind(this)),e.on("click","#bp-media-submit",this.submitMedia.bind(this)),e.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),e.on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),e.on("click","#bb-delete-media",this.deleteMedia.bind(this)),e.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),void 0!==r&&"1"===r?h('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request):this.bp_media_after_load(),e.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),i.on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),i.on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),i.on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),i.on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),i.on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),i.on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),e.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),i.on("click",".bb-rl-media-create-folder-close",this.closeCreateFolderModal.bind(this)),i.on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),i.on("click",".open-popup .errorPopup",this.closeErrorPopup.bind(this)),e.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),h("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),h('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),h(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),t.on("click","li.load-more",this.appendMedia.bind(this)),e.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),t.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),i.on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),e.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),e.on("click","#bp-save-album-title",this.saveAlbum.bind(this)),i.on("click","#bp-save-folder-title",this.saveFolder.bind(this)),e.on("change","#bp-media-single-album select#bb-rl-album-privacy",this.saveAlbum.bind(this)),e.on("change","#media-stream select#bb-rl-folder-privacy",this.savePrivacy.bind(this)),e.on("click","#bb-delete-album",this.deleteAlbum.bind(this)),i.on("click","#bb-delete-folder",this.deleteFolder.bind(this)),i.on("click",".bb-rl-edit-album",this.editAlbum.bind(this)),i.on("click",".bb-rl-media-edit-album-close",this.closeEditAlbumModal.bind(this)),i.on("click","ul.document-nav li",this.resetPageDocumentDirectory.bind(this)),i.on("click","ul.document-nav li a",this.resetPageDocumentDirectory.bind(this)),i.on("click","#bb-rl-forums-media-button",this.openForumsUploader.bind(this)),i.on("click","#bb-rl-forums-document-button",this.openForumsDocumentUploader.bind(this)),i.on("click","#bb-rl-forums-video-button",this.openForumsVideoUploader.bind(this)),i.on("click","#bb-rl-forums-gif-button",this.toggleGifSelector.bind(this)),i.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keydown",".search-query-input",this.searchGif.bind(this)),i.on("click",".bbpress-forums-activity #whats-new-toolbar .found-media-item",this.selectGif.bind(this)),i.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),i.find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),a.length||i.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),i.find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),i.find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),i.on("click",".gif-image-container",this.playVideo.bind(this)),i.on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),i.on("click",".bb-rl-activity-media-elem .bb_rl_copy_download_file_url a, .media-folder_action__list .bb_rl_copy_download_file_url a, .media .bb-photo-thumb .bb_rl_copy_download_file_url a",this.copyDownloadLink.bind(this)),i.on("click",".bb-rl-activity-media-elem.bb-rl-media-activity .bb-rl-more_dropdown-wrap .bb_rl_more_dropdown__action, #media-stream.media .bb-photo-thumb .bb-rl-more_dropdown-wrap .bb_rl_more_dropdown__action, .bb-rl-activity-media-elem.bb-rl-document-activity .bb-rl-document-action-wrap .bb-rl-document-action_more, .bb-rl-activity-media-elem.bb-rl-document-activity .bb-rl-document-action-wrap .bb_rl_more_dropdown li a",this.fileActivityActionButton.bind(this)),i.click(this.toggleFileActivityActionButton),i.on("click",".bb-rl-activity-media-elem.bb-rl-document-activity .bb-rl-document-expand .bb-rl-document-expand-anchor, .bb-rl-activity-media-elem.bb-rl-document-activity .document-expand .document-expand-anchor, .bb-rl-activity-media-elem.bb-rl-document-activity .bb-rl-document-action-wrap .bb-rl-document-action_collapse",this.toggleCodePreview.bind(this)),i.on("click",".activity .bb-rl-document-move-activity, #media-stream .bb-rl-document-move-activity",this.moveDocumentIntoFolder.bind(this)),i.on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),i.on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),i.on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this)),i.on("click",".bp-media-document-uploader .modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),i.on("click",".bp-media-photo-uploader .modal-container .bb-field-uploader-actions",this.uploadMediaNavigate.bind(this)),i.on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this)),i.on("click",".activity .bb-rl-media-move-activity, #media-stream .bb-rl-media-move-activity",this.moveMediaIntoAlbum.bind(this)),h('#buddypress .bb-rl-activity-list, #buddypress [data-bp-list="activity"], #bb-rl-media-model-container .bb-rl-activity-list, #media-stream')),o=h(".group-media #media-stream"),o=(e.on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this)),e.add(o).on("click",".ac-media-move",this.openMediaMove.bind(this)),e.on("click",".bb-rl-ac-document-close-button, .bb-rl-ac-folder-close-button",this.closeDocumentMove.bind(this)),e.on("click",".bb-rl-ac-media-close-button",this.closeMediaMove.bind(this)),h("#bb-rl-media-model-container .bb-rl-activity-list, #media-stream")),e=(o.on("click",".ac-document-rename",this.renameDocument.bind(this)),o.on("click",".ac-document-edit",this.editDocument.bind(this)),o.on("click",".bb-rl-media-edit-document-close",this.closeEditDocumentModal.bind(this)),o.on("click","#bp-media-edit-document-submit",this.editDocumentSubmit.bind(this)),i.on("click","#bp-media-edit-album-submit",this.editAlbumSubmit.bind(this)),i.on("click",".bb-rl-document-file-delete",this.deleteDocument.bind(this)),i.on("click",".bb-rl-media-file-delete",this.deleteMedia.bind(this)),i.on("click",".bb-rl-folder-move",this.folderMove.bind(this)),i.on("click",".bb-rl-document-open-create-popup-folder",this.createFolderInPopup.bind(this)),i.on("click",".bb-rl-media-open-create-popup-folder",this.createAlbumInPopup.bind(this)),i.on("click",".bb-rl-close-create-popup-folder",this.closeCreateFolderInPopup.bind(this)),i.on("click",".bb-rl-close-create-popup-album",this.closeCreateAlbumInPopup.bind(this)),i.on("click",".bb-rl-document-create-popup-folder-submit",this.submitCreateFolderInPopup.bind(this)),i.on("click",".bb-rl-media-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this)),h(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar")),o=h(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),d=h(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container"),e=(a.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),a.on("click","#bp-group-messages-document-button",this.openGroupMessagesDocumentUploader.bind(this)),a.on("click","#bp-group-messages-video-button",this.openGroupMessagesVideoUploader.bind(this)),a.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),e.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),e.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),o.scroll(this.loadMoreGroupMessagesGif.bind(this)),h(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),d.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),t.on("scroll",this.loadExistingMedia.bind(this)),document.addEventListener("keyup",this.closePopup.bind(this)),document.addEventListener("keyup",this.submitPopup.bind(this)),h(window).bind("beforeunload",this.beforeunloadWindow.bind(this)),_.isUndefined(g.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1),document.addEventListener("keydown",_.bind(this.closePickersOnEsc,this)),i.on("click",_.bind(this.closePickersOnClick,this))),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&h("#bb-rl-forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&h("#bb-rl-forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&h("#bb-rl-forums-video-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&(this.editGifPreview(),a=jQuery("#bb-rl-forums-gif-button").addClass("active").closest("form"),bp.Nouveau.Media.disableButtonsInToolBox(a,["#bb-rl-forums-media-button","#bb-rl-forums-document-button","#bb-rl-forums-video-button"])),h("#bp-media-edit-child-folder"));"#openEditFolder"===window.location.hash&&e.length&&(history.pushState(null,null,window.location.href.split("#")[0]),e.show()),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(bp.Nouveau.Media.reply_topic_allow_delete_media=!0)},loadExistingMedia:function(){h(window).scroll()},resetPageDocumentDirectory:function(e){e.preventDefault(),this.current_page=1},submitCreateFolderInPopup:function(e){e.preventDefault(),this.submitCreateFolderAlbumInPopup(e,"document","folder")},submitCreateAlbumInPopup:function(e){e.preventDefault(),this.submitCreateFolderAlbumInPopup(e,"media","album")},editAlbum:function(e){e.preventDefault();var t=h("#bb-rl-media-edit-album"),i=h(e.currentTarget).closest("#bp-media-single-album"),a=i.find("#bp-single-album-title .title-wrap").text();h(e.currentTarget).attr("data-privacy")&&0<t.find("#bb-album-privacy").length?"grouponly"===(e=h(e.currentTarget).attr("data-privacy"))?t.find("#bb-album-privacy").addClass("bp-hide"):t.find("#bb-album-privacy").val(e).change().removeClass("bp-hide"):0<t.find("#bb-album-privacy").length&&t.find("#bb-album-privacy").addClass("bp-hide"),t.show(),t.addClass("open-popup"),t.find("#bb-album-title").val(a).focus().select(),t.attr("data-id",i.attr("data-id"))},closeEditAlbumModal:function(e){e.preventDefault();e=h("#bb-rl-media-edit-album");e.hide(),e.removeClass("open-popup")},closeCreateFolderInPopup:function(e){e.preventDefault(),this.closeCreateFolderAlbumInPopup(e,"folder")},closeCreateAlbumInPopup:function(e){e.preventDefault(),this.closeCreateFolderAlbumInPopup(e,"album")},createFolderInPopup:function(e){e.preventDefault(),this.createAlbumFolderInPopup(e,"document","folder")},createAlbumInPopup:function(e){e.preventDefault(),this.createAlbumFolderInPopup(e,"media","album")},savePrivacy:function(e){var i,a,t,o=h(e.currentTarget);if(e.preventDefault(),o.hasClass("new-folder-create-privacy"))return!1;i=parseInt(o.data("item-id")),e=o.data("item-type"),a=o.val(),t=o.find("option:selected").text(),this.privacySelectorSelect.addClass("hide"),this.privacySelectorSpan.text(""),this.privacySelectorSpan.text(t),this.privacySelectorSpan.show(),0<i&&(t={action:"document_save_privacy",item_id:i,type:e,value:a,_wpnonce:w.media},h.ajax({type:"POST",url:y,data:t,success:function(e){var t;e.success?((t=h(document)).find("#div-listing-"+i+" li#"+i+" a").attr("data-privacy",a),e.data.document&&e.data.document.video_symlink&&t.find('a.bb-rl-open-document-theatre[data-id="'+i+'"]').attr("data-video-preview",e.data.document.video_symlink)):(o.find('option[value="'+o.attr("data-privacy")+'"]').attr("selected","selected"),o.siblings("span").text(o.find('option[value="'+o.attr("data-privacy")+'"]').text()),alert(e.data.feedback.replace("&#039;","'")))}}))},deleteDocument:function(e){e.preventDefault();var e=h(e.currentTarget),t=e.attr("data-type"),i=e.attr("data-item-id"),a=e.attr("data-item-attachment-id"),o=e.attr("data-item-preview-attachment-id"),d=[];if("activity"!==e.attr("data-item-from")){if("folder"===t){if(!confirm(g.i18n_strings.folder_delete_confirm))return!1}else if("document"===t&&!confirm(g.i18n_strings.document_delete_confirm))return!1;var r,d={action:"document_delete",id:i,preview_attachment_id:o,type:t,attachment_id:a,_wpnonce:w.media};"yes"===g.is_document_directory&&(r=bp.Nouveau.getStorage("bp-document").scope,d.scope=""===r?"all":r),h.ajax({type:"POST",url:y,asyc:!1,data:d,success:function(e){var t;e.success&&((t=h("#media-stream")).html(""),t.html(e.data.html))}}),this.current_page=1}else{if(!confirm(g.i18n_strings.document_delete_confirm))return!1;var n=e.attr("data-item-activity-id");d={action:"document_activity_delete",id:i,preview_attachment_id:o,type:t,activity_id:n,attachment_id:a,_wpnonce:w.media},h.ajax({type:"POST",url:y,data:d,success:function(e){e.success&&(h("body #buddypress .bb-rl-activity-list li#activity-"+n+" .bb-rl-document-activity .bb-rl-activity-inner .bb-activity-media-wrap .bb-rl-document-activity."+i).remove(),h("body #buddypress .bb-rl-activity-list .bb-rl-activity-comments .bb-rl-document-activity."+i).remove(),!0===e.data.delete_activity?(h("body #buddypress .bb-rl-activity-list li#activity-"+n).remove(),h("body .bb-rl-activity-media-elem.bb-rl-document-activity."+i).remove(),h("body .bb-rl-activity-comments li#acomment-"+n).remove()):h("body #buddypress .bb-rl-activity-list li#activity-"+n).replaceWith(e.data.activity_content))}})}},bp_ajax_media_request:function(e,t){g.group_id&&void 0!==t&&void 0!==t.response.scopes.groups&&0===parseInt(t.response.scopes.groups)?h(".bb-photos-actions").hide():g.group_id&&void 0!==t&&void 0!==t.response.scopes.groups&&0!==parseInt(t.response.scopes.groups)?h(".bb-photos-actions").show():void 0!==t&&void 0!==t.response.scopes.personal&&0===parseInt(t.response.scopes.personal)?h(".bb-photos-actions").hide():void 0!==t&&void 0!==t.response.scopes.personal&&0!==parseInt(t.response.scopes.personal)&&h(".bb-photos-actions").show()},bp_media_after_load:function(){h(".media-list.bb-photo-list").children().length&&h(".bb-photos-actions").show()},addSelectedClassToWrapper:function(e){var e=e.currentTarget;h(e).is(":checked")?(h(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",g.i18n_strings.unselect),h(e).closest(".bb-item-thumb").addClass("selected"),h("#bb-delete-media").length&&h("#bb-delete-media").removeAttr("disabled")):(h(e).closest(".bb-item-thumb").removeClass("selected"),h(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",g.i18n_strings.select),(e=h(".bp-nouveau #bb-select-deselect-all-media")).hasClass("selected")&&e.removeClass("selected"),h("#bb-delete-media").length&&h("#bb-delete-media").attr("disabled","disabled"))},moveDocumentIntoFolder:function(e){this.moveAttachments(e,"document","folder")},moveMediaIntoAlbum:function(e){this.moveAttachments(e,"media","album")},folderMove:function(e){this.moveAttachments(e,"document_folder","folder")},deleteMedia:function(e){var i,a=h(e.currentTarget),o=this;if(e.preventDefault(),a.attr("disabled"))return!1;var d,r=[],n=h("#buddypress"),e=a.attr("data-type"),s=a.data("item-from"),l="",c=h(document);if("album"===e){if(!confirm(g.i18n_strings.album_delete_confirm))return!1}else if("media"===e&&!confirm(g.i18n_strings.media_delete_confirm))return!1;if(a.hasClass("bb-delete")){if(!confirm(g.i18n_strings.media_delete_confirm))return!1;e=n.find(".media-list:not(.existing-media-list)");e.find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){h(this).closest(".bb-item-thumb").addClass("loading deleting"),r.push(h(this).val())}),e.parent().parent().hasClass("album-single-view")&&e.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){h(this).closest(".bb-item-thumb").addClass("loading deleting"),r.push(h(this).val())})}if(d=a.data("parent-activity-id"),s&&s.length&&"activity"===s&&0===r.length&&(l=a.attr("data-item-id"),r.push(l)),0===r.length&&r.push(a.data("item-id")),0===r.length)return!1;a.prop("disabled",!0),h("#buddypress #media-stream.media .bp-feedback").remove();e={action:"media_delete",_wpnonce:w.media,media:r,activity_id:d,from_where:s};h.ajax({type:"POST",url:y,data:e,success:function(e){o.current_page=1,s&&s.length&&"activity"===s?e.success&&(h.each(r,function(e,t){var i=h('#bb-rl-activity-stream ul.bb-rl-activity-list li.activity .bb-rl-activity-content .bb-rl-activity-inner .bb-activity-media-wrap div[data-id="'+t+'"]'),i=(i.length&&i.remove(),h("body .bb-rl-activity-media-elem.bb-rl-media-activity."+t));i.length&&i.remove()}),h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+d+'"] .bb-rl-activity-content .bb-rl-activity-inner .bb-activity-media-wrap').remove(),h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+d+'"] .bb-rl-activity-content .bb-rl-activity-inner').append(e.data.media_content),0===h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+d+'"] .bb-rl-activity-content .bb-rl-activity-inner .bb-rl-activity-media-elem').length&&h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+d+'"]').remove(),!0===e.data.delete_activity?(h("body #buddypress .bb-rl-activity-list li#activity-"+d).remove(),h("body .bb-rl-activity-media-elem.bb-rl-media-activity."+l).remove(),h("body .bb-rl-activity-comments li#acomment-"+d).remove()):h("body #buddypress .bb-rl-activity-list li#activity-"+d).replaceWith(e.data.activity_content)):s&&s.length&&"media"===s?e.success&&("yes"===g.is_media_directory?(("personal"===(t=bp.Nouveau.getStorage("bp-media").scope)?c.find('#bb-rl-media-scope-options option[data-bp-scope="personal"]'):"groups"===t?c.find('#bb-rl-media-scope-options option[data-bp-scope="groups"]'):c.find('#bb-rl-media-scope-options option[data-bp-scope="all"]')).prop("selected",!0),c.find("#bb-rl-media-scope-options").trigger("change")):(e.data.media_personal_count&&h("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),void 0!==e.data&&void 0!==e.data.media_group_count&&(0<h("#buddypress .bb-item-count").length&&"yes"!==BP_Nouveau.media.is_media_directory?(i=BP_Nouveau.dir_labels.hasOwnProperty("media")?1===parseInt(e.data.media_group_count)?BP_Nouveau.dir_labels.media.singular:BP_Nouveau.dir_labels.media.plural:"",h("#buddypress .bb-item-count").html('<span class="bb-count">'+e.data.media_group_count+"</span> "+i)):h("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count)),0!==e.data.media_html_content.length?(0===parseInt(e.data.media_personal_count)?(h(".bb-photos-actions").hide(),h("#media-stream")):n.find(".media-list:not(.existing-media-list)")).html(e.data.media_html_content):0!==e.data.group_media_html_content.length?(0===parseInt(e.data.media_group_count)?(h(".bb-photos-actions").hide(),h("#media-stream")):n.find(".media-list:not(.existing-media-list)")).html(e.data.group_media_html_content):h.each(r,function(e,t){t=h('#media-stream ul.media-list li[data-id="'+t+'"]');t.length&&t.remove()}))):(setTimeout(function(){a.prop("disabled",!1)},500),e.success?(void 0!==e.data&&void 0!==e.data.media_personal_count&&h("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),void 0!==e.data&&void 0!==e.data.media_group_count&&h("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count),(t=n.find(".media-list:not(.existing-media-list)")).find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){h(this).closest("li").remove()}),t.parent().parent().hasClass("album-single-view")&&t.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){h(this).closest("li").remove()}),0!==e.data.media_html_content.length?(0===parseInt(e.data.media_personal_count)?(h(".bb-photos-actions").hide(),h("#media-stream")):t).html(e.data.media_html_content):0!==e.data.group_media_html_content.length?(0===parseInt(e.data.media_group_count)?(h(".bb-photos-actions").hide(),h("#media-stream")):t).html(e.data.group_media_html_content):h.each(r,function(e,t){t=h('#media-stream ul.media-list li[data-id="'+t+'"]');t.length&&t.remove()})):h("#buddypress #media-stream.media").prepend(e.data.feedback));var t=h(".bp-nouveau #bb-select-deselect-all-media");t.hasClass("selected")&&t.removeClass("selected"),jQuery(window).scroll()}})},toggleSelectAllMedia:function(e){e.preventDefault();var e=h(e.currentTarget),t=!e.hasClass("selected");this.setMediaSelectionState(t),h("#bb-delete-media").length&&(t?h("#bb-delete-media").removeAttr("disabled"):h("#bb-delete-media").attr("disabled","disabled")),e.toggleClass("selected",t).data("bp-tooltip",t?BP_Nouveau.media.i18n_strings.unselectall:BP_Nouveau.media.i18n_strings.selectall)},editFolderTitle:function(e){e.preventDefault(),this.editAlbumFolderTitle(e,"document")},cancelEditAlbumTitle:function(e){e.preventDefault(),h("#bb-album-title").removeClass("error"),h("#bp-save-folder-title").hide(),h("#bp-cancel-edit-album-title").hide(),h("#bp-edit-album-title,#bp-edit-folder-title").show(),h("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),h("#bp-media-uploader").hide(),h("#bp-media-add-more").hide(),h("#bp-media-uploader-modal-title").text(g.i18n_strings.upload),h("#bp-media-uploader-modal-status-text").text(""),h("#bp-media-post-content").val(""),this.dropzone_obj.element&&this.dropzone_obj.destroy(),this.dropzone_media=[];var t=h(e.currentTarget).closest("#bp-media-uploader");h(".bb-rl-close-create-popup-album").trigger("click"),h(".bb-rl-close-create-popup-folder").trigger("click"),t.find('.bb-rl-breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find(".bb-field-steps-1 #bp-media-photo-next, .bb-field-steps-1 #bp-media-document-next ").hide(),t.find(".bb-field-steps-1").removeClass("controls-added"),t.find("#bp-media-document-prev, #bp-media-prev, #bp-media-document-submit, #bp-media-submit, .bb-rl-media-open-create-popup-folder, .bb-rl-document-open-create-popup-folder, .bb-rl-create-popup-folder-wrap, .bb-rl-create-popup-album-wrap, .bb-rl-video-open-create-popup-album").hide()),this.clearFolderLocationUI(e)},closeChildFolderUploader:function(e){e.preventDefault();e=h(document);e.find(".open-popup #bb-album-child-title").val(""),e.find(".open-popup #bp-media-create-child-folder-submit").removeClass("loading"),e.find("#bp-media-create-child-folder").removeClass("open-popup"),e.find("#bp-media-create-child-folder").hide(),e.find(".open-popup #bb-album-title").text(""),e.find(".open-popup #bp-media-create-folder").hide(),e.find("#bp-media-create-folder").removeClass("open-popup")},closeFolderUploader:function(e){e.preventDefault();e=h(document);e.find(".open-popup #bb-album-title").val(""),e.find(".open-popup #bp-media-create-folder-submit").removeClass("loading"),e.find(".open-popup #bp-media-document-submit").hide(),e.find("#bp-media-create-folder").removeClass("open-popup"),e.find("#bp-media-create-folder").hide()},loadMoreGif:function(e){var t=e.target,i=this,e=h(e.target).closest("form").find(".forums-attached-gif-container"),a=e.data("key");i.gif_container_key=a,t.scrollTop+t.offsetHeight>=t.scrollHeight&&!e.hasClass("loading")&&0<i.gif_data[a].total_count&&i.gif_data[a].offset<=i.gif_data[a].total_count&&(t={offset:i.gif_data[a].offset,fmt:"json",limit:i.gif_data[a].limit},e.addClass("loading"),e=_.isNull(i.gif_data[a].q)?i.giphy.trending(t,_.bind(i.loadMoreGifResponse,i)):i.giphy.search(_.extend({q:i.gif_data[a].q},t),_.bind(i.loadMoreGifResponse,i)),i.gif_data[a].requests.push(e),i.gif_data[a].offset=i.gif_data[a].offset+i.gif_data[a].limit)},loadMoreGroupMessagesGif:function(e){var t=e.target,i=this,a=h(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");i.gif_container_key=a,t.scrollTop+t.offsetHeight>=t.scrollHeight&&!h(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&0<i.gif_total_count&&i.gif_offset<=i.gif_total_count&&(t={offset:i.gif_offset,fmt:"json",limit:i.gif_limit},h(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),e=_.isNull(i.gif_q)?i.giphy.trending(t,_.bind(i.loadMoreGroupMessagesGifResponse,i)):i.giphy.search(_.extend({q:i.gif_q},t),_.bind(i.loadMoreGroupMessagesGifResponse,i)),i.gif_requests.push(e),i.gif_offset=i.gif_offset+i.gif_limit,i.gif_data[a].requests.push(e),i.gif_data[a].offset=i.gif_data[a].offset+i.gif_data[a].limit)},loadMoreGroupMessagesGifResponse:function(e){var t=0,i=h(".bp-group-messages-attached-gif-container");if(i.removeClass("loading"),void 0!==e.data&&e.data.length){for(var a="",o=e.data.length,t=0;t<o;t++){var d=Math.floor(6*Math.random())+1,r=768<window.innerWidth?140:130,n=e.data[t].images.original.width;a+='<li class="bg'+d+'" style="height: '+r*e.data[t].images.original.height/n+'px;">\n\t<a class="found-media-item" href="'+e.data[t].images.original.url+'" data-id="'+e.data[t].id+'">\n\t\t<img src="'+e.data[t].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[t].saved=!1,this.gif_data.push(e.data[t])}i.find(".gif-search-results-list").append(a)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(this.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var t=this,i=0,a=h('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]');if(a.removeClass("loading"),void 0!==e.data&&e.data.length){for(var o="",d=e.data.length,i=0;i<d;i++){var r=Math.floor(6*Math.random())+1,n=768<window.innerWidth?140:130,s=e.data[i].images.original.width;o+='<li class="bg'+r+'" style="height: '+n*e.data[i].images.original.height/s+'px;">\n\t<a class="found-media-item" href="'+e.data[i].images.original.url+'" data-id="'+e.data[i].id+'">\n\t\t<img src="'+e.data[i].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[i].saved=!1,t.gif_data[t.gif_container_key].data.push(e.data[i])}a.closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[t.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,t={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?t=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?t=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(t=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===t.images)return!1;e=h("#whats-new-attachments .forums-attached-gif-container"),e[0].style.backgroundImage="url("+t.images.fixed_width.url+")",e[0].style.backgroundSize="contain",e[0].style.height=t.images.original.height+"px",e[0].style.width=t.images.original.width+"px",e.find(".gif-image-container img").attr("src",t.images.original.url),e.removeClass("closed"),e=h("#bbp_media_gif");e.length&&e.val(JSON.stringify(t))},selectGif:function(e){var t=this,i=0,a=h(e.currentTarget),o=a.closest("form").find(".forums-attached-gif-container"),d=(e.preventDefault(),o.closest("form").find(".bb-rl-gif-media-search-dropdown").removeClass("open"),o.data("key"));if(void 0!==t.gif_data[d]&&void 0!==t.gif_data[d].data&&t.gif_data[d].data.length){for(var r=t.gif_data[d].data.length,i=0;i<r;i++)if(t.gif_data[d].data[i].id===e.currentTarget.dataset.id){a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+t.gif_data[d].data[i].images.fixed_width.url+")",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=t.gif_data[d].data[i].images.original.height+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=t.gif_data[d].data[i].images.original.width+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",t.gif_data[d].data[i].images.original.url),a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),a.closest("form").find("#bbp_media_gif").length&&a.closest("form").find("#bbp_media_gif").val(JSON.stringify(t.gif_data[d].data[i]));break}o=a.closest("form");o.addClass("has-gif"),bp.Nouveau.Media.disableButtonsInToolBox(o,["#bb-rl-forums-media-button","#bb-rl-forums-document-button","#bb-rl-forums-video-button"])}},selectGroupMessagesGif:function(e){var t=this,i=0,a=(e.preventDefault(),h("#whats-new-attachments .bp-group-messages-attached-gif-container")),o=h("#bp_group_messages_gif");if(h("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),t.gif_data.length){for(var d=t.gif_data.length,i=0;i<d;i++)if(t.gif_data[i].id===e.currentTarget.dataset.id){a[0].style.backgroundImage="url("+t.gif_data[i].images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=t.gif_data[i].images.original.height+"px",a[0].style.width=t.gif_data[i].images.original.width+"px",a.find(".gif-image-container img").attr("src",t.gif_data[i].images.original.url),a.removeClass("closed"),o.length&&o.val(JSON.stringify(t.gif_data[i]));break}var r=h("#send_group_message_form");bp.Nouveau.Media.disableButtonsInToolBox(r,["#bp-group-messages-media-button","#bp-group-messages-document-button","#bp-group-messages-video-button"])}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var e=h(e.target),t=(e.closest("form").find("#whats-new-toolbar #bb-rl-forums-gif-button").removeClass("active"),e.closest("form").find(".bb-rl-gif-media-search-dropdown").removeClass("open"),e.closest("form").find("#whats-new-attachments .forums-attached-gif-container")),i=(t.length&&(t.addClass("closed"),t.find(".gif-image-container img").attr("src",""),t[0].style=""),e.closest("form").find("#bbp_media_gif").length&&e.closest("form").find("#bbp_media_gif").val(""),e.closest("form"));i.removeClass("has-gif"),["media","document","video","gif"].forEach(function(e){i.find("#bb-rl-forums-"+e+"-button")&&i.find("#bb-rl-forums-"+e+"-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable no-click")})},resetGroupMessagesGifComponent:function(){var e=h("#whats-new-attachments .bp-group-messages-attached-gif-container"),t=h("#bp_group_messages_gif"),i=(h("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),h("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",t.length&&t.val(""),h("#send_group_message_form"));["media","document","video"].forEach(function(e){i.find("#bp-group-messages-"+e+"-button")&&i.find("#bp-group-messages-"+e+"-button").parents(".bb-rl-post-elements-buttons-item").removeClass("disable")})},searchGif:function(e){if("Enter"===e.key||13===e.keyCode)return e.preventDefault(),!1;var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),""===e.target.value?this.toggleGroupMessagesGifSelector(e):t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGroupMessagesGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGifRequest:function(r){var n=this,s=(n.gif_q=r.target.value,n.gif_offset=0),e=(n.clearGifRequests(),h(r.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),h(r.target).find(".gif-no-results").removeClass("show"),h(r.target).find(".gif-no-connection").removeClass("show"),n.giphy.search({q:n.gif_q,offset:n.gif_offset,fmt:"json",limit:n.gif_limit},function(e){if(void 0!==e.data.length&&0===e.data.length&&h(r.target).find(".gif-no-results").addClass("show"),void 0!==e.meta.status&&200!==e.meta.status&&h(r.target).find(".gif-no-connection").addClass("show"),void 0!==e.data&&e.data.length){var t="",i=e.data.length;for(s=0;s<i;s++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[s].images.original.width;t+='<li class="bg'+a+'" style="height: '+o*e.data[s].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[s].images.original.url+'" data-id="'+e.data[s].id+'">\n\t\t<img src="'+e.data[s].images.fixed_width.url+'" alt="" alt="">\n\t</a>\n</li>',e.data[s].saved=!1,n.gif_data.push(e.data[s])}h(r.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(n.gif_total_count=e.pagination.total_count),h(r.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")},function(){h(r.target).find(".gif-no-connection").addClass("show")}));n.gif_requests.push(e),n.gif_offset=n.gif_offset+n.gif_limit},searchGifRequest:function(r){var n=this,s=0,l=h(r.target).closest("form").find(".forums-attached-gif-container"),c=(l.addClass("loading"),l.data("key")),e=(h(r.target).closest("form").find(".gif-no-results").removeClass("show"),h(r.target).closest("form").find(".gif-no-connection").removeClass("show"),n.clearGifRequests(c),n.gif_data[c].q=r.target.value,n.gif_data[c].offset=0,n.giphy.search({q:n.gif_data[c].q,offset:n.gif_data[c].offset,fmt:"json",limit:n.gif_data[c].limit},function(e){if(void 0!==e.data.length&&0===e.data.length&&h(r.target).closest("form").find(".gif-no-results").addClass("show"),void 0!==e.meta.status&&200!==e.meta.status&&h(r.target).closest("form").find(".gif-no-connection").addClass("show"),void 0!==e.data&&e.data.length){var t="",i=e.data.length;for(s=0;s<i;s++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[s].images.original.width;t+='<li class="bg'+a+'" style="height: '+o*e.data[s].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[s].images.original.url+'" data-id="'+e.data[s].id+'">\n\t\t<img src="'+e.data[s].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[s].saved=!1,n.gif_data[c].data.push(e.data[s])}h(r.target).closest(".gif-search-content").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(n.gif_data[c].total_count=e.pagination.total_count),l.removeClass("loading")},function(){h(r.target).closest("form").find(".gif-no-connection").addClass("show")}));n.gif_data[c].requests.push(e),n.gif_data[c].offset=n.gif_data[c].offset+n.gif_data[c].limit},clearGifRequests:function(e){var t=this;if(void 0!==t.gif_data[e]&&void 0!==t.gif_data[e].requests){for(var i=t.gif_data[e].requests.length,a=0;a<i;a++)t.gif_data[e].requests[a].abort();h('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),t.gif_data[e].requests=[],t.gif_data[e].data=[],t.gif_data.splice(e,1)}},toggleGifSelector:function(e){var r,n,s=this,l=h(e.currentTarget),t=l.closest("form").find(".bb-rl-gif-media-search-dropdown"),c=0,e=(e.preventDefault(),void 0!==window.Giphy&&void 0!==g.gif_api_key&&(s.giphy=new window.Giphy(g.gif_api_key),(r=l.closest("form").find(".forums-attached-gif-container")).addClass("loading"),n=r.data("key"),s.clearGifRequests(n),s.gif_data[n]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]},e=s.giphy.trending({offset:s.gif_data[n].offset,fmt:"json",limit:s.gif_data[n].limit},function(e){if(void 0!==e.data&&e.data.length){var t="",i=e.data.length;for(c=0;c<i;c++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[c].images.original.width;t+='<li class="bg'+a+'" style="height: '+o*e.data[c].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[c].images.original.url+'" data-id="'+e.data[c].id+'">\n\t\t<img src="'+e.data[c].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[c].saved=!1,s.gif_data[n].data.push(e.data[c])}l.closest("form").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(s.gif_data[n].total_count=e.pagination.total_count),r.removeClass("loading")}),s.gif_data[n].requests.push(e),s.gif_data[n].offset=s.gif_data[n].offset+s.gif_data[n].limit),t.toggleClass("open"),l.parents("form").find("#whats-new-attachments .forums-attached-gif-container img")),t=(0<e.length&&""!==e.attr("src")?l.addClass("active"):l.toggleClass("active"),l.closest("form").find("#bb-rl-forums-post-media-uploader")),e=(t.length&&s.resetForumsMediaComponent(t.data("key")),l.closest("form").find("#bb-rl-forums-post-document-uploader")),t=(e.length&&s.resetForumsDocumentComponent(e.data("key")),l.closest("form").find("#bb-rl-forums-post-video-uploader"));t.length&&s.resetForumsVideoComponent(t.data("key")),h(window).width()<=544&&(e=l.closest(".bb-modal"),jQuery(e).scrollTop(e[0].scrollHeight))},closePickersOnEsc:function(e){var t=h(e.currentTarget);"Escape"!==e.key&&27!==e.keyCode||_.isUndefined(g)||_.isUndefined(g.gif_api_key)||(t.find("form").find(".bb-rl-gif-media-search-dropdown").removeClass("open"),0<h(".bb-rl-gif-media-search-dropdown-standalone.open").length&&t.find(".bb-rl-gif-media-search-dropdown-standalone").removeClass("open"),t.find("#bbpress-forums form").each(function(){var e=jQuery(this),t=e.find("#whats-new-attachments .forums-attached-gif-container img");0<t.length&&""!==t.attr("src")?e.find("#bb-rl-forums-gif-button").addClass("active"):e.find("#bb-rl-forums-gif-button").removeClass("active")}),t.find("#send_group_message_form").each(function(){var e=jQuery(this),t=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");0<t.length&&""!==t.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),t.find(".bb-rl-activity-comments form").each(function(){var e=jQuery(this),t=e.find(".ac-textarea").find(".bb-rl-ac-reply-attachments .activity-attached-gif-container");t.length&&""!==h.trim(t.html())?e.find(".bb-rl-ac-reply-gif-button").addClass("active"):e.find(".bb-rl-ac-reply-gif-button").removeClass("active")}))},closePickersOnClick:function(e){var t=h(e.target),e=h(e.currentTarget);_.isUndefined(g)||_.isUndefined(g.gif_api_key)||t.closest(".bb-rl-post-gif").length||t.closest(".bb-rl-gif-media-search-dropdown").length||(e.find("form").find(".bb-rl-gif-media-search-dropdown").removeClass("open"),0<h(".bb-rl-gif-media-search-dropdown-standalone.open").length&&e.find(".bb-rl-gif-media-search-dropdown-standalone").removeClass("open"),e.find("#bbpress-forums form").each(function(){var e=jQuery(this),t=e.find("#whats-new-attachments .forums-attached-gif-container img");0<t.length&&""!==t.attr("src")?e.find("#bb-rl-forums-gif-button").addClass("active"):e.find("#bb-rl-forums-gif-button").removeClass("active")}),e.find("#send_group_message_form").each(function(){var e=jQuery(this),t=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");0<t.length&&""!==t.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),e.find(".bb-rl-activity-modal form").each(function(){var e=jQuery(this),t=e.find(".bb-rl-ac-reply-attachments .bb-rl-activity-attached-gif-container");t.length&&""!==h.trim(t.html())?e.find(".bb-rl-ac-reply-gif-button").addClass("active"):e.find(".bb-rl-ac-reply-gif-button").removeClass("active")}))},toggleGroupMessagesGifSelector:function(e){var r=this,n=h(e.currentTarget),t=n.closest("form").find(".bb-rl-gif-media-search-dropdown"),s=0,e=(e.preventDefault(),void 0!==window.Giphy&&void 0!==g.gif_api_key&&null==r.giphy&&(r.giphy=new window.Giphy(g.gif_api_key),r.gif_offset=0,r.gif_q=null,r.gif_limit=20,r.gif_requests=[],r.gif_data=[],r.clearGifRequests(),h(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading"),e=r.giphy.trending({offset:r.gif_offset,fmt:"json",limit:r.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var t="",i=e.data.length;for(s=0;s<i;s++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[s].images.original.width;t+='<li class="bg'+a+'" style="height: '+o*e.data[s].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[s].images.original.url+'" data-id="'+e.data[s].id+'">\n\t\t<img src="'+e.data[s].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[s].saved=!1,r.gif_data.push(e.data[s])}n.closest("form").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(r.gif_total_count=e.pagination.total_count),h(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")}),r.gif_requests.push(e),r.gif_offset=r.gif_offset+r.gif_limit),n.parents("form").find("#whats-new-attachments .bp-group-messages-attached-gif-container img"));0<e.length&&""!==e.attr("src")?n.addClass("active"):n.toggleClass("active"),t.toggleClass("open"),r.resetGroupMessagesMediaComponent(),r.resetGroupMessagesDocumentComponent(),r.resetGroupMessagesVideoComponent()},resetGroupMessagesMediaComponent:function(){this.resetGroupMessagesAttachmentComponent({dropzoneObj:this.dropzone_obj,dropzoneData:this.dropzone_media,type:"media"})},resetGroupMessagesDocumentComponent:function(){this.resetGroupMessagesAttachmentComponent({dropzoneObj:this.document_dropzone_obj,dropzoneData:this.dropzone_media,type:"document"})},resetGroupMessagesVideoComponent:function(){this.resetGroupMessagesAttachmentComponent({dropzoneObj:this.video_dropzone_obj,dropzoneData:this.dropzone_media,type:"video"})},resetForumsMediaComponent:function(e){this.resetForumsAttachmentComponent({dropzoneObj:this.dropzone_obj,dropzoneData:this.dropzone_media,type:"media",dropzoneContainer:e})},resetForumsDocumentComponent:function(e){this.resetForumsAttachmentComponent({dropzoneObj:this.dropzone_obj,dropzoneData:this.dropzone_media,type:"document",dropzoneContainer:e})},resetForumsVideoComponent:function(e){this.resetForumsAttachmentComponent({dropzoneObj:this.dropzone_obj,dropzoneData:this.dropzone_media,type:"video",dropzoneContainer:e})},openForumsUploader:function(e){var i,t=this,a=h(e.currentTarget),o=a.closest("form").find("#bb-rl-forums-post-media-uploader"),d=a.closest("form").find("#bb-rl-forums-post-document-uploader"),r=a.closest("form").find("#bb-rl-forums-post-video-uploader"),n=[],d=(e.preventDefault(),a.toggleClass("active"),d.data("key")),r=r.data("key");t.resetForumsDocumentComponent(d),t.resetForumsVideoComponent(r),void 0!==window.Dropzone&&o.length&&(d=o.data("key"),o.hasClass("closed")?(t.dropzone_obj[d]=new Dropzone(o[0],t.options),t.dropzone_media[d]=[],t.setupForumDropzoneEvents({self:t,dropzoneObj:t.dropzone_obj[d],dropzoneDataObj:t.dropzone_media[d],target:a,type:"media",dropzoneContainer:o}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?n=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?n=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(n=this.bbp_forum_edit_media),n.length)&&(r=parseInt(h("#new-post").find("#bbp_reply_id").val()),bp.Readylaunch.Utilities.injectFiles({commonData:n,id:r,self:this,fileType:"media",dropzoneObj:t.dropzone_obj[d],dropzoneData:t.dropzone_media[d],dropzoneContainer:o}),t.addAttachmentIdsToForumsForm(o,t.dropzone_media[d],"media"),_.isNull(t.dropzone_obj[d].files)||0===t.dropzone_obj[d].files.length||(i=a.closest("form"),["media","document","video","gif"].forEach(function(e){var t=i.find("#bb-rl-forums-"+e+"-button");t&&("media"===e?t.removeClass("no-click"):t.parents(".bb-rl-post-elements-buttons-item").addClass("disable"))})))):t.resetForumsMediaComponent(d))},openForumsDocumentUploader:function(e){var i,t=this,a=h(e.currentTarget),o=a.closest("form").find("#bb-rl-forums-post-document-uploader"),d=a.closest("form").find("#bb-rl-forums-post-media-uploader"),r=a.closest("form").find("#bb-rl-forums-post-video-uploader"),n=[],d=(e.preventDefault(),a.toggleClass("active"),d.data("key")),r=r.data("key");t.resetForumsMediaComponent(d),t.resetForumsVideoComponent(r),void 0!==window.Dropzone&&o.length&&(d=o.data("key"),o.hasClass("closed")?(t.dropzone_obj[d]=new Dropzone(o[0],t.documentOptions),t.dropzone_media[d]=[],t.setupForumDropzoneEvents({self:t,dropzoneObj:t.dropzone_obj[d],dropzoneDataObj:t.dropzone_media[d],target:a,type:"document",dropzoneContainer:o}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?n=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?n=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(n=this.bbp_forum_edit_document),n.length)&&(r=parseInt(h("#new-post").find("#bbp_reply_id").val()),bp.Readylaunch.Utilities.injectFiles({commonData:n,id:r,self:this,fileType:"document",dropzoneObj:t.dropzone_obj[d],dropzoneData:t.dropzone_media[d],dropzoneContainer:o}),t.addAttachmentIdsToForumsForm(o,t.dropzone_media[d],"document"),_.isNull(t.dropzone_obj[d].files)||0===t.dropzone_obj[d].files.length||(i=a.closest("form"),["media","document","video","gif"].forEach(function(e){var t=i.find("#bb-rl-forums-"+e+"-button");t&&("document"===e?t.removeClass("no-click"):t.parents(".bb-rl-post-elements-buttons-item").addClass("disable"))})))):t.resetForumsDocumentComponent(d))},openForumsVideoUploader:function(e){var i,t=this,a=h(e.currentTarget),o=a.closest("form").find("#bb-rl-forums-post-video-uploader"),d=a.closest("form").find("#bb-rl-forums-post-media-uploader"),r=a.closest("form").find("#bb-rl-forums-post-document-uploader"),n=[],d=(e.preventDefault(),a.toggleClass("active"),d.data("key")),r=r.data("key");t.resetForumsMediaComponent(d),t.resetForumsDocumentComponent(r),void 0!==window.Dropzone&&o.length&&(d=o.data("key"),o.hasClass("closed")?(t.dropzone_obj[d]=new Dropzone(o[0],t.videoOptions),t.dropzone_media[d]=[],t.setupForumDropzoneEvents({self:t,dropzoneObj:t.dropzone_obj[d],dropzoneDataObj:t.dropzone_media[d],target:a,type:"video",dropzoneContainer:o}),o.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&(this.bbp_reply_edit_video.length?n=this.bbp_reply_edit_video:this.bbp_topic_edit_video.length?n=this.bbp_topic_edit_video:this.bbp_forum_edit_video.length&&(n=this.bbp_forum_edit_video),n.length)&&(r=parseInt(h("#new-post").find("#bbp_reply_id").val()),bp.Readylaunch.Utilities.injectFiles({commonData:n,id:r,self:this,fileType:"video",dropzoneObj:t.dropzone_obj[d],dropzoneData:t.dropzone_media[d],dropzoneContainer:o}),t.addAttachmentIdsToForumsForm(o,t.dropzone_media[d],"video"),_.isNull(t.dropzone_obj[d].files)||0===t.dropzone_obj[d].files.length||(i=a.closest("form"),["media","document","video","gif"].forEach(function(e){var t=i.find("#bb-rl-forums-"+e+"-button");t&&("video"===e?t.removeClass("no-click"):t.parents(".bb-rl-post-elements-buttons-item").addClass("disable"))})))):t.resetForumsVideoComponent(d))},addMediaIdsToForumsForm:function(e){var t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(this.dropzone_media[t]))},addDocumentIdsToForumsForm:function(e){var t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(this.dropzone_media[t]))},addVideoIdsToForumsForm:function(e){var t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_video").length&&e.closest("#whats-new-attachments").find("#bbp_video").val(JSON.stringify(this.dropzone_media[t]))},openGroupMessagesUploader:function(e){var t=this,i=h("div#bp-group-messages-post-media-uploader"),a=h(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",t.options),t.setupGroupMessageDropzoneEvents({self:t,dropzoneObj:t.dropzone_obj,dropzoneDataObj:t.dropzone_media,target:a,type:"media",dropzoneContainer:i}),i.removeClass("closed").addClass("open"),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesDocumentComponent(),t.resetGroupMessagesVideoComponent()):t.resetGroupMessagesMediaComponent())},openGroupMessagesDocumentUploader:function(e){var t=this,i=h("div#bp-group-messages-post-document-uploader"),a=h(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t.document_dropzone_obj=new Dropzone("div#bp-group-messages-post-document-uploader",t.documentOptions),t.setupGroupMessageDropzoneEvents({self:t,dropzoneObj:t.document_dropzone_obj,dropzoneDataObj:t.dropzone_media,target:a,type:"document",dropzoneContainer:i}),i.removeClass("closed").addClass("open"),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesMediaComponent(),t.resetGroupMessagesVideoComponent()):t.resetGroupMessagesDocumentComponent())},openGroupMessagesVideoUploader:function(e){var t=this,i=h("div#bp-group-messages-post-video-uploader"),a=h(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t.video_dropzone_obj=new Dropzone("div#bp-group-messages-post-video-uploader",t.videoOptions),t.setupGroupMessageDropzoneEvents({self:t,dropzoneObj:t.video_dropzone_obj,dropzoneDataObj:t.dropzone_media,target:a,type:"video",dropzoneContainer:i}),i.removeClass("closed").addClass("open"),t.resetGroupMessagesMediaComponent(),t.resetGroupMessagesGifComponent(),t.resetGroupMessagesDocumentComponent()):t.resetGroupMessagesVideoComponent())},addAttachmentIdsToForumsForm:function(e,t,i){e.closest("#whats-new-attachments").find("#bbp_"+i).length&&e.closest("#whats-new-attachments").find("#bbp_"+i).val(JSON.stringify(t))},openUploader:function(e){var i=this;e.preventDefault();var t,a,o=h(document),d=h("#bp-media-uploader");void 0!==window.Dropzone&&h("div#media-uploader").length&&(d.addClass("open-popup").show(),h(e.currentTarget).closest("#bp-media-single-album").length&&h("#bb-media-privacy").hide(),d.find(".bb-field-steps.bb-field-steps-2").length&&(t="#bp-media-uploader.bp-media-photo-uploader",0!==Number(h(t).find(".bb-rl-album-selected-id").data("value"))?(a=h(t).find(".bb-rl-album-selected-id").data("value"),h(t).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup)&&h.ajax({url:y,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){o.find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-media").html(e.data.first_span_text),(""===e.data.html?(o.find(".open-popup .bb-rl-location-album-list-wrap").hide(),o.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists")):(o.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),o.find(".open-popup .bb-rl-location-album-list-wrap"))).show(),!1===e.data.create_album?(o.find(".open-popup .bb-rl-media-open-create-popup-folder").removeClass("create-album"),o.find(".open-popup .bb-rl-media-open-create-popup-folder").hide()):o.find(".open-popup .bb-rl-media-open-create-popup-folder").addClass("create-album"),o.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),o.find(".open-popup .bb-rl-album-create-from").val("profile"),h(t).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),h(t).find(".bb-rl-location-album-list-wrap").append(e.data.html),h(t).find('ul.location-album-list span[data-id="'+a+'"]').trigger("click"),h(t).find(".bb-rl-album-selected-id").val(a)}}),o.on("click",t+" .location-album-list li span",function(e){var t;e.preventDefault(),h(this).parent().hasClass("is_active")||(0!==h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+h(this).attr("id")+'">'+h(this).text()+"</span>"),h(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a===h(e.currentTarget).data("id")?h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").hasClass("is-disabled"))||(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val(h(e.currentTarget).data("id")),t=h(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy"),0!==Number(h(e.currentTarget).data("id"))?(t.find("option").removeAttr("selected"),t.val(h(e.currentTarget).parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1)))}),o.on("click",t+" .breadcrumb .item > span",function(e){var t,i;h(this).hasClass("is-disabled")||(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val(0),h(e.currentTarget).closest(".bb-rl-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),a===h(e.currentTarget).data("id")?h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),t=h(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy"),i=h(e.currentTarget).closest("#bp-media-uploader").find(".location-album-list li.is_active").data("privacy"),0!==Number(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-album-selected-id").val())?(t.find("option").removeAttr("selected"),t.val(void 0===i?"public":i),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1)))}),i.options.previewTemplate=document.getElementsByClassName("uploader-post-media-template").length?document.getElementsByClassName("uploader-post-media-template")[0].innerHTML:"",i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",w.media)}),i.dropzone_obj.on("uploadprogress",function(e){var t=h(e.previewElement).find(".dz-progress-ring circle")[0],i=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=i+" "+i,t.style.strokeDashoffset=i,t.style.strokeDashoffset=i-e.upload.progress.toFixed(0)/100*i}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?h(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&h(e.previewElement).find(".dz-error-message span").text(g.connection_lost_error):(jQuery(".media-error-popup").length||h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),i.dropzone_obj.on("queuecomplete",function(){h("#bp-media-uploader-modal-title").text(g.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){h("#bp-media-uploader-modal-title").text(g.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,t){t.data.id?(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.album_id=i.album_id,t.data.group_id=i.group_id,t.data.saved=!1,i.dropzone_media.push(t.data)):(jQuery(".media-error-popup").length||h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),h(".bb-field-steps-1 #bp-media-photo-next, #bp-media-submit").show(),h(".modal-container").addClass("modal-container--alert"),h(".bb-field-steps-1").addClass("controls-added"),h("#bp-media-add-more").show(),h("#bp-media-uploader-modal-title").text(g.i18n_strings.uploading+"..."),h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid===i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1);break}i.dropzone_obj.getAcceptedFiles().length?h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(h("#bp-media-uploader-modal-status-text").text(""),h("#bp-media-add-more, #bp-media-photo-next").hide(),h(".bb-field-steps-1").removeClass("controls-added"),h("#bp-media-submit").hide(),h(".modal-container").removeClass("modal-container--alert"))}))},openDocumentUploader:function(e){var a,t,l=this,i=(e.preventDefault(),h(document)),o=h("#bp-media-uploader");void 0!==window.Dropzone&&h("div#media-uploader").length&&(o.hasClass("bp-media-document-uploader")&&!this.currentTargetParent&&(this.currentTargetParent=0),h(e.currentTarget).closest("#bp-media-single-folder").length&&h("#bb-document-privacy").hide(),i.removeClass("open-popup"),o.show(),o.addClass("open-popup"),h("#bp-media-uploader.bp-media-document-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(t="#bp-media-uploader.bp-media-document-uploader",0!==Number(h(t).find(".bb-rl-folder-selected-id").data("value"))?(a=h(t).find(".bb-rl-folder-selected-id").data("value"),h(t).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup)&&h.ajax({url:y,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i.find(".bp-media-document-uploader .bb-rl-location-folder-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-document").html(e.data.first_span_text),(""===e.data.html?(i.find(".bp-media-document-uploader.open-popup .bb-rl-location-folder-list-wrap").hide(),i.find(".bp-media-document-uploader.open-popup .bb-rl-location-folder-list-wrap-main span.bb-rl-no-folder-exists")):(i.find(".bp-media-document-uploader.open-popup .bb-rl-location-folder-list-wrap-main span.bb-rl-no-folder-exists").hide(),i.find(".bp-media-document-uploader.open-popup .bb-rl-location-folder-list-wrap"))).show(),i.find(".bp-media-document-uploader .bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),i.find(".bp-media-document-uploader .open-popup .bb-rl-folder-create-from").val("profile"),h(t).find(".bb-rl-location-folder-list-wrap .location-folder-list").remove(),h(t).find(".bb-rl-location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(t,a),h(t).find("ul.location-folder-list span#"+a).trigger("click"),h(t).find(".bb-rl-folder-selected-id").val(a)}}),i.on("click",t+" .location-folder-list li span",function(e){var t;e.preventDefault(),h(this).parent().hasClass("is_active")||(0!==h(this).closest(".bb-rl-location-folder-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&h(this).closest(".bb-rl-location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),h(this).closest(".bb-rl-location-folder-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+h(this).attr("id")+'">'+h(this).text()+"</span>"),h(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a===h(e.currentTarget).data("id")?h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").hasClass("is-disabled"))||(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-folder-selected-id").val(h(e.currentTarget).data("id")),t=h(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy"),0!==Number(h(e.currentTarget).data("id"))?(t.find("option").removeAttr("selected"),t.val(h(e.currentTarget).parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1)))}),i.on("click",t+" .breadcrumb .item > span",function(e){var t,i;h(this).hasClass("is-disabled")||(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-folder-selected-id").val(h(e.currentTarget).data("id")),h(e.currentTarget).closest(".bb-rl-field-wrap").find(".location-folder-list li span").removeClass("selected").parent().removeClass("is_active"),h(e.currentTarget).closest(".bb-rl-field-wrap").find('.location-folder-list li[data-id="'+h(e.currentTarget).data("id")+'"]').addClass("is_active"),h(this).closest(".bb-rl-location-folder-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&h(this).closest(".bb-rl-location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),a===h(e.currentTarget).data("id")?h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-model-footer .bb-rl-media-move").removeClass("is-disabled"),t=h(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy"),i=h(e.currentTarget).closest("#bp-media-uploader").find(".location-folder-list li.is_active").data("privacy"),0!==Number(h(e.currentTarget).closest(".bb-rl-field-wrap").find(".bb-rl-folder-selected-id").val())?(t.find("option").removeAttr("selected"),t.val(void 0===i?"public":i),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1)))}),l.options.previewTemplate=document.getElementsByClassName("uploader-post-document-template").length?document.getElementsByClassName("uploader-post-document-template")[0].innerHTML:"",l.dropzone_obj=new Dropzone("div#media-uploader",l.options),l.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",w.media)}),l.dropzone_obj.on("uploadprogress",function(e){var t=h(e.previewElement).find(".dz-progress-ring circle")[0],i=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=i+" "+i,t.style.strokeDashoffset=i,t.style.strokeDashoffset=i-e.upload.progress.toFixed(0)/100*i}),l.dropzone_obj.on("addedfile",function(){setTimeout(function(){l.dropzone_obj.getAcceptedFiles().length&&h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),l.dropzone_obj.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?h(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&h(e.previewElement).find(".dz-error-message span").text(g.connection_lost_error):(jQuery(".document-error-popup").length||h("body").append('<div id="bp-media-create-album" style="display: block;" class="open-popup document-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI bb-rl-has-warning"><header class="bb-model-header"><h4>'+g.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times bbb"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),l.dropzone_obj.on("accept",function(e,t){0===e.size?t(g.empty_document_type):t()}),l.dropzone_obj.on("queuecomplete",function(){h("#bp-media-uploader-modal-title").text(g.i18n_strings.upload)}),l.dropzone_obj.on("processing",function(){h("#bp-media-uploader-modal-title").text(g.i18n_strings.uploading+"...")}),l.dropzone_obj.on("success",function(e,t){if(!t.data.id){var i,a,o,d,r,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),r=[],a=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=d[a],r.push(i.textContent=n);return r}e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=l.dropzone_media.length,t.data.folder_id=l.current_folder,t.data.group_id=l.current_group_id,t.data.saved=!1,l.dropzone_media.push(t.data);var s=e.upload.filename,s=s.substr(s.lastIndexOf(".")+1),t=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,s=_.isEmpty(t)?"bb-icon-file-"+s:t;h(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&h(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(s),h(".bb-field-steps-1 #bp-media-document-next, #bp-media-document-submit").show(),h(".modal-container").addClass("modal-container--alert"),h(".bb-field-steps-1").addClass("controls-added"),h("#bp-media-uploader-modal-title").text(g.i18n_strings.uploading+"..."),h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show()}),l.dropzone_obj.on("removedfile",function(e){if(l.dropzone_media.length)for(var t in l.dropzone_media)if(e.upload.uuid===l.dropzone_media[t].uuid){void 0===l.dropzone_media[t].saved||l.dropzone_media[t].saved||l.removeAttachment(l.dropzone_media[t].id),l.dropzone_media.splice(t,1);break}l.dropzone_obj.getAcceptedFiles().length?h("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(g.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show():(h("#bp-media-uploader-modal-status-text").text(""),h("#bp-media-document-submit").hide(),h(".modal-container").removeClass("modal-container--alert"))}))},openMediaMove:function(e){e.preventDefault();var i,t,a,o,d=h(document),e=h(e.currentTarget),r=(this.moveToIdPopup=e.attr("id"),this.moveToTypePopup=e.attr("data-type"),0<e.closest(".bb-rl-activity-inner").length?i=e.closest(".bb-rl-activity-inner"):0<e.closest("#media-stream.media").length?i=e.closest("#media-stream.media"):0<e.closest(".comment-item").length&&(i=e.closest(".comment-item")),h(i).find(".bb-rl-media-move-file").addClass("open").show(),a=e.closest(".media-action-wrap").siblings("a").data("id"),t=e.closest(".media-action-wrap").siblings("a").data("album-id"),i.find(".bb-rl-media-move").attr("id",a),i.find(".bb-rl-model-footer .bb-rl-media-move").addClass("is-disabled"),o=e.closest(".bb-rl-conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+e.closest(".bb-rl-conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bb-rl-media-move-file":"#"+e.closest("li.activity-item").attr("id")+" > .bb-rl-activity-content .bb-rl-media-move-file",h(o).find(".bb-rl-document-move").attr("id",e.closest(".bb-rl-document-activity").attr("data-id")),0<e.closest(".media-list").length&&(o=".bb-rl-media-move-file"),"group"===this.moveToTypePopup?d.find(".bb-rl-location-album-list-wrap h4").show():d.find(".bb-rl-location-album-list-wrap h4").hide(),h(o).addClass("open-popup"),h(o).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),h(o).find(".bb-rl-location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>'),t),n=this.moveToTypePopup;""!==this.moveToIdPopup&&h.ajax({url:y,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){d.find(".bb-rl-location-album-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-media").html(e.data.first_span_text),(""===e.data.html?(d.find(".open-popup .bb-rl-location-album-list-wrap").hide(),d.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists")):(d.find(".open-popup .bb-rl-location-album-list-wrap-main span.bb-rl-no-album-exists").hide(),d.find(".open-popup .bb-rl-location-album-list-wrap"))).show(),"group"===n?(d.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").hide(),d.find(".open-popup .bb-rl-album-create-from").val("group")):(d.find(".bb-rl-popup-on-fly-create-album .bb-rl-privacy-field-wrap-hide-show").show(),d.find(".open-popup .bb-rl-album-create-from").val("profile")),!1===e.data.create_album?(h(o+".open-popup").find(".bb-rl-media-open-create-popup-folder").removeClass("create-album"),h(o+".open-popup").find(".bb-rl-media-open-create-popup-folder").hide()):(h(o+".open-popup").find(".bb-rl-media-open-create-popup-folder").addClass("create-album"),h(o+".open-popup").find(".bb-rl-media-open-create-popup-folder").show()),h(o).find(".bb-rl-location-album-list-wrap .location-album-list").remove(),h(o).find(".bb-rl-location-album-list-wrap").append(e.data.html),h(o).find("ul.location-album-list span#"+r).trigger("click")}}),d.on("click",o+" .location-album-list li span",function(e){var t;e.preventDefault(),h(this).parent().hasClass("is_active")||(0!==h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+h(this).attr("id")+'">'+h(this).text()+"</span>"),h(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),t=h(document).find('a.bb-rl-open-media-theatre[data-id="'+i.find(".bb-rl-media-move").attr("id")+'"]').data("album-id"),Number(t)===Number(h(e.currentTarget).data("id"))?h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-model-footer .bb-rl-media-move").removeClass("is-disabled"),h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-model-footer .bb-rl-media-move").hasClass("is-disabled"))||h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-album-selected-id").val(h(e.currentTarget).data("id"))}),d.on("click",o+" .breadcrumb .item > span",function(e){h(this).hasClass("is-disabled")||(h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-album-selected-id").val(0),h(e.currentTarget).closest(".bb-rl-media-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&h(this).closest(".bb-rl-location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),r===h(e.currentTarget).data("id")?h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-model-footer .bb-rl-media-move").addClass("is-disabled"):h(e.currentTarget).closest(".bb-rl-media-move-file").find(".bb-rl-model-footer .bb-rl-media-move").removeClass("is-disabled"))})},openDocumentMove:function(e){e.preventDefault();var t=h(document),e=h(e.currentTarget),i=(this.moveToIdPopup=e.attr("id"),this.moveToTypePopup=e.attr("data-type"),e.attr("data-action")),a=e.closest(".bb-rl-conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+e.closest(".bb-rl-conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bb-rl-media-move-file":"#"+e.closest("li.activity-item").attr("id")+" > .bb-rl-activity-content .bb-rl-media-move-file",o=(h(a).find(".bb-rl-document-move").attr("id",e.closest(".bb-rl-document-activity").attr("data-id")),this.currentTargetParent=e.closest(".bb-rl-activity-media-elem").attr("data-parent-id"),0<e.closest(".media-folder_items").length&&(this.currentTargetParent=e.closest(".media-folder_items").attr("data-parent-id"),(e.hasClass("ac-document-move")?h(a=".bb-rl-media-move-file").find(".bb-rl-document-move"):h(a=".bb-rl-media-move-folder").find(".bb-rl-folder-move")).attr("id",e.closest(".media-folder_items").attr("data-id"))),h(a).find(".bb-rl-location-folder-list-wrap .location-folder-list").remove(),h(a).find(".bb-rl-location-folder-list-wrap").append('<ul class="location-folder-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>'),"document"===i?h(a).find(".bb-rl-modal-header h4 .target_name").text(g.move_to_file):h(a).find(".bb-rl-modal-header h4 .target_name").text(g.move_to_folder),h(a).show(),h(a).addClass("open-popup"),"group"===this.moveToTypePopup?(t.find(".bb-rl-location-folder-list-wrap h4").show(),h(a).addClass("move-folder-popup-group")):(t.find(".bb-rl-location-folder-list-wrap h4").hide(),h(".move-folder-popup-group").removeClass("move-folder-popup-group")),this.currentTargetParent),d=this.moveToTypePopup;""!==this.moveToIdPopup&&h.ajax({url:y,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){t.find(".bb-rl-location-folder-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-document").html(e.data.first_span_text),(""===e.data.html?(t.find(".open-popup .bb-rl-location-folder-list-wrap").hide(),t.find(".open-popup .bb-rl-location-folder-list-wrap-main span.bb-rl-no-folder-exists")):(t.find(".open-popup .bb-rl-location-folder-list-wrap-main span.bb-rl-no-folder-exists").hide(),t.find(".open-popup .bb-rl-location-folder-list-wrap"))).show(),"group"===d?(t.find(".bb-rl-popup-on-fly-create-folder .bb-rl-privacy-field-wrap-hide-show").hide(),t.find(".open-popup .bb-rl-folder-create-from").val("group")):(t.find(".bb-rl-popup-on-fly-create-folder .bb-rl-privacy-field-wrap-hide-show").show(),t.find(".open-popup .bb-rl-folder-create-from").val("profile")),h(a).find(".bb-rl-location-folder-list-wrap .location-folder-list").remove(),h(a).find(".bb-rl-location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI(a,o),h(a).find("ul.location-folder-list span#"+o).trigger("click"))}})},closeMediaMove:function(e){e.preventDefault();e=h(e.currentTarget);0!==e.closest(".bb-rl-media-move-file").find(".bb-rl-location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&e.closest(".bb-rl-media-move-file").find(".bb-rl-location-album-list-wrap .breadcrumb .item span:last-child").remove(),e.closest(".bb-rl-media-move-file").hide()},closeDocumentMove:function(e){e.preventDefault();var t=h(e.currentTarget),i=jQuery(e.currentTarget).closest(".bb-rl-has-folderlocationUI");(t.hasClass("bb-rl-ac-document-close-button")?t.closest(".bb-rl-media-move-file").hide().find(".bb-rl-document-move"):t.closest(".bb-rl-media-move-folder").hide().find(".bb-rl-folder-move")).attr("id",""),i.find(".bb-rl-document-move.loading").removeClass("loading"),this.clearFolderLocationUI(e)},renameDocument:function(e){var t=h(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),i=t.children("span").text();t.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(i).focus().select(),e.preventDefault()},editDocument:function(e){e.preventDefault();var t=h(document),i=h("#bb-rl-media-edit-file"),a=h(e.currentTarget).closest(".media-folder_items"),o=a.find(".media-folder_name").children("span").text(),d=a.data("id"),r=a.find(".media-folder_name").data("attachment-id"),a=a.find(".media-folder_name").data("privacy");h(e.currentTarget).attr("data-privacy")&&0<i.find("#bb-rl-folder-privacy-select").length?"grouponly"===(e=h(e.currentTarget).attr("data-privacy"))?i.find("#bb-rl-folder-privacy-select").addClass("bp-hide"):i.find("#bb-rl-folder-privacy-select").val(e).change().removeClass("bp-hide"):0<i.find("#bb-rl-folder-privacy-select").length&&i.find("#bb-rl-folder-privacy-select").addClass("bp-hide"),i.show(),i.addClass("open-popup"),i.find("#bb-document-title").val(o).focus().select(),i.attr("data-id",d),i.attr("data-attachment-id",r),i.attr("data-privacy",a),i.find("#bb-rl-folder-privacy").val(a),t.find(".open-popup #bb-rl-media-create-album-popup #bb-album-title").show(),t.find(".open-popup #bb-rl-media-create-album-popup #bb-album-title").removeClass("error")},renameDocumentSubmit:function(e){var t=h(e.currentTarget),i=t.closest(".media-folder_items").find(".media-folder_name_edit"),a=t.closest(".media-folder_items").find(".media-folder_name > span"),o=t.closest(".media-folder_items").find(".media-folder_name"),d=t.closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id"),r=t.closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),n=t.closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id"),s=i.val().trim(),l="",l=(t.closest(".ac-document-list").length?l=/[?\[\]=<>:;,'"&$#*()|~`!{}%+ \/]+/g:t.closest(".ac-folder-list").length&&(l=/[\\/?%*:|"<>]+/g),l.exec(s)),l=Boolean(l);if(l?i.addClass("error"):i.removeClass("error"),t.closest(".ac-document-list").length&&(-1!==s.indexOf("\\\\")||l?i.addClass("error"):i.removeClass("error")),!t.hasClass("name_edit_cancel")&&27!==e.keyCode||(i.removeClass("error"),i.parent().hide().siblings(".media-folder_name").show()),t.hasClass("name_edit_save")||13===e.keyCode){if(l)return;i.parent().addClass("submitting").append('<i class="animate-spin bb-icon-l bb-icon-spinner"></i>'),h.ajax({url:y,type:"post",data:{action:"document_update_file_name",document_id:d,attachment_document_id:r,document_type:n,name:s,_wpnonce:w.media},success:function(e){e.success?void 0!==e.data.document&&0<h(e.data.document).length?t.closest(".media-folder_items").html(h(e.data.document).html()):(o.attr("data-document-title",e.data.response.title+"."+o.data("extension")),a.html(e.data.response.title),i.removeClass("submitting"),i.parent().find(".animate-spin").remove(),i.parent().hide().siblings(".media-folder_name").show()):(i.removeClass("submitting"),i.parent().find(".animate-spin").remove(),i.parent().hide().siblings(".media-folder_name").show(),alert(e.data.feedback.replace("&#039;","'")))}})}e.preventDefault()},closeEditDocumentModal:function(e){e.preventDefault();e=h(e.target).closest("#bb-rl-media-edit-file");e.find("#bb-document-title").val(""),e.attr("data-activity-id",""),e.attr("data-id",""),e.attr("data-attachment-id",""),e.attr("data-privacy",""),e.removeClass("open-popup").hide()},editPrivacyDocument:function(e){e.preventDefault();var e=h(e.currentTarget),t=(e.closest("#media-folder-document-data-table").find(".media-folder_visibility .media-folder_details__bottom span").show().siblings("select").addClass("hide"),e.closest(".media-folder_items").find(".media-folder_visibility"));t.find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide"),t.find(".media-folder_details__bottom span").hide().siblings("select").val(e.attr("data-privacy")),t.find(".media-folder_details__bottom #bb-rl-folder-privacy").attr("data-privacy",e.attr("data-privacy")),this.privacySelectorSelect=t.find(".media-folder_details__bottom span").hide().siblings("select"),this.privacySelectorSpan=t.find(".media-folder_details__bottom span")},editDocumentSubmit:function(e){var t=h(e.currentTarget),i=t.closest("#bb-rl-media-edit-file"),a=i.attr("data-id"),o=h('.media-folder_items[data-id="'+a+'"]'),a=i.find("#bb-document-title"),d=o.find(".media-folder_name > span"),r=o.find(".media-folder_name"),n=o.find(".media-folder_name > i.media-document-id").attr("data-item-id"),s=o.find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),l=o.find(".media-folder_name > i.media-document-type").attr("data-item-id"),c=a.val().trim(),p=0<i.find("#bb-rl-folder-privacy-select").length?i.find("#bb-rl-folder-privacy-select").val():"",b="",b=(o.length?b=/[?\[\]=<>:;,'"&$#*()|~`!{}%+ \/]+/g:t.closest(".ac-folder-list").length&&(b=/[\\/?%*:|"<>]+/g),b.exec(c)),b=Boolean(b);b?a.addClass("error"):a.removeClass("error"),o.length&&(-1!==c.indexOf("\\\\")||b?a.addClass("error"):a.removeClass("error")),b||(t.addClass("saving"),h.ajax({url:y,type:"post",data:{action:"document_update_file_name",document_id:n,attachment_document_id:s,document_type:l,document_privacy:p,name:c,_wpnonce:w.media},success:function(e){e.success?(void 0!==e.data.document&&0<h(e.data.document).length?o.html(h(e.data.document).html()):(r.attr("data-document-title",e.data.response.title+"."+r.data("extension")),d.html(e.data.response.title),void 0!==e.data.response.privacy_label&&0<o.find(".media-folder_details__bottom .bb-rl-privacy-label").length&&o.find(".media-folder_details__bottom .bb-rl-privacy-label").html(e.data.response.privacy_label),void 0!==e.data.response.privacy&&0<o.find(".bb_more_options .ac-document-edit").length&&o.find(".bb_more_options .ac-document-edit").attr("data-privacy",e.data.response.privacy)),t.removeClass("saving")):(t.removeClass("saving"),alert(e.data.feedback.replace("&#039;","'"))),i.find("#bp-media-edit-document-close").trigger("click")}}),e.preventDefault())},editAlbumSubmit:function(e){var t=h(e.currentTarget),i=t.closest("#bb-rl-media-edit-album"),a=i.attr("data-id"),o=h('.bb-rl-media-single-album[data-id="'+a+'"]'),d=o.attr("data-group")||0,r=i.find("#bb-album-title").val().trim(),n=0<i.find("#bb-album-privacy").length?i.find("#bb-album-privacy").val():"",s=n?i.find('#bb-album-privacy option[value="'+n+'"]').text():"";t.addClass("saving"),h.ajax({url:y,type:"post",data:{action:"media_album_save",_wpnonce:w.media,album_id:a,group_id:d,title:r,privacy:n},success:function(e){e.success?(r&&o.find("#bp-single-album-title .title-wrap").html(r),n&&(o.find(".bb-media-privacy-wrap .bb-media-privacy-icon").attr("class","bb-media-privacy-icon privacy").addClass(n),o.find(".bb-rl-edit-album").attr("data-privacy",n)),s&&o.find(".bb-media-privacy-wrap .bb-media-privacy-text").html(s),t.removeClass("saving")):(t.removeClass("saving"),alert(e.data.feedback.replace("&#039;","'"))),i.find("#bp-media-edit-album-close").trigger("click")}}),e.preventDefault()},removeAttachment:function(e){e={action:"media_delete_attachment",_wpnonce:w.media,id:e};h.ajax({type:"POST",url:y,data:e})},beforeunloadWindow:function(){0<h("body.messages").length&&h.each(Dropzone.instances,function(e,t){t.removeAllFiles(!0)})},changeUploadModalTab:function(e){e.preventDefault();var e=h(e.currentTarget),t=e.data("content"),i=e.closest("#bp-media-uploader");h(".bp-media-upload-tab-content").hide(),h("#"+t).show(),this.current_tab=t,i.find(".bp-media-upload-tab").removeClass("selected"),e.addClass("selected"),this.toggleSubmitMediaButton(),i.find(".bb-field-steps-2").slideUp(200),i.find("#bb-media-privacy").hide(),i.find(".bb-rl-media-open-create-popup-folder").hide(),"bp-dropzone-content"===t&&(i.find(".bb-field-steps-1").show(),i.find("#bb-media-privacy").show(),i.find(".bb-rl-media-open-create-popup-folder, .bb-rl-document-open-create-popup-folder, #bb-media-privacy").hide()),"bp-existing-media-content"===t&&i.find(".bb-field-uploader-actions").hide(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),h("#bp-media-create-album").show(),h("body").hasClass("directory")&&h("#bp-media-uploader").hide()},openCreateFolderModal:function(e){e.preventDefault();var e=h(document),t=h("#bp-media-create-folder");t.show(),t.addClass("open-popup"),e.find(".open-popup #bb-rl-media-create-album-popup #bb-album-title").show(),e.find(".open-popup #bb-rl-media-create-album-popup #bb-album-title").removeClass("error")},openCreateFolderChildModal:function(e){e.preventDefault();var e=h(document),t=h("#bp-media-create-child-folder");t.show(),t.addClass("open-popup"),e.find(".open-popup #bb-rl-media-create-album-popup #bb-album-child-title").show(),e.find(".open-popup #bb-rl-media-create-album-popup #bb-album-child-title").removeClass("error")},openEditFolderChildModal:function(t){t.preventDefault();var e,i=h(document),a=g.current_user_id,o=g.current_group_id,d=g.current_type;"group"===d?(e=o,i.find(".bb-rl-location-folder-list-wrap h4").show()):(e=a,i.find(".bb-rl-location-folder-list-wrap h4").hide()),h.ajax({url:y,type:"GET",data:{action:"document_get_folder_view",id:e,type:d},success:function(e){i.find(".bb-rl-location-folder-list-wrap h4 span.bb-rl-where-to-move-profile-or-group-document").html(e.data.first_span_text),h(".bb-rl-location-folder-list-wrap .location-folder-list").remove(),h(".bb-rl-location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI("#bp-media-edit-child-folder",g.current_folder),h(t.currentTarget).closest("#bp-media-single-folder").find("ul.location-folder-list span#"+g.current_folder).trigger("click")),"group"===d?(i.find(".bb-rl-popup-on-fly-create-folder .bb-rl-privacy-field-wrap-hide-show").hide(),i.find(".open-popup .bb-rl-folder-create-from").val("group")):(i.find(".bb-rl-popup-on-fly-create-folder .bb-rl-privacy-field-wrap-hide-show").show(),i.find(".open-popup .bb-rl-folder-create-from").val("profile"))}}),h("#bp-media-edit-child-folder").show()},folderLocationUI:function(a,o){var e,i;0<h(a).find(".bb-rl-folder-destination").length&&(e=h(document),h(a).find(".bb-rl-location-folder-list-wrap").hasClass("is_loaded")||(e.on("click",a+" .bb-rl-folder-destination",function(){h(this).parent().find(".bb-rl-location-folder-list-wrap").slideToggle()}),h(a).find(".bb-rl-location-folder-list-wrap").addClass("is_loaded"),e.on("click",a+" .location-folder-list span",function(){this.currentTargetParent=h(this).attr("id");var e=h(this),i=h('<div class="item"></div>');e.parents("li").each(function(e,t){t=h(t).children("span").clone();i.prepend("",t)}),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").html(i.prepend('<span data-id="0">'+g.target_text+"</span>")),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||h('<span class="more_options">...</span>').insertAfter(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),h(this).hasClass("selected")&&!h(this).hasClass("disabled")?(h(this).closest(".bb-rl-location-folder-list-wrap-main").find(".bb-rl-folder-destination").val(""),h(this).closest(".bb-rl-location-folder-list-wrap-main").find(".bb-rl-folder-selected-id").val("0"),h(a).find(".location-folder-list li.is_active").length?h(a).find(".bb-rl-folder-selected-id").val(h(a).find(".location-folder-list li.is_active").attr("data-id")):h(a).find(".bb-rl-folder-selected-id").val("0")):(h(this).closest(".bb-rl-location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),h(this).addClass("selected"),h(this).closest(".bb-rl-location-folder-list-wrap-main").find(".bb-rl-folder-destination").val(h(this).text()),h(this).closest(".bb-rl-location-folder-list-wrap-main").find(".bb-rl-folder-selected-id").val(h(this).parent().attr("data-id"))),h(this).closest(".bb-rl-location-folder-list-wrap").find(".location-folder-title").text(h(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),h(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),h(this).siblings("ul").children("li").show().children("span,i").show(),h(this).closest(".is_active").removeClass("is_active"),h(a).find("li.is_active").removeClass("is_active"),h(this).parent().addClass("is_active"),h(a).find(".bb-rl-folder-selected-id").val(h(a).find(".location-folder-list li.is_active").attr("data-id")),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").each(function(){h(this).show()}),o===h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(h(a).hasClass("bb-rl-media-move-file")||h(a).hasClass("bb-rl-media-move-folder"))?(h(a).find(".bb-rl-document-move").addClass("is-disabled"),h(a).find(".bb-rl-folder-move").addClass("is-disabled")):(h(a).find(".bb-rl-document-move").removeClass("is-disabled"),h(a).find(".bb-rl-folder-move").removeClass("is-disabled")),setTimeout(function(){var e=(h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").prev():h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child")).attr("id");o===e&&(h(a).hasClass("bb-rl-media-move-file")||h(a).hasClass("bb-rl-media-move-folder"))?(h(a).find(".bb-rl-document-move").addClass("is-disabled"),h(a).find(".bb-rl-folder-move").addClass("is-disabled")):(h(a).find(".bb-rl-document-move").removeClass("is-disabled"),h(a).find(".bb-rl-folder-move").removeClass("is-disabled"))},100)}),e.on("click",a+" .bb-rl-breadcrumbs-append-ul-li .item span",function(e){var t,i;h(this).parent().hasClass("is-disabled")||h(this).hasClass("more_options")||(t=h(e.currentTarget).attr("data-id"),h(a).find(".bb-rl-location-folder-list-wrap").find(".location-folder-title").text(h(a).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),h(a).find(".bb-rl-folder-selected-id").val(t),h(a).find(".location-folder-list li").hide(),h(a).find(".location-folder-list li.is_active").removeClass("is_active"),h(a).find(".location-folder-list li > span.selected").removeClass("selected"),h(a).find('.location-folder-list li[data-id="'+t+'"]').addClass("is_active").children("span").addClass("selected"),h(a).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),h(a).find(".location-folder-list li.is_active").children("ul").length&&!h(a).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){h(a).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):h(a).find(".location-folder-list li.is_active").hasClass("has-ul").length?h(a).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){h(a).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),"0"===t&&(h(a).find(".location-folder-list").children("li").show().children("span,i").show(),h(a).find(".bb-rl-location-folder-list-wrap").find(".location-folder-title").text(g.target_text),h(a).find(".location-folder-back").hide()),h(e.currentTarget).nextAll().remove(),o===h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(h(a).hasClass("bb-rl-media-move-file")||h(a).hasClass("bb-rl-media-move-folder"))?(h(a).find(".bb-rl-document-move").addClass("is-disabled"),h(a).find(".bb-rl-folder-move").addClass("is-disabled")):(h(a).find(".bb-rl-document-move").removeClass("is-disabled"),h(a).find(".bb-rl-folder-move").removeClass("is-disabled")),e=h(a).find(".location-folder-list .is_active > span"),i=h('<div class="item"></div>'),e.parents("li").each(function(e,t){t=h(t).children("span").clone();i.prepend("",t)}),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").html(i.prepend('<span data-id="0">'+g.target_text+"</span>")),0===h(a).find('.bb-rl-breadcrumbs-append-ul-li .breadcrumb .item > span[data-id="'+t+'"]').length&&h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").append(h(a).find('.location-folder-list li[data-id="'+t+'"]').children("span").clone()),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||h('<span class="more_options">...</span>').insertAfter(h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),h(a).find(".bb-rl-folder-selected-id").val(t))})),h(a).find(".location-folder-list li").each(function(){h(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-l bb-icon-angle-right sub-menu-anchor"></i>')}),h(a).hasClass("bb-rl-media-move-folder")&&(h(a).find(".location-folder-list li>span").removeClass("is-disabled"),h(a).find('.location-folder-list li>span[id="'+h(a).find(".bb-rl-folder-move").attr("id")+'"]').parent().addClass("is-disabled")),e=h(a).find(".bb-rl-folder-move").attr("id"),0===h(a).find('.location-folder-list li[data-id="'+e+'"]').siblings().length&&h(a).find('.location-folder-list li[data-id="'+e+'"]').parent("ul").addClass("no-folder-list a"),o&&(h(a).find(".location-folder-list li").hide(),h(a).find(".location-folder-list li.is_active").removeClass("is_active"),h(a).find('.location-folder-list li[data-id="'+o+'"]').addClass("is_active"),h(a).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),h(a).find(".location-folder-list li.is_active").children("ul").length&&!h(a).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){h(a).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):h(a).find(".location-folder-list li.is_active").hasClass("has-ul").length?h(a).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){h(a).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),h(a).find(".bb-rl-location-folder-list-wrap").find(".location-folder-title").text(h(a).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),h(a).find(".bb-rl-folder-selected-id").val(h(a).find(".location-folder-list li.is_active").attr("data-id")),h(a).find('.location-folder-list li[data-id="'+e+'"]').children().hide()),"0"===o&&(h(a).find(".location-folder-list").children("li").show(),h(a).find(".bb-rl-location-folder-list-wrap").find(".location-folder-title").text(g.target_text),h(a).find(".location-folder-back").hide()),setTimeout(function(){var e=(h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child").prev():h(a).find(".bb-rl-breadcrumbs-append-ul-li .item > span:last-child")).attr("id");o===e&&(h(a).hasClass("bb-rl-media-move-file")||h(a).hasClass("bb-rl-media-move-folder"))?(h(a).find(".bb-rl-document-move").addClass("is-disabled"),h(a).find(".bb-rl-folder-move").addClass("is-disabled")):(h(a).find(".bb-rl-document-move").removeClass("is-disabled"),h(a).find(".bb-rl-folder-move").removeClass("is-disabled"))},100),e=h(a).find(".location-folder-list .is_active > span"),i=h('<div class="item"></div>'),e.parents("li").each(function(e,t){t=h(t).children("span").clone();i.prepend("",t)}),h(a).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").html(i.prepend('<span data-id="0">'+g.target_text+"</span>")))},clearFolderLocationUI:function(e){e=jQuery(e.currentTarget).closest(".bb-rl-has-folderlocationUI");0<e.length&&(e.find(".bb-rl-location-folder-list-wrap-main .bb-rl-location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),e.find(".bb-rl-location-folder-list-wrap-main .bb-rl-location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),e.find(".location-folder-title").text(g.target_text),e.find(".location-folder-back").hide().closest(".bb-rl-has-folderlocationUI").find(".bb-rl-folder-selected-id").val("0"),e.find(".ac_document_search_folder").val(""),e.find(".bb-model-header h4 span").text("..."),e.find(".bb_rl_ac_document_search_folder_list ul").html("").parent().hide().siblings(".bb-rl-location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),h("#bp-media-create-album").hide(),h("#bb-album-title").val("").removeClass("error")},closeCreateFolderModal:function(e){e.preventDefault(),h("#bp-media-create-folder, #bp-media-create-child-folder").hide(),h("#bb-album-title, #bb-album-child-title").val(""),h("#bp-media-create-child-folder-submit").removeClass("loading")},closeEditFolderModal:function(e){e.preventDefault();var t=h(e.currentTarget).closest("#bp-media-edit-child-folder");h("#bp-media-edit-child-folder").hide(),t.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide(),this.clearFolderLocationUI(e)},closeErrorPopup:function(e){e.preventDefault(),h(e.currentTarget).closest(".open-popup").remove()},submitMedia:function(r){var n,e,s=this,l=h(r.currentTarget),t=h("#bb-media-privacy");if(r.preventDefault(),l.hasClass("saving"))return!1;if(l.addClass("saving"),"bp-dropzone-content"===s.current_tab){var i=h("#bp-media-post-content").val(),c=h(r.currentTarget).closest(".open-popup"),a=c.find(".bb-rl-album-selected-id").val();if(a.length&&0<parseInt(a))for(var o=s.dropzone_media.length,d=0;d<o;d++)s.dropzone_media[d].album_id=a;else a=s.album_id;i={action:"media_save",_wpnonce:w.media,medias:s.dropzone_media,content:i,album_id:a,group_id:s.group_id,privacy:t.val()},h("#bp-dropzone-content .bp-feedback").remove(),h.ajax({type:"POST",url:y,data:i,success:function(e){if(e.success){h("#media-stream ul.media-list").length||location.reload(!0);for(var t,i=h(".bb-photos-actions"),a=h("#buddypress"),o=(0<i.length&&i.show(),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),e.data.media_personal_count&&(a.find(".bp-wrap .users-nav ul li#media-personal-li a span.count").length?a.find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count):((i=document.createElement("span")).setAttribute("class","count"),t=document.createTextNode(e.data.media_personal_count),i.appendChild(t),a.find(".bp-wrap .users-nav ul li#media-personal-li a").append(i))),e.data.media_group_count&&(0<a.find(".bb-item-count").length&&"yes"!==BP_Nouveau.media.is_media_directory?(n=BP_Nouveau.dir_labels.hasOwnProperty("media")?1===parseInt(e.data.media_group_count)?BP_Nouveau.dir_labels.media.singular:BP_Nouveau.dir_labels.media.plural:"",a.find(".bb-item-count").html('<span class="bb-count">'+e.data.media_group_count+"</span> "+n)):a.find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").length?a.find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count):((t=document.createElement("span")).setAttribute("class","count"),i=document.createTextNode(e.data.media_group_count),t.appendChild(i),a.find(".bp-wrap .users-nav ul li#photos-groups-li a").append(t))),"yes"===g.is_media_directory&&(a.find(".media-type-navs ul.media-nav li#media-all a span.count").text(e.data.media_all_count),a.find(".media-type-navs ul.media-nav li#media-personal a span.count").text(e.data.media_personal_count),a.find(".media-type-navs ul.media-nav li#media-groups a span.count").text(e.data.media_group_count)),s.dropzone_media.length),d=0;d<o;d++)s.dropzone_media[d].saved=!0;c.find(".bb-rl-album-selected-id").val(0),s.closeUploader(r),jQuery(window).scroll()}else h("#bp-dropzone-content").prepend(e.data.feedback);l.removeClass("saving")}})}else"bp-existing-media-content"===s.current_tab?(e=[],h('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){e.push(h(this).val())}),i={action:"media_move_to_album",_wpnonce:w.media,medias:e,album_id:s.album_id,group_id:s.group_id},h("#bp-existing-media-content .bp-feedback").remove(),h.ajax({type:"POST",url:y,data:i,success:function(e){var t;e.success?(h("#media-stream ul.media-list").length||h("#media-stream").html(h("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),0<(t=h(".bb-photos-actions")).length&&t.show(),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),h('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){parseInt(h(this).closest("li").data("id"))===parseInt(h(this).val())&&h(this).closest("li").remove()}),jQuery(window).scroll(),s.closeUploader(r)):h("#bp-existing-media-content").prepend(e.data.feedback),l.removeClass("saving")}})):s.current_tab||(s.closeUploader(r),l.removeClass("saving"))},submitDocumentMedia:function(a){var o=this,d=h(a.currentTarget),r=h(a.currentTarget).closest("#bp-media-uploader");if(a.preventDefault(),d.hasClass("saving"))return!1;var n=h(document);if(d.addClass("saving"),"bp-dropzone-content"===o.current_tab){var e=h("#bp-media-post-content").val(),t=h("#bb-document-privacy").val(),i=h(a.currentTarget).closest(".open-popup"),s=i.find(".bb-rl-folder-selected-id").val(),i=i.find(".bb-rl-folder-selected-id").data("value"),l=!0;if(s.length&&0<parseInt(s)){void 0!==i&&parseInt(s)!==parseInt(i)&&(l=!1);for(var c=o.dropzone_media.length,p=0;p<c;p++)o.dropzone_media[p].folder_id=s}i={action:"document_document_save",_wpnonce:w.media,documents:o.dropzone_media,content:e,privacy:t,folder_id:o.current_folder,group_id:o.current_group_id},h("#bp-dropzone-content .bp-feedback").remove(),h.ajax({type:"POST",url:y,data:i,success:function(e){if(e.success){h("#media-stream div#media-folder-document-data-table").length||(h("#media-stream").html(h("<div></div>").addClass("display")),h("#media-stream div").attr("id","media-folder-document-data-table"),h(".bb-photos-actions").show()),h(".document-data-table-head").length?"yes"===g.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(n.find("li#document-personal a").trigger("click"),n.find("li#document-personal").trigger("click")):l&&bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"):location.reload(!0),h("#bp-media-post-content").val("");for(var t=o.dropzone_media.length,i=0;i<t;i++)o.dropzone_media[i].saved=!0;o.closeUploader(a),n.removeClass("open-popup"),jQuery(window).scroll()}else n.removeClass("open-popup"),h("#bp-dropzone-content").prepend(e.data.feedback);d.removeClass("saving"),r.find("#bp-media-document-submit").hide()}})}else o.current_tab||(o.closeUploader(a),d.removeClass("saving"))},saveAlbum:function(e){this.saveItem(e,"album","media")},saveFolder:function(e){this.saveItem(e,"folder","document")},saveChildFolder:function(e){this.saveItem(e,"child_folder","document")},renameChildFolder:function(e){e.preventDefault();var t=h(e.currentTarget),i=this,e=h("#bp-media-edit-child-folder #bb-album-child-title"),a=h("#bp-media-edit-child-folder #bb-rl-folder-privacy"),o=this.currentTargetParent,d=/[\\/?%*:|"<>]+/g.exec(e.val()),d=Boolean(d);if(""===h.trim(e.val())||d)return e.addClass("error"),!1;e.removeClass("error"),t.prop("disabled",!0).addClass("loading");d={action:"document_edit_folder",_wpnonce:w.media,title:e.val(),privacy:a.val(),id:o,group_id:i.current_group_id};h(".bb-single-album-header .bp-feedback").remove(),h("#bb-rl-media-create-album-popup .bp-feedback").remove(),h.ajax({type:"POST",url:y,data:d,success:function(e){setTimeout(function(){t.prop("disabled",!1)},500),e.success?window.location.reload(!0):i.current_folder?h("#bp-media-single-album").prepend(e.data.feedback):h("#bb-rl-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(e){e.preventDefault(),this.deleteAttachment(e,"media","album")},deleteFolder:function(e){e.preventDefault(),this.deleteAttachment(e,"document","folder")},injectMedias:function(e){this.injectAttachments(e,"media")},injectDocuments:function(e){this.injectAttachments(e,"document")},sortDocuments:function(e){var e=h(e.currentTarget),t="",i="date_created";switch(e.data("target")){case"name":i="title";break;case"modified":i="date_modified";break;case"visibility":i="privacy";break;case"group":i="group_id"}e.hasClass("asce")?e.removeClass("asce"):e.addClass("asce");var e=e.hasClass("asce")?"DESC":"ASC",a={},a=(a.orderby=i,a.sort=e,"group"!==i&&bp.Nouveau.setStorage("bp-document","extras",a),bp.Nouveau.getStorage("bp-document")),o=a.scope||null,a=a.filter||null,d=h("#buddypress .bp-dir-search-form input[type=search]");d.length&&(t=d.val()),this.sort_by=e,this.order_by=i,this.current_page=1,bp.Nouveau.objectRequest({object:"document",scope:o,filter:a,search_terms:t,page:1,order_by:i,sort:e,method:"reset",target:"#buddypress [data-bp-list]"}).done()},documentPopupNavigate:function(e){e.preventDefault();var e=h(e.currentTarget),t=e.closest(".bb-field-steps"),i=0===e.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";e.closest(".document-options").length&&(i="#bb-album-title"),e.hasClass("bb-field-steps-next")&&""===t.find(i).val().trim()?t.find(i).addClass("error"):(t.find(i).removeClass("error"),t.slideUp(200).siblings(".bb-field-steps").slideDown(200))},uploadDocumentNavigate:function(e){e.preventDefault();var e=h(e.currentTarget),t=h(e).closest("#bp-media-uploader");h(e).hasClass("bb-field-uploader-next")?(t.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),t.find("#bp-media-document-submit, #bp-media-document-prev, .bb-rl-document-open-create-popup-folder, #bb-document-privacy").show(),0!==Number(h(t).find(".bb-rl-folder-selected-id"))&&h(t).find(".location-folder-list li.is_active").length&&h(t).find(".location-folder-list").scrollTop(h(t).find(".location-folder-list li.is_active").offset().top-h(t).find(".location-folder-list").offset().top),h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||h('<span class="more_options">...</span>').insertAfter(h(t).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))})):(h(e).hide(),t.find("#bp-media-document-prev, .bb-rl-document-open-create-popup-folder").hide(),t.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),t.closest("#bp-media-single-folder").length&&h("#bb-document-privacy").hide())},uploadMediaNavigate:function(e){e.preventDefault();var e=h(e.currentTarget),t=h(e).closest(".bp-media-photo-uploader");h(e).hasClass("bb-field-uploader-next")?(t.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),t.find("#bp-media-submit, #bp-media-prev, .bb-rl-media-open-create-popup-folder.create-album").show(),t.find("#bb-media-privacy").show(),0!==Number(h(t).find(".bb-rl-album-selected-id"))&&h(t).find(".location-album-list li.is_active").length&&h(t).find(".location-album-list").scrollTop(h(t).find(".location-album-list li.is_active").offset().top-h(t).find(".location-album-list").offset().top)):(h(e).hide(),t.find("#bp-media-prev, .bb-rl-media-open-create-popup-folder").hide(),t.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),t.closest("#bp-media-single-album").length&&h("#bb-media-privacy").hide())},appendMedia:function(e){var t,i,a,o=bp.Nouveau.getStorage("bp-media"),d=o.scope||null,o=o.filter||null,r=h(e.currentTarget);r.hasClass("load-more")&&(t=Number(this.current_page_existing_media)+1,i=this,a="",e.preventDefault(),r.find("a").first().addClass("loading"),(e=h("#buddypress .dir-search input[type=search]")).length&&(a=e.val()),bp.Nouveau.objectRequest({object:"media",scope:d,filter:o,search_terms:a,page:t,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(e){!0===e.success&&(r.remove(),i.current_page_existing_media=t,jQuery(window).scroll())}))},appendAlbums:function(t){var i=Number(this.current_page_albums)+1,a=this,e=(t.preventDefault(),h(t.currentTarget).find("a").first().addClass("loading"),{action:"media_albums_loader",_wpnonce:w.media,page:i});h.ajax({type:"POST",url:y,data:e,success:function(e){!0===e.success&&(h(t.currentTarget).remove(),h("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){h("#albums-dir-list ul.bb-albums-list").append(e.data.albums),h(this).fadeIn(100)}),a.current_page_albums=i)}})},toggleSubmitMediaButton:function(){var e=h("#bp-media-submit"),t=h("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),t.show()):(e.hide(),t.hide()):"bp-existing-media-content"===this.current_tab&&(h('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),t.hide())},playVideo:function(e){e.preventDefault();var e=h(e.currentTarget),t=e.find("video").get(0),e=e.find(".gif-play-button");!0===t.paused?(t.play(),e.hide()):(t.pause(),e.show())},autoPlayGifVideos:function(){h(".gif-player").each(function(){var e=h(this).find("video").get(0),t=h(this).find(".gif-play-button");h(this).is(":in-viewport")?(e.play(),t.hide()):(e.pause(),t.show())})},fileActionButton:function(e){var t=h(e.currentTarget),i=t.parent();i.hasClass("download_file")||i.hasClass("bb_rl_copy_download_file_url")||i.hasClass("redirect-activity-privacy-change")||(e.preventDefault(),t.closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"),t.closest(".media-folder_items").find(".media-folder_action__list.bb_rl_more_dropdown").toggleClass("open").closest(".media-folder_items").siblings(".media-folder_items").find(".media-folder_action__list.bb_rl_more_dropdown").removeClass("open"),h("body").addClass("document_more_option_open"))},copyDownloadLink:function(e){e.preventDefault();var t=e.currentTarget,e="document_copy_link",i=(h("body").append('<textarea style="position:absolute;opacity:0;" id="'+e+'"></textarea>'),h(t).text()),e=(h(t).text(g.copy_to_clip_board_text),h("#"+e));return e.val(h(t).attr("href")),e.select(),document.execCommand("copy"),setTimeout(function(){h(t).text(i)},2e3),!1},fileActivityActionButton:function(e){e.preventDefault();var t=h(e.currentTarget);t.parent().hasClass("bb_rl_copy_download_file_url")||(t.closest(".bb-rl-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-rl-activity-media-elem").removeClass("is-visible"),t.closest(".bb-rl-activity-media-elem").find(".bb_rl_more_dropdown").toggleClass("open").closest(".bb-rl-activity-media-elem").siblings().find(".bb_rl_more_dropdown").removeClass("open").closest(".activity-item").siblings().find(".bb-rl-activity-media-elem .bb_rl_more_dropdown").removeClass("open"),h("body").addClass("document_more_option_open"),t.closest(".bb-rl-activity-media-elem").length<1&&(t.closest(".bb-photo-thumb").toggleClass("is-visible").parent().siblings().find(".bb-photo-thumb").removeClass("is-visible").removeClass("is-visible"),t.closest(".bb-photo-thumb").find(".bb_rl_more_dropdown").toggleClass("open").closest(".bb-photo-thumb").parent().siblings().find(".bb-photo-thumb .bb_rl_more_dropdown").removeClass("open")),"a"!==e.currentTarget.tagName.toLowerCase())||t.hasClass("bb-rl-document-action_more")||t.hasClass("bb_rl_more_dropdown__action")||(t.closest(".bb-rl-activity-media-elem").removeClass("is-visible").find(".bb_rl_more_dropdown").removeClass("open"),t.closest(".bb-photo-thumb").removeClass("is-visible").find(".bb_rl_more_dropdown").removeClass("open"))},toggleFileActivityActionButton:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||h(t).hasClass("bb-rl-document-action_more")||h(t).parent().hasClass("bb-rl-document-action_more")||h(t).hasClass("media-folder_action__anchor")||h(t).parent().hasClass("media-folder_action__anchor")||h(t).hasClass("bb_rl_more_dropdown__action")||h(t).parent().hasClass("bb_rl_more_dropdown__action")?e:(h(".bb-rl-activity-media-elem.is-visible").removeClass("is-visible"),h(".media-folder_items.is-visible").removeClass("is-visible"),h(".bb-photo-thumb.is-visible").removeClass("is-visible"),h(".bb-item-thumb.is-visible").removeClass("is-visible"),h(".bb-rl-activity-video-elem.is-visible").removeClass("is-visible"),h(".bb-rl-more_dropdown-wrap.is-visible").removeClass("is-visible"),h(".bb-rl-more_dropdown-wrap .bb_rl_more_dropdown").removeClass("open"),h(".bb-rl-activity-media-elem .bb_rl_more_dropdown").removeClass("open"),h(".bb-photo-thumb .bb_rl_more_dropdown").removeClass("open"),h(".media-folder_items .bb_rl_more_dropdown").removeClass("open"),void h("body").removeClass("document_more_option_open video_more_option_open item_more_option_open"))},toggleCodePreview:function(e){e.preventDefault(),h(e.currentTarget).closest(".bb-rl-document-activity").toggleClass("code-full-view")},documentCodeMirror:function(){h(".bb-rl-document-text:not(.loaded), .document-text:not(.loaded)").each(function(){var e=h(this),t=e.attr("data-extension"),i=e.attr("data-extension");"html"!==t&&"htm"!==t||(i="text/html"),"js"===t?CodeMirror(e[0],{value:(0<e.find(".bb-rl-document-text-file-data-hidden").length?e.find(".bb-rl-document-text-file-data-hidden"):e.find(".document-text-file-data-hidden")).val(),lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}):CodeMirror(e[0],{value:(0<e.find(".bb-rl-document-text-file-data-hidden").length?e.find(".bb-rl-document-text-file-data-hidden"):e.find(".document-text-file-data-hidden")).val(),mode:i,lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}),e.addClass("loaded"),150<e.parent().height()&&(e.closest(".bb-rl-document-text-wrap, .document-text-wrap").addClass("is_large"),e.closest(".bb-rl-document-activity").addClass("is_large"))})},closePopup:function(e){27===e.keyCode&&(h(".bb-rl-media-move-folder.open-popup .bb-rl-ac-folder-close-button:visible, .bb-rl-media-move-file .bb-rl-ac-media-close-button:visible, .bb-rl-media-move-folder.open-popup .bb-rl-close-create-popup-folder:visible,.bb-rl-media-move-file.open-popup .bb-rl-ac-document-close-button:visible, .bb-rl-media-move-file .bb-rl-close-create-popup-folder:visible, .bb-rl-media-move-photo.open .bb-rl-close-create-popup-album:visible").trigger("click"),h("#bp-media-create-folder #bp-media-create-folder-close:visible, #bp-media-create-child-folder #bp-media-create-folder-close:visible").trigger("click"),h("#bp-media-uploader #bp-media-uploader-close:visible").trigger("click"),h("#bp-media-edit-child-folder #bp-media-edit-folder-close:visible").trigger("click"),h("#bp-media-create-album #bp-media-create-album-close:visible").trigger("click"),h(".media-folder_visibility select#bb-rl-folder-privacy:not(.hide)").each(function(){h(this).attr("data-mouseup","false").addClass("hide").siblings("span").show().text(h(this).find("option:selected").text())}),h(".bb-rl-video-thumbnail-uploader .bb-rl-video-thumbnail-uploader-close:visible").trigger("click"),h(".bb-action-popup .bb-close-action-popup:visible").trigger("click"))},submitPopup:function(e){h(document).find(".bb-rl-modal-wrapper:visible").length<1||13===e.keyCode&&(h(".bb-rl-media-move-folder.open-popup .bb-rl-document-move:not(.is-disabled):visible, .bb-rl-media-move-folder.open-popup  .bb-rl-folder-move:not(.is-disabled):visible,.bb-rl-media-move-file.open-popup .bb-rl-document-move:not(.is-disabled):visible, .bb-rl-media-move-file.open-popup .bb-rl-document-create-popup-folder-submit:visible, .bb-rl-media-move-folder.open-popup .bb-rl-document-create-popup-folder-submit:visible, .bb-rl-media-move-file.open .bb-rl-media-move:not(.is-disabled):visible, .bb-rl-media-move-file.open .bb-rl-media-create-popup-album-submit:visible").trigger("click"),h("#bp-media-create-folder #bp-media-create-folder-submit:visible, #bp-media-create-child-folder #bp-media-create-child-folder-submit:visible").trigger("click"),h("#bp-media-uploader #bp-media-document-submit:visible, #bp-media-uploader #bp-media-submit:visible").trigger("click"),h("#bp-media-edit-child-folder #bp-media-edit-child-folder-submit:visible").trigger("click"),h("#bp-media-create-album #bp-media-create-album-submit:visible").trigger("click"))},updateAlbumNavCount:function(e){var t=h(".single-screen-navs.albums-nav").find("ul li#albums-li");t.length<1||(0<h(t).find("span.count").length?h(t).find("span.count").text(e):h(t).find("a#albums").append('<span class="count">'+e+"</span>"))},setupForumDropzoneEvents:function(e){var c=e.self,a=e.dropzoneObj,d=e.target,p=e.type,b=e.dropzoneDataObj,m=e.dropzoneContainer;"video"===p&&a.on("addedfile",function(e){e.dataURL&&e.dataThumb&&e.dataThumb.length?h(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.dataThumb+' " alt=""/>'):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-image")}),a.on("sending",function(e,t,i){i.append("action","document"===p?p+"_"+p+"_upload":p+"_upload");var a="document"===p?"media":p,o=(i.append("_wpnonce",w[a]),d.closest("form"));o.addClass("has-media"),["media","document","video","gif"].forEach(function(e){var t=o.find("#bb-rl-forums-"+e+"-button");t&&(t=t.parents(".bb-rl-post-elements-buttons-item"),p===e?t.addClass("no-click"):t.addClass("disable"))})}),a.on("uploadprogress",function(e){d.closest("form").addClass("media-uploading");var t=h(e.previewElement).find(".dz-progress-ring circle")[0],i=2*t.r.baseVal.value*Math.PI,a=(t.style.strokeDasharray=i+" "+i,i-e.upload.progress.toFixed(0)/100*i);t.style.strokeDashoffset=a,"video"===p&&(e.upload.progress<=99?(h(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+u.i18n_strings.video_uploaded_text),t.style.strokeDashoffset=a):100===e.upload.progress&&(t.style.strokeDashoffset=i-.99*i,h(e.previewElement).find(".dz-progress-count").text("99% "+u.i18n_strings.video_uploaded_text)))}),a.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?h(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&h(e.previewElement).find(".dz-error-message span").text(g.connection_lost_error):(jQuery(".forum-"+("media"===p?"document":p)+"-error-popup").length||("media"===p?h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"):"document"===p?h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"):"video"===p&&h("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup forum-video-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-video-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+u.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>")),this.removeFile(e),d.closest("form").removeClass("media-uploading"))}),"media"!==p&&a.on("accept",function(e,t){0===e.size?t(g["empty_"+p+"_type"]):t()}),a.on("success",function(e,t){var i,a;if("video"===p&&100===e.upload.progress&&(h(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,h(e.previewElement).find(".dz-progress-count").text("100% "+u.i18n_strings.video_uploaded_text),h(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id)e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=h(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.group_id=c.group_id,t.data.saved=!1,"media"===p?t.data.album_id=c.album_id:"document"===p?t.data.folder_id=c.current_folder:"video"===p&&(t.data.album_id=c.album_id,t.data.js_preview=h(e.previewElement).find(".dz-image img").attr("src")),b.push(t.data),m.closest("#whats-new-attachments").find("#bbp_"+p).length&&m.closest("#whats-new-attachments").find("#bbp_"+p).val(JSON.stringify(b)),"document"===p&&(a=(a=e.upload.filename).substr(a.lastIndexOf(".")+1),i=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,a=_.isEmpty(i)?"bb-icon-file-"+a:i,h(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").length)&&h(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").removeClass("bb-icon-file").addClass(a);else if("media"===p)jQuery(".forum-"+p+"-error-popup").length||h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button" id="bp-media-create-folder-close" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e);else if("document"===p||"video"===p){var o,d,r,n,s,l=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],d=0,r=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<r;d++)o=n[d],s.push(o.textContent=l);return s}}),a.on("removedfile",function(e){if(!0===bp.Nouveau.Media.reply_topic_allow_delete_media){if(b.length)for(var t in b)if((e.media_edit_data||e.document_edit_data||e.video_edit_data||e).id===b[t].id){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===b[t].saved||b[t].saved||"edit"!==bp.Nouveau.Media.reply_topic_display_post||c.removeAttachment(b[t].id),b.splice(t,1),m.closest("#whats-new-attachments").find("#bbp_"+p).length&&m.closest("#whats-new-attachments").find("#bbp_"+p).val(JSON.stringify(b));break}var i;_.isNull(a.files)||0!==a.files.length||(i=d.closest("form"),["media","document","video","gif"].forEach(function(e){var t=i.find("#bb-rl-forums-"+e+"-button");t&&(t=t.parents(".bb-rl-post-elements-buttons-item"),p===e?t.removeClass("no-click"):t.removeClass("disable"))}))}_.isNull(a.files)||0!==a.files.length||d.closest("form").removeClass("has-media")}),a.on("complete",function(e){var t,i;0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&d.closest("form").removeClass("media-uploading"),"document"===p&&(i=(i=_.isUndefined(e.name)?"":e.name).substr(i.lastIndexOf(".")+1),t=_.isUndefined(e.svg_icon)?"":e.svg_icon,i=_.isEmpty(t)?"bb-icon-file-"+i:t,h(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length)&&h(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").hasClass("bb-icon-file")&&h(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(i)})},setupGroupMessageDropzoneEvents:function(e){var c=e.self,a=e.dropzoneObj,d=e.target,p=e.type,b=e.dropzoneDataObj;"video"===p&&a.on("addedfile",function(e){e.dataURL&&e.dataThumb&&e.dataThumb.length?h(e.previewElement).find(".dz-image").prepend('<img src=" '+e.dataThumb+' " alt=""/>'):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-image")}),a.on("sending",function(e,t,i){i.append("action","document"===p?p+"_"+p+"_upload":p+"_upload");var a="document"===p?"media":p,o=(i.append("_wpnonce",w[a]),d.closest("#send_group_message_form"));["media","document","video","gif"].forEach(function(e){var t=o.find("#bp-group-messages-"+e+"-button");t&&(t=t.parents(".post-elements-buttons-item"),p===e?t.addClass("no-click"):t.addClass("disable"))})}),a.on("uploadprogress",function(e){var t=h(e.previewElement).find(".dz-progress-ring circle")[0],i=2*t.r.baseVal.value*Math.PI,a=(t.style.strokeDasharray=i+" "+i,i-e.upload.progress.toFixed(0)/100*i);t.style.strokeDashoffset=a,"video"===p&&(e.upload.progress<=99?(h(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+u.i18n_strings.video_uploaded_text),t.style.strokeDashoffset=a):100===e.upload.progress&&(t.style.strokeDashoffset=i-.99*i,h(e.previewElement).find(".dz-progress-count").text("99% "+u.i18n_strings.video_uploaded_text)))}),a.on("error",function(e,t){e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?h(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&h(e.previewElement).find(".dz-error-message span").text(g.connection_lost_error):("media"===p||"document"===p?jQuery(".group-"+("media"===p?"document":p)+"-error-popup").length||("document"===p?h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-document-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"):h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>")):h("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-video-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+u.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),"media"!==p&&a.on("accept",function(e,t){0===e.size?t(g["empty_"+p+"_type"]):t()}),a.on("success",function(e,t){if("video"===p&&100===e.upload.progress&&(h(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,h(e.previewElement).find(".dz-progress-count").text("100% "+u.i18n_strings.video_uploaded_text),h(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id){e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=h(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.group_id=c.group_id,t.data.saved=!1,"media"===p?t.data.album_id=c.album_id:"document"===p?t.data.folder_id=c.current_folder:"video"===p&&(t.data.album_id=c.album_id,t.data.js_preview=h(e.previewElement).find(".dz-video-thumbnail img").attr("src")),b.push(t.data);var i,a=h("#bp_group_messages_"+p);a.length&&a.val(JSON.stringify(b)),"document"===p&&(a=(a=e.upload.filename).substr(a.lastIndexOf(".")+1),i=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,a=_.isEmpty(i)?"bb-icons-rl-"+a:i,h(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl").length)&&h(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl").removeClass("bb-icon-file").addClass(a)}else if("media"===p)jQuery(".group-message-error-popup").length||h("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-message-error-popup"><transition name="modal"><div class="bb-rl-modal-mask bb-white bbm-model-wrap"><div class="bb-rl-modal-wrapper"><div id="bb-rl-media-create-album-popup" class="modal-container bb-rl-has-folderlocationUI"><header class="bb-model-header"><h4>'+g.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="bb-icon-l bb-icon-times"></span></a></header><div class="bb-rl-field-wrap"><p>'+t.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e);else if("document"===p||"video"===p){var o,d,r,n,s,l=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],d=0,r=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<r;d++)o=n[d],s.push(o.textContent=l);return s}}),a.on("removedfile",function(e){if(b.length)for(var t in b)if(e.upload.uuid===b[t].uuid){void 0===b[t].saved||b[t].saved||c.removeAttachment(b[t].id),b.splice(t,1);t=h("#bp_group_messages_"+p);t.length&&t.val(JSON.stringify(b));break}var i;_.isNull(a.files)||0!==a.files.length||(i=h("#send_group_message_form"),["media","document","video","gif"].forEach(function(e){var t=i.find("#bp-group-messages-"+e+"-button");t&&(t=t.parents(".post-elements-buttons-item"),p===e?t.removeClass("no-click"):t.removeClass("disable"))}))})},moveAttachments:function(e,o,d){var r=h(e.currentTarget);e.preventDefault();var n,s="document_folder"===o?"document":o,l="document"===o?"media":o,c=("document_folder"===o?(n=r.attr("id"),h("#media-folder-document-data-table #bb-rl-media-move-folder .bb-rl-modal-mask .bb-rl-modal-wrapper #bb-rl-media-create-album-popup .bb-rl-field-wrap .bb-rl-folder-selected-id")):(n=r.attr("id"),t="document"===o?".location-folder-list":".location-album-list",e="document"===o?".bb-rl-folder-selected-id":".bb-rl-album-selected-id",r.closest(".bb-rl-"+l+"-move-file").find(e))).val();if(""===n||""===c)return"document_folder"===o?alert(g.i18n_strings.folder_move_error):r.closest(".bb-rl-modal-container").find(t).addClass("has-error"),!1;"document"===o&&"yes"!==g.is_document_directory&&(this.current_page=1),"document_folder"!==o&&r.closest(".bb-rl-modal-container").find(t).removeClass("has-error"),r.addClass("loading");var e="video"===o?'li.bb_rl_move_video a[data-video-id="'+n+'"]':'a[data-media-id="'+n+'"]',p=h(document).find(e).attr("data-parent-activity-id"),t=this.group_id,e=("media"!==o||t||(t=!1,"group"===h(document).find(e).attr("data-type")&&(t=h(document).find(e).attr("id"))),{action:o+"_move",_wpnonce:w.media,group_id:t,activity_id:p});"folder"===d?"document"===o?(e.document_id=n,e.folder_id=c):"document_folder"===o&&(e.current_folder_id=n,e.folder_move_to_id=c):("media"===o?e.media_id=n:"video"===o&&(e.video_id=n,e._wpnonce=w.video),e.album_id=c),h.ajax({type:"POST",url:y,data:e,success:function(e){if(e.success){var t,i,a;"yes"===g["is_"+s+"_directory"]?(a="personal"===bp.Nouveau.getStorage("bp-"+s).scope?"li#"+s+"-personal":"li#"+s+"-all",h(document).find(a).trigger("click"),h(document).find(a).trigger("click")):("document_folder"!==o&&("folder"===d?(t=g.current_folder,i=e.data.document_content):"media"===o?(t=g.current_album,i=e.data.media_content):"video"===o&&(t=u.current_album,i=e.data.video_content),0<parseInt(t)?(h("#"+s+"-stream ul."+l+'-list li[data-id="'+n+'"]').remove(),"video"===o&&h('#media-stream ul.media-list li[data-id="'+n+'"]').remove()):h("#bb-rl-activity-stream ul.bb-rl-bb-rl-activity-list li .bb-rl-activity-content .bb-rl-activity-inner .bb-activity-"+l+'-wrap div[data-id="'+c+'"]').length&&!h("#bb-rl-activity-stream ul.bb-rl-activity-list li .bb-rl-activity-content .activity-inner .bb-activity-"+l+'-wrap div[data-id="'+c+'"]').parent().hasClass("bb-"+l+"-length-1")&&(h("#bb-rl-activity-stream ul.bb-rl-activity-list li .bb-rl-activity-content .bb-rl-activity-inner .bb-activity-"+l+'-wrap div[data-id="'+c+'"]').remove(),p)&&p.length&&(h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+p+'"] .bb-rl-activity-content .bb-rl-activity-inner .bb-activity-'+l+"-wrap").remove(),h('#bb-rl-activity-stream ul.bb-rl-activity-list li[data-bp-activity-id="'+p+'"] .bb-rl-activity-content .bb-rl-activity-inner').append(i),"video"===o)&&jQuery(window).scroll()),"document"!==o&&"document_folder"!==o||((a=h("#media-stream")).html(""),a.html(e.data.html)),h(document).find(".open-popup .error").hide(),h(document).find(".open-popup .error").html(""),r.removeClass("loading"),h(document).removeClass("open-popup")),"document_folder"!==o&&(r.closest(".bb-rl-"+l+"-move-file").find(".bb-rl-ac-"+s+"-close-button").trigger("click"),"media"===o)&&h(document).find("a.bb-rl-open-"+l+'-theatre[data-id="'+n+'"]').data("album-id",c)}else{if("document_folder"===o)return h(document).find(".open-popup .error").show(),h(document).find(".open-popup .error").html(e.data.feedback),r.removeClass("loading"),!1;alert(e.data.feedback.replace("&#039;","'"))}}})},editAlbumFolderTitle:function(e,t){h("#bb-album-title").show(),h("#bp-cancel-edit-album-title").show(),h("#bp-media-single-album #bp-single-album-title").hide(),"document"===t?(h("#bp-save-folder-title").show(),h("#bp-edit-folder-title").hide()):"media"===t&&(h("#bp-save-album-title").show(),h("#bp-edit-album-title").hide())},createAlbumFolderInPopup:function(e,t,i){var a=h(document),o=a.find(".open-popup"),d=parseInt(o.find(".bb-rl-"+i+"-selected-id").val()),r=o.find(".bb-rl-"+i+"-create-from").val(),o=(0<d?o.find(".bb-rl-privacy-field-wrap-hide-show").hide():o.find(".bb-rl-privacy-field-wrap-hide-show").show(),"group"===r||"folder"===i&&0<d?a.find(".bb-rl-popup-on-fly-create-"+i+" .bb-rl-privacy-field-wrap-hide-show").hide():a.find(".bb-rl-popup-on-fly-create-"+i+" .bb-rl-privacy-field-wrap-hide-show").show(),h(".bb-rl-modal-container .bb-rl-model-footer, .modal-container .bb-model-footer, .bb-rl-modal-container #bp-media-document-prev").hide(),h(".bb-field-wrap-search").hide(),"media"===t?"document":t);h(".bb-rl-"+o+"-open-create-popup-folder").hide(),h(".bb-rl-location-"+i+"-list-wrap-main").hide(),"album"===i&&h(".bb-field-steps-2 #bp-media-prev").hide(),h(".bb-rl-create-popup-"+i+"-wrap").show();r=h(e.currentTarget).closest(".bb-rl-has-folderlocationUI"),d="folder"===i?g.create_folder:g.create_album_title;r.find(".bb-rl-modal-header").children().hide(),r.find(".bb-rl-modal-header").append("<p>"+d+"</p>"),h(".bb-rl-modal-container #bb-rl-folder-privacy").addClass("new-folder-create-privacy"),a.find(".open-popup .error").hide()},closeCreateFolderAlbumInPopup:function(e,t){h(".bb-rl-modal-container .bb-rl-model-footer, .modal-container .bb-model-footer").show(),h(".bb-field-wrap-search").show(),h(".bb-rl-document-open-create-popup-folder").show(),"album"===t&&h(".bb-rl-modal-container:visible .bb-rl-video-open-create-popup-album").show(),h(".bb-rl-location-"+t+"-list-wrap-main").show(),"folder"===t?h("#bp-media-document-prev").show():"album"===t&&((i=h(".bb-field-steps-2")).find("#bp-media-prev").show(),i.find("#bp-video-next").show()),h(".bb-rl-create-popup-"+t+"-wrap").hide(),"album"===t&&h(".bb-rl-media-create-popup-album-submit.loading").removeClass("loading");var i=h(e.currentTarget).closest(".bb-rl-has-folderlocationUI");i.find(".bb-rl-modal-header").children().show(),i.find(".bb-rl-modal-header p").hide()},submitCreateFolderAlbumInPopup:function(e,a,o){e.preventDefault();var d=this,e=h(e.currentTarget),r=e.closest(".open-popup"),n=h(r).find(".bb-rl-"+a+"-create-popup-"+o+"-submit"),t=r.find(".bb-rl-"+o+"-selected-id").val(),s=e.closest(".modal-container, .bb-rl-modal-container").find(".bb-rl-popup-on-fly-create-"+o+"-title"),i=h.trim(s.val());if("document"===a){var l=/[\\/?%*:|"<>]+/g.exec(i),l=Boolean(l);if(""===i||l)return s.addClass("error"),!1;s.removeClass("error")}this.currentTargetParent=t=""===t?0:t;var c=this.currentTargetParent,p=0,b="",m="",u=0;if("group"===this.moveToTypePopup?(b="grouponly",p=this.moveToIdPopup):(b=e.closest(".bb-rl-modal-container").find(".bb-rl-popup-on-fly-create-"+o+" #bb-rl-"+o+"-privacy").val(),m=e.closest(".bb-rl-modal-container").find(".bb-rl-popup-on-fly-create-"+o+" #bb-rl-"+o+"-privacy")),""===i)return l="document"===a?g.create_folder_error_title:g.create_album_error_title,alert(l),!1;n.addClass("loading");var f=("video"===a?"media":a)+"_"+o+"_save",v=".location-"+o+"-list";setTimeout(function(){var e={action:f,_wpnonce:w.media,title:i,privacy:b,parent:c,group_id:p};h.ajax({type:"POST",url:y,data:e,async:!1,success:function(e){var t,i;e.success?("document"===a&&h(".document-data-table-head").length&&parseInt(c)===parseInt(g.current_folder)&&(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()),r.find(".bb-rl-location-"+o+"-list-wrap "+v).remove(),r.find(".bb-rl-location-"+o+"-list-wrap").append(e.data.tree_view),t="document"===a?"#"+h(r).attr("id"):r,i="document"===a?e.data.folder_id:e.data.album_id,bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(t,i),u=i,(""===e.data.tree_view?(r.find(".bb-rl-location-"+o+"-list-wrap").hide(),r.find(".bb-rl-location-"+o+"-list-wrap-main span.bb-rl-no-"+o+"-exists")):(r.find(".bb-rl-location-"+o+"-list-wrap-main span.bb-rl-no-"+o+"-exists").hide(),r.find(".bb-rl-location-"+o+"-list-wrap"))).show(),r.find("ul"+v+" span#"+u).trigger("click"),r.find(".bb-rl-model-footer, .bb-model-footer").show(),"document"===a&&r.find(".bb-rl-model-footer, .bb-model-footer, #bp-media-"+a+"-prev").show(),r.find(".bb-field-wrap-search").show(),r.find(".bb-rl-"+a+"-open-create-popup-"+o).show(),r.find(".bb-rl-location-"+o+"-list-wrap-main").show(),r.find(".bb-rl-create-popup-"+o+"-wrap").hide(),"media"===a&&r.find(".bb-field-steps-2 #bp-media-prev").show(),r.find(".bb-rl-"+o+"-selected-id").val(),r.find(".bb-rl"+o+"-selected-id").val(u),r.find(".bb-rl-modal-header").children().show(),r.find(".bb-rl-modal-header p").hide(),s.val(""),""!==m&&m.val("public"),h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item").width()>h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb").width()&&(h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||h('<span class="more_options">...</span>').insertAfter(h(r).find(".bb-rl-breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),"media"===a&&d.updateAlbumNavCount(e.data.album_count),n.removeClass("loading"),"document"===a&&setTimeout(function(){var e=r.find("ul"+v+" span#"+u),t=(e.trigger("click"),h(r).find("#bb-document-privacy"));0!==Number(e.data("id"))?(t.find("option").removeAttr("selected"),t.val(e.parent().data("privacy")),t.prop("disabled",!0)):(t.find("option").removeAttr("selected"),t.val("public"),t.prop("disabled",!1))},200)):n.removeClass("loading")}}),this.currentTargetParent=u,r.find(v+" li.is_active").show().children("span, i").show().siblings("ul").hide(),r.find(v+" li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),r.find(v+" li span.selected").removeClass("selected"),r.find(v+" li.is_active").children("span").addClass("selected")},0)},setMediaSelectionState:function(e){var i=h("#buddypress").find(".media-list:not(.existing-media-list)"),a=!0===e,e=["media"];0<i.closest(".album-single-view").length&&e.push("video"),e.forEach(function(t){i.find(".bb-"+t+'-check-wrap [name="bb-'+t+'-select"]').each(function(){var e=h(this);e.prop("checked",a),e.closest(".bb-item-thumb").toggleClass("selected",a),e.closest(".bb-"+t+"-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",a?BP_Nouveau.media.i18n_strings.unselect:BP_Nouveau.media.i18n_strings.select)})})},resetGroupMessagesAttachmentComponent:function(e){var t=e.dropzoneObj,t=(t&&"function"==typeof t.destroy&&t.destroy(),e.dropzoneData=[],h("div#bp-group-messages-post-"+e.type+"-uploader"));t.html(""),t.addClass("closed").removeClass("open"),h("#bp-group-messages-"+e.type+"-button").removeClass("active"),h("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_"+e.type).val("")},resetForumsAttachmentComponent:function(e){h("#bb-rl-forums-"+e.type+"-button").removeClass("active");var t=e.dropzoneObj,i=e.dropzoneData,a=e.dropzoneContainer;void 0!==a&&(void 0!==t[a]&&(t[a].destroy(),t.splice(a,1),i.splice(a,1)),(t=h("div#bb-rl-forums-post-"+e.type+"-uploader")).html(""),t.addClass("closed").removeClass("open"))},injectAttachments:function(e,t){var i,a,o,d,r=bp.Nouveau.getStorage("bp-"+t),n=r.scope||null,s=r.filter||null,l=h(e.currentTarget);l.hasClass("load-more")&&(i=Number(this.current_page)+1,a=this,o="",e.preventDefault(),l.find("a").first().addClass("loading"),(e=h("#buddypress .dir-search input[type=search]")).length&&(o=e.val()),e={object:t,scope:n,filter:s,search_terms:o,page:i,method:"append"},"document"===t?(n=this.order_by&&this.sort_by?(d=this.sort_by,this.order_by):void 0!==r.extras?(d=r.extras.sort,r.extras.orderby):(d="ASC","title"),e.target="#buddypress [data-bp-list] div#media-folder-document-data-table",e.order_by=n,e.sort=d):"media"!==t&&"video"!==t||(e.target="#buddypress [data-bp-list] ul.bp-list"),bp.Nouveau.objectRequest(e).done(function(e){!0===e.success&&("document"===t?l.parent(".pager").remove():"media"!==t&&"video"!==t||l.remove(),a.current_page=i,jQuery(window).scroll())}))},deleteAttachment:function(t,e,i){if("album"===i&&!this.album_id)return!1;var a="album"===i?g.i18n_strings.album_delete_confirm:g.i18n_strings.attachment_delete_confirm;if(!confirm(a))return!1;h(t.currentTarget).prop("disabled",!0);a={action:e+"_"+i+"_delete",_wpnonce:w.media};"album"===i?(a.album_id=this.album_id,a.group_id=this.group_id):"folder"===i&&(a.folder_id=g.current_folder,a.group_id=g.current_group_id),h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){e.success?window.location.href=e.data.redirect_url:(e="album"===i?g.i18n_strings.album_delete_error:g.i18n_strings.folder_delete_error,alert(e),h(t.currentTarget).prop("disabled",!1))}})},saveItem:function(i,e,t,a){var o,d=h(i.currentTarget),r="album"===e,n="folder"===e,s="child_folder"===e,l=d.closest("#bb-rl-media-edit-album"),c=this,p=h(s?"#bp-media-create-child-folder #bb-album-child-title":"#bb-album-title"),b=BP_Nouveau.nonces.media;if(r?(o=h("#bb-rl-album-privacy"),"video"===t&&(b=BP_Nouveau.nonces.video)):n&&(o=d.parents().find(".open-popup #bb-rl-folder-privacy option:selected")),r&&d.hasClass("saving"))return!1;i.preventDefault();var m=(n||s)&&/[\\/?%*:|"<>]+/g.test(p.val());if(""===h.trim(p.val())||m)return p.addClass("error"),!1;if(p.removeClass("error"),r||n){if(!c.group_id&&""===h.trim(o.val()))return o.addClass("error"),!1;o.removeClass("error")}d.prop("disabled",!0).toggleClass(r?"saving":"loading");m={action:t+"_"+e+"_save",_wpnonce:b,title:p.val()};r?("media"===t?m.medias=c.dropzone_media:"video"===t&&(m.videos=a),m.privacy=o.val(),c.album_id&&(m.album_id=c.album_id),c.group_id&&(m.group_id=c.group_id)):n?(m.privacy=o.val(),m.album_id=c.current_folder,m.group_id=c.current_group_id):s&&(m.folder_id=c.current_folder,m.group_id=c.current_group_id),h(".bb-single-album-header .bp-feedback, #bb-rl-media-create-album-popup .bp-feedback").remove(),h.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:m,success:function(e){var t;(r||n)&&setTimeout(function(){r&&d.removeClass("saving"),d.prop("disabled",!1)},500),e.success?r?c.album_id?(h("#bp-single-album-title .title-wrap").text(p.val()),h("#bb-rl-album-privacy").val(o.val()),c.cancelEditAlbumTitle(i),l.find("#bp-media-edit-album-close").trigger("click")):(h("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):n?(c.closeFolderUploader(i),h(".document-data-table-head").length?"yes"===BP_Nouveau.media.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(h(document).find("li#document-personal a").trigger("click"),h(document).find("li#document-personal").trigger("click")):(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()):location.reload(!0)):s&&(c.closeChildFolderUploader(i),location.reload(!0)):r?(t=c.album_id?"#bp-media-single-album":"#bb-rl-media-create-album-popup .bb-model-header",h(t).prepend(e.data.feedback)):alert(e.data.feedback.replace("&#039;","'"))}})},disableButtonsInToolBox:function(t,e){e.forEach(function(e){e=t.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").addClass("disable")})}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.documents=[],this.current_media=!1,this.current_document=!1,this.current_index=0,this.current_document_index=0,this.is_open_media=!1,this.is_open_document=!1,this.nextLink=h(".bb-rl-next-media"),this.nextDocumentLink=h(".bb-rl-next-document"),this.previousDocumentLink=h(".bb-rl-prev-document"),this.previousLink=h(".bb-rl-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==g.group_id&&g.group_id},addListeners:function(){var e=h(document);e.on("click",".bb-rl-open-media-theatre",this.openTheatre.bind(this)),e.on("click",".bb-rl-open-document-theatre",this.openDocumentTheatre.bind(this)),e.on("click",".bb-rl-document-detail-wrap-description-popup",this.openDocumentTheatre.bind(this)),e.on("click",".bb-rl-close-media-theatre",this.closeTheatre.bind(this)),e.on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),e.on("click",".bb-icons-rl-sidebar-simple",this.ToggleTheatreSidebar.bind(this)),e.on("click",".bb-rl-prev-media",this.previous.bind(this)),e.on("click",".bb-rl-next-media",this.next.bind(this)),e.on("click",".bb-rl-prev-document",this.previousDocument.bind(this)),e.on("click",".bb-rl-next-document",this.nextDocument.bind(this)),e.on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),e.on("click","#bb-rl-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),e.on("click","#bb-rl-media-model-container .document-privacy>li",this.documentPrivacyChange.bind(this)),e.on("click","#bb-rl-media-model-container .bb-rl-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),e.on("click","#bb-rl-media-model-container .bb-rl-document-section span.privacy",bp.Nouveau,this.toggleDocumentPrivacyDropdown.bind(this)),e.on("click",".bp-add-media-activity-description",this.openMediaActivityDescription.bind(this)),e.on("click","#bp-activity-description-new-reset",this.closeMediaActivityDescription.bind(this)),e.on("keyup",".bp-edit-media-activity-description #add-activity-description",this.MediaActivityDescriptionUpdate.bind(this)),e.on("click","#bp-activity-description-new-submit",this.submitMediaActivityDescription.bind(this)),e.on("click",".bb-rl-media-thumb",this.handleThumbnailClick.bind(this)),e.click(this.togglePopupDropdown),document.addEventListener("keyup",this.checkPressedKeyDocuments.bind(this)),document.addEventListener("keyup",this.checkPressedKey.bind(this))},checkPressedKey:function(e){var t=this;if(e=e||window.event,!t.is_open_media)return!1;var i=h(e.target).hasClass("ac-input")||"add-activity-description"===h(e.target).attr("id");switch(e.keyCode){case 27:t.closeTheatre(e);break;case 37:if(void 0===t.medias[t.current_index-1]||i)return!1;t.previous(e);break;case 39:if(void 0===t.medias[t.current_index+1]||i)return!1;t.next(e)}},checkPressedKeyDocuments:function(e){e=e||window.event;var t=this;if(!t.is_open_document)return!1;var i=h(e.target).hasClass("ac-input")||"add-activity-description"===h(e.target).attr("id");switch(e.keyCode){case 27:t.closeDocumentTheatre(e);break;case 37:if(void 0===t.documents[t.current_document_index-1]||i)return!1;t.previousDocument(e);break;case 39:if(void 0===t.documents[t.current_document_index+1]||i)return!1;t.nextDocument(e)}},handleOpenTheatre:function(e){var t=e.target,i=e.self||this,a=e.modalWrapper,o=e.mediaType,e=e.action,d=(i.setupGlobals(),i.setMedias({target:t,modalWrapper:a,mediaType:o,action:e}),t.data("id")),d=(i.setCurrentMedia(d),i.showMedia({modalWrapper:a,mediaType:o,action:e}),i.navigationCommands(),i.current_activity_data&&i.generateAndDisplayMediaThumbnails({target:t,modalWrapper:a,mediaType:o,action:e}),i.getParentActivityHtml({target:t,modalWrapper:a,mediaType:o,action:e}),i.getMediasDescription({modalWrapper:a,mediaType:o,action:e}),t.closest(".activity-item").data("activity-popup-title")),o=(h(a+" .bb-rl-media-model-header h2").text(d),h(a+".document").hide(),document.getElementById(h(a+".video video").attr("id")));o&&o.pause(),h(a+".video").length&&h(a+".video").hide(),h(a+"."+e).length&&h(a+"."+e).show(),i.is_open_media=!0},openTheatre:function(e){e.preventDefault();var t=h(e.currentTarget);if(this.current_activity_data=t.closest(".activity-item").data("bp-activity"),t.closest("#bp-existing-media-content").length)return!1;this.handleOpenTheatre({self:this,target:t,event:e,modalWrapper:".bb-rl-media-model-wrapper",action:"media"})},getParentActivityHtml:function(e){var t=e.target,e=e.action;if("comment"===t.data("privacy"))return!1;var i=h("#hidden_parent_id"),a=i.val(),t=t.closest(".bb-rl-"+e+"-model-wrapper").find("#bb-rl-"+e+"-model-container .bb-rl-activity-list li.activity-item").data("bp-activity-id");parseInt(a)===parseInt(t)&&(t=h("#bb-rl-"+e+'-model-container [data-bp-activity-id="'+a+'"]'),h('[data-bp-activity-id="'+a+'"] > .activity-state').html(h(t).find(".activity-state").html()),h('[data-bp-activity-id="'+a+'"] > .activity-meta').html(h(t).find(".activity-meta").html()),h('[data-bp-activity-id="'+a+'"] > .bb-rl-activity-comments').html(h(t).find(".bb-rl-activity-comments").html())),i.length&&i.remove()},getMediasDescription:function(e){var t=e.action;this.fetchMediaDescription(this.current_media,h(".bb-rl-"+t+"-model-wrapper"),e)},openDocumentTheatre:function(e){e.preventDefault();var t=h(e.currentTarget),i=this;if(t.closest("#bp-existing-document-content").length)return!1;t.closest(".document.bb-rl-document-theatre").length&&i.closeDocumentTheatre(e),a=t.data("id"),i.setupGlobals(),i.setDocuments(t),i.setCurrentDocument(a),i.showDocument(),i.navigationDocumentCommands(),i.getParentActivityHtml({target:t,action:"media"}),i.getDocumentsDescription();var a=t.closest(".activity-item").data("activity-popup-title"),t=(h(".bb-rl-media-model-wrapper .bb-rl-media-model-header h2").text(a),-1!==h.inArray(i.current_document.extension,n.mp3_preview_extension.split(","))&&h(e.currentTarget).closest(".bb-rl-activity-media-elem.bb-rl-document-activity").length&&h(e.currentTarget).closest(".bb-rl-activity-media-elem.bb-rl-document-activity").find(".bb-rl-document-audio-wrap").length&&h(e.currentTarget).closest(".bb-rl-activity-media-elem.bb-rl-document-activity").find(".bb-rl-document-audio-wrap audio")[0].pause(),h(".bb-rl-media-model-wrapper.media").hide(),h(".bb-rl-media-model-wrapper.document").show(),document.getElementById(h(".bb-rl-media-model-wrapper.video video").attr("id")));t&&(t.pause(),t.src=""),h(".bb-rl-media-model-wrapper.video").hide(),i.is_open_document=!0},resetRemoveActivityCommentsData:function(e){var t,i=this,a=!1,o=!1,d=!1,r=!1,n=!1,s=!1;i.current_media.parent_activity_comments&&((a=(r=h(".bb-rl-"+e+'-model-wrapper.media [data-bp-activity-id="'+i.current_media.activity_id+'"]')).find(".bb-rl-activity-comments")).length&&(t=a.find("#ac-form-"+i.current_media.activity_id),this.purgeEditActivityForm(t),t.find("#ac-input-"+i.current_media.activity_id).html(""),t.removeClass("has-content has-gif has-media").addClass("root"),a.append(t),t.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),this.resetActivityMedia(i.current_media.activity_id),a.find(".acomment-display").removeClass("display-focus"),a.find(".comment-item").removeClass("comment-item-focus"),n=a.html(),s=a.attr("class"),a.remove(),(a=h('[data-bp-activity-id="'+i.current_media.activity_id+'"] .bb-rl-activity-comments')).length)&&(a.attr("class",s),0===a.find("#ac-form-"+i.current_media.activity_id).length)&&(a.append(t),a.children("form").removeClass("events-initiated").addClass("not-initialized")),(d=r.find(".activity-state")).length&&(n=d.html(),s=d.attr("class"),d.remove(),(d=h('[data-bp-activity-id="'+i.current_media.activity_id+'"] .activity-state')).length)&&(d.html(n),d.attr("class",s)),(o=r.find(".activity-meta")).length&&(n=o.html(),s=o.attr("class"),o.remove(),(o=h('[data-bp-activity-id="'+i.current_media.activity_id+'"] > .activity-meta')).length)&&(o.html(n),o.attr("class",s)),r.remove()),i.current_document.parent_activity_comments&&((a=(r=h(".bb-rl-"+e+'-model-wrapper.document [data-bp-activity-id="'+i.current_document.activity_id+'"]')).find(".bb-rl-activity-comments")).length&&(t=a.find("#ac-form-"+i.current_document.activity_id),this.purgeEditActivityForm(t),t.find("#ac-input-"+i.current_document.activity_id).html(""),t.removeClass("has-content has-gif has-media").addClass("root"),a.append(t),t.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),this.resetActivityMedia(i.current_document.activity_id),a.find(".acomment-display").removeClass("display-focus"),a.find(".comment-item").removeClass("comment-item-focus"),n=a.html(),s=a.attr("class"),a.remove(),(a=h('[data-bp-activity-id="'+i.current_document.activity_id+'"] .bb-rl-activity-comments')).length)&&(a.attr("class",s),0===a.find("#ac-form-"+i.current_document.activity_id).length&&(a.append(t),a.children("form").removeClass("events-initiated").addClass("not-initialized")),a.find(".bb-rl-document-text.loaded").removeClass("loaded").find(".CodeMirror").remove(),jQuery(window).scroll()),(d=r.find(".activity-state")).length&&(n=d.html(),s=d.attr("class"),d.remove(),(d=h('[data-bp-activity-id="'+i.current_document.activity_id+'"] .activity-state')).length)&&(d.html(n),d.attr("class",s)),(o=r.find(".activity-meta")).length&&(n=o.html(),s=o.attr("class"),o.remove(),(o=h('[data-bp-activity-id="'+i.current_document.activity_id+'"] > .activity-meta')).length)&&(o.html(n),o.attr("class",s)),r.remove()),bp.Nouveau.reportPopUp(),bp.Nouveau.reportActions()},closeTheatre:function(e){e.preventDefault();var e=h(e.currentTarget),t="";if(e.closest(".bb-rl-internal-model").hasClass("media-video")?t="media-video":e.closest(".bb-rl-internal-model").hasClass("media")?t="media":e.closest(".bb-rl-internal-model").hasClass("video")&&(t="video"),h(e).closest(".bb-rl-"+t+"-model-wrapper").hasClass("bb-rl-video-theatre"))return!1;var i=h(".bb-rl-"+t+"-model-wrapper.media .bb-rl-media-section"),i=(i.find("img").attr("src",""),i.find("video"));i.length&&videojs(i.attr("id")).reset(),h(".bb-rl-"+t+"-model-wrapper").hide(),this.is_open_media=!1,this.resetRemoveActivityCommentsData(t),this.current_media=!1,this.getParentActivityHtml({target:e,action:t})},closeDocumentTheatre:function(e){e.preventDefault();var t=h(document).find(".bb-rl-document-theatre");t.find(".bb-rl-media-section").removeClass("bb-media-no-preview").find(".document-preview").html(""),h(".bb-media-info-section.document").show(),t.hide(),this.is_open_document=!1,this.resetRemoveActivityCommentsData("media"),this.current_document=!1,this.getParentActivityHtml({target:h(e.currentTarget),action:"media"})},ToggleTheatreSidebar:function(e){e.preventDefault(),h(e.currentTarget).closest(".bb-rl-media-model-container").toggleClass("bb-rl-media-toggle-sidebar")},setMedias:function(e){var t=e.target,e=e.action,i=h(t),a=0;if("media-video"===e&&(i=h(".bb-rl-open-"+e+"-theatre")),void 0!==(i=h("body").hasClass("activity")?h(t).closest(".bb-activity-media-wrap").find(".bb-rl-open-"+e+"-theatre"):i)){this.medias=[];for(var o=i.length,a=0;a<o;a++){var d,r=h(i[a]);r.closest("#bp-existing-media-content").length||(d={id:r.data("id"),attachment:r.data("attachment-full"),activity_id:r.data("activity-id"),attachment_id:r.data("attachment-id"),privacy:r.data("privacy"),parent_activity_id:r.data("parent-activity-id"),album_id:r.data("album-id"),group_id:r.data("group-id"),can_edit:r.data("can-edit"),is_forum:!1,type:r.data("type")||"media"},r.closest(".forums-media-wrap").length&&(d.is_forum=!0),d.is_message=void 0!==d.privacy&&"message"===d.privacy,this.medias.push(d))}}},setDocuments:function(e){var t=h(".bb-rl-open-document-theatre"),i=0;if(h(e).closest(".bp-search-ac-header").length?t=h(e).closest(".bp-search-ac-header").find(".bb-rl-open-document-theatre"):h("body").hasClass("activity")&&0===h(e).closest(".search-document-list").length&&(t=h(e).closest(".bb-activity-media-wrap").find(".bb-rl-open-document-theatre")),void 0!==t){this.documents=[];for(var a=t.length,i=0;i<a;i++){var o,d=h(t[i]);t.closest("#bp-existing-document-content").length||(o={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),extension:d.data("extension"),target_text:d.data("document-title"),preview:d.data("preview"),full_preview:d.data("full-preview"),text_preview:d.data("text-preview"),mirror_text:d.data("mirror-text"),target_icon_class:d.data("icon-class"),author:d.data("author"),download:d.attr("href"),mp3:d.data("mp3-preview"),can_edit:d.data("can-edit"),video:d.attr("data-video-preview"),is_forum:!1},d.closest(".forums-media-wrap").length&&(o.is_forum=!0),o.is_message=void 0!==o.privacy&&"message"===o.privacy,this.documents.push(o))}}},setCurrentMedia:function(e){for(var t=this,i=t.medias.length,a=0;a<i;a++)if(e===t.medias[a].id){t.current_media=t.medias[a],t.current_index=a;break}},setCurrentDocument:function(e){for(var t=this,i=t.documents.length,a=0;a<i;a++)if(e===t.documents[a].id){t.current_document=t.documents[a],t.current_document_index=a;break}},showMedia:function(e){var t=this,i=e.modalWrapper,a=e.mediaType;if(void 0===t.current_media)return!1;"media-video"===e.action?(e=h(i+" .bb-rl-media-section figure"),"video"===a?h(i+" .bb-rl-media-section").find("figure").addClass("loading").html('<i class="bb-rl-loader"></i>'):h(i+" .bb-rl-media-section").children("img").length?e.find("img").attr("src",t.current_media.attachment):e.html('<img src="'+t.current_media.attachment+'" alt="" />')):h(i+" .bb-rl-media-section").find("img").attr("src",t.current_media.attachment);a=h(".bb-rl-media-section .bb-media-privacy-wrap");a.length&&(a.show(),a.find("ul.media-privacy li").removeClass("selected"),a.find(".bp-tooltip").attr("data-bp-tooltip",""),(e=a.find("ul.media-privacy").find("li[data-value="+t.current_media.privacy+"]")).addClass("selected"),a.find(".bp-tooltip").attr("data-bp-tooltip",e.text()),a.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(t.current_media.privacy),!(void 0!==s&&void 0!==t.current_media.activity_id&&0!==t.current_media.activity_id||t.group_id||t.current_media.is_forum||t.current_media.group_id||t.current_media.album_id||t.current_media.is_message)&&t.can_manage_media&&t.current_media.can_edit||a.hide()),t.navigationCommands()},showDocument:function(){var e=this;if(void 0===e.current_document)return!1;var t,i=e.current_document.target_text,a=e.current_document.target_icon_class,o=h(document).find(".bb-rl-document-theatre"),d=e.current_document.extension,r=e.current_document.mirror_text,d=(o.find(".bb-rl-document-section").removeClass("bb-video-preview"),-1!==h.inArray(e.current_document.extension,["css","txt","js","html","htm","csv"])?(o.find(".bb-rl-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),o.find(".bb-rl-document-section").removeClass("bb-media-no-preview"),o.find(".bb-rl-document-section .document-preview").html(""),o.find(".bb-rl-document-section .document-preview").html("<h3>"+i+'</h3><div class="bb-rl-document-text"><textarea class="bb-rl-document-text-file-data-hidden"></textarea></div>'),o.find(".bb-rl-document-section .document-preview .bb-rl-document-text").attr("data-extension",d),t=o.find(".bb-rl-document-section .document-preview .bb-rl-document-text textarea"),"html"===d||"htm"===d?t.val(r):t.html(r),setTimeout(function(){bp.Nouveau.Media.documentCodeMirror()},1e3)):-1!==h.inArray(e.current_document.extension,n.mp3_preview_extension.split(","))?(o.find(".bb-rl-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),o.find(".bb-rl-document-section").removeClass("bb-media-no-preview"),o.find(".bb-rl-document-section .document-preview").html(""),o.find(".bb-rl-document-section .document-preview").html('<div class="img-section"><h3>'+i+'</h3><div class="document-audio"><audio src="'+e.current_document.mp3+'" controls controlsList="nodownload"></audio></div></div>')):-1!==h.inArray("."+e.current_document.extension,u.video_type.split(","))?(o.find(".bb-rl-document-section").addClass("bb-video-preview"),o.find(".bb-rl-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),o.find(".bb-rl-document-section").removeClass("bb-media-no-preview"),o.find(".bb-rl-document-section .document-preview").html(""),"mov"===e.current_document.extension||"m4v"===e.current_document.extension?o.find(".bb-rl-document-section .document-preview").html('<video playsinline id="video-'+e.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+e.current_document.video+'" type="video/mp4" ></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'):o.find(".bb-rl-document-section .document-preview").html('<video playsinline id="video-'+e.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+e.current_document.video+'" type="video/'+e.current_document.extension+'" ></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'),h(window).scroll()):e.current_document.full_preview?(o.find(".bb-rl-document-section").removeClass("bb-media-no-preview"),o.find(".bb-rl-document-section .document-preview").html(""),o.find(".bb-rl-document-section .document-preview").html("<h3>"+i+'</h3><div class="img-section"><div class="img-block-wrap"> <img src="'+e.current_document.full_preview+'" alt=""/></div></div>')):(o.find(".bb-rl-document-section").addClass("bb-media-no-preview"),o.find(".bb-rl-document-section .document-preview").html(""),o.find(".bb-rl-document-section .document-preview").html('<div class="img-section"> <i class="'+a+'"></i><p>'+i+"</p></div>")),h(".bb-rl-document-section .bb-document-privacy-wrap"));d.length&&(d.show(),d.parent().show(),d.find("ul.document-privacy li").removeClass("selected"),d.find(".bp-tooltip").attr("data-bp-tooltip",""),(t=d.find("ul.document-privacy").find("li[data-value="+e.current_document.privacy+"]")).addClass("selected"),d.find(".bp-tooltip").attr("data-bp-tooltip",t.text()),d.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_document.privacy),void 0!==s&&void 0!==e.current_document.activity_id&&0!==e.current_document.activity_id||e.group_id||e.current_document.is_forum||e.current_document.group_id||e.current_document.album_id||!e.can_manage_document||!e.current_document.can_edit||e.current_document.is_message)&&d.parent().hide(),e.navigationDocumentCommands()},generateAndDisplayMediaThumbnails:function(e){var t,i=e.target,e=e.action,a=this;a.current_activity_data=i.closest(".activity-item").data("bp-activity"),!a.current_activity_data||!a.current_activity_data.media||a.current_activity_data.media.length<=1||(i=a.current_activity_data.media.map(function(e){return'<div class="bb-rl-media-thumb'+(e.id===a.current_media.id?" active":"")+'" data-id="'+e.id+'" data-attachment-id="'+e.attachment_id+'" data-activity-id="'+a.current_media.activity_id+'"><img src="'+e.thumb+'" alt="'+(e.name||"")+'" data-full-img="'+e.url+'"/></div>'}).join(""),(t=(e=h("."+e+".bb-rl-"+e+"-theatre .bb-rl-media-section")).find(".bb-rl-media-thumbnails")).length?t.html(i):e.append('<div class="bb-rl-media-thumbnails">'+i+"</div>"))},handleThumbnailClick:function(e){var t,i,a,e=h(e.currentTarget);!e.hasClass("active")&&((i=h(".bb-rl-media-model-wrapper.media .bb-rl-media-section").find("figure")).find("img").hide(),i.addClass("loading").append('<i class="bb-rl-loader"></i>'),t=e.data("id"),i=this.medias.find(function(e){return e.id===t}))&&(a="",e.closest(".bb-rl-internal-model").hasClass("media-video")?a="media-video":e.closest(".bb-rl-internal-model").hasClass("media")?a="media":e.closest(".bb-rl-internal-model").hasClass("video")&&(a="video"),this.updateMedia(i,e,{modalWrapper:".bb-rl-"+a+"-model-wrapper",action:a}))},next:function(e){e.preventDefault();var e=h(e.currentTarget),t="";e.closest(".bb-rl-internal-model").hasClass("media-video")?t="media-video":e.closest(".bb-rl-internal-model").hasClass("media")?t="media":e.closest(".bb-rl-internal-model").hasClass("video")&&(t="video");var e={modalWrapper:".bb-rl-"+t+"-model-wrapper",action:t},i=this;i.current_activity_data&&i.medias[i.current_index+1]?i.updateMedia(i.medias[i.current_index+1],h("."+t+".bb-rl-"+t+"-theatre .bb-rl-media-thumb").eq(i.current_index+1),e):(i.resetRemoveActivityCommentsData(t),void 0!==i.medias[i.current_index+1]?(i.current_index=i.current_index+1,i.current_media=i.medias[i.current_index],e.mediaType=i.medias[i.current_index].type||"",i.showMedia(e),i.getMediasDescription(e)):i.nextLink.hide())},previous:function(e){e.preventDefault();var e=h(e.currentTarget),t="";e.closest(".bb-rl-internal-model").hasClass("media-video")?t="media-video":e.closest(".bb-rl-internal-model").hasClass("media")?t="media":e.closest(".bb-rl-internal-model").hasClass("video")&&(t="video");var e={modalWrapper:".bb-rl-"+t+"-model-wrapper",action:t},i=this;i.current_activity_data&&i.medias[i.current_index-1]?i.updateMedia(i.medias[i.current_index-1],h("."+t+".bb-rl-"+t+"-theatre .bb-rl-media-thumb").eq(i.current_index-1),e):(i.resetRemoveActivityCommentsData(t),void 0!==i.medias[i.current_index-1]?(i.current_index=i.current_index-1,i.current_media=i.medias[i.current_index],e.mediaType=i.medias[i.current_index].type||"",i.showMedia(e),i.getMediasDescription(e)):i.previousLink.hide())},updateMedia:function(t,e,i){var a=i.action,o=this,a=h("."+a+".bb-rl-"+a+"-theatre"),d=a.find(".bb-rl-media-section figure"),r=d.find("img");r.one("load",function(){d.removeClass("loading").find(".bb-rl-loader").remove(),r.show()}).one("error",function(){d.removeClass("loading").find(".bb-rl-loader").remove()}).attr("src",t.attachment),a.find(".bb-rl-media-thumb").removeClass("active"),e.addClass("active"),o.current_index=o.medias.findIndex(function(e){return e.id===t.id}),o.current_media=t,o.nextLink.toggle(Boolean(o.medias[o.current_index+1])),o.previousLink.toggle(Boolean(o.medias[o.current_index-1])),o.activity_ajax&&o.activity_ajax.abort(),o.fetchMediaDescription(t,a,i)},fetchMediaDescription:function(o,d,e){var r=e.mediaType,n=e.action,s=this,e=(!1!==s.activity_ajax&&s.activity_ajax.abort(),h('[data-bp-activity-id="'+o.activity_id+'"] .bb-rl-activity-comments')),e=(e.length&&(e=e.find("#ac-form-"+o.activity_id),o.parent_activity_comments=!0,e.remove()),!0===o.parent_activity_comments&&h(".bb-rl-"+n+"-model-wrapper:last").after('<input type="hidden" value="'+o.activity_id+'" id="hidden_parent_id"/>'),{id:o.id,attachment_id:o.attachment_id,activity_id:o.activity_id});"media-video"===n&&"video"===r?(e.action="video_get_video_description",e.nonce=w.video):(e.action="media_get_media_description",e.nonce=w.media),s.activity_ajax=h.ajax({type:"POST",url:y,data:e,beforeSend:function(){d.find(".bb-media-info-section .bb-rl-activity-list").addClass("loading").html('<i class="bb-rl-loader"></i>')},success:function(e){var t,i,a;e.success?(t=d.find(".bb-media-info-section:visible"),i=h(".bb-rl-"+n+"-model-wrapper"),"media-video"===n&&"video"===r&&((a=i.find(".bb-rl-media-section figure")).html(e.data.video_data),a.find("video").attr("autoplay",!0)),t.find(".bb-rl-activity-list").removeClass("loading").html(e.data.description),void 0!==e.data.comment_form&&void 0!==bp.Nouveau.Activity&&(t.find(".bb-rl-activity-list .bb-rl-activity-comments ul:first").after(e.data.comment_form),t.find("#ac-form-"+o.activity_id).removeClass("not-initialized").addClass("root events-initiated").find("#ac-input-"+o.activity_id).focus(),a=t.find("#ac-form-"+o.activity_id),bp.Nouveau.Activity.clearFeedbackNotice(a),a.removeClass("events-initiated"),e=t.find(".ac-form .ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(e),_.isUndefined(g)||_.isUndefined(g.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#bb-rl-activity-modal ",o.activity_id)),t.show(),t.find(".bb-activity-more-options-action").attr("data-balloon-pos","left"),s.updateTheaterHeaderTitle({wrapper:i,action:n}),requestAnimationFrame(function(){h(window).scroll(),bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()})):d.find(".bb-media-info-section.media").hide()}})},nextDocument:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData("media"),void 0!==e.documents[e.current_document_index+1]?(e.current_document_index=e.current_document_index+1,e.current_document=e.documents[e.current_document_index],e.showDocument(),e.getDocumentsDescription()):e.nextDocumentLink.hide()},previousDocument:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData("media"),void 0!==e.documents[e.current_document_index-1]?(e.current_document_index=e.current_document_index-1,e.current_document=e.documents[e.current_document_index],e.showDocument(),e.getDocumentsDescription()):e.previousDocumentLink.hide()},navigationCommands:function(){var e=this;0===e.current_index&&e.current_index!==e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0===e.current_index&&e.current_index===e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index===e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},navigationDocumentCommands:function(){var e=this;0===e.current_document_index&&e.current_document_index!==e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.show()):0===e.current_document_index&&e.current_document_index===e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.hide()):e.current_document_index===e.documents.length-1?(e.previousDocumentLink.show(),e.nextDocumentLink.hide()):(e.previousDocumentLink.show(),e.nextDocumentLink.show())},getDocumentsDescription:function(){var t=this,e=(h(".bb-media-info-section .bb-rl-activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!==t.activity_ajax&&t.activity_ajax.abort(),h('[data-bp-activity-id="'+t.current_document.activity_id+'"] .bb-rl-activity-comments'));e.length&&(e=e.find("#ac-form-"+t.current_document.activity_id),t.current_document.parent_activity_comments=!0,e.remove()),!0===t.current_document.parent_activity_comments&&h(".bb-rl-media-model-wrapper:last").after('<input type="hidden" value="'+t.current_document.activity_id+'" id="hidden_parent_id"/>'),t.activity_ajax=h.ajax({type:"POST",url:y,data:{action:"document_get_document_description",id:t.current_document.id,attachment_id:t.current_document.attachment_id,nonce:w.media},success:function(e){e.success?(h(".bb-media-info-section:visible .bb-rl-activity-list").removeClass("loading").html(e.data.description),void 0!==e.data.comment_form&&void 0!==bp.Nouveau.Activity&&(h(".bb-media-info-section:visible .bb-rl-activity-list .bb-rl-activity-comments ul:first").after(e.data.comment_form),h(".bb-media-info-section:visible").find("#ac-form-"+t.current_document.activity_id).removeClass("not-initialized").addClass("root events-initiated").find("#ac-input-"+t.current_document.activity_id).focus(),e=h(".bb-media-info-section:visible").find("#ac-form-"+t.current_document.activity_id),bp.Nouveau.Activity.clearFeedbackNotice(e),e.removeClass("events-initiated"),e=h(".bb-media-info-section:visible").find(".ac-form .ac-input[contenteditable]"),bp.Nouveau.Activity.listenCommentInput(e),_.isUndefined(g)||_.isUndefined(g.emoji)||bp.Nouveau.Activity.initializeEmojioneArea(!0,"#bb-rl-activity-modal ",t.current_document.activity_id)),h(".bb-media-info-section:visible").show(),t.updateTheaterHeaderTitle({wrapper:h(".bb-rl-media-model-wrapper"),action:"media"}),h(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10),h(".bb-media-info-section:visible").find(".bb-activity-more-options-action").attr("data-balloon-pos","left")):h(".bb-media-info-section.document").hide()}})},activityDeleted:function(e,t){var i=this,a=0;if(i.is_open_media&&void 0!==t&&"delete_activity"===t.action&&i.current_media.activity_id===t.id){for(var o=h(document).find('[data-bp-list="media"] .bb-rl-open-media-theatre[data-id="'+i.current_media.id+'"]'),d=o.parents("ul"),r=(o.closest("li").remove(),0===d.find("li:not(.load-more)").length&&(0<(o=h(".bb-photos-actions")).length&&o.hide(),1===d.find("li.load-more").length)&&location.reload(),h(document).find('[data-bp-list="activity"] .bb-rl-open-media-theatre[data-id="'+i.current_media.id+'"]').closest(".bb-rl-activity-media-elem").remove(),i.medias.length),a=0;a<r;a++)if(i.medias[a].activity_id===t.id){i.medias.splice(a,1);break}0===i.current_index&&i.current_index!==i.medias.length?(i.current_index=-1,i.next(e)):0===i.current_index&&i.current_index===i.medias.length?(h(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+i.current_media.activity_id+'"]').remove(),i.closeTheatre(e)):i.current_index===i.medias.length?i.previous(e):(i.current_index=-1,i.next(e))}if(i.is_open_document&&void 0!==t&&"delete_activity"===t.action&&i.current_document.activity_id===t.id){h(document).find('[data-bp-list="document"] .bb-rl-open-document-theatre[data-id="'+i.current_document.id+'"]').closest('div.ac-document-list[data-activity-id="'+i.current_document.activity_id+'"]').remove(),h(document).find('[data-bp-list="activity"] .bb-rl-open-document-theatre[data-id="'+i.current_document.id+'"]').closest(".bb-rl-activity-media-elem").remove();var n=i.documents.length;for(a=0;a<n;a++)if(i.documents[a].activity_id===t.id){i.documents.splice(a,1);break}0===i.current_document_index&&i.current_document_index!==i.documents.length?(i.current_document_index=-1,i.nextDocument(e)):0===i.current_document_index&&i.current_document_index===i.documents.length?(h(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+i.current_document.activity_id+'"]').remove(),i.closeDocumentTheatre(e)):i.current_document_index===i.documents.length?i.previousDocument(e):(i.current_document_index=-1,i.nextDocument(e))}},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||h(t).hasClass("privacy-wrap")||h(t).parent().hasClass("privacy-wrap")?e:(h("ul.media-privacy").removeClass("bb-open"),void h("ul.document-privacy").removeClass("bb-open"))},togglePrivacyDropdown:function(e){var t=h(e.target);e.preventDefault(),t.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var t,i=h(e.target),a=i.data("value");if(e.preventDefault(),i.hasClass("selected"))return!1;i.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),t=i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),i.addClass("selected"),h.ajax({type:"POST",url:y,data:{action:"media_update_privacy",id:this.current_media.id,_wpnonce:w.media,privacy:a},success:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(t),i.closest(".bb-media-privacy-wrap").find(".privacy").addClass(a),i.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i.text())},error:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})},openMediaActivityDescription:function(e){e.preventDefault();e=h(e.currentTarget);if(e.parents(".activity-media-description").find(".bp-edit-media-activity-description").length<1)return!1;e.parents(".activity-media-description").find(".bp-edit-media-activity-description").show().addClass("open"),e.parents(".activity-media-description").find(".bp-media-activity-description").hide(),e.hide()},closeMediaActivityDescription:function(e){e.preventDefault();e=h(e.currentTarget);if(e.parents(".activity-media-description").length<1)return!1;var t=e.parents(".activity-media-description").find("#add-activity-description").get(0).defaultValue;e.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),e.parents(".activity-media-description").find(".bp-media-activity-description").show(),e.parents(".activity-media-description").find("#add-activity-description").val(t),e.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open")},MediaActivityDescriptionUpdate:function(e){e=h(e.currentTarget);""!==e.val().trim()?e.closest(".bp-edit-media-activity-description").addClass("has-content"):e.closest(".bp-edit-media-activity-description").removeClass("has-content")},submitMediaActivityDescription:function(e){e.preventDefault();var t=h(e.currentTarget),i=t.parents(".activity-media-description"),e={action:"media_description_save",description:i.find("#add-activity-description").val(),attachment_id:i.find("#bp-attachment-id").val(),_wpnonce:w.media};h.ajax({type:"POST",url:y,data:e,async:!1,success:function(e){e.success?(t.parents(".activity-media-description").find(".bp-media-activity-description").html(e.data.description).show(),t.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),i.find("#add-activity-description").val(e.data.description),i.find("#add-activity-description").get(0).defaultValue=e.data.description,""===e.data.description?t.parents(".activity-media-description").find(".bp-add-media-activity-description").removeClass("show-edit").addClass("show-add"):t.parents(".activity-media-description").find(".bp-add-media-activity-description").addClass("show-edit").removeClass("show-add"),t.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open"),t.parents(".activity-media-description").find(".bp-media-activity-description").show(),t.parents(".activity-media-description").find(".bp-feedback.error").remove()):t.parents(".activity-media-description").prepend(e.data.feedback)}})},toggleDocumentPrivacyDropdown:function(e){var t=h(e.target);e.preventDefault(),t.closest(".bb-document-privacy-wrap").find(".document-privacy").toggleClass("bb-open")},documentPrivacyChange:function(e){var t,i=h(e.target),a=i.data("value");if(e.preventDefault(),i.hasClass("selected"))return!1;i.closest(".bb-document-privacy-wrap").find(".privacy").addClass("loading"),t=i.closest(".bb-document-privacy-wrap").find("ul.document-privacy li.selected").data("value"),i.closest(".bb-document-privacy-wrap").find("ul.document-privacy li").removeClass("selected"),i.addClass("selected"),h.ajax({type:"POST",url:y,data:{action:"document_save_privacy",item_id:this.current_document.id,_wpnonce:w.media,value:a,type:"document"},success:function(){i.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading").removeClass(t),i.closest(".bb-document-privacy-wrap").find(".privacy").addClass(a),i.closest(".bb-document-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i.text())},error:function(){i.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading")}})},resetActivityMedia:function(t){["media","document","video","gif"].forEach(function(e){bp.Nouveau.Activity.destroyUploader(e,t)})},purgeEditActivityForm:function(e){var t,i,a;e.hasClass("acomment-edit")&&(t=e.attr("data-item-id"),a=(i=h('[data-bp-activity-comment-id="'+t+'"]')).find("#acomment-edit-form-"+t),i.find("#acomment-display-"+t).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),a.empty())},updateTheaterHeaderTitle:function(e){var t=e.wrapper,e=e.action,t=t.find(".activity-item");t.find(".bb-rl-activity-header").length&&(t=t.find(".bb-rl-activity-header a").first()).length&&(t=t.text()+g.i18n_strings.theater_title,h(".bb-rl-"+e+"-model-wrapper .bb-rl-media-model-header h2").text(t))}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())})((bp,jQuery));