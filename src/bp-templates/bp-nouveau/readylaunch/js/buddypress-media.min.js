window.bp=window.bp||{},function(b){var e,f,s,m,h,n,v,r,t;"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},f=(e=BP_Nouveau).media,s=e.document,m=e.ajaxurl,h=e.video,n=e.is_send_ajax_request,v=e.nonces,r=e.activity,t=void 0!==window.BP_Forums_Nouveau&&(window.BP_Forums_Nouveau.media,1)?window.BP_Forums_Nouveau.media:{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=b("body");this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-dropzone-content",this.sort_by="",this.order_by="",this.currentTargetParent=f.current_folder,this.moveToIdPopup=f.move_to_id_popup,this.moveToTypePopup=f.current_type,this.privacySelectorSelect="",this.privacySelectorSpan="",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1);e=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"";this.documentOptions=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:f.dictFileTooBig,acceptedFiles:f.document_type,createImageThumbnails:!1,dictDefaultMessage:f.dropzone_document_message,maxFiles:void 0!==s.maxFiles?s.maxFiles:10,maxFilesize:void 0!==s.max_upload_size?s.max_upload_size:2,dictInvalidFileType:s.dictInvalidFileType,dictMaxFilesExceeded:f.document_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation});var i,e=document.getElementsByClassName("forum-post-video-template").length?document.getElementsByClassName("forum-post-video-template")[0].innerHTML:"";this.videoOptions=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:h.dictFileTooBig,acceptedFiles:h.video_type,createImageThumbnails:!1,dictDefaultMessage:h.dropzone_video_message,maxFiles:void 0!==h.maxFiles?h.maxFiles:10,maxFilesize:void 0!==h.max_upload_size?h.max_upload_size:2,dictInvalidFileType:h.dictInvalidFileType,dictMaxFilesExceeded:h.video_dict_file_exceeded,previewTemplate:e,dictCancelUploadConfirmation:h.dictCancelUploadConfirmation}),b("#bp-media-uploader").hasClass("bp-media-document-uploader")?(i=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"",this.options=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:f.dictFileTooBig,acceptedFiles:f.document_type,createImageThumbnails:!1,dictDefaultMessage:f.dropzone_document_message,maxFiles:void 0!==s.maxFiles?s.maxFiles:10,maxFilesize:void 0!==s.max_upload_size?s.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:f.document_dict_file_exceeded,previewTemplate:i,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation})):(i=document.getElementsByClassName("forum-post-media-template").length?document.getElementsByClassName("forum-post-media-template")[0].innerHTML:"",this.options=bp.Readylaunch.Utilities.createDropzoneOptions({dictFileTooBig:f.dictFileTooBig,dictDefaultMessage:f.dropzone_media_message,acceptedFiles:"image/*",maxFiles:void 0!==f.maxFiles?f.maxFiles:10,maxFilesize:void 0!==f.max_upload_size?f.max_upload_size:2,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictMaxFilesExceeded:f.media_dict_file_exceeded,previewTemplate:i,dictCancelUploadConfirmation:f.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==f.max_upload_size?f.max_upload_size:2})),void 0!==f.dropzone_options&&Object.assign(this.options,f.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==f.album_id&&f.album_id,this.current_folder=void 0!==f.current_folder&&f.current_folder,this.current_group_id=void 0!==f.current_group_id&&f.current_group_id,this.group_id=void 0!==f.group_id&&f.group_id,this.bbp_is_reply_edit=void 0!==t.bbp_is_reply_edit&&t.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==t.bbp_is_topic_edit&&t.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==t.bbp_is_forum_edit&&t.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==t.reply_edit_media?t.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==t.reply_edit_document?t.reply_edit_document:[],this.bbp_reply_edit_video=void 0!==t.reply_edit_video?t.reply_edit_video:[],this.bbp_topic_edit_media=void 0!==t.topic_edit_media?t.topic_edit_media:[],this.bbp_topic_edit_video=void 0!==t.topic_edit_video?t.topic_edit_video:[],this.bbp_topic_edit_document=void 0!==t.topic_edit_document?t.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==t.forum_edit_media?t.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==t.forum_edit_document?t.forum_edit_document:[],this.bbp_forum_edit_video=void 0!==t.forum_edit_video?t.forum_edit_video:[],this.bbp_reply_edit_gif_data=void 0!==t.reply_edit_gif_data?t.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==t.topic_edit_gif_data?t.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==t.forum_edit_gif_data?t.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1,this.reply_topic_allow_delete_media=!1,this.reply_topic_display_post="edit",bp.Nouveau.Media.documentCodeMirror(),b(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var e=b(".bp-nouveau"),i=b(".bp-existing-media-wrap"),t=b(document),a=b(".buddypress.groups.messages");e.on("click","#bp-add-media",this.openUploader.bind(this)),e.on("click","#bp-add-document",this.openDocumentUploader.bind(this)),e.on("click","#bp-media-submit",this.submitMedia.bind(this)),e.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),e.on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),e.on("click","#bb-delete-media",this.deleteMedia.bind(this)),e.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),void 0!==n&&"1"===n?b('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request):this.bp_media_after_load(),e.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),t.on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),t.on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),t.on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),t.on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),t.on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),t.on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),e.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),t.on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this)),t.on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),t.on("click",".open-popup .errorPopup",this.closeErrorPopup.bind(this)),e.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),b("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),b('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),b(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),i.on("click","li.load-more",this.appendMedia.bind(this)),e.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),i.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),e.on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),t.on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),e.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),e.on("click","#bp-save-album-title",this.saveAlbum.bind(this)),t.on("click","#bp-save-folder-title",this.saveFolder.bind(this)),e.on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),e.on("change","#media-stream select#bb-folder-privacy",this.savePrivacy.bind(this)),e.on("click","#bb-delete-album",this.deleteAlbum.bind(this)),t.on("click","#bb-delete-folder",this.deleteFolder.bind(this)),t.on("click","ul.document-nav li",this.resetPageDocumentDirectory.bind(this)),t.on("click","ul.document-nav li a",this.resetPageDocumentDirectory.bind(this)),t.on("click","#forums-media-button",this.openForumsUploader.bind(this)),t.on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this)),t.on("click","#forums-video-button",this.openForumsVideoUploader.bind(this)),t.on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),t.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keydown",".search-query-input",this.searchGif.bind(this)),t.on("click",".bbpress-forums-activity #whats-new-toolbar .found-media-item",this.selectGif.bind(this)),t.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),t.find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),a.length||t.find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),t.find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),t.find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),t.on("click",".gif-image-container",this.playVideo.bind(this)),t.on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),t.on("click",".bb-activity-media-elem .copy_download_file_url a, .media-folder_action__list .copy_download_file_url a, .media .bb-photo-thumb .copy_download_file_url a",this.copyDownloadLink.bind(this)),t.on("click",".bb-activity-media-elem.media-activity .media-action-wrap .media-action_more, #media-stream.media .bb-photo-thumb .media-action-wrap .media-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this)),t.click(this.toggleFileActivityActionButton),t.on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.toggleCodePreview.bind(this)),t.on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this)),t.on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),t.on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),t.on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this)),t.on("click",".bp-media-document-uploader .modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),t.on("click",".bp-media-photo-uploader .modal-container .bb-field-uploader-actions",this.uploadMediaNavigate.bind(this)),t.on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this)),t.on("click",".activity .bp-media-move-activity, #media-stream .bp-media-move-activity",this.moveMediaIntoAlbum.bind(this));var o=b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream'),d=b(".group-media #media-stream");o.on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this)),o.add(d).on("click",".ac-media-move",this.openMediaMove.bind(this)),o.on("click",".ac-document-close-button, .ac-folder-close-button",this.closeDocumentMove.bind(this)),o.on("click",".ac-media-close-button",this.closeMediaMove.bind(this));e=b("#bb-media-model-container .activity-list, #media-stream");e.on("click",".ac-document-rename",this.renameDocument.bind(this)),e.on("click",".ac-document-privacy",this.editPrivacyDocument.bind(this)),e.on("keyup",".media-folder_name_edit",this.renameDocumentSubmit.bind(this)),e.on("click",".name_edit_cancel, .name_edit_save",this.renameDocumentSubmit.bind(this)),t.on("click",".document-file-delete",this.deleteDocument.bind(this)),t.on("click",".media-file-delete",this.deleteMedia.bind(this)),t.on("click",".bp-folder-move",this.folderMove.bind(this)),t.on("click",".bp-document-open-create-popup-folder",this.createFolderInPopup.bind(this)),t.on("click",".bp-media-open-create-popup-folder",this.createAlbumInPopup.bind(this)),t.on("click",".close-create-popup-folder",this.closeCreateFolderInPopup.bind(this)),t.on("click",".close-create-popup-album",this.closeCreateAlbumInPopup.bind(this)),t.on("click",".bp-document-create-popup-folder-submit",this.submitCreateFolderInPopup.bind(this)),t.on("click",".bp-media-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this));d=b(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar"),o=b(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),e=b(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");a.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),a.on("click","#bp-group-messages-document-button",this.openGroupMessagesDocumentUploader.bind(this)),a.on("click","#bp-group-messages-video-button",this.openGroupMessagesVideoUploader.bind(this)),a.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),d.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),d.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),o.scroll(this.loadMoreGroupMessagesGif.bind(this)),b(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),e.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),i.on("scroll",this.loadExistingMedia.bind(this)),document.addEventListener("keyup",this.closePopup.bind(this)),document.addEventListener("keyup",this.submitPopup.bind(this)),b(window).bind("beforeunload",this.beforeunloadWindow.bind(this)),_.isUndefined(f.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1),document.addEventListener("keydown",_.bind(this.closePickersOnEsc,this)),t.on("click",_.bind(this.closePickersOnClick,this))),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&b("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&b("#forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&b("#forums-video-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&(this.editGifPreview(),s=jQuery("#forums-gif-button").addClass("active").closest("form"),this.disableButtonsInToolBox(s,["#forums-media-button","#forums-document-button","#forums-video-button"]));var s=b("#bp-media-edit-child-folder");"#openEditFolder"===window.location.hash&&s.length&&(history.pushState(null,null,window.location.href.split("#")[0]),s.show()),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(bp.Nouveau.Media.reply_topic_allow_delete_media=!0)},loadExistingMedia:function(){b(window).scroll()},resetPageDocumentDirectory:function(e){e.preventDefault(),this.current_page=1},submitCreateFolderInPopup:function(e){e.preventDefault();var i=b(e.currentTarget),t=i.closest(".open-popup"),a=b(t).find(".bp-document-create-popup-folder-submit"),o=t.find(".bb-folder-selected-id").val(),d=b.trim(i.closest(".modal-container").find(".popup-on-fly-create-folder-title").val()),s=i.closest(".modal-container").find(".popup-on-fly-create-folder-title"),e=/ [\\ / ? % * : | "<>]+/g.exec(s.val()),e=Boolean(e);if(""===b.trim(s.val())||e)return s.addClass("error"),!1;s.removeClass("error"),this.currentTargetParent=o=""===o?0:o;var n=this.currentTargetParent,r=0,l="",c="",p=0;if("group"===this.moveToTypePopup?(l="grouponly",r=this.moveToIdPopup):(l=i.closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy").val(),c=i.closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy")),""===d)return alert(f.create_folder_error_title),!1;a.addClass("loading"),setTimeout(function(){var e={action:"document_folder_save",_wpnonce:v.media,title:d,privacy:l,parent:n,group_id:r};b.ajax({type:"POST",url:m,data:e,async:!1,success:function(e){var i;e.success&&(b(".document-data-table-head").length&&parseInt(n)===parseInt(f.current_folder)&&(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()),t.find(".location-folder-list-wrap .location-folder-list").remove(),t.find(".location-folder-list-wrap").append(e.data.tree_view),i="#"+b(t).attr("id"),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(i,e.data.folder_id),p=e.data.folder_id,""===e.data.tree_view?(t.find(".location-folder-list-wrap").hide(),t.find(".location-folder-list-wrap-main span.no-folder-exists").show()):(t.find(".location-folder-list-wrap-main span.no-folder-exists").hide(),t.find(".location-folder-list-wrap").show()),t.find("ul.location-folder-list span#"+p).trigger("click"),t.find(".bb-model-footer").show(),t.find(".bb-model-footer, #bp-media-document-prev").show(),t.find(".bb-field-wrap-search").show(),t.find(".bp-document-open-create-popup-folder").show(),t.find(".location-folder-list-wrap-main").show(),t.find(".create-popup-folder-wrap").hide(),t.find(".bb-folder-selected-id").val(),t.find(".bb-folder-selected-id").val(p),t.find(".bb-model-header").children().show(),t.find(".bb-model-header p").hide(),s.val(""),""!==c&&c.val("public"),b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(t).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||b('<span class="more_options">...</span>').insertAfter(b(t).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),a.removeClass("loading"),setTimeout(function(){var e=t.find("ul.location-folder-list span#"+p);e.trigger("click");var i=b(t).find("#bb-document-privacy");0!==Number(e.data("id"))?(i.find("option").removeAttr("selected"),i.val(e.parent().data("privacy")),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1))},200))}}),this.currentTargetParent=p,t.find(".location-folder-list li.is_active").show().children("span, i").show().siblings("ul").hide(),t.find(".location-folder-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),t.find(".location-folder-list li span.selected").removeClass("selected"),t.find(".location-folder-list li.is_active").children("span").addClass("selected")},0)},submitCreateAlbumInPopup:function(e){e.preventDefault();var i=this,t=b(e.currentTarget),a=t.closest(".open-popup"),o=b(a).find(".bp-media-create-popup-album-submit"),e=a.find(".bb-album-selected-id").val();this.currentTargetParent=e=""===e?0:e;var d=this.currentTargetParent,s=0,n=b.trim(t.closest(".modal-container").find(".popup-on-fly-create-album-title").val()),r=t.closest(".modal-container").find(".popup-on-fly-create-album-title"),l="",c="",p=0;if("group"===this.moveToTypePopup?(l="grouponly",s=this.moveToIdPopup):(l=t.closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy").val(),c=t.closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy")),""===n)return alert(f.create_album_error_title),!1;o.addClass("loading"),setTimeout(function(){var e={action:"media_album_save",_wpnonce:v.media,title:n,privacy:l,parent:d,group_id:s};b.ajax({type:"POST",url:m,data:e,async:!1,success:function(e){e.success&&(a.find(".location-album-list-wrap .location-album-list").remove(),a.find(".location-album-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(a,e.data.album_id),p=e.data.album_id,""===e.data.tree_view?(a.find(".location-album-list-wrap").hide(),a.find(".location-album-list-wrap-main span.no-album-exists").show()):(a.find(".location-album-list-wrap-main span.no-album-exists").hide(),a.find(".location-album-list-wrap").show()),a.find("ul.location-album-list span#"+p).trigger("click"),a.find(".bb-model-footer").show(),a.find(".bb-field-wrap-search").show(),a.find(".bp-media-open-create-popup-album").show(),a.find(".location-album-list-wrap-main").show(),a.find(".create-popup-album-wrap").hide(),a.find(".bb-field-steps-2 #bp-media-prev").show(),a.find(".bb-album-selected-id").val(),a.find(".bb-album-selected-id").val(p),a.find(".bb-model-header").children().show(),a.find(".bb-model-header p").hide(),r.val(""),""!==c&&c.val("public"),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||b('<span class="more_options">...</span>').insertAfter(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),i.updateAlbumNavCount(e.data.album_count)),o.removeClass("loading")}}),this.currentTargetParent=p,a.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide(),a.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide(),a.find(".location-album-list li span.selected").removeClass("selected"),a.find(".location-album-list li.is_active").children("span").addClass("selected")},0)},closeCreateFolderInPopup:function(e){e.preventDefault(),b(".modal-container .bb-model-footer").show(),b(".bb-field-wrap-search").show(),b(".bp-document-open-create-popup-folder").show(),b(".location-folder-list-wrap-main").show(),b("#bp-media-document-prev").show(),b(".create-popup-folder-wrap").hide();e=b(e.currentTarget).closest(".has-folderlocationUI");e.find(".bb-model-header").children().show(),e.find(".bb-model-header p").hide()},closeCreateAlbumInPopup:function(e){e.preventDefault(),b(".modal-container .bb-model-footer").show(),b(".bb-field-wrap-search").show(),b(".bp-document-open-create-popup-folder").show(),b(".modal-container:visible .bp-video-open-create-popup-album").show(),b(".location-album-list-wrap-main").show(),b(".bb-field-steps-2 #bp-media-prev").show(),b(".bb-field-steps-2 #bp-video-next").show(),b(".create-popup-album-wrap").hide(),b(".bp-media-create-popup-album-submit.loading").removeClass("loading");e=b(e.currentTarget).closest(".has-folderlocationUI");e.find(".bb-model-header").children().show(),e.find(".bb-model-header p").hide()},createFolderInPopup:function(e){e.preventDefault();var i=b(document),t=parseInt(i.find(".open-popup .bb-folder-selected-id").val()),a=i.find(".open-popup .bb-folder-create-from").val(),o=i.find(".open-popup .privacy-field-wrap-hide-show"),d=i.find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show");0<t?o.hide():o.show(),"group"===a||0<t?d.hide():d.show(),b(".modal-container .bb-model-footer, .modal-container #bp-media-document-prev").hide(),b(".bb-field-wrap-search").hide(),b(".bp-document-open-create-popup-folder").hide(),b(".location-folder-list-wrap-main").hide(),b(".create-popup-folder-wrap").show();e=b(e.currentTarget).closest(".has-folderlocationUI");e.find(".bb-model-header").children().hide(),e.find(".bb-model-header").append("<p>"+f.create_folder+"</p>"),b(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),i.find(".open-popup .error").hide()},createAlbumInPopup:function(e){e.preventDefault();var i=b(document),t=parseInt(i.find(".open-popup .bb-album-selected-id").val()),a=i.find(".open-popup .bb-album-create-from").val(),o=i.find(".open-popup .privacy-field-wrap-hide-show"),d=i.find(".popup-on-fly-create-album .privacy-field-wrap-hide-show");0<t?o.hide():o.show(),"group"===a?d.hide():d.show(),b(".modal-container .bb-model-footer").hide(),b(".bb-field-wrap-search").hide(),b(".bp-document-open-create-popup-folder").hide(),b(".location-album-list-wrap-main").hide(),b(".bb-field-steps-2 #bp-media-prev").hide(),b(".create-popup-album-wrap").show();e=b(e.currentTarget).closest(".has-folderlocationUI");e.find(".bb-model-header").children().hide(),e.find(".bb-model-header").append("<p>"+f.create_album_title+"</p>"),b(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy"),i.find(".open-popup .error").hide()},savePrivacy:function(e){var t,a,i,o=b(e.currentTarget);if(e.preventDefault(),o.hasClass("new-folder-create-privacy"))return!1;t=parseInt(o.data("item-id")),i=o.data("item-type"),a=o.val(),e=o.find("option:selected").text(),this.privacySelectorSelect.addClass("hide"),this.privacySelectorSpan.text(""),this.privacySelectorSpan.text(e),this.privacySelectorSpan.show(),0<t&&(i={action:"document_save_privacy",item_id:t,type:i,value:a,_wpnonce:v.media},b.ajax({type:"POST",url:m,data:i,success:function(e){var i;e.success?((i=b(document)).find("#div-listing-"+t+" li#"+t+" a").attr("data-privacy",a),e.data.document&&e.data.document.video_symlink&&i.find('a.bb-open-document-theatre[data-id="'+t+'"]').attr("data-video-preview",e.data.document.video_symlink)):(o.find('option[value="'+o.attr("data-privacy")+'"]').attr("selected","selected"),o.siblings("span").text(o.find('option[value="'+o.attr("data-privacy")+'"]').text()),alert(e.data.feedback.replace("&#039;","'")))}}))},folderMove:function(e){var a=b(e.currentTarget);e.preventDefault();var i=a.attr("id"),e=b("#media-folder-document-data-table #bp-media-move-folder .modal-mask .modal-wrapper #boss-media-create-album-popup .bb-field-wrap .bb-folder-selected-id").val();if(""===i||""===e)return alert(f.i18n_strings.folder_move_error),!1;a.addClass("loading");e={action:"document_folder_move",current_folder_id:i,folder_move_to_id:e,group_id:this.group_id,_wpnonce:v.media};b.ajax({type:"POST",url:m,data:e,success:function(e){var i,t=b(document);if(!e.success)return t.find(".open-popup .error").show(),t.find(".open-popup .error").html(e.data.feedback),a.removeClass("loading"),!1;"yes"===f.is_document_directory?"personal"===bp.Nouveau.getStorage("bp-document").scope?(t.find("li#document-personal a").trigger("click"),t.find("li#document-personal").trigger("click")):(t.find("li#document-all a").trigger("click"),t.find("li#document-all").trigger("click")):((i=b("#media-stream")).html(""),i.html(e.data.html),t.find(".open-popup .error").hide(),t.find(".open-popup .error").html(""),a.removeClass("loading"),t.removeClass("open-popup"))}})},deleteDocument:function(e){e.preventDefault();var i=b(e.currentTarget),t=i.attr("data-type"),a=i.attr("data-item-id"),o=i.attr("data-item-attachment-id"),d=i.attr("data-item-preview-attachment-id"),s=[];if("activity"!==i.attr("data-item-from")){if("folder"===t){if(!confirm(f.i18n_strings.folder_delete_confirm))return!1}else if("document"===t&&!confirm(f.i18n_strings.document_delete_confirm))return!1;s={action:"document_delete",id:a,preview_attachment_id:d,type:t,attachment_id:o,_wpnonce:v.media};"yes"===f.is_document_directory&&(e=bp.Nouveau.getStorage("bp-document").scope,s.scope=""===e?"all":e),b.ajax({type:"POST",url:m,asyc:!1,data:s,success:function(e){var i;e.success&&((i=b("#media-stream")).html(""),i.html(e.data.html))}}),this.current_page=1}else{if(!confirm(f.i18n_strings.document_delete_confirm))return!1;var n=i.attr("data-item-activity-id");s={action:"document_activity_delete",id:a,preview_attachment_id:d,type:t,activity_id:n,attachment_id:o,_wpnonce:v.media},b.ajax({type:"POST",url:m,data:s,success:function(e){e.success&&(b("body #buddypress .activity-list li#activity-"+n+" .document-activity .activity-inner .bb-activity-media-wrap .document-activity."+a).remove(),b("body #buddypress .activity-list .activity-comments .document-activity."+a).remove(),!0===e.data.delete_activity?(b("body #buddypress .activity-list li#activity-"+n).remove(),b("body .bb-activity-media-elem.document-activity."+a).remove(),b("body .activity-comments li#acomment-"+n).remove()):b("body #buddypress .activity-list li#activity-"+n).replaceWith(e.data.activity_content))}})}},bp_ajax_media_request:function(e,i){f.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0===parseInt(i.response.scopes.groups)?b(".bb-photos-actions").hide():f.group_id&&void 0!==i&&void 0!==i.response.scopes.groups&&0!==parseInt(i.response.scopes.groups)?b(".bb-photos-actions").show():void 0!==i&&void 0!==i.response.scopes.personal&&0===parseInt(i.response.scopes.personal)?b(".bb-photos-actions").hide():void 0!==i&&void 0!==i.response.scopes.personal&&0!==parseInt(i.response.scopes.personal)&&b(".bb-photos-actions").show()},bp_media_after_load:function(){b(".media-list.bb-photo-list").children().length&&b(".bb-photos-actions").show()},addSelectedClassToWrapper:function(e){var e=e.currentTarget;b(e).is(":checked")?(b(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.unselect),b(e).closest(".bb-item-thumb").addClass("selected")):(b(e).closest(".bb-item-thumb").removeClass("selected"),b(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.select),(e=b(".bp-nouveau #bb-select-deselect-all-media")).hasClass("selected")&&e.removeClass("selected"))},moveDocumentIntoFolder:function(e){var t=b(e.currentTarget);e.preventDefault();var a=b(document),o=t.attr("id"),e=t.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===o||""===e)return t.closest(".modal-container").find(".location-folder-list").addClass("has-error"),!1;"yes"!==f.is_document_directory&&(this.current_page=1),t.closest(".modal-container").find(".location-folder-list").removeClass("has-error"),t.addClass("loading");var d=a.find('a[data-media-id="'+o+'"]').attr("data-parent-activity-id"),e={action:"document_move",_wpnonce:v.media,document_id:o,folder_id:e,group_id:this.group_id,activity_id:d};b.ajax({type:"POST",url:m,data:e,success:function(e){var i;e.success?("yes"===f.is_document_directory?"personal"===bp.Nouveau.getStorage("bp-document").scope?(a.find("li#document-personal a").trigger("click"),a.find("li#document-personal").trigger("click")):(a.find("li#document-all a").trigger("click"),a.find("li#document-all").trigger("click")):(0<parseInt(f.current_folder)?b('#document-stream ul.media-list li[data-id="'+o+'"]').remove():b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+o+'"]').length&&!b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+o+'"]').parent().hasClass("bb-media-length-1")&&(b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+o+'"]').remove(),d&&d.length&&(b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.document_content))),(i=b("#media-stream")).html(""),i.html(e.data.html),a.find(".open-popup .error").hide(),a.find(".open-popup .error").html(""),t.removeClass("loading"),a.removeClass("open-popup")),t.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click")):alert(e.data.feedback.replace("&#039;","'"))}})},moveMediaIntoAlbum:function(e){var i=b(e.currentTarget);e.preventDefault();var t=b(document),a=i.attr("id"),o=i.closest(".bp-media-move-file").find(".bb-album-selected-id").val();if(""===a||""===o)return i.closest(".modal-container").find(".location-album-list").addClass("has-error"),!1;i.closest(".modal-container").find(".location-album-list").removeClass("has-error"),i.addClass("loading");var d=t.find('a[data-media-id="'+a+'"]').attr("data-parent-activity-id"),e=parseInt(this.group_id);e||(e=!1,"group"===t.find('a[data-media-id="'+a+'"]').attr("data-type")&&(e=t.find('a[data-media-id="'+a+'"]').attr("id")));e={action:"media_move",_wpnonce:v.media,media_id:a,album_id:o,group_id:e,activity_id:d};b.ajax({type:"POST",url:m,data:e,success:function(e){e.success?("yes"===f.is_media_directory?"personal"===bp.Nouveau.getStorage("bp-media").scope?(t.find("li#media-personal a").trigger("click"),t.find("li#media-personal").trigger("click")):(t.find("li#media-all a").trigger("click"),t.find("li#media-all").trigger("click")):(0<parseInt(f.current_album)?b('#media-stream ul.media-list li[data-id="'+a+'"]').remove():b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').length&&!b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').parent().hasClass("bb-media-length-1")&&(b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+a+'"]').remove(),d&&d.length&&(b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(e.data.media_content),jQuery(window).scroll())),t.find(".open-popup .error").hide(),t.find(".open-popup .error").html(""),i.removeClass("loading"),t.removeClass("open-popup")),i.closest(".bp-media-move-file").find(".ac-media-close-button").trigger("click"),b(document).find('a.bb-open-media-theatre[data-id="'+a+'"]').data("album-id",o)):alert(e.data.feedback.replace("&#039;","'"))}})},deleteMedia:function(e){var t=b(e.currentTarget),a=this;e.preventDefault();var o,d=[],s=b("#buddypress"),e=t.attr("data-type"),n=t.data("item-from"),r="",l=b(document);if("album"===e){if(!confirm(f.i18n_strings.album_delete_confirm))return!1}else if("media"===e&&!confirm(f.i18n_strings.media_delete_confirm))return!1;if(t.hasClass("bb-delete")){if(!confirm(f.i18n_strings.media_delete_confirm))return!1;var i=s.find(".media-list:not(.existing-media-list)");i.find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){b(this).closest(".bb-item-thumb").addClass("loading deleting"),d.push(b(this).val())}),i.parent().parent().hasClass("album-single-view")&&i.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){b(this).closest(".bb-item-thumb").addClass("loading deleting"),d.push(b(this).val())})}if(o=t.data("parent-activity-id"),n&&n.length&&"activity"===n&&0===d.length&&(r=t.attr("data-item-id"),d.push(r)),0===d.length&&d.push(t.data("item-id")),0===d.length)return!1;t.prop("disabled",!0),b("#buddypress #media-stream.media .bp-feedback").remove();i={action:"media_delete",_wpnonce:v.media,media:d,activity_id:o,from_where:n};b.ajax({type:"POST",url:m,data:i,success:function(e){var i;a.current_page=1,n&&n.length&&"activity"===n?e.success&&(b.each(d,function(e,i){var t=b('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+i+'"]');t.length&&t.remove();i=b("body .bb-activity-media-elem.media-activity."+i);i.length&&i.remove()}),b('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove(),b('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"] .activity-content .activity-inner').append(e.data.media_content),0===b('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"] .activity-content .activity-inner .bb-activity-media-elem').length&&b('#activity-stream ul.activity-list li[data-bp-activity-id="'+o+'"]').remove(),!0===e.data.delete_activity?(b("body #buddypress .activity-list li#activity-"+o).remove(),b("body .bb-activity-media-elem.media-activity."+r).remove(),b("body .activity-comments li#acomment-"+o).remove()):b("body #buddypress .activity-list li#activity-"+o).replaceWith(e.data.activity_content)):n&&n.length&&"media"===n?e.success&&("yes"===f.is_media_directory?"personal"===(i=bp.Nouveau.getStorage("bp-media").scope)?(l.find("li#media-personal a").trigger("click"),l.find("li#media-personal").trigger("click")):"groups"===i?(l.find("li#media-groups a").trigger("click"),l.find("li#media-groups").trigger("click")):(l.find("li#media-all a").trigger("click"),l.find("li#media-all").trigger("click")):(e.data.media_personal_count&&b("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),e.data.media_group_count&&b("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count),0!==e.data.media_html_content.length?0===parseInt(e.data.media_personal_count)?(b(".bb-photos-actions").hide(),b("#media-stream").html(e.data.media_html_content)):s.find(".media-list:not(.existing-media-list)").html(e.data.media_html_content):0!==e.data.group_media_html_content.length?0===parseInt(e.data.media_group_count)?(b(".bb-photos-actions").hide(),b("#media-stream").html(e.data.group_media_html_content)):s.find(".media-list:not(.existing-media-list)").html(e.data.group_media_html_content):b.each(d,function(e,i){i=b('#media-stream ul.media-list li[data-id="'+i+'"]');i.length&&i.remove()}))):(setTimeout(function(){t.prop("disabled",!1)},500),e.success?(void 0!==e.data&&void 0!==e.data.media_personal_count&&b("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count),void 0!==e.data&&void 0!==e.data.media_group_count&&b("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count),(i=s.find(".media-list:not(.existing-media-list)")).find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){b(this).closest("li").remove()}),i.parent().parent().hasClass("album-single-view")&&i.find('.bb-video-check-wrap [name="bb-video-select"]:checked').each(function(){b(this).closest("li").remove()}),0!==e.data.media_html_content.length?0===parseInt(e.data.media_personal_count)?(b(".bb-photos-actions").hide(),b("#media-stream").html(e.data.media_html_content)):i.html(e.data.media_html_content):0!==e.data.group_media_html_content.length?0===parseInt(e.data.media_group_count)?(b(".bb-photos-actions").hide(),b("#media-stream").html(e.data.group_media_html_content)):i.html(e.data.group_media_html_content):b.each(d,function(e,i){i=b('#media-stream ul.media-list li[data-id="'+i+'"]');i.length&&i.remove()})):b("#buddypress #media-stream.media").prepend(e.data.feedback));e=b(".bp-nouveau #bb-select-deselect-all-media");e.hasClass("selected")&&e.removeClass("selected"),jQuery(window).scroll()}})},toggleSelectAllMedia:function(e){e.preventDefault();var i=b(e.currentTarget);i.hasClass("selected")?(i.data("bp-tooltip",f.i18n_strings.selectall),this.deselectAllMedia(e)):(i.data("bp-tooltip",f.i18n_strings.unselectall),this.selectAllMedia(e)),i.toggleClass("selected")},selectAllMedia:function(e){e.preventDefault();e=b("#buddypress").find(".media-list:not(.existing-media-list)");e.find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){b(this).prop("checked",!0),b(this).closest(".bb-item-thumb").addClass("selected"),b(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.unselect)}),e.parent().parent().hasClass("album-single-view")&&e.find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){b(this).prop("checked",!0),b(this).closest(".bb-item-thumb").addClass("selected"),b(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault();e=b("#buddypress").find(".media-list:not(.existing-media-list)");e.find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){b(this).prop("checked",!1),b(this).closest(".bb-item-thumb").removeClass("selected"),b(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.select)}),e.parent().parent().hasClass("album-single-view")&&e.find('.bb-video-check-wrap [name="bb-video-select"]').each(function(){b(this).prop("checked",!1),b(this).closest(".bb-item-thumb").removeClass("selected"),b(this).closest(".bb-video-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",f.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),b("#bb-album-title").show(),b("#bp-save-album-title").show(),b("#bp-cancel-edit-album-title").show(),b("#bp-edit-album-title").hide(),b("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(e){e.preventDefault(),b("#bb-album-title").show(),b("#bp-save-folder-title").show(),b("#bp-cancel-edit-album-title").show(),b("#bp-edit-folder-title").hide(),b("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),b("#bb-album-title").removeClass("error").hide(),b("#bp-save-album-title,#bp-save-folder-title").hide(),b("#bp-cancel-edit-album-title").hide(),b("#bp-edit-album-title,#bp-edit-folder-title").show(),b("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),b("#bp-media-uploader").hide(),b("#bp-media-add-more").hide(),b("#bp-media-uploader-modal-title").text(f.i18n_strings.upload),b("#bp-media-uploader-modal-status-text").text(""),b("#bp-media-post-content").val(""),this.dropzone_obj.element&&this.dropzone_obj.destroy(),this.dropzone_media=[];var i=b(e.currentTarget).closest("#bp-media-uploader");b(".close-create-popup-album").trigger("click"),b(".close-create-popup-folder").trigger("click"),i.find('.breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click"),i.find(".bb-field-steps").length&&(i.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),i.find(".bb-field-steps-1 #bp-media-photo-next, .bb-field-steps-1 #bp-media-document-next ").hide(),i.find(".bb-field-steps-1").removeClass("controls-added"),i.find("#bp-media-document-prev, #bp-media-prev, #bp-media-document-submit, #bp-media-submit, .bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, .create-popup-folder-wrap, .create-popup-album-wrap, .bp-video-open-create-popup-album").hide()),this.clearFolderLocationUI(e)},closeChildFolderUploader:function(e){e.preventDefault();e=b(document);e.find(".open-popup #bb-album-child-title").val(""),e.find(".open-popup #bp-media-create-child-folder-submit").removeClass("loading"),e.find("#bp-media-create-child-folder").removeClass("open-popup"),e.find("#bp-media-create-child-folder").hide(),e.find(".open-popup #bb-album-title").text(""),e.find(".open-popup #bp-media-create-folder").hide(),e.find("#bp-media-create-folder").removeClass("open-popup")},closeFolderUploader:function(e){e.preventDefault();e=b(document);e.find(".open-popup #bb-album-title").val(""),e.find(".open-popup #bp-media-create-folder-submit").removeClass("loading"),e.find(".open-popup #bp-media-document-submit").hide(),e.find("#bp-media-create-folder").removeClass("open-popup"),e.find("#bp-media-create-folder").hide()},loadMoreGif:function(e){var i=e.target,t=this,a=b(e.target).closest("form").find(".forums-attached-gif-container"),e=a.data("key");t.gif_container_key=e,i.scrollTop+i.offsetHeight>=i.scrollHeight&&!a.hasClass("loading")&&0<t.gif_data[e].total_count&&t.gif_data[e].offset<=t.gif_data[e].total_count&&(i={offset:t.gif_data[e].offset,fmt:"json",limit:t.gif_data[e].limit},a.addClass("loading"),i=_.isNull(t.gif_data[e].q)?t.giphy.trending(i,_.bind(t.loadMoreGifResponse,t)):t.giphy.search(_.extend({q:t.gif_data[e].q},i),_.bind(t.loadMoreGifResponse,t)),t.gif_data[e].requests.push(i),t.gif_data[e].offset=t.gif_data[e].offset+t.gif_data[e].limit)},loadMoreGroupMessagesGif:function(e){var i=e.target,t=this,a=b(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");t.gif_container_key=a,i.scrollTop+i.offsetHeight>=i.scrollHeight&&!b(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&0<t.gif_total_count&&t.gif_offset<=t.gif_total_count&&(i={offset:t.gif_offset,fmt:"json",limit:t.gif_limit},b(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),i=_.isNull(t.gif_q)?t.giphy.trending(i,_.bind(t.loadMoreGroupMessagesGifResponse,t)):t.giphy.search(_.extend({q:t.gif_q},i),_.bind(t.loadMoreGroupMessagesGifResponse,t)),t.gif_requests.push(i),t.gif_offset=t.gif_offset+t.gif_limit,t.gif_data[a].requests.push(i),t.gif_data[a].offset=t.gif_data[a].offset+t.gif_data[a].limit)},loadMoreGroupMessagesGifResponse:function(e){var i=0,t=b(".bp-group-messages-attached-gif-container");if(t.removeClass("loading"),void 0!==e.data&&e.data.length){for(var a="",o=e.data.length,i=0;i<o;i++){var d=Math.floor(6*Math.random())+1,s=768<window.innerWidth?140:130,n=e.data[i].images.original.width;a+='<li class="bg'+d+'" style="height: '+s*e.data[i].images.original.height/n+'px;">\n\t<a class="found-media-item" href="'+e.data[i].images.original.url+'" data-id="'+e.data[i].id+'">\n\t\t<img src="'+e.data[i].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[i].saved=!1,this.gif_data.push(e.data[i])}t.find(".gif-search-results-list").append(a)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(this.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var i=this,t=0,a=b('div.forums-attached-gif-container[data-key="'+i.gif_container_key+'"]');if(a.removeClass("loading"),void 0!==e.data&&e.data.length){for(var o="",d=e.data.length,t=0;t<d;t++){var s=Math.floor(6*Math.random())+1,n=768<window.innerWidth?140:130,r=e.data[t].images.original.width;o+='<li class="bg'+s+'" style="height: '+n*e.data[t].images.original.height/r+'px;">\n\t<a class="found-media-item" href="'+e.data[t].images.original.url+'" data-id="'+e.data[t].id+'">\n\t\t<img src="'+e.data[t].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[t].saved=!1,i.gif_data[i.gif_container_key].data.push(e.data[t])}a.closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_data[i.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,i={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?i=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?i=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(i=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===i.images)return!1;e=b("#whats-new-attachments .forums-attached-gif-container");e[0].style.backgroundImage="url("+i.images.fixed_width.url+")",e[0].style.backgroundSize="contain",e[0].style.height=i.images.original.height+"px",e[0].style.width=i.images.original.width+"px",e.find(".gif-image-container img").attr("src",i.images.original.url),e.removeClass("closed");e=b("#bbp_media_gif");e.length&&e.val(JSON.stringify(i))},selectGif:function(e){var i=this,t=0,a=b(e.currentTarget),o=a.closest("form").find(".forums-attached-gif-container");e.preventDefault(),o.closest("form").find(".gif-media-search-dropdown").removeClass("open");var d=o.data("key");if(void 0!==i.gif_data[d]&&void 0!==i.gif_data[d].data&&i.gif_data[d].data.length){for(var s=i.gif_data[d].data.length,t=0;t<s;t++)if(i.gif_data[d].data[t].id===e.currentTarget.dataset.id){a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.gif_data[d].data[t].images.fixed_width.url+")",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.gif_data[d].data[t].images.original.height+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.gif_data[d].data[t].images.original.width+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.gif_data[d].data[t].images.original.url),a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),a.closest("form").find("#bbp_media_gif").length&&a.closest("form").find("#bbp_media_gif").val(JSON.stringify(i.gif_data[d].data[t]));break}o=a.closest("form");o.addClass("has-gif"),this.disableButtonsInToolBox(o,["#forums-media-button","#forums-document-button","#forums-video-button"])}},selectGroupMessagesGif:function(e){var i=this,t=0;e.preventDefault();var a=b("#whats-new-attachments .bp-group-messages-attached-gif-container"),o=b("#bp_group_messages_gif");if(b("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),i.gif_data.length){for(var d=i.gif_data.length,t=0;t<d;t++)if(i.gif_data[t].id===e.currentTarget.dataset.id){a[0].style.backgroundImage="url("+i.gif_data[t].images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=i.gif_data[t].images.original.height+"px",a[0].style.width=i.gif_data[t].images.original.width+"px",a.find(".gif-image-container img").attr("src",i.gif_data[t].images.original.url),a.removeClass("closed"),o.length&&o.val(JSON.stringify(i.gif_data[t]));break}var s=b("#send_group_message_form");this.disableButtonsInToolBox(s,["#bp-group-messages-media-button","#bp-group-messages-document-button","#bp-group-messages-video-button"])}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var i=b(e.target);i.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active"),i.closest("form").find(".gif-media-search-dropdown").removeClass("open");e=i.closest("form").find("#whats-new-attachments .forums-attached-gif-container");e.length&&(e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style=""),i.closest("form").find("#bbp_media_gif").length&&i.closest("form").find("#bbp_media_gif").val("");var t=i.closest("form");t.removeClass("has-gif"),["media","document","video","gif"].forEach(function(e){t.find("#forums-"+e+"-button")&&t.find("#forums-"+e+"-button").parents(".post-elements-buttons-item").removeClass("disable no-click")})},resetGroupMessagesGifComponent:function(){var e=b("#whats-new-attachments .bp-group-messages-attached-gif-container"),i=b("#bp_group_messages_gif");b("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),b("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",i.length&&i.val("");var t=b("#send_group_message_form");["media","document","video"].forEach(function(e){t.find("#bp-group-messages-"+e+"-button")&&t.find("#bp-group-messages-"+e+"-button").parents(".post-elements-buttons-item").removeClass("disable")})},searchGif:function(e){if("Enter"===e.key||13===e.keyCode)return e.preventDefault(),!1;var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),""!==e.target.value?i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGroupMessagesGifRequest(e,e.target.value)},1e3):this.toggleGroupMessagesGifSelector(e)},searchGroupMessagesGifRequest:function(s){var n=this;n.gif_q=s.target.value;var r=n.gif_offset=0;n.clearGifRequests(),b(s.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),b(s.target).find(".gif-no-results").removeClass("show"),b(s.target).find(".gif-no-connection").removeClass("show");var e=n.giphy.search({q:n.gif_q,offset:n.gif_offset,fmt:"json",limit:n.gif_limit},function(e){if(void 0!==e.data.length&&0===e.data.length&&b(s.target).find(".gif-no-results").addClass("show"),void 0!==e.meta.status&&200!==e.meta.status&&b(s.target).find(".gif-no-connection").addClass("show"),void 0!==e.data&&e.data.length){var i="",t=e.data.length;for(r=0;r<t;r++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[r].images.original.width;i+='<li class="bg'+a+'" style="height: '+o*e.data[r].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[r].images.original.url+'" data-id="'+e.data[r].id+'">\n\t\t<img src="'+e.data[r].images.fixed_width.url+'" alt="" alt="">\n\t</a>\n</li>',e.data[r].saved=!1,n.gif_data.push(e.data[r])}b(s.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(n.gif_total_count=e.pagination.total_count),b(s.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")},function(){b(s.target).find(".gif-no-connection").addClass("show")});n.gif_requests.push(e),n.gif_offset=n.gif_offset+n.gif_limit},searchGifRequest:function(s){var n=this,r=0,l=b(s.target).closest("form").find(".forums-attached-gif-container");l.addClass("loading");var c=l.data("key");b(s.target).closest("form").find(".gif-no-results").removeClass("show"),b(s.target).closest("form").find(".gif-no-connection").removeClass("show"),n.clearGifRequests(c),n.gif_data[c].q=s.target.value,n.gif_data[c].offset=0;var e=n.giphy.search({q:n.gif_data[c].q,offset:n.gif_data[c].offset,fmt:"json",limit:n.gif_data[c].limit},function(e){if(void 0!==e.data.length&&0===e.data.length&&b(s.target).closest("form").find(".gif-no-results").addClass("show"),void 0!==e.meta.status&&200!==e.meta.status&&b(s.target).closest("form").find(".gif-no-connection").addClass("show"),void 0!==e.data&&e.data.length){var i="",t=e.data.length;for(r=0;r<t;r++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[r].images.original.width;i+='<li class="bg'+a+'" style="height: '+o*e.data[r].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[r].images.original.url+'" data-id="'+e.data[r].id+'">\n\t\t<img src="'+e.data[r].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[r].saved=!1,n.gif_data[c].data.push(e.data[r])}b(s.target).closest(".gif-search-content").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(n.gif_data[c].total_count=e.pagination.total_count),l.removeClass("loading")},function(){b(s.target).closest("form").find(".gif-no-connection").addClass("show")});n.gif_data[c].requests.push(e),n.gif_data[c].offset=n.gif_data[c].offset+n.gif_data[c].limit},clearGifRequests:function(e){var i=this;if(void 0!==i.gif_data[e]&&void 0!==i.gif_data[e].requests){for(var t=i.gif_data[e].requests.length,a=0;a<t;a++)i.gif_data[e].requests[a].abort();b('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),i.gif_data[e].requests=[],i.gif_data[e].data=[],i.gif_data.splice(e,1)}},toggleGifSelector:function(e){var s,n,r=this,l=b(e.currentTarget),i=l.closest("form").find(".gif-media-search-dropdown"),c=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==f.gif_api_key&&(r.giphy=new window.Giphy(f.gif_api_key),(s=l.closest("form").find(".forums-attached-gif-container")).addClass("loading"),n=s.data("key"),r.clearGifRequests(n),r.gif_data[n]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]},e=r.giphy.trending({offset:r.gif_data[n].offset,fmt:"json",limit:r.gif_data[n].limit},function(e){if(void 0!==e.data&&e.data.length){var i="",t=e.data.length;for(c=0;c<t;c++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[c].images.original.width;i+='<li class="bg'+a+'" style="height: '+o*e.data[c].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[c].images.original.url+'" data-id="'+e.data[c].id+'">\n\t\t<img src="'+e.data[c].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[c].saved=!1,r.gif_data[n].data.push(e.data[c])}l.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(r.gif_data[n].total_count=e.pagination.total_count),s.removeClass("loading")}),r.gif_data[n].requests.push(e),r.gif_data[n].offset=r.gif_data[n].offset+r.gif_data[n].limit),i.toggleClass("open");i=l.parents("form").find("#whats-new-attachments .forums-attached-gif-container img");0<i.length&&""!==i.attr("src")?l.addClass("active"):l.toggleClass("active");i=l.closest("form").find("#forums-post-media-uploader");i.length&&r.resetForumsMediaComponent(i.data("key"));i=l.closest("form").find("#forums-post-document-uploader");i.length&&r.resetForumsDocumentComponent(i.data("key"));var i=l.closest("form").find("#forums-post-video-uploader");i.length&&r.resetForumsVideoComponent(i.data("key")),b(window).width()<=544&&(i=l.closest(".bb-modal"),jQuery(i).scrollTop(i[0].scrollHeight))},closePickersOnEsc:function(e){var i=b(e.currentTarget);"Escape"!==e.key&&27!==e.keyCode||_.isUndefined(f)||_.isUndefined(f.gif_api_key)||(i.find("form").find(".gif-media-search-dropdown").removeClass("open"),0<b(".gif-media-search-dropdown-standalone.open").length&&i.find(".gif-media-search-dropdown-standalone").removeClass("open"),i.find("#bbpress-forums form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .forums-attached-gif-container img");0<i.length&&""!==i.attr("src")?e.find("#forums-gif-button").addClass("active"):e.find("#forums-gif-button").removeClass("active")}),i.find("#send_group_message_form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");0<i.length&&""!==i.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),i.find(".activity-comments form").each(function(){var e=jQuery(this),i=e.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");i.length&&""!==b.trim(i.html())?e.find(".ac-reply-gif-button").addClass("active"):e.find(".ac-reply-gif-button").removeClass("active")}))},closePickersOnClick:function(e){var i=b(e.target),e=b(e.currentTarget);_.isUndefined(f)||_.isUndefined(f.gif_api_key)||i.closest(".post-gif").length||i.closest(".gif-media-search-dropdown").length||(e.find("form").find(".gif-media-search-dropdown").removeClass("open"),0<b(".gif-media-search-dropdown-standalone.open").length&&e.find(".gif-media-search-dropdown-standalone").removeClass("open"),e.find("#bbpress-forums form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .forums-attached-gif-container img");0<i.length&&""!==i.attr("src")?e.find("#forums-gif-button").addClass("active"):e.find("#forums-gif-button").removeClass("active")}),e.find("#send_group_message_form").each(function(){var e=jQuery(this),i=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");0<i.length&&""!==i.attr("src")?e.find("#bp-group-messages-gif-button").addClass("active"):e.find("#bp-group-messages-gif-button").removeClass("active")}),e.find(".activity-comments form").each(function(){var e=jQuery(this),i=e.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");i.length&&""!==b.trim(i.html())?e.find(".ac-reply-gif-button").addClass("active"):e.find(".ac-reply-gif-button").removeClass("active")}))},toggleGroupMessagesGifSelector:function(e){var s=this,n=b(e.currentTarget),i=n.closest("form").find(".gif-media-search-dropdown"),r=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==f.gif_api_key&&null==s.giphy&&(s.giphy=new window.Giphy(f.gif_api_key),s.gif_offset=0,s.gif_q=null,s.gif_limit=20,s.gif_requests=[],s.gif_data=[],s.clearGifRequests(),b(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading"),t=s.giphy.trending({offset:s.gif_offset,fmt:"json",limit:s.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var i="",t=e.data.length;for(r=0;r<t;r++){var a=Math.floor(6*Math.random())+1,o=768<window.innerWidth?140:130,d=e.data[r].images.original.width;i+='<li class="bg'+a+'" style="height: '+o*e.data[r].images.original.height/d+'px;">\n\t<a class="found-media-item" href="'+e.data[r].images.original.url+'" data-id="'+e.data[r].id+'">\n\t\t<img src="'+e.data[r].images.fixed_width.url+'" alt="">\n\t</a>\n</li>',e.data[r].saved=!1,s.gif_data.push(e.data[r])}n.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(s.gif_total_count=e.pagination.total_count),b(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")}),s.gif_requests.push(t),s.gif_offset=s.gif_offset+s.gif_limit);var t=n.parents("form").find("#whats-new-attachments .bp-group-messages-attached-gif-container img");0<t.length&&""!==t.attr("src")?n.addClass("active"):n.toggleClass("active"),i.toggleClass("open"),s.resetGroupMessagesMediaComponent(),s.resetGroupMessagesDocumentComponent(),s.resetGroupMessagesVideoComponent()},resetGroupMessagesMediaComponent:function(){this.dropzone_obj&&void 0!==this.dropzone_obj&&this.dropzone_obj.destroy(),this.dropzone_media=[];var e=b("div#bp-group-messages-post-media-uploader");e.html(""),e.addClass("closed").removeClass("open"),b("#bp-group-messages-media-button").removeClass("active"),b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_media").val("")},resetGroupMessagesDocumentComponent:function(){this.document_dropzone_obj&&void 0!==this.document_dropzone_obj&&this.document_dropzone_obj.destroy(),this.dropzone_media=[];var e=b("div#bp-group-messages-post-document-uploader");e.html(""),e.addClass("closed").removeClass("open"),b("#bp-group-messages-document-button").removeClass("active"),b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_document").val("")},resetGroupMessagesVideoComponent:function(){this.video_dropzone_obj&&void 0!==this.video_dropzone_obj&&this.video_dropzone_obj.destroy(),this.dropzone_media=[];var e=b("div#bp-group-messages-post-video-uploader");e.html(""),e.addClass("closed").removeClass("open"),b("#bp-group-messages-video-button").removeClass("active"),b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_video").val("")},resetForumsMediaComponent:function(e){b("#forums-media-button").removeClass("active"),void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),(e=b("div#forums-post-media-uploader")).html(""),e.addClass("closed").removeClass("open"))},resetForumsDocumentComponent:function(e){b("#forums-document-button").removeClass("active"),void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),(e=b("div#forums-post-document-uploader")).html(""),e.addClass("closed").removeClass("open"))},resetForumsVideoComponent:function(e){b("#forums-video-button").removeClass("active"),void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),(e=b("div#forums-post-video-uploader")).html(""),e.addClass("closed").removeClass("open"))},openForumsUploader:function(e){var i=this,t=b(e.currentTarget),a=t.closest("form").find("#forums-post-media-uploader"),o=t.closest("form").find("#forums-post-document-uploader"),d=t.closest("form").find("#forums-post-video-uploader"),s=[];e.preventDefault(),t.toggleClass("active");o=o.data("key"),d=d.data("key");if(i.resetForumsDocumentComponent(o),i.resetForumsVideoComponent(d),void 0!==window.Dropzone&&a.length){var n=a.data("key");if(a.hasClass("closed")){if(i.dropzone_obj[n]=new Dropzone(a[0],i.options),i.dropzone_media[n]=[],i.setupForumDropzoneEvents({self:i,dropzoneObj:i.dropzone_obj[n],dropzoneDataObj:i.dropzone_media[n],target:t,type:"media",dropzoneContainer:a}),a.removeClass("closed").addClass("open"),i.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?s=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?s=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(s=this.bbp_forum_edit_media),s.length)){for(var r,l,c=s.length,p=0;p<c;p++)i.dropzone_media[n].push({id:s[p].attachment_id,media_id:s[p].id,name:s[p].title,thumb:s[p].thumb,url:s[p].full,uuid:s[p].id,menu_order:p,saved:!!1}),r={name:s[p].title,accepted:!0,kind:"image",upload:{filename:s[p].title,uuid:s[p].id},dataURL:s[p].url,id:s[p].id},i.dropzone_obj[n].files.push(r),i.dropzone_obj[n].emit("addedfile",r),i.createThumbnailFromUrl(r,a);i.addMediaIdsToForumsForm(a),_.isNull(i.dropzone_obj[n].files)||0===i.dropzone_obj[n].files.length||(l=t.closest("form"),["media","document","video","gif"].forEach(function(e){var i=l.find("#forums-"+e+"-button");i&&("media"===e?i.removeClass("no-click"):i.parents(".post-elements-buttons-item").addClass("disable"))}))}}else i.resetForumsMediaComponent(n)}},openForumsDocumentUploader:function(e){var i=this,t=b(e.currentTarget),a=t.closest("form").find("#forums-post-document-uploader"),o=t.closest("form").find("#forums-post-media-uploader"),d=t.closest("form").find("#forums-post-video-uploader"),s=[];e.preventDefault(),t.toggleClass("active");o=o.data("key"),d=d.data("key");if(i.resetForumsMediaComponent(o),i.resetForumsVideoComponent(d),void 0!==window.Dropzone&&a.length){var n=a.data("key");if(a.hasClass("closed")){if(i.dropzone_obj[n]=new Dropzone(a[0],i.documentOptions),i.dropzone_media[n]=[],i.setupForumDropzoneEvents({self:i,dropzoneObj:i.dropzone_obj[n],dropzoneDataObj:i.dropzone_media[n],target:t,type:"document",dropzoneContainer:a}),a.removeClass("closed").addClass("open"),i.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?s=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?s=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(s=this.bbp_forum_edit_document),s.length)){for(var r,l,c=s.length,p=0;p<c;p++)i.dropzone_media[n].push({id:s[p].attachment_id,document_id:s[p].id,name:s[p].name,type:"document",title:s[p].name,size:s[p].size,url:s[p].url,uuid:s[p].id,menu_order:p,saved:!!1}),r={name:s[p].name,size:s[p].size,accepted:!0,kind:"document",upload:{name:s[p].name,filename:s[p].name,title:s[p].name,size:s[p].size,uuid:s[p].id},dataURL:s[p].url,id:s[p].id},i.dropzone_obj[n].files.push(r),i.dropzone_obj[n].emit("addedfile",r),i.dropzone_obj[n].emit("complete",r);i.addDocumentIdsToForumsForm(a),_.isNull(i.dropzone_obj[n].files)||0===i.dropzone_obj[n].files.length||(l=t.closest("form"),["media","document","video","gif"].forEach(function(e){var i=l.find("#forums-"+e+"-button");i&&("document"===e?i.removeClass("no-click"):i.parents(".post-elements-buttons-item").addClass("disable"))}))}}else i.resetForumsDocumentComponent(n)}},openForumsVideoUploader:function(e){var i=this,t=b(e.currentTarget),a=t.closest("form").find("#forums-post-video-uploader"),o=t.closest("form").find("#forums-post-media-uploader"),d=t.closest("form").find("#forums-post-document-uploader"),s=[];e.preventDefault(),t.toggleClass("active");o=o.data("key"),d=d.data("key");if(i.resetForumsMediaComponent(o),i.resetForumsDocumentComponent(d),void 0!==window.Dropzone&&a.length){var n=a.data("key");if(a.hasClass("closed")){if(i.dropzone_obj[n]=new Dropzone(a[0],i.videoOptions),i.dropzone_media[n]=[],i.setupForumDropzoneEvents({self:i,dropzoneObj:i.dropzone_obj[n],dropzoneDataObj:i.dropzone_media[n],target:t,type:"video",dropzoneContainer:a}),a.removeClass("closed").addClass("open"),i.resetForumsGifComponent(e),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)&&(this.bbp_reply_edit_video.length?s=this.bbp_reply_edit_video:this.bbp_topic_edit_video.length?s=this.bbp_topic_edit_video:this.bbp_forum_edit_video.length&&(s=this.bbp_forum_edit_video),s.length)){for(var r,l,c=s.length,p=0;p<c;p++)i.dropzone_media[n].push({id:s[p].attachment_id,video_id:s[p].id,name:s[p].name,type:"video",title:s[p].name,size:s[p].size,url:s[p].url,uuid:s[p].id,thumb:s[p].thumb,menu_order:p,saved:!!1}),r={name:s[p].name,size:s[p].size,accepted:!0,kind:"video",upload:{name:s[p].name,title:s[p].name,size:s[p].size,uuid:s[p].id},dataURL:s[p].url,dataThumb:s[p].thumb,id:s[p].id},i.dropzone_obj[n].files.push(r),i.dropzone_obj[n].emit("addedfile",r),i.dropzone_obj[n].emit("complete",r);i.addVideoIdsToForumsForm(a),_.isNull(i.dropzone_obj[n].files)||0===i.dropzone_obj[n].files.length||(l=t.closest("form"),["media","document","video","gif"].forEach(function(e){var i=l.find("#forums-"+e+"-button");i&&("video"===e?i.removeClass("no-click"):i.parents(".post-elements-buttons-item").addClass("disable"))}))}}else i.resetForumsVideoComponent(n)}},openGroupMessagesUploader:function(e){var i=this,t=b("div#bp-group-messages-post-media-uploader"),a=b(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(i.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",i.options),i.setupGroupMessageDropzoneEvents({self:i,dropzoneObj:i.dropzone_obj,dropzoneDataObj:i.dropzone_media,target:a,type:"media",dropzoneContainer:t}),t.removeClass("closed").addClass("open"),i.resetGroupMessagesGifComponent(),i.resetGroupMessagesDocumentComponent(),i.resetGroupMessagesVideoComponent()):i.resetGroupMessagesMediaComponent())},openGroupMessagesDocumentUploader:function(e){var i=this,t=b("div#bp-group-messages-post-document-uploader"),a=b(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(i.document_dropzone_obj=new Dropzone("div#bp-group-messages-post-document-uploader",i.documentOptions),i.setupGroupMessageDropzoneEvents({self:i,dropzoneObj:i.document_dropzone_obj,dropzoneDataObj:i.dropzone_media,target:a,type:"document",dropzoneContainer:t}),t.removeClass("closed").addClass("open"),i.resetGroupMessagesGifComponent(),i.resetGroupMessagesMediaComponent(),i.resetGroupMessagesVideoComponent()):i.resetGroupMessagesDocumentComponent())},openGroupMessagesVideoUploader:function(e){var i=this,t=b("div#bp-group-messages-post-video-uploader"),a=b(e.currentTarget);e.preventDefault(),a.toggleClass("active"),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(i.video_dropzone_obj=new Dropzone("div#bp-group-messages-post-video-uploader",i.videoOptions),i.setupGroupMessageDropzoneEvents({self:i,dropzoneObj:i.video_dropzone_obj,dropzoneDataObj:i.dropzone_media,target:a,type:"video",dropzoneContainer:t}),t.removeClass("closed").addClass("open"),i.resetGroupMessagesMediaComponent(),i.resetGroupMessagesGifComponent(),i.resetGroupMessagesDocumentComponent()):i.resetGroupMessagesVideoComponent())},addMediaIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(this.dropzone_media[i]))},addDocumentIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(this.dropzone_media[i]))},addVideoIdsToForumsForm:function(e){var i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_video").length&&e.closest("#whats-new-attachments").find("#bbp_video").val(JSON.stringify(this.dropzone_media[i]))},createThumbnailFromUrl:function(i,e){var t=this,a=e.data("key");t.dropzone_obj[a].createThumbnailFromUrl(i,t.dropzone_obj[a].options.thumbnailWidth,t.dropzone_obj[a].options.thumbnailHeight,t.dropzone_obj[a].options.thumbnailMethod,!0,function(e){t.dropzone_obj[a].emit("thumbnail",i,e),t.dropzone_obj[a].emit("complete",i)})},openUploader:function(e){var t=this;e.preventDefault();var i,a,o=b(document),d=b("#bp-media-uploader");void 0!==window.Dropzone&&b("div#media-uploader").length&&(d.addClass("open-popup").show(),b(e.currentTarget).closest("#bp-media-single-album").length&&b("#bb-media-privacy").hide(),d.find(".bb-field-steps.bb-field-steps-2").length&&(i="#bp-media-uploader.bp-media-photo-uploader",0!==Number(b(i).find(".bb-album-selected-id").data("value"))?(a=b(i).find(".bb-album-selected-id").data("value"),b(i).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&b.ajax({url:m,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){o.find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(o.find(".open-popup .location-album-list-wrap").hide(),o.find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(o.find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),o.find(".open-popup .location-album-list-wrap").show()),!1===e.data.create_album?(o.find(".open-popup .bp-media-open-create-popup-folder").removeClass("create-album"),o.find(".open-popup .bp-media-open-create-popup-folder").hide()):o.find(".open-popup .bp-media-open-create-popup-folder").addClass("create-album"),o.find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),o.find(".open-popup .bb-album-create-from").val("profile"),b(i).find(".location-album-list-wrap .location-album-list").remove(),b(i).find(".location-album-list-wrap").append(e.data.html),b(i).find('ul.location-album-list span[data-id="'+a+'"]').trigger("click"),b(i).find(".bb-album-selected-id").val(a)}})),o.on("click",i+" .location-album-list li span",function(e){var i;e.preventDefault(),b(this).parent().hasClass("is_active")||(0!==b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),b(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>"),b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a===b(e.currentTarget).data("id")?b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")||(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(b(e.currentTarget).data("id")),i=b(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy"),0!==Number(b(e.currentTarget).data("id"))?(i.find("option").removeAttr("selected"),i.val(b(e.currentTarget).parent().data("privacy")),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1))))}),o.on("click",i+" .breadcrumb .item > span",function(e){var i,t;b(this).hasClass("is-disabled")||(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(0),b(e.currentTarget).closest(".bb-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),a===b(e.currentTarget).data("id")?b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),i=b(e.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy"),t=b(e.currentTarget).closest("#bp-media-uploader").find(".location-album-list li.is_active").data("privacy"),0!==Number(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val())?(i.find("option").removeAttr("selected"),i.val(void 0===t?"public":t),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1)))}),t.options.previewTemplate=document.getElementsByClassName("uploader-post-media-template").length?document.getElementsByClassName("uploader-post-media-template")[0].innerHTML:"",t.dropzone_obj=new Dropzone("div#media-uploader",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",v.media)}),t.dropzone_obj.on("uploadprogress",function(e){var i=b(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t,i.style.strokeDashoffset=t,i.style.strokeDashoffset=t-e.upload.progress.toFixed(0)/100*t}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?b(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&b(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(jQuery(".media-error-popup").length||b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),t.dropzone_obj.on("queuecomplete",function(){b("#bp-media-uploader-modal-title").text(f.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){b("#bp-media-uploader-modal-title").text(f.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,i){i.data.id?(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t.dropzone_media.length,i.data.album_id=t.album_id,i.data.group_id=t.group_id,i.data.saved=!1,t.dropzone_media.push(i.data)):(jQuery(".media-error-popup").length||b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e)),b(".bb-field-steps-1 #bp-media-photo-next, #bp-media-submit").show(),b(".modal-container").addClass("modal-container--alert"),b(".bb-field-steps-1").addClass("controls-added"),b("#bp-media-add-more").show(),b("#bp-media-uploader-modal-title").text(f.i18n_strings.uploading+"..."),b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var i in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[i].uuid){void 0===t.dropzone_media[i].saved||t.dropzone_media[i].saved||t.removeAttachment(t.dropzone_media[i].id),t.dropzone_media.splice(i,1);break}t.dropzone_obj.getAcceptedFiles().length?b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(b("#bp-media-uploader-modal-status-text").text(""),b("#bp-media-add-more, #bp-media-photo-next").hide(),b(".bb-field-steps-1").removeClass("controls-added"),b("#bp-media-submit").hide(),b(".modal-container").removeClass("modal-container--alert"))}))},openDocumentUploader:function(e){var l=this;e.preventDefault();var a,i,t=b(document),o=b("#bp-media-uploader");void 0!==window.Dropzone&&b("div#media-uploader").length&&(o.hasClass("bp-media-document-uploader")&&(this.currentTargetParent||(this.currentTargetParent=0)),b(e.currentTarget).closest("#bp-media-single-folder").length&&b("#bb-document-privacy").hide(),t.removeClass("open-popup"),o.show(),o.addClass("open-popup"),b("#bp-media-uploader.bp-media-document-uploader").find(".bb-field-steps.bb-field-steps-2").length&&(i="#bp-media-uploader.bp-media-document-uploader",0!==Number(b(i).find(".bb-folder-selected-id").data("value"))?(a=b(i).find(".bb-folder-selected-id").data("value"),b(i).find("#bb-document-privacy").prop("disabled",!0)):a=0,""!==this.moveToIdPopup&&b.ajax({url:m,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){t.find(".bp-media-document-uploader .location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(e.data.first_span_text),""===e.data.html?(t.find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").hide(),t.find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").show()):(t.find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").hide(),t.find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").show()),t.find(".bp-media-document-uploader .popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),t.find(".bp-media-document-uploader .open-popup .bb-folder-create-from").val("profile"),b(i).find(".location-folder-list-wrap .location-folder-list").remove(),b(i).find(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(i,a),b(i).find("ul.location-folder-list span#"+a).trigger("click"),b(i).find(".bb-folder-selected-id").val(a)}})),t.on("click",i+" .location-folder-list li span",function(e){var i;e.preventDefault(),b(this).parent().hasClass("is_active")||(0!==b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>"),b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),a===b(e.currentTarget).data("id")?b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")||(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(b(e.currentTarget).data("id")),i=b(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy"),0!==Number(b(e.currentTarget).data("id"))?(i.find("option").removeAttr("selected"),i.val(b(e.currentTarget).parent().data("privacy")),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1))))}),t.on("click",i+" .breadcrumb .item > span",function(e){var i,t;b(this).hasClass("is-disabled")||(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(b(e.currentTarget).data("id")),b(e.currentTarget).closest(".bb-field-wrap").find(".location-folder-list li span").removeClass("selected").parent().removeClass("is_active"),b(e.currentTarget).closest(".bb-field-wrap").find('.location-folder-list li[data-id="'+b(e.currentTarget).data("id")+'"]').addClass("is_active"),b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove(),a===b(e.currentTarget).data("id")?b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),i=b(e.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy"),t=b(e.currentTarget).closest("#bp-media-uploader").find(".location-folder-list li.is_active").data("privacy"),0!==Number(b(e.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val())?(i.find("option").removeAttr("selected"),i.val(void 0===t?"public":t),i.prop("disabled",!0)):(i.find("option").removeAttr("selected"),i.val("public"),i.prop("disabled",!1)))}),l.options.previewTemplate=document.getElementsByClassName("uploader-post-document-template").length?document.getElementsByClassName("uploader-post-document-template")[0].innerHTML:"",l.dropzone_obj=new Dropzone("div#media-uploader",l.options),l.dropzone_obj.on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",v.media)}),l.dropzone_obj.on("uploadprogress",function(e){var i=b(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t,i.style.strokeDashoffset=t,i.style.strokeDashoffset=t-e.upload.progress.toFixed(0)/100*t}),l.dropzone_obj.on("addedfile",function(){setTimeout(function(){l.dropzone_obj.getAcceptedFiles().length&&b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),l.dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?b(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&b(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(jQuery(".document-error-popup").length||b("body").append('<div id="bp-media-create-album" style="display: block;" class="open-popup document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),l.dropzone_obj.on("accept",function(e,i){0===e.size?i(f.empty_document_type):i()}),l.dropzone_obj.on("queuecomplete",function(){b("#bp-media-uploader-modal-title").text(f.i18n_strings.upload)}),l.dropzone_obj.on("processing",function(){b("#bp-media-uploader-modal-title").text(f.i18n_strings.uploading+"...")}),l.dropzone_obj.on("success",function(e,i){if(!i.data.id){var t,a,o,d,s,n=i.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)t=d[a],s.push(t.textContent=n);return s}e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=l.dropzone_media.length,i.data.folder_id=l.current_folder,i.data.group_id=l.current_group_id,i.data.saved=!1,l.dropzone_media.push(i.data);var r=e.upload.filename,r=r.substr(r.lastIndexOf(".")+1),i=_.isUndefined(i.data.svg_icon)?"":i.data.svg_icon,i=_.isEmpty(i)?"bb-icon-file-"+r:i;b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(i),b(".bb-field-steps-1 #bp-media-document-next, #bp-media-document-submit").show(),b(".modal-container").addClass("modal-container--alert"),b(".bb-field-steps-1").addClass("controls-added"),b("#bp-media-uploader-modal-title").text(f.i18n_strings.uploading+"..."),b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show()}),l.dropzone_obj.on("removedfile",function(e){if(l.dropzone_media.length)for(var i in l.dropzone_media)if(e.upload.uuid==l.dropzone_media[i].uuid){void 0===l.dropzone_media[i].saved||l.dropzone_media[i].saved||l.removeAttachment(l.dropzone_media[i].id),l.dropzone_media.splice(i,1);break}l.dropzone_obj.getAcceptedFiles().length?b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(f.i18n_strings.upload_status,l.dropzone_media.length,l.dropzone_obj.getAcceptedFiles().length)).show():(b("#bp-media-uploader-modal-status-text").text(""),b("#bp-media-document-submit").hide(),b(".modal-container").removeClass("modal-container--alert"))}))},openMediaMove:function(e){e.preventDefault();var t,i,a,o=b(document),d=b(e.currentTarget);this.moveToIdPopup=d.attr("id"),this.moveToTypePopup=d.attr("data-type"),0<d.closest(".activity-inner").length?t=d.closest(".activity-inner"):0<d.closest("#media-stream.media").length?t=d.closest("#media-stream.media"):0<d.closest(".comment-item").length&&(t=d.closest(".comment-item")),b(t).find(".bp-media-move-file").addClass("open").show(),i=d.closest(".media-action-wrap").siblings("a").data("id"),e=d.closest(".media-action-wrap").siblings("a").data("album-id"),t.find(".bp-media-move").attr("id",i),t.find(".bb-model-footer .bp-media-move").addClass("is-disabled"),a=d.closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+d.closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file":"#"+d.closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file",b(a).find(".bp-document-move").attr("id",d.closest(".document-activity").attr("data-id")),0<d.closest(".media-list").length&&(a=".bp-media-move-file"),"group"===this.moveToTypePopup?o.find(".location-album-list-wrap h4").show():o.find(".location-album-list-wrap h4").hide(),b(a).addClass("open-popup"),b(a).find(".location-album-list-wrap .location-album-list").remove(),b(a).find(".location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>');var s=e,n=this.moveToTypePopup;""!==this.moveToIdPopup&&b.ajax({url:m,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){o.find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(e.data.first_span_text),""===e.data.html?(o.find(".open-popup .location-album-list-wrap").hide(),o.find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()):(o.find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide(),o.find(".open-popup .location-album-list-wrap").show()),"group"===n?(o.find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide(),o.find(".open-popup .bb-album-create-from").val("group")):(o.find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show(),o.find(".open-popup .bb-album-create-from").val("profile")),!1===e.data.create_album?(b(a+".open-popup").find(".bp-media-open-create-popup-folder").removeClass("create-album"),b(a+".open-popup").find(".bp-media-open-create-popup-folder").hide()):(b(a+".open-popup").find(".bp-media-open-create-popup-folder").addClass("create-album"),b(a+".open-popup").find(".bp-media-open-create-popup-folder").show()),b(a).find(".location-album-list-wrap .location-album-list").remove(),b(a).find(".location-album-list-wrap").append(e.data.html),b(a).find("ul.location-album-list span#"+s).trigger("click")}}),o.on("click",a+" .location-album-list li span",function(e){var i;e.preventDefault(),b(this).parent().hasClass("is_active")||(0!==b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")&&b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),b(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>"),b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected"),i=b(document).find('a.bb-open-media-theatre[data-id="'+t.find(".bp-media-move").attr("id")+'"]').data("album-id"),Number(i)===Number(b(e.currentTarget).data("id"))?b(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"),b(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")||b(e.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(b(e.currentTarget).data("id")))}),o.on("click",a+" .breadcrumb .item > span",function(e){b(this).hasClass("is-disabled")||(b(e.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(0),b(e.currentTarget).closest(".bp-media-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active"),b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")&&b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove(),s===b(e.currentTarget).data("id")?b(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled"):b(e.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled"))})},openDocumentMove:function(e){e.preventDefault();var i=b(document),t=b(e.currentTarget);t.closest(".bb-activity-media-elem").find(".document-title").text();this.moveToIdPopup=t.attr("id"),this.moveToTypePopup=t.attr("data-type");var e=t.attr("data-action"),a=t.closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length?"#"+t.closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file":"#"+t.closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file";b(a).find(".bp-document-move").attr("id",t.closest(".document-activity").attr("data-id")),this.currentTargetParent=t.closest(".bb-activity-media-elem").attr("data-parent-id"),0<t.closest(".media-folder_items").length&&(this.currentTargetParent=t.closest(".media-folder_items").attr("data-parent-id"),(t.hasClass("ac-document-move")?b(a=".bp-media-move-file").find(".bp-document-move"):b(a=".bp-media-move-folder").find(".bp-folder-move")).attr("id",t.closest(".media-folder_items").attr("data-id"))),b(a).find(".location-folder-list-wrap .location-folder-list").remove(),b(a).find(".location-folder-list-wrap").append('<ul class="location-folder-list is-loading"><li><i class="bb-icon-l bb-icon-spinner animate-spin"></i></li></ul>'),"document"===e?b(a).find(".bb-model-header h4 .target_name").text(f.move_to_file):b(a).find(".bb-model-header h4 .target_name").text(f.move_to_folder),b(a).show(),b(a).addClass("open-popup"),"group"===this.moveToTypePopup?(i.find(".location-folder-list-wrap h4").show(),b(a).addClass("move-folder-popup-group")):(i.find(".location-folder-list-wrap h4").hide(),b(".move-folder-popup-group").removeClass("move-folder-popup-group"));var o=this.currentTargetParent,d=this.moveToTypePopup;""!==this.moveToIdPopup&&b.ajax({url:m,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){i.find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(e.data.first_span_text),""===e.data.html?(i.find(".open-popup .location-folder-list-wrap").hide(),i.find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").show()):(i.find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").hide(),i.find(".open-popup .location-folder-list-wrap").show()),"group"===d?(i.find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide(),i.find(".open-popup .bb-folder-create-from").val("group")):(i.find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show(),i.find(".open-popup .bb-folder-create-from").val("profile")),b(a).find(".location-folder-list-wrap .location-folder-list").remove(),b(a).find(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI(a,o),b(a).find("ul.location-folder-list span#"+o).trigger("click"))}})},closeMediaMove:function(e){e.preventDefault();e=b(e.currentTarget);0!==e.closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").data("id")&&e.closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").remove(),e.closest(".bp-media-move-file").hide()},closeDocumentMove:function(e){e.preventDefault();var i=b(e.currentTarget),t=jQuery(e.currentTarget).closest(".has-folderlocationUI");(i.hasClass("ac-document-close-button")?i.closest(".bp-media-move-file").hide().find(".bp-document-move"):i.closest(".bp-media-move-folder").hide().find(".bp-folder-move")).attr("id",""),t.find(".bp-document-move.loading").removeClass("loading"),this.clearFolderLocationUI(e)},renameDocument:function(e){var i=b(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),t=i.children("span").text();i.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(t).focus().select(),e.preventDefault()},editPrivacyDocument:function(e){e.preventDefault();var i=b(e.currentTarget);i.closest("#media-folder-document-data-table").find(".media-folder_visibility .media-folder_details__bottom span").show().siblings("select").addClass("hide");e=i.closest(".media-folder_items").find(".media-folder_visibility");e.find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide"),e.find(".media-folder_details__bottom span").hide().siblings("select").val(i.attr("data-privacy")),e.find(".media-folder_details__bottom #bb-folder-privacy").attr("data-privacy",i.attr("data-privacy")),this.privacySelectorSelect=e.find(".media-folder_details__bottom span").hide().siblings("select"),this.privacySelectorSpan=e.find(".media-folder_details__bottom span")},renameDocumentSubmit:function(e){var i=b(e.currentTarget),t=i.closest(".media-folder_items").find(".media-folder_name_edit"),a=i.closest(".media-folder_items").find(".media-folder_name > span"),o=i.closest(".media-folder_items").find(".media-folder_name"),d=i.closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id"),s=i.closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),n=i.closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id"),r=t.val().trim(),l="";i.closest(".ac-document-list").length?l=/[?\[\]=<>:;,'"&$#*()|~`!{}%+ \/]+/g:i.closest(".ac-folder-list").length&&(l=/ [\\ / ? % * : | "<>]+/g);l=l.exec(r),l=Boolean(l);if(l?t.addClass("error"):t.removeClass("error"),i.closest(".ac-document-list").length&&(-1!==r.indexOf("\\\\")||l?t.addClass("error"):t.removeClass("error")),!i.hasClass("name_edit_cancel")&&27!==e.keyCode||(t.removeClass("error"),t.parent().hide().siblings(".media-folder_name").show()),i.hasClass("name_edit_save")||13===e.keyCode){if(l)return;t.parent().addClass("submitting").append('<i class="animate-spin bb-icon-l bb-icon-spinner"></i>'),b.ajax({url:m,type:"post",data:{action:"document_update_file_name",document_id:d,attachment_document_id:s,document_type:n,name:r,_wpnonce:v.media},success:function(e){e.success?void 0!==e.data.document&&0<b(e.data.document).length?i.closest(".media-folder_items").html(b(e.data.document).html()):(o.attr("data-document-title",e.data.response.title+"."+o.data("extension")),a.html(e.data.response.title),t.removeClass("submitting"),t.parent().find(".animate-spin").remove(),t.parent().hide().siblings(".media-folder_name").show()):(t.removeClass("submitting"),t.parent().find(".animate-spin").remove(),t.parent().hide().siblings(".media-folder_name").show(),alert(e.data.feedback.replace("&#039;","'")))}})}e.preventDefault()},removeAttachment:function(e){e={action:"media_delete_attachment",_wpnonce:v.media,id:e};b.ajax({type:"POST",url:m,data:e})},beforeunloadWindow:function(){0<b("body.messages").length&&b.each(Dropzone.instances,function(e,i){i.removeAllFiles(!0)})},changeUploadModalTab:function(e){e.preventDefault();var i=b(e.currentTarget),t=i.data("content"),e=i.closest("#bp-media-uploader");b(".bp-media-upload-tab-content").hide(),b("#"+t).show(),this.current_tab=t,e.find(".bp-media-upload-tab").removeClass("selected"),i.addClass("selected"),this.toggleSubmitMediaButton(),e.find(".bb-field-steps-2").slideUp(200),e.find("#bb-media-privacy").hide(),e.find(".bp-media-open-create-popup-folder").hide(),"bp-dropzone-content"===t&&(e.find(".bb-field-steps-1").show(),e.find("#bb-media-privacy").show(),e.find(".bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, #bb-media-privacy").hide()),"bp-existing-media-content"===t&&e.find(".bb-field-uploader-actions").hide(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),b("#bp-media-create-album").show(),b("body").hasClass("directory")&&b("#bp-media-uploader").hide()},openCreateFolderModal:function(e){e.preventDefault();var i=b(document),e=b("#bp-media-create-folder");e.show(),e.addClass("open-popup"),i.find(".open-popup #boss-media-create-album-popup #bb-album-title").show(),i.find(".open-popup #boss-media-create-album-popup #bb-album-title").removeClass("error")},openCreateFolderChildModal:function(e){e.preventDefault();var i=b(document),e=b("#bp-media-create-child-folder");e.show(),e.addClass("open-popup"),i.find(".open-popup #boss-media-create-album-popup #bb-album-child-title").show(),i.find(".open-popup #boss-media-create-album-popup #bb-album-child-title").removeClass("error")},openEditFolderChildModal:function(i){i.preventDefault();var e,t=b(document),a=f.current_user_id,o=f.current_group_id,d=f.current_type;"group"===d?(e=o,t.find(".location-folder-list-wrap h4").show()):(e=a,t.find(".location-folder-list-wrap h4").hide()),b.ajax({url:m,type:"GET",data:{action:"document_get_folder_view",id:e,type:d},success:function(e){t.find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(e.data.first_span_text),b(".location-folder-list-wrap .location-folder-list").remove(),b(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&(bp.Nouveau.Media.folderLocationUI("#bp-media-edit-child-folder",f.current_folder),b(i.currentTarget).closest("#bp-media-single-folder").find("ul.location-folder-list span#"+f.current_folder).trigger("click")),"group"===d?(t.find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide(),t.find(".open-popup .bb-folder-create-from").val("group")):(t.find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show(),t.find(".open-popup .bb-folder-create-from").val("profile"))}}),b("#bp-media-edit-child-folder").show()},folderLocationUI:function(a,o){var e,t;0<b(a).find(".bb-folder-destination").length&&(e=b(document),b(a).find(".location-folder-list-wrap").hasClass("is_loaded")||(e.on("click",a+" .bb-folder-destination",function(){b(this).parent().find(".location-folder-list-wrap").slideToggle()}),b(a).find(".location-folder-list-wrap").addClass("is_loaded"),e.on("click",a+" .location-folder-list span",function(){this.currentTargetParent=b(this).attr("id");var e=b(this),t=b('<div class="item"></div>');e.parents("li").each(function(e,i){i=b(i).children("span").clone();t.prepend("",i)}),b(a).find(".breadcrumbs-append-ul-li .breadcrumb").html(t.prepend('<span data-id="0">'+f.target_text+"</span>")),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||b(a).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||b('<span class="more_options">...</span>').insertAfter(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),b(this).hasClass("selected")&&!b(this).hasClass("disabled")?(b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(""),b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("0"),b(a).find(".location-folder-list li.is_active").length?b(a).find(".bb-folder-selected-id").val(b(a).find(".location-folder-list li.is_active").attr("data-id")):b(a).find(".bb-folder-selected-id").val("0")):(b(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),b(this).addClass("selected"),b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(b(this).text()),b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(b(this).parent().attr("data-id"))),b(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(b(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),b(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),b(this).siblings("ul").children("li").show().children("span,i").show(),b(this).closest(".is_active").removeClass("is_active"),b(a).find("li.is_active").removeClass("is_active"),b(this).parent().addClass("is_active"),b(a).find(".bb-folder-selected-id").val(b(a).find(".location-folder-list li.is_active").attr("data-id")),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").each(function(){b(this).show()}),o===b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(b(a).hasClass("bp-media-move-file")||b(a).hasClass("bp-media-move-folder"))?(b(a).find(".bp-document-move").addClass("is-disabled"),b(a).find(".bp-folder-move").addClass("is-disabled")):(b(a).find(".bp-document-move").removeClass("is-disabled"),b(a).find(".bp-folder-move").removeClass("is-disabled")),setTimeout(function(){var e=(b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").prev():b(a).find(".breadcrumbs-append-ul-li .item > span:last-child")).attr("id");o===e&&(b(a).hasClass("bp-media-move-file")||b(a).hasClass("bp-media-move-folder"))?(b(a).find(".bp-document-move").addClass("is-disabled"),b(a).find(".bp-folder-move").addClass("is-disabled")):(b(a).find(".bp-document-move").removeClass("is-disabled"),b(a).find(".bp-folder-move").removeClass("is-disabled"))},100)}),e.on("click",a+" .breadcrumbs-append-ul-li .item span",function(e){var i,t;b(this).parent().hasClass("is-disabled")||b(this).hasClass("more_options")||(i=b(e.currentTarget).attr("data-id"),b(a).find(".location-folder-list-wrap").find(".location-folder-title").text(b(a).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),b(a).find(".bb-folder-selected-id").val(i),b(a).find(".location-folder-list li").hide(),b(a).find(".location-folder-list li.is_active").removeClass("is_active"),b(a).find(".location-folder-list li > span.selected").removeClass("selected"),b(a).find('.location-folder-list li[data-id="'+i+'"]').addClass("is_active").children("span").addClass("selected"),b(a).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),b(a).find(".location-folder-list li.is_active").children("ul").length&&!b(a).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){b(a).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):b(a).find(".location-folder-list li.is_active").hasClass("has-ul").length?b(a).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){b(a).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),"0"===i&&(b(a).find(".location-folder-list").children("li").show().children("span,i").show(),b(a).find(".location-folder-list-wrap").find(".location-folder-title").text(f.target_text),b(a).find(".location-folder-back").hide()),b(e.currentTarget).nextAll().remove(),o===b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(b(a).hasClass("bp-media-move-file")||b(a).hasClass("bp-media-move-folder"))?(b(a).find(".bp-document-move").addClass("is-disabled"),b(a).find(".bp-folder-move").addClass("is-disabled")):(b(a).find(".bp-document-move").removeClass("is-disabled"),b(a).find(".bp-folder-move").removeClass("is-disabled")),e=b(a).find(".location-folder-list .is_active > span"),t=b('<div class="item"></div>'),e.parents("li").each(function(e,i){i=b(i).children("span").clone();t.prepend("",i)}),b(a).find(".breadcrumbs-append-ul-li .breadcrumb").html(t.prepend('<span data-id="0">'+f.target_text+"</span>")),0===b(a).find('.breadcrumbs-append-ul-li .breadcrumb .item > span[data-id="'+i+'"]').length&&b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").append(b(a).find('.location-folder-list li[data-id="'+i+'"]').children("span").clone()),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length||b(a).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>'),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(a).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||b('<span class="more_options">...</span>').insertAfter(b(a).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))}),b(a).find(".bb-folder-selected-id").val(i))})),b(a).find(".location-folder-list li").each(function(){b(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-l bb-icon-angle-right sub-menu-anchor"></i>')}),b(a).hasClass("bp-media-move-folder")&&(b(a).find(".location-folder-list li>span").removeClass("is-disabled"),b(a).find('.location-folder-list li>span[id="'+b(a).find(".bp-folder-move").attr("id")+'"]').parent().addClass("is-disabled")),e=b(a).find(".bp-folder-move").attr("id"),0===b(a).find('.location-folder-list li[data-id="'+e+'"]').siblings().length&&b(a).find('.location-folder-list li[data-id="'+e+'"]').parent("ul").addClass("no-folder-list a"),o&&(b(a).find(".location-folder-list li").hide(),b(a).find(".location-folder-list li.is_active").removeClass("is_active"),b(a).find('.location-folder-list li[data-id="'+o+'"]').addClass("is_active"),b(a).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),b(a).find(".location-folder-list li.is_active").children("ul").length&&!b(a).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")?setTimeout(function(){b(a).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100):b(a).find(".location-folder-list li.is_active").hasClass("has-ul").length?b(a).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show():setTimeout(function(){b(a).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10),b(a).find(".location-folder-list-wrap").find(".location-folder-title").text(b(a).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),b(a).find(".bb-folder-selected-id").val(b(a).find(".location-folder-list li.is_active").attr("data-id")),b(a).find('.location-folder-list li[data-id="'+e+'"]').children().hide()),"0"===o&&(b(a).find(".location-folder-list").children("li").show(),b(a).find(".location-folder-list-wrap").find(".location-folder-title").text(f.target_text),b(a).find(".location-folder-back").hide()),setTimeout(function(){var e=(b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")?b(a).find(".breadcrumbs-append-ul-li .item > span:last-child").prev():b(a).find(".breadcrumbs-append-ul-li .item > span:last-child")).attr("id");o===e&&(b(a).hasClass("bp-media-move-file")||b(a).hasClass("bp-media-move-folder"))?(b(a).find(".bp-document-move").addClass("is-disabled"),b(a).find(".bp-folder-move").addClass("is-disabled")):(b(a).find(".bp-document-move").removeClass("is-disabled"),b(a).find(".bp-folder-move").removeClass("is-disabled"))},100),e=b(a).find(".location-folder-list .is_active > span"),t=b('<div class="item"></div>'),e.parents("li").each(function(e,i){i=b(i).children("span").clone();t.prepend("",i)}),b(a).find(".breadcrumbs-append-ul-li .breadcrumb").html(t.prepend('<span data-id="0">'+f.target_text+"</span>")))},clearFolderLocationUI:function(e){e=jQuery(e.currentTarget).closest(".has-folderlocationUI");0<e.length&&(e.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),e.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),e.find(".location-folder-title").text(f.target_text),e.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),e.find(".ac_document_search_folder").val(""),e.find(".bb-model-header h4 span").text("..."),e.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),b("#bp-media-create-album").hide(),b("#bb-album-title").val("").removeClass("error")},closeCreateFolderModal:function(e){e.preventDefault(),b("#bp-media-create-folder, #bp-media-create-child-folder").hide(),b("#bb-album-title, #bb-album-child-title").val(""),b("#bp-media-create-child-folder-submit").removeClass("loading")},closeEditFolderModal:function(e){e.preventDefault();var i=b(e.currentTarget).closest("#bp-media-edit-child-folder");b("#bp-media-edit-child-folder").hide(),i.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide(),this.clearFolderLocationUI(e)},closeErrorPopup:function(e){e.preventDefault(),b(e.currentTarget).closest(".open-popup").remove()},submitMedia:function(n){var e,r=this,l=b(n.currentTarget),i=b("#bb-media-privacy");if(n.preventDefault(),l.hasClass("saving"))return!1;if(l.addClass("saving"),"bp-dropzone-content"===r.current_tab){var t=b("#bp-media-post-content").val(),c=b(n.currentTarget).closest(".open-popup"),a=c.find(".bb-album-selected-id").val();if(a.length&&0<parseInt(a))for(var o=r.dropzone_media.length,d=0;d<o;d++)r.dropzone_media[d].album_id=a;else a=r.album_id;t={action:"media_save",_wpnonce:v.media,medias:r.dropzone_media,content:t,album_id:a,group_id:r.group_id,privacy:i.val()},b("#bp-dropzone-content .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:t,success:function(e){if(e.success){b("#media-stream ul.media-list").length||location.reload(!0);var i,t,a=b(".bb-photos-actions"),o=b("#buddypress");0<a.length&&a.show(),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),e.data.media_personal_count&&(o.find(".bp-wrap .users-nav ul li#media-personal-li a span.count").length?o.find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(e.data.media_personal_count):((t=document.createElement("span")).setAttribute("class","count"),i=document.createTextNode(e.data.media_personal_count),t.appendChild(i),o.find(".bp-wrap .users-nav ul li#media-personal-li a").append(t))),e.data.media_group_count&&(o.find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").length?o.find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(e.data.media_group_count):((i=document.createElement("span")).setAttribute("class","count"),t=document.createTextNode(e.data.media_group_count),i.appendChild(t),o.find(".bp-wrap .users-nav ul li#photos-groups-li a").append(i))),"yes"===f.is_media_directory&&(o.find(".media-type-navs ul.media-nav li#media-all a span.count").text(e.data.media_all_count),o.find(".media-type-navs ul.media-nav li#media-personal a span.count").text(e.data.media_personal_count),o.find(".media-type-navs ul.media-nav li#media-groups a span.count").text(e.data.media_group_count));for(var d=r.dropzone_media.length,s=0;s<d;s++)r.dropzone_media[s].saved=!0;c.find(".bb-album-selected-id").val(0),r.closeUploader(n),jQuery(window).scroll()}else b("#bp-dropzone-content").prepend(e.data.feedback);l.removeClass("saving")}})}else"bp-existing-media-content"===r.current_tab?(e=[],b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){e.push(b(this).val())}),t={action:"media_move_to_album",_wpnonce:v.media,medias:e,album_id:r.album_id,group_id:r.group_id},b("#bp-existing-media-content .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:t,success:function(e){var i;e.success?(b("#media-stream ul.media-list").length||b("#media-stream").html(b("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),0<(i=b(".bb-photos-actions")).length&&i.show(),bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){parseInt(b(this).closest("li").data("id"))===parseInt(b(this).val())&&b(this).closest("li").remove()}),jQuery(window).scroll(),r.closeUploader(n)):b("#bp-existing-media-content").prepend(e.data.feedback),l.removeClass("saving")}})):r.current_tab||(r.closeUploader(n),l.removeClass("saving"))},submitDocumentMedia:function(a){var o=this,d=b(a.currentTarget),s=b(a.currentTarget).closest("#bp-media-uploader");if(a.preventDefault(),d.hasClass("saving"))return!1;var n=b(document);if(d.addClass("saving"),"bp-dropzone-content"===o.current_tab){var e=b("#bp-media-post-content").val(),i=b("#bb-document-privacy").val(),t=b(a.currentTarget).closest(".open-popup"),r=t.find(".bb-folder-selected-id").val(),t=t.find(".bb-folder-selected-id").data("value"),l=!0;if(r.length&&0<parseInt(r)){void 0!==t&&parseInt(r)!==parseInt(t)&&(l=!1);for(var c=o.dropzone_media.length,p=0;p<c;p++)o.dropzone_media[p].folder_id=r}i={action:"document_document_save",_wpnonce:v.media,documents:o.dropzone_media,content:e,privacy:i,folder_id:o.current_folder,group_id:o.current_group_id},b("#bp-dropzone-content .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:i,success:function(e){if(e.success){b("#media-stream div#media-folder-document-data-table").length||(b("#media-stream").html(b("<div></div>").addClass("display")),b("#media-stream div").attr("id","media-folder-document-data-table"),b(".bb-photos-actions").show()),b(".document-data-table-head").length?"yes"===f.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(n.find("li#document-personal a").trigger("click"),n.find("li#document-personal").trigger("click")):l&&bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"):location.reload(!0),b("#bp-media-post-content").val("");for(var i=o.dropzone_media.length,t=0;t<i;t++)o.dropzone_media[t].saved=!0;o.closeUploader(a),n.removeClass("open-popup"),jQuery(window).scroll()}else n.removeClass("open-popup"),b("#bp-dropzone-content").prepend(e.data.feedback);d.removeClass("saving"),s.find("#bp-media-document-submit").hide()}})}else o.current_tab||(o.closeUploader(a),d.removeClass("saving"))},saveAlbum:function(i){var t=b(i.currentTarget),a=this,o=b("#bb-album-title"),d=b("#bb-album-privacy");if(t.hasClass("saving"))return!1;if(i.preventDefault(),""===b.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===b.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.addClass("saving"),t.attr("disabled",!0);var e={action:"media_album_save",_wpnonce:v.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(e.album_id=a.album_id),a.group_id&&(e.group_id=a.group_id),b("#bp-media-single-album .bp-feedback").remove(),b("#boss-media-create-album-popup .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:e,success:function(e){setTimeout(function(){t.removeClass("saving"),t.prop("disabled",!1)},500),e.success?a.album_id?(b("#bp-single-album-title").text(o.val()),b("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(i)):(b("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):a.album_id?b("#bp-media-single-album").prepend(e.data.feedback):b("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},saveFolder:function(i){var t=b(i.currentTarget),a=this,e=b("#bb-album-title"),o=b(i.currentTarget).parents().find(".open-popup #bb-folder-privacy option:selected");i.preventDefault();var d=/ [\\ / ? % * : | "<>]+/g.exec(e.val()),d=Boolean(d),s=b(document);if(""===b.trim(e.val())||d)return e.addClass("error"),!1;if(e.removeClass("error"),!a.group_id&&""===b.trim(o.val()))return o.addClass("error"),!1;o.removeClass("error"),t.prop("disabled",!0).addClass("loading");o={action:"document_folder_save",_wpnonce:v.media,title:e.val().trim(),privacy:o.val(),album_id:a.current_folder,group_id:a.current_group_id};b(".bb-single-album-header .bp-feedback").remove(),b("#boss-media-create-album-popup .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:o,success:function(e){setTimeout(function(){t.prop("disabled",!1)},500),e.success?(a.closeFolderUploader(i),b(".document-data-table-head").length?"yes"===f.is_document_directory&&"groups"===bp.Nouveau.getStorage("bp-document").scope?(s.find("li#document-personal a").trigger("click"),s.find("li#document-personal").trigger("click")):(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()):location.reload(!0)):alert(e.data.feedback.replace("&#039;","'"))}})},saveChildFolder:function(i){var e=b(i.currentTarget),t=this,a=b("#bp-media-create-child-folder #bb-album-child-title");i.preventDefault();var o=/ [\\ / ? % * : | "<>]+/g.exec(a.val()),o=Boolean(o);if(""===b.trim(a.val())||o)return a.addClass("error"),!1;a.removeClass("error"),e.prop("disabled",!0).addClass("loading");a={action:"document_child_folder_save",_wpnonce:v.media,title:a.val(),folder_id:t.current_folder,group_id:t.current_group_id};b(".bb-single-album-header .bp-feedback").remove(),b("#boss-media-create-album-popup .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:a,success:function(e){e.success?(t.closeChildFolderUploader(i),location.reload(!0)):alert(e.data.feedback.replace("&#039;","'"))}})},renameChildFolder:function(e){e.preventDefault();var i=b(e.currentTarget),t=this,a=b("#bp-media-edit-child-folder #bb-album-child-title"),o=b("#bp-media-edit-child-folder #bb-folder-privacy"),d=this.currentTargetParent,e=/ [\\ / ? % * : | "<>]+/g.exec(a.val()),e=Boolean(e);if(""===b.trim(a.val())||e)return a.addClass("error"),!1;a.removeClass("error"),i.prop("disabled",!0).addClass("loading");d={action:"document_edit_folder",_wpnonce:v.media,title:a.val(),privacy:o.val(),id:d,group_id:t.current_group_id};b(".bb-single-album-header .bp-feedback").remove(),b("#boss-media-create-album-popup .bp-feedback").remove(),b.ajax({type:"POST",url:m,data:d,success:function(e){setTimeout(function(){i.prop("disabled",!1)},500),e.success?window.location.reload(!0):t.current_folder?b("#bp-media-single-album").prepend(e.data.feedback):b("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(i){if(i.preventDefault(),!this.album_id)return!1;if(!confirm(f.i18n_strings.album_delete_confirm))return!1;b(i.currentTarget).prop("disabled",!0);var e={action:"media_album_delete",_wpnonce:v.media,album_id:this.album_id,group_id:this.group_id};b.ajax({type:"POST",url:m,data:e,success:function(e){e.success?window.location.href=e.data.redirect_url:(alert(f.i18n_strings.album_delete_error),b(i.currentTarget).prop("disabled",!1))}})},deleteFolder:function(i){if(i.preventDefault(),!f.current_folder)return!1;if(!confirm(f.i18n_strings.folder_delete_confirm))return!1;b(i.currentTarget).prop("disabled",!0);var e={action:"document_folder_delete",_wpnonce:v.media,folder_id:f.current_folder,group_id:f.current_group_id};b.ajax({type:"POST",url:m,data:e,success:function(e){e.success?window.location.href=e.data.redirect_url:(alert(f.i18n_strings.folder_delete_error),b(i.currentTarget).prop("disabled",!1))}})},injectMedias:function(e){var i,t,a=bp.Nouveau.getStorage("bp-media"),o=a.scope||null,d=a.filter||null,s=b(e.currentTarget);s.hasClass("load-more")&&(i=+Number(this.current_page)+1,t=this,a="",e.preventDefault(),s.find("a").first().addClass("loading"),(e=b("#buddypress .dir-search input[type=search]")).length&&(a=e.val()),bp.Nouveau.objectRequest({object:"media",scope:o,filter:d,search_terms:a,page:i,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(s.remove(),t.current_page=i,jQuery(window).scroll())}))},injectDocuments:function(e){var i,t,a,o=bp.Nouveau.getStorage("bp-document"),d="",s="",n=o.scope||null,r=o.filter||null,l=b(e.currentTarget);l.hasClass("load-more")&&(i=+Number(this.current_page)+1,t=this,a="",e.preventDefault(),l.find("a").first().addClass("loading"),(e=b("#buddypress .dir-search input[type=search]")).length&&(a=e.val()),s=this.order_by&&this.sort_by?(d=this.sort_by,this.order_by):void 0!==o.extras?(d=o.extras.sort,o.extras.orderby):(d="ASC","title"),bp.Nouveau.objectRequest({object:"document",scope:n,filter:r,search_terms:a,page:i,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table",order_by:s,sort:d}).done(function(e){!0===e.success&&(l.parent(".pager").remove(),t.current_page=i,jQuery(window).scroll())}))},sortDocuments:function(e){var i=b(e.currentTarget),t="",a="date_created";switch(i.data("target")){case"name":a="title";break;case"modified":a="date_modified";break;case"visibility":a="privacy";break;case"group":a="group_id"}i.hasClass("asce")?i.removeClass("asce"):i.addClass("asce");var o=i.hasClass("asce")?"DESC":"ASC",d={};d.orderby=a,d.sort=o,"group"!==a&&bp.Nouveau.setStorage("bp-document","extras",d);e=bp.Nouveau.getStorage("bp-document"),i=e.scope||null,d=e.filter||null,e=b("#buddypress .bp-dir-search-form input[type=search]");e.length&&(t=e.val()),this.sort_by=o,this.order_by=a,this.current_page=1,bp.Nouveau.objectRequest({object:"document",scope:i,filter:d,search_terms:t,page:1,order_by:a,sort:o,method:"reset",target:"#buddypress [data-bp-list]"}).done()},documentPopupNavigate:function(e){e.preventDefault();var i=b(e.currentTarget),t=i.closest(".bb-field-steps"),e=0===i.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";i.closest(".document-options").length&&(e="#bb-album-title"),i.hasClass("bb-field-steps-next")&&""===t.find(e).val().trim()?t.find(e).addClass("error"):(t.find(e).removeClass("error"),t.slideUp(200).siblings(".bb-field-steps").slideDown(200))},uploadDocumentNavigate:function(e){e.preventDefault();var e=b(e.currentTarget),i=b(e).closest("#bp-media-uploader");b(e).hasClass("bb-field-uploader-next")?(i.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),i.find("#bp-media-document-submit, #bp-media-document-prev, .bp-document-open-create-popup-folder, #bb-document-privacy").show(),0!==Number(b(i).find(".bb-folder-selected-id"))&&b(i).find(".location-folder-list li.is_active").length&&b(i).find(".location-folder-list").scrollTop(b(i).find(".location-folder-list li.is_active").offset().top-b(i).find(".location-folder-list").offset().top),b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(e){0<e&&b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(i).find(".breadcrumbs-append-ul-li .breadcrumb").width()&&(b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2)),b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length||b('<span class="more_options">...</span>').insertAfter(b(i).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0)))})):(b(e).hide(),i.find("#bp-media-document-prev, .bp-document-open-create-popup-folder").hide(),i.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),i.closest("#bp-media-single-folder").length&&b("#bb-document-privacy").hide())},uploadMediaNavigate:function(e){e.preventDefault();var i=b(e.currentTarget),e=b(i).closest(".bp-media-photo-uploader");b(i).hasClass("bb-field-uploader-next")?(e.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),e.find("#bp-media-submit, #bp-media-prev, .bp-media-open-create-popup-folder.create-album").show(),e.find("#bb-media-privacy").show(),0!==Number(b(e).find(".bb-album-selected-id"))&&b(e).find(".location-album-list li.is_active").length&&b(e).find(".location-album-list").scrollTop(b(e).find(".location-album-list li.is_active").offset().top-b(e).find(".location-album-list").offset().top)):(b(i).hide(),e.find("#bp-media-prev, .bp-media-open-create-popup-folder").hide(),e.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200),e.closest("#bp-media-single-album").length&&b("#bb-media-privacy").hide())},appendMedia:function(e){var i,t,a=bp.Nouveau.getStorage("bp-media"),o=a.scope||null,d=a.filter||null,s=b(e.currentTarget);s.hasClass("load-more")&&(i=+Number(this.current_page_existing_media)+1,t=this,a="",e.preventDefault(),s.find("a").first().addClass("loading"),(e=b("#buddypress .dir-search input[type=search]")).length&&(a=e.val()),bp.Nouveau.objectRequest({object:"media",scope:o,filter:d,search_terms:a,page:i,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(e){!0===e.success&&(s.remove(),t.current_page_existing_media=i,jQuery(window).scroll())}))},appendAlbums:function(i){var t=+Number(this.current_page_albums)+1,a=this;i.preventDefault(),b(i.currentTarget).find("a").first().addClass("loading");var e={action:"media_albums_loader",_wpnonce:v.media,page:t};b.ajax({type:"POST",url:m,data:e,success:function(e){!0===e.success&&(b(i.currentTarget).remove(),b("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){b("#albums-dir-list ul.bb-albums-list").append(e.data.albums),b(this).fadeIn(100)}),a.current_page_albums=t)}})},toggleSubmitMediaButton:function(){var e=b("#bp-media-submit"),i=b("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),i.show()):(e.hide(),i.hide()):"bp-existing-media-content"===this.current_tab&&(b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),i.hide())},playVideo:function(e){e.preventDefault();var i=b(e.currentTarget),e=i.find("video").get(0),i=i.find(".gif-play-button");!0===e.paused?(e.play(),i.hide()):(e.pause(),i.show())},autoPlayGifVideos:function(){b(".gif-player").each(function(){var e=b(this).find("video").get(0),i=b(this).find(".gif-play-button");b(this).is(":in-viewport")?(e.play(),i.hide()):(e.pause(),i.show())})},fileActionButton:function(e){var i=b(e.currentTarget),t=i.parent();t.hasClass("download_file")||t.hasClass("copy_download_file_url")||t.hasClass("redirect-activity-privacy-change")||(e.preventDefault(),i.closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"),i.closest(".media-folder_items").find(".media-folder_action__list.bb_more_dropdown").toggleClass("open").closest(".media-folder_items").siblings(".media-folder_items").find(".media-folder_action__list.bb_more_dropdown").removeClass("open"),b("body").addClass("document_more_option_open"))},copyDownloadLink:function(e){e.preventDefault();var i=e.currentTarget,e="document_copy_link";b("body").append('<textarea style="position:absolute;opacity:0;" id="'+e+'"></textarea>');var t=b(i).text();b(i).text(f.copy_to_clip_board_text);e=b("#"+e);return e.val(b(i).attr("href")),e.select(),document.execCommand("copy"),setTimeout(function(){b(i).text(t)},2e3),!1},fileActivityActionButton:function(e){e.preventDefault();var i=b(e.currentTarget);i.parent().hasClass("copy_download_file_url")||(i.closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible"),i.closest(".bb-activity-media-elem").find(".bb_more_dropdown").toggleClass("open").closest(".bb-activity-media-elem").siblings().find(".bb_more_dropdown").removeClass("open").closest(".activity-item").siblings().find(".bb-activity-media-elem .bb_more_dropdown").removeClass("open"),b("body").addClass("document_more_option_open"),i.closest(".bb-activity-media-elem").length<1&&(i.closest(".bb-photo-thumb").toggleClass("is-visible").parent().siblings().find(".bb-photo-thumb").removeClass("is-visible").removeClass("is-visible"),i.closest(".bb-photo-thumb").find(".bb_more_dropdown").toggleClass("open").closest(".bb-photo-thumb").parent().siblings().find(".bb-photo-thumb .bb_more_dropdown").removeClass("open")),"a"!==e.currentTarget.tagName.toLowerCase()||i.hasClass("document-action_more")||i.hasClass("media-action_more")||(i.closest(".bb-activity-media-elem").removeClass("is-visible").find(".bb_more_dropdown").removeClass("open"),i.closest(".bb-photo-thumb").removeClass("is-visible").find(".bb_more_dropdown").removeClass("open")))},toggleFileActivityActionButton:function(e){var i;return(e=e||window.event).target?i=e.target:e.srcElement&&(i=e.srcElement),3===i.nodeType&&(i=i.parentNode),!0===e.altKey||!0===e.metaKey||b(i).hasClass("document-action_more")||b(i).parent().hasClass("document-action_more")||b(i).hasClass("media-folder_action__anchor")||b(i).parent().hasClass("media-folder_action__anchor")||b(i).hasClass("media-action_more")||b(i).parent().hasClass("media-action_more")||b(i).hasClass("video-action_more")||b(i).parent().hasClass("video-action_more")?e:(b(".bb-activity-media-elem.is-visible").removeClass("is-visible"),b(".media-folder_items.is-visible").removeClass("is-visible"),b(".bb-photo-thumb.is-visible").removeClass("is-visible"),b(".bb-item-thumb.is-visible").removeClass("is-visible"),b(".bb-activity-video-elem.is-visible").removeClass("is-visible"),b(".video-action-wrap.item-action-wrap.is-visible").removeClass("is-visible"),b(".video-action-wrap .bb_more_dropdown").removeClass("open"),b(".bb-activity-media-elem .bb_more_dropdown").removeClass("open"),b(".bb-photo-thumb .bb_more_dropdown").removeClass("open"),b(".media-folder_items .bb_more_dropdown").removeClass("open"),void b("body").removeClass("document_more_option_open video_more_option_open item_more_option_open"))},toggleCodePreview:function(e){e.preventDefault(),b(e.currentTarget).closest(".document-activity").toggleClass("code-full-view")},documentCodeMirror:function(){b(".document-text:not(.loaded)").each(function(){var e=b(this),i=e.attr("data-extension"),t=e.attr("data-extension");"html"!==i&&"htm"!==i||(t="text/html"),"js"===i?CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}):CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),mode:t,lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}),e.addClass("loaded"),150<e.parent().height()&&(e.closest(".document-text-wrap").addClass("is_large"),e.closest(".document-activity").addClass("is_large"))})},closePopup:function(e){27===e.keyCode&&(b(".bp-media-move-folder.open-popup .ac-folder-close-button:visible, .bp-media-move-file .ac-media-close-button:visible, .bp-media-move-folder.open-popup .close-create-popup-folder:visible,.bp-media-move-file.open-popup .ac-document-close-button:visible, .bp-media-move-file .close-create-popup-folder:visible, .bp-media-move-photo.open .close-create-popup-album:visible").trigger("click"),b("#bp-media-create-folder #bp-media-create-folder-close:visible, #bp-media-create-child-folder #bp-media-create-folder-close:visible").trigger("click"),b("#bp-media-uploader #bp-media-uploader-close:visible").trigger("click"),b("#bp-media-edit-child-folder #bp-media-edit-folder-close:visible").trigger("click"),b("#bp-media-create-album #bp-media-create-album-close:visible").trigger("click"),b(".media-folder_visibility select#bb-folder-privacy:not(.hide)").each(function(){b(this).attr("data-mouseup","false").addClass("hide").siblings("span").show().text(b(this).find("option:selected").text())}),b(".bp-video-thumbnail-uploader .bp-video-thumbnail-uploader-close:visible").trigger("click"),b(".bb-action-popup .bb-close-action-popup:visible").trigger("click"))},submitPopup:function(e){b(document).find(".modal-wrapper:visible").length<1||13===e.keyCode&&(b(".bp-media-move-folder.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-folder.open-popup  .bp-folder-move:not(.is-disabled):visible,.bp-media-move-file.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-file.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-folder.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-file.open .bp-media-move:not(.is-disabled):visible, .bp-media-move-file.open .bp-media-create-popup-album-submit:visible").trigger("click"),b("#bp-media-create-folder #bp-media-create-folder-submit:visible, #bp-media-create-child-folder #bp-media-create-child-folder-submit:visible").trigger("click"),b("#bp-media-uploader #bp-media-document-submit:visible, #bp-media-uploader #bp-media-submit:visible").trigger("click"),b("#bp-media-edit-child-folder #bp-media-edit-child-folder-submit:visible").trigger("click"),b("#bp-media-create-album #bp-media-create-album-submit:visible").trigger("click"))},updateAlbumNavCount:function(e){var i=b(".single-screen-navs.albums-nav").find("ul li#albums-li");i.length<1||(0<b(i).find("span.count").length?b(i).find("span.count").text(e):b(i).find("a#albums").append('<span class="count">'+e+"</span>"))},setupForumDropzoneEvents:function(e){var c=e.self,a=e.dropzoneObj,o=e.target,p=e.type,m=e.dropzoneDataObj,u=e.dropzoneContainer;"video"===p&&a.on("addedfile",function(e){e.dataURL&&e.dataThumb&&e.dataThumb.length?b(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.dataThumb+' " alt=""/>'):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),a.on("sending",function(e,i,t){t.append("action","document"===p?p+"_"+p+"_upload":p+"_upload"),t.append("_wpnonce",v["document"===p?"media":p]);var a=o.closest("form");a.addClass("has-media"),["media","document","video","gif"].forEach(function(e){var i=a.find("#forums-"+e+"-button");i&&(i=i.parents(".post-elements-buttons-item"),p===e?i.addClass("no-click"):i.addClass("disable"))})}),a.on("uploadprogress",function(e){o.closest("form").addClass("media-uploading");var i=b(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t;var a=t-e.upload.progress.toFixed(0)/100*t;i.style.strokeDashoffset=a,"video"===p&&(e.upload.progress<=99?(b(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+h.i18n_strings.video_uploaded_text),i.style.strokeDashoffset=a):100===e.upload.progress&&(i.style.strokeDashoffset=t-.99*t,b(e.previewElement).find(".dz-progress-count").text("99% "+h.i18n_strings.video_uploaded_text)))}),a.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?b(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&b(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):(jQuery(".forum-"+("media"===p?"document":p)+"-error-popup").length||("media"===p?b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"):"document"===p?b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"):"video"===p&&b("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup forum-video-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+h.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>")),this.removeFile(e),o.closest("form").removeClass("media-uploading"))}),"media"!==p&&a.on("accept",function(e,i){0===e.size?i(f["empty_"+p+"_type"]):i()}),a.on("success",function(e,i){var t,a;if("video"===p&&100===e.upload.progress&&(b(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,b(e.previewElement).find(".dz-progress-count").text("100% "+h.i18n_strings.video_uploaded_text),b(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id)e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=b(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.group_id=c.group_id,i.data.saved=!1,"media"===p?i.data.album_id=c.album_id:"document"===p?i.data.folder_id=c.current_folder:"video"===p&&(i.data.album_id=c.album_id,i.data.js_preview=b(e.previewElement).find(".dz-video-thumbnail img").attr("src")),m.push(i.data),u.closest("#whats-new-attachments").find("#bbp_"+p).length&&u.closest("#whats-new-attachments").find("#bbp_"+p).val(JSON.stringify(m)),"document"===p&&(t=(a=e.upload.filename).substr(a.lastIndexOf(".")+1),a=_.isUndefined(i.data.svg_icon)?"":i.data.svg_icon,a=_.isEmpty(a)?"bb-icon-file-"+t:a,b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(a));else if("media"===p)jQuery(".forum-"+p+"-error-popup").length||b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button" id="bp-media-create-folder-close" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e);else if("document"===p||"video"===p){var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),r=[],d=0,s=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<s;d++)o=n[d],r.push(o.textContent=l);return r}}),a.on("removedfile",function(e){if(!0===bp.Nouveau.Media.reply_topic_allow_delete_media){if(m.length)for(var i in m)if(e.upload.uuid===m[i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===m[i].saved||m[i].saved||"edit"!==bp.Nouveau.Media.reply_topic_display_post||c.removeAttachment(m[i].id),m.splice(i,1),u.closest("#whats-new-attachments").find("#bbp_"+p).length&&u.closest("#whats-new-attachments").find("#bbp_"+p).val(JSON.stringify(m));break}var t;_.isNull(a.files)||0!==a.files.length||(t=o.closest("form"),["media","document","video","gif"].forEach(function(e){var i=t.find("#forums-"+e+"-button");i&&(i=i.parents(".post-elements-buttons-item"),p===e?i.removeClass("no-click"):i.removeClass("disable"))}))}_.isNull(a.files)||0!==a.files.length||o.closest("form").removeClass("has-media")}),a.on("complete",function(e){var i,t;0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&o.closest("form").removeClass("media-uploading"),"document"===p&&(i=(t=_.isUndefined(e.name)?"":e.name).substr(t.lastIndexOf(".")+1),t=_.isUndefined(e.svg_icon)?"":e.svg_icon,t=_.isEmpty(t)?"bb-icon-file-"+i:t,b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").hasClass("bb-icon-file")&&b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(t))})},setupGroupMessageDropzoneEvents:function(e){var c=e.self,a=e.dropzoneObj,o=e.target,p=e.type,m=e.dropzoneDataObj;"video"===p&&a.on("addedfile",function(e){e.dataURL&&e.dataThumb&&e.dataThumb.length?b(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.dataThumb+' " alt=""/>'):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),a.on("sending",function(e,i,t){t.append("action","document"===p?p+"_"+p+"_upload":p+"_upload"),t.append("_wpnonce",v["document"===p?"media":p]);var a=o.closest("#send_group_message_form");["media","document","video","gif"].forEach(function(e){var i=a.find("#bp-group-messages-"+e+"-button");i&&(i=i.parents(".post-elements-buttons-item"),p===e?i.addClass("no-click"):i.addClass("disable"))})}),a.on("uploadprogress",function(e){var i=b(e.previewElement).find(".dz-progress-ring circle")[0],t=2*i.r.baseVal.value*Math.PI;i.style.strokeDasharray=t+" "+t;var a=t-e.upload.progress.toFixed(0)/100*t;i.style.strokeDashoffset=a,"video"===p&&(e.upload.progress<=99?(b(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+h.i18n_strings.video_uploaded_text),i.style.strokeDashoffset=a):100===e.upload.progress&&(i.style.strokeDashoffset=t-.99*t,b(e.previewElement).find(".dz-progress-count").text("99% "+h.i18n_strings.video_uploaded_text)))}),a.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback?b(e.previewElement).find(".dz-error-message span").text(i.data.feedback):"error"===e.status&&e.xhr&&0===e.xhr.status&&b(e.previewElement).find(".dz-error-message span").text(f.connection_lost_error):("media"===p||"document"===p?jQuery(".group-"+("media"===p?"document":p)+"-error-popup").length||("document"===p?b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"):b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>")):b("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+h.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>"),this.removeFile(e))}),"media"!==p&&a.on("accept",function(e,i){0===e.size?i(f["empty_"+p+"_type"]):i()}),a.on("success",function(e,i){if("video"===p&&100===e.upload.progress&&(b(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,b(e.previewElement).find(".dz-progress-count").text("100% "+h.i18n_strings.video_uploaded_text),b(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id){e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=b(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.group_id=c.group_id,i.data.saved=!1,"media"===p?i.data.album_id=c.album_id:"document"===p?i.data.folder_id=c.current_folder:"video"===p&&(i.data.album_id=c.album_id,i.data.js_preview=b(e.previewElement).find(".dz-video-thumbnail img").attr("src")),m.push(i.data);var t,a=b("#bp_group_messages_"+p);a.length&&a.val(JSON.stringify(m)),"document"===p&&(a=(t=e.upload.filename).substr(t.lastIndexOf(".")+1),t=_.isUndefined(i.data.svg_icon)?"":i.data.svg_icon,t=_.isEmpty(t)?"bb-icon-file-"+a:t,b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").length&&b(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass(t))}else if("media"===p)jQuery(".group-message-error-popup").length||b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-message-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+f.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>"),this.removeFile(e);else if("document"===p||"video"===p){var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),r=[],d=0,s=(n=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;d<s;d++)o=n[d],r.push(o.textContent=l);return r}}),a.on("removedfile",function(e){if(m.length)for(var i in m)if(e.upload.uuid===m[i].uuid){void 0===m[i].saved||m[i].saved||c.removeAttachment(m[i].id),m.splice(i,1);i=b("#bp_group_messages_"+p);i.length&&i.val(JSON.stringify(m));break}var t;_.isNull(a.files)||0!==a.files.length||(t=b("#send_group_message_form"),["media","document","video","gif"].forEach(function(e){var i=t.find("#bp-group-messages-"+e+"-button");i&&(i=i.parents(".post-elements-buttons-item"),p===e?i.removeClass("no-click"):i.removeClass("disable"))}))})}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.documents=[],this.current_media=!1,this.current_document=!1,this.current_index=0,this.current_document_index=0,this.is_open_media=!1,this.is_open_document=!1,this.nextLink=b(".bb-next-media"),this.nextDocumentLink=b(".bb-next-document"),this.previousDocumentLink=b(".bb-prev-document"),this.previousLink=b(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==f.group_id&&f.group_id},addListeners:function(){var e=b(document);e.on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),e.on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this)),e.on("click",".document-detail-wrap-description-popup",this.openDocumentTheatre.bind(this)),e.on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),e.on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),e.on("click",".bb-prev-media",this.previous.bind(this)),e.on("click",".bb-next-media",this.next.bind(this)),e.on("click",".bb-prev-document",this.previousDocument.bind(this)),e.on("click",".bb-next-document",this.nextDocument.bind(this)),e.on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),e.on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),e.on("click","#bb-media-model-container .document-privacy>li",this.documentPrivacyChange.bind(this)),e.on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),e.on("click","#bb-media-model-container .bb-document-section span.privacy",bp.Nouveau,this.toggleDocumentPrivacyDropdown.bind(this)),e.on("click",".bp-add-media-activity-description",this.openMediaActivityDescription.bind(this)),e.on("click","#bp-activity-description-new-reset",this.closeMediaActivityDescription.bind(this)),e.on("keyup",".bp-edit-media-activity-description #add-activity-description",this.MediaActivityDescriptionUpdate.bind(this)),e.on("click","#bp-activity-description-new-submit",this.submitMediaActivityDescription.bind(this)),e.click(this.togglePopupDropdown),document.addEventListener("keyup",this.checkPressedKeyDocuments.bind(this)),document.addEventListener("keyup",this.checkPressedKey.bind(this))},checkPressedKey:function(e){var i=this;if(e=e||window.event,!i.is_open_media)return!1;var t=b(e.target).hasClass("ac-input")||"add-activity-description"===b(e.target).attr("id");switch(e.keyCode){case 27:i.closeTheatre(e);break;case 37:if(void 0===i.medias[i.current_index-1]||t)return!1;i.previous(e);break;case 39:if(void 0===i.medias[i.current_index+1]||t)return!1;i.next(e)}},checkPressedKeyDocuments:function(e){e=e||window.event;var i=this;if(!i.is_open_document)return!1;var t=b(e.target).hasClass("ac-input")||"add-activity-description"===b(e.target).attr("id");switch(e.keyCode){case 27:i.closeDocumentTheatre(e);break;case 37:if(void 0===i.documents[i.current_document_index-1]||t)return!1;i.previousDocument(e);break;case 39:if(void 0===i.documents[i.current_document_index+1]||t)return!1;i.nextDocument(e)}},openTheatre:function(e){e.preventDefault();var i=b(e.currentTarget),t=this;if(i.closest("#bp-existing-media-content").length)return!1;t.setupGlobals(),t.setMedias(i),e=i.data("id"),t.setCurrentMedia(e),t.showMedia(),t.navigationCommands(),t.getParentActivityHtml(i),t.getMediasDescription(),b(".bb-media-model-wrapper.document").hide();i=document.getElementById(b(".bb-media-model-wrapper.video video").attr("id"));i&&i.pause(),b(".bb-media-model-wrapper.video").hide(),b(".bb-media-model-wrapper.media").show(),t.is_open_media=!0},getParentActivityHtml:function(e){var i=b("#hidden_parent_id"),t=i.val(),e=e.closest(".bb-media-model-wrapper").find("#bb-media-model-container .activity-list li.activity-item").data("bp-activity-id");parseInt(t)===parseInt(e)&&(e=b('#bb-media-model-container [data-bp-activity-id="'+t+'"]'),b('[data-bp-activity-id="'+t+'"] > .activity-state').html(b(e).find(".activity-state").html()),b('[data-bp-activity-id="'+t+'"] > .activity-meta').html(b(e).find(".activity-meta").html()),b('[data-bp-activity-id="'+t+'"] > .activity-comments').html(b(e).find(".activity-comments").html())),i.length&&i.remove()},getMediasDescription:function(){var e=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!==e.activity_ajax&&e.activity_ajax.abort();var i=b('[data-bp-activity-id="'+e.current_media.activity_id+'"] .activity-comments');i.length&&(i=i.find("#ac-form-"+e.current_media.activity_id),e.current_media.parent_activity_comments=!0,i.remove()),!0===e.current_media.parent_activity_comments&&b(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_media.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=b.ajax({type:"POST",url:m,data:{action:"media_get_media_description",id:e.current_media.id,attachment_id:e.current_media.attachment_id,nonce:v.media},success:function(e){e.success?(b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),b(".bb-media-info-section:visible").show(),b(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10)):b(".bb-media-info-section.media").hide()}})},openDocumentTheatre:function(e){e.preventDefault();var i,t=b(e.currentTarget),a=this;if(t.closest("#bp-existing-document-content").length)return!1;t.closest(".document.document-theatre").length&&a.closeDocumentTheatre(e),i=t.data("id"),a.setupGlobals(),a.setDocuments(t),a.setCurrentDocument(i),a.showDocument(),a.navigationDocumentCommands(),a.getParentActivityHtml(t),a.getDocumentsDescription(),-1!==b.inArray(a.current_document.extension,s.mp3_preview_extension.split(","))&&b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").length&&b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap").length&&b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap audio")[0].pause(),b(".bb-media-model-wrapper.media").hide(),b(".bb-media-model-wrapper.document").show();e=document.getElementById(b(".bb-media-model-wrapper.video video").attr("id"));e&&(e.pause(),e.src=""),b(".bb-media-model-wrapper.video").hide(),a.is_open_document=!0},resetRemoveActivityCommentsData:function(){var e,i=this,t=!1,a=!1,o=!1,d=!1,s=!1,n=!1;i.current_media.parent_activity_comments&&((t=(d=b('.bb-media-model-wrapper.media [data-bp-activity-id="'+i.current_media.activity_id+'"]')).find(".activity-comments")).length&&(e=t.find("#ac-form-"+i.current_media.activity_id),this.purgeEditActivityForm(e),e.find("#ac-input-"+i.current_media.activity_id).html(""),e.removeClass("has-content has-gif has-media").addClass("root"),t.append(e),e.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),this.resetActivityMedia(i.current_media.activity_id),t.find(".acomment-display").removeClass("display-focus"),t.find(".comment-item").removeClass("comment-item-focus"),s=t.html(),n=t.attr("class"),t.remove(),(t=b('[data-bp-activity-id="'+i.current_media.activity_id+'"] .activity-comments')).length&&(t.attr("class",n),0===t.find("#ac-form-"+i.current_media.activity_id).length&&(t.append(e),t.children("form").removeClass("events-initiated").addClass("not-initialized")))),(o=d.find(".activity-state")).length&&(s=o.html(),n=o.attr("class"),o.remove(),(o=b('[data-bp-activity-id="'+i.current_media.activity_id+'"] .activity-state')).length&&(o.html(s),o.attr("class",n))),(a=d.find(".activity-meta")).length&&(s=a.html(),n=a.attr("class"),a.remove(),(a=b('[data-bp-activity-id="'+i.current_media.activity_id+'"] > .activity-meta')).length&&(a.html(s),a.attr("class",n))),d.remove()),i.current_document.parent_activity_comments&&((t=(d=b('.bb-media-model-wrapper.document [data-bp-activity-id="'+i.current_document.activity_id+'"]')).find(".activity-comments")).length&&(e=t.find("#ac-form-"+i.current_document.activity_id),this.purgeEditActivityForm(e),e.find("#ac-input-"+i.current_document.activity_id).html(""),e.removeClass("has-content has-gif has-media").addClass("root"),t.append(e),e.find(".post-elements-buttons-item.post-emoji").removeClass("active").empty(""),this.resetActivityMedia(i.current_document.activity_id),t.find(".acomment-display").removeClass("display-focus"),t.find(".comment-item").removeClass("comment-item-focus"),s=t.html(),n=t.attr("class"),t.remove(),(t=b('[data-bp-activity-id="'+i.current_document.activity_id+'"] .activity-comments')).length&&(t.attr("class",n),0===t.find("#ac-form-"+i.current_document.activity_id).length&&(t.append(e),t.children("form").removeClass("events-initiated").addClass("not-initialized")),t.find(".document-text.loaded").removeClass("loaded").find(".CodeMirror").remove(),jQuery(window).scroll())),(o=d.find(".activity-state")).length&&(s=o.html(),n=o.attr("class"),o.remove(),(o=b('[data-bp-activity-id="'+i.current_document.activity_id+'"] .activity-state')).length&&(o.html(s),o.attr("class",n))),(a=d.find(".activity-meta")).length&&(s=a.html(),n=a.attr("class"),a.remove(),(a=b('[data-bp-activity-id="'+i.current_document.activity_id+'"] > .activity-meta')).length&&(a.html(s),a.attr("class",n))),d.remove()),bp.Nouveau.reportPopUp(),bp.Nouveau.reportActions()},closeTheatre:function(e){e.preventDefault();var i=b(e.currentTarget);if(b(i).closest(".bb-media-model-wrapper").hasClass("video-theatre"))return!1;e=b(".bb-media-model-wrapper.media .bb-media-section");e.find("img").attr("src","");e=e.find("video");e.length&&videojs(e.attr("id")).reset(),b(".bb-media-model-wrapper").hide(),this.is_open_media=!1,this.resetRemoveActivityCommentsData(),this.current_media=!1,this.getParentActivityHtml(i)},closeDocumentTheatre:function(e){e.preventDefault();var i=b(document).find(".document-theatre");i.find(".bb-media-section").removeClass("bb-media-no-preview").find(".document-preview").html(""),b(".bb-media-info-section.document").show(),i.hide(),this.is_open_document=!1,this.resetRemoveActivityCommentsData(),this.current_document=!1,this.getParentActivityHtml(b(e.currentTarget))},setMedias:function(e){var i=b(".bb-open-media-theatre"),t=0;if(void 0!==(i=b("body").hasClass("activity")?b(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre"):i)){this.medias=[];for(var a=i.length,t=0;t<a;t++){var o,d=b(i[t]);d.closest("#bp-existing-media-content").length||(o={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),can_edit:d.data("can-edit"),is_forum:!1},d.closest(".forums-media-wrap").length&&(o.is_forum=!0),void 0!==o.privacy&&"message"===o.privacy?o.is_message=!0:o.is_message=!1,this.medias.push(o))}}},setDocuments:function(e){var i=b(".bb-open-document-theatre"),t=0;if(b(e).closest(".bp-search-ac-header").length?i=b(e).closest(".bp-search-ac-header").find(".bb-open-document-theatre"):b("body").hasClass("activity")&&0===b(e).closest(".search-document-list").length&&(i=b(e).closest(".bb-activity-media-wrap").find(".bb-open-document-theatre")),void 0!==i){this.documents=[];for(var a=i.length,t=0;t<a;t++){var o,d=b(i[t]);i.closest("#bp-existing-document-content").length||(o={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),attachment_id:d.data("attachment-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),extension:d.data("extension"),target_text:d.data("document-title"),preview:d.data("preview"),full_preview:d.data("full-preview"),text_preview:d.data("text-preview"),mirror_text:d.data("mirror-text"),target_icon_class:d.data("icon-class"),author:d.data("author"),download:d.attr("href"),mp3:d.data("mp3-preview"),can_edit:d.data("can-edit"),video:d.attr("data-video-preview"),is_forum:!1},d.closest(".forums-media-wrap").length&&(o.is_forum=!0),void 0!==o.privacy&&"message"===o.privacy?o.is_message=!0:o.is_message=!1,this.documents.push(o))}}},setCurrentMedia:function(e){for(var i=this,t=i.medias.length,a=0;a<t;a++)if(e===i.medias[a].id){i.current_media=i.medias[a],i.current_index=a;break}},setCurrentDocument:function(e){for(var i=this,t=i.documents.length,a=0;a<t;a++)if(e===i.documents[a].id){i.current_document=i.documents[a],i.current_document_index=a;break}},showMedia:function(){var e=this;if(void 0===e.current_media)return!1;b(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src",e.current_media.attachment);var i,t=b(".bb-media-section .bb-media-privacy-wrap");t.length&&(t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.media-privacy").find("li[data-value="+e.current_media.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_media.privacy),!(void 0!==r&&void 0!==e.current_media.activity_id&&0!==e.current_media.activity_id||e.group_id||e.current_media.is_forum||e.current_media.group_id||e.current_media.album_id||e.current_media.is_message)&&e.can_manage_media&&e.current_media.can_edit||t.hide()),e.navigationCommands()},showDocument:function(){var e=this;if(void 0===e.current_document)return!1;var i=e.current_document.target_text,t=e.current_document.target_icon_class,a=b(document).find(".document-theatre"),o=e.current_document.extension,d=e.current_document.mirror_text;a.find(".bb-document-section").removeClass("bb-video-preview"),-1!==b.inArray(e.current_document.extension,["css","txt","js","html","htm","csv"])?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+i+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>'),a.find(".bb-document-section .document-preview .document-text").attr("data-extension",o),a.find(".bb-document-section .document-preview .document-text textarea").html(d),setTimeout(function(){bp.Nouveau.Media.documentCodeMirror()},1e3)):-1!==b.inArray(e.current_document.extension,s.mp3_preview_extension.split(","))?(a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"><h3>'+i+'</h3><div class="document-audio"><audio src="'+e.current_document.mp3+'" controls controlsList="nodownload"></audio></div></div>')):-1!==b.inArray("."+e.current_document.extension,h.video_type.split(","))?(a.find(".bb-document-section").addClass("bb-video-preview"),a.find(".bb-document-section .document-preview").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),"mov"===e.current_document.extension||"m4v"===e.current_document.extension?a.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+e.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+e.current_document.video+'" type="video/mp4" ></source></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'):a.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+e.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+e.current_document.video+'" type="video/'+e.current_document.extension+'" ></source></video><span class="video-loader"><i class="bb-icon-l bb-icon-spinner animate-spin"></i></span>'),b(window).scroll()):e.current_document.full_preview?(a.find(".bb-document-section").removeClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html("<h3>"+i+'</h3><div class="img-section"><div class="img-block-wrap"> <img src="'+e.current_document.full_preview+'" /></div></div>')):(a.find(".bb-document-section").addClass("bb-media-no-preview"),a.find(".bb-document-section .document-preview").html(""),a.find(".bb-document-section .document-preview").html('<div class="img-section"> <i class="'+t+'"></i><p>'+i+"</p></div>"));t=b(".bb-document-section .bb-document-privacy-wrap");t.length&&(t.show(),t.parent().show(),t.find("ul.document-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",""),(i=t.find("ul.document-privacy").find("li[data-value="+e.current_document.privacy+"]")).addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",i.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_document.privacy),(void 0!==r&&void 0!==e.current_document.activity_id&&0!==e.current_document.activity_id||e.group_id||e.current_document.is_forum||e.current_document.group_id||e.current_document.album_id||!e.can_manage_document||!e.current_document.can_edit||e.current_document.is_message)&&t.parent().hide()),e.navigationDocumentCommands()},next:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData(),void 0!==e.medias[e.current_index+1]?(e.current_index=e.current_index+1,e.current_media=e.medias[e.current_index],e.showMedia(),e.getMediasDescription()):e.nextLink.hide()},previous:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData(),void 0!==e.medias[e.current_index-1]?(e.current_index=e.current_index-1,e.current_media=e.medias[e.current_index],e.showMedia(),e.getMediasDescription()):e.previousLink.hide()},nextDocument:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData(),void 0!==e.documents[e.current_document_index+1]?(e.current_document_index=e.current_document_index+1,e.current_document=e.documents[e.current_document_index],e.showDocument(),e.getDocumentsDescription()):e.nextDocumentLink.hide()},previousDocument:function(e){e.preventDefault();e=this;e.resetRemoveActivityCommentsData(),void 0!==e.documents[e.current_document_index-1]?(e.current_document_index=e.current_document_index-1,e.current_document=e.documents[e.current_document_index],e.showDocument(),e.getDocumentsDescription()):e.previousDocumentLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},navigationDocumentCommands:function(){var e=this;0==e.current_document_index&&e.current_document_index!=e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.show()):0==e.current_document_index&&e.current_document_index==e.documents.length-1?(e.previousDocumentLink.hide(),e.nextDocumentLink.hide()):e.current_document_index==e.documents.length-1?(e.previousDocumentLink.show(),e.nextDocumentLink.hide()):(e.previousDocumentLink.show(),e.nextDocumentLink.show())},getDocumentsDescription:function(){var e=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-l bb-icon-spinner animate-spin"></i>'),!1!==e.activity_ajax&&e.activity_ajax.abort();var i=b('[data-bp-activity-id="'+e.current_document.activity_id+'"] .activity-comments');i.length&&(i=i.find("#ac-form-"+e.current_document.activity_id),e.current_document.parent_activity_comments=!0,i.remove()),!0===e.current_document.parent_activity_comments&&b(".bb-media-model-wrapper:last").after('<input type="hidden" value="'+e.current_document.activity_id+'" id="hidden_parent_id"/>'),e.activity_ajax=b.ajax({type:"POST",url:m,data:{action:"document_get_document_description",id:e.current_document.id,attachment_id:e.current_document.attachment_id,nonce:v.media},success:function(e){e.success?(b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description),b(".bb-media-info-section:visible").show(),b(window).scroll(),setTimeout(function(){bp.Nouveau.reportPopUp(),bp.Nouveau.reportedPopup()},10)):b(".bb-media-info-section.document").hide()}})},activityDeleted:function(e,i){var t=this,a=0;if(t.is_open_media&&void 0!==i&&"delete_activity"===i.action&&t.current_media.activity_id==i.id){var o=b(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+t.current_media.id+'"]'),d=o.parents("ul");o.closest("li").remove(),0===d.find("li:not(.load-more)").length&&(0<(o=b(".bb-photos-actions")).length&&o.hide(),1===d.find("li.load-more").length&&location.reload()),b(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+t.current_media.id+'"]').closest(".bb-activity-media-elem").remove();for(var s=t.medias.length,a=0;a<s;a++)if(t.medias[a].activity_id==i.id){t.medias.splice(a,1);break}0==t.current_index&&t.current_index!=t.medias.length?(t.current_index=-1,t.next(e)):0==t.current_index&&t.current_index==t.medias.length?(b(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+t.current_media.activity_id+'"]').remove(),t.closeTheatre(e)):t.current_index==t.medias.length?t.previous(e):(t.current_index=-1,t.next(e))}if(t.is_open_document&&void 0!==i&&"delete_activity"===i.action&&t.current_document.activity_id==i.id){b(document).find('[data-bp-list="document"] .bb-open-document-theatre[data-id="'+t.current_document.id+'"]').closest('div.ac-document-list[data-activity-id="'+t.current_document.activity_id+'"]').remove(),b(document).find('[data-bp-list="activity"] .bb-open-document-theatre[data-id="'+t.current_document.id+'"]').closest(".bb-activity-media-elem").remove();var n=t.documents.length;for(a=0;a<n;a++)if(t.documents[a].activity_id==i.id){t.documents.splice(a,1);break}0==t.current_document_index&&t.current_document_index!=t.documents.length?(t.current_document_index=-1,t.nextDocument(e)):0==t.current_document_index&&t.current_document_index==t.documents.length?(b(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+t.current_document.activity_id+'"]').remove(),t.closeDocumentTheatre(e)):t.current_document_index==t.documents.length?t.previousDocument(e):(t.current_document_index=-1,t.nextDocument(e))}},togglePopupDropdown:function(e){var i;return(e=e||window.event).target?i=e.target:e.srcElement&&(i=e.srcElement),3===i.nodeType&&(i=i.parentNode),!0===e.altKey||!0===e.metaKey||b(i).hasClass("privacy-wrap")||b(i).parent().hasClass("privacy-wrap")?e:(b("ul.media-privacy").removeClass("bb-open"),void b("ul.document-privacy").removeClass("bb-open"))},togglePrivacyDropdown:function(e){var i=b(e.target);e.preventDefault(),i.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var i,t=b(e.target),a=t.data("value");if(e.preventDefault(),t.hasClass("selected"))return!1;t.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),i=t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),t.addClass("selected"),b.ajax({type:"POST",url:m,data:{action:"media_update_privacy",id:this.current_media.id,_wpnonce:v.media,privacy:a},success:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(i),t.closest(".bb-media-privacy-wrap").find(".privacy").addClass(a),t.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",t.text())},error:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})},openMediaActivityDescription:function(e){e.preventDefault();e=b(e.currentTarget);if(e.parents(".activity-media-description").find(".bp-edit-media-activity-description").length<1)return!1;e.parents(".activity-media-description").find(".bp-edit-media-activity-description").show().addClass("open"),e.parents(".activity-media-description").find(".bp-media-activity-description").hide(),e.hide()},closeMediaActivityDescription:function(e){e.preventDefault();var i=b(e.currentTarget);if(i.parents(".activity-media-description").length<1)return!1;e=i.parents(".activity-media-description").find("#add-activity-description").get(0).defaultValue;i.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),i.parents(".activity-media-description").find(".bp-media-activity-description").show(),i.parents(".activity-media-description").find("#add-activity-description").val(e),i.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open")},MediaActivityDescriptionUpdate:function(e){e=b(e.currentTarget);""!==e.val().trim()?e.closest(".bp-edit-media-activity-description").addClass("has-content"):e.closest(".bp-edit-media-activity-description").removeClass("has-content")},submitMediaActivityDescription:function(e){e.preventDefault();var i=b(e.currentTarget),t=i.parents(".activity-media-description"),e={action:"media_description_save",description:t.find("#add-activity-description").val(),attachment_id:t.find("#bp-attachment-id").val(),_wpnonce:v.media};b.ajax({type:"POST",url:m,data:e,async:!1,success:function(e){e.success?(i.parents(".activity-media-description").find(".bp-media-activity-description").html(e.data.description).show(),i.parents(".activity-media-description").find(".bp-add-media-activity-description").show(),t.find("#add-activity-description").val(e.data.description),t.find("#add-activity-description").get(0).defaultValue=e.data.description,""===e.data.description?i.parents(".activity-media-description").find(".bp-add-media-activity-description").removeClass("show-edit").addClass("show-add"):i.parents(".activity-media-description").find(".bp-add-media-activity-description").addClass("show-edit").removeClass("show-add"),i.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open"),i.parents(".activity-media-description").find(".bp-media-activity-description").show(),i.parents(".activity-media-description").find(".bp-feedback.error").remove()):i.parents(".activity-media-description").prepend(e.data.feedback)}})},toggleDocumentPrivacyDropdown:function(e){var i=b(e.target);e.preventDefault(),i.closest(".bb-document-privacy-wrap").find(".document-privacy").toggleClass("bb-open")},documentPrivacyChange:function(e){var i,t=b(e.target),a=t.data("value");if(e.preventDefault(),t.hasClass("selected"))return!1;t.closest(".bb-document-privacy-wrap").find(".privacy").addClass("loading"),i=t.closest(".bb-document-privacy-wrap").find("ul.document-privacy li.selected").data("value"),t.closest(".bb-document-privacy-wrap").find("ul.document-privacy li").removeClass("selected"),t.addClass("selected"),b.ajax({type:"POST",url:m,data:{action:"document_save_privacy",item_id:this.current_document.id,_wpnonce:v.media,value:a,type:"document"},success:function(){t.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading").removeClass(i),t.closest(".bb-document-privacy-wrap").find(".privacy").addClass(a),t.closest(".bb-document-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",t.text())},error:function(){t.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading")}})},resetActivityMedia:function(e){bp.Nouveau.Activity.destroyCommentMediaUploader(e),bp.Nouveau.Activity.destroyCommentDocumentUploader(e),bp.Nouveau.Activity.destroyCommentVideoUploader(e),bp.Nouveau.Activity.resetGifPicker(e)},purgeEditActivityForm:function(e){var i,t,a;e.hasClass("acomment-edit")&&(i=e.attr("data-item-id"),a=(t=b('[data-bp-activity-comment-id="'+i+'"]')).find("#acomment-edit-form-"+i),t.find("#acomment-display-"+i).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),a.empty())}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}((bp,jQuery));