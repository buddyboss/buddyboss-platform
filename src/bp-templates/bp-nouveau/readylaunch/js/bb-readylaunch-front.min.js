window.bp=window.bp||{},function(u){bp.Readylaunch={start:function(){this.deletedNotifications=[],this.markAsReadNotifications=[],this.notificationIconSelector=u(".bb-icons-rl-bell-simple"),this.addListeners(),this.mobileSubMenu(),this.gridListFilter(),this.collapsibleContextNav(),this.bbReloadWindow()},addListeners:function(){u(".bb-nouveau-list").scroll("scroll",this.bbScrollHeaderDropDown.bind(this)),u(document).on("click",".notification-link, .notification-header-tab-action, .bb-rl-load-more a",this.bbHandleLoadMore.bind(this)),u(document).on("heartbeat-send",this.bbHeartbeatSend.bind(this)),u(document).on("heartbeat-tick",this.bbHeartbeatTick.bind(this)),u(document).on("click",".bb-rl-option-wrap__action",this.openMoreOption.bind(this)),u(document).on("click",this.closeMoreOption.bind(this)),u(document).on("click",".header-aside div.menu-item-has-children > a",this.showHeaderNotifications.bind(this)),u(document).on("click",".bb-rl-left-panel-mobile, .bb-rl-close-panel-mobile",this.toggleMobileMenu.bind(this)),u(document).on("click",".action-unread",this.markNotificationRead.bind(this)),u(document).on("click",".action-delete",this.markNotificationDelete.bind(this))},bbScrollHeaderDropDown:function(e){var t=e.target;"notification-list"===t.id&&t.scrollTop+t.offsetHeight>=t.scrollHeight&&!t.classList.contains("loading")&&((e=u(t).find(".bb-rl-load-more")).length&&(t.classList.add("loading"),e.find("a").trigger("click")))},mobileSubMenu:function(){u(".bb-readylaunch-mobile-menu .sub-menu, .bb-readylaunchpanel-menu .sub-menu").each(function(){u(this).closest("li.menu-item-has-children").find("a:first").append('<i class="bb-icons-rl-caret-down submenu-toggle"></i>')}),u(document).on("click",".submenu-toggle",function(e){e.preventDefault(),u(this).closest(".menu-item-has-children").toggleClass("open-parent")})},gridListFilter:function(){u(".bb-rl-filter select").select2({theme:"rl",containerCssClass:"bb-rl-select2-container",dropdownCssClass:"bb-rl-select2-dropdown"})},bbHandleLoadMore:function(e){e.preventDefault();var t,a,i=u(e.target).closest(".notification-link, .notification-header-tab-action, .bb-rl-load-more a");!i.length||(a=i.closest(".notification-wrap")).length&&(a.hasClass("selected")||a.data("loading")||(a.data("loading",!0),t=a.attr("id"),a=a.hasClass("bb-message-dropdown-notification"),i=i.data("page")?i.data("page")+1:1,this.bbPerformAjaxRequest(e,{action:a?"bb_fetch_header_messages":"bb_fetch_header_notifications",page:i,isMessage:a,containerId:t})))},bbPerformAjaxRequest:function(e,t){e.preventDefault();var a=u.extend({action:"",page:1,isMessage:!1,containerId:""},t),i=u("#"+a.containerId);1<a.page?i.find(".bb-rl-load-more").before('<i class="bb-rl-loader"></i>'):i.find(".notification-list").html('<i class="bb-rl-loader"></i>');t={action:a.action,nonce:bbReadyLaunchFront.nonce,page:a.page};u.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:t,success:function(e){var t;i.data("loading",!1),e.success&&e.data&&((t=i.find(".notification-list")).find(".bb-rl-loader").has(".bb-rl-loader")&&t.find(".bb-rl-loader").remove(".bb-rl-loader"),1<a.page?t.find(".bb-rl-load-more").replaceWith(e.data):t.html(e.data))},error:function(){i.data("loading",!1),i.find(".notification-list").html("<p>Failed to load data. Please try again.</p>")}})},bbHeartbeatSend:function(e,t){t.bb_fetch_header_notifications=!0,0<bp.Readylaunch.markAsReadNotifications.length&&(t.mark_as_read_notifications=bp.Readylaunch.markAsReadNotifications.join(",")),0<bp.Readylaunch.deletedNotifications.length&&(t.mark_as_delete_notifications=bp.Readylaunch.deletedNotifications.join(","))},bbHeartbeatTick:function(e,t){this.bbpInjectNotifications(e,t),t.mark_as_read_processed&&(bp.Readylaunch.markAsReadNotifications=[]),t.mark_as_delete_processed&&(bp.Readylaunch.deletedNotifications=[])},bbpInjectNotifications:function(e,t){void 0!==t.unread_notifications&&""!==t.unread_notifications&&u("#header-notifications-dropdown-elem .notification-dropdown .notification-list").empty().html(t.unread_notifications);var a=bp.Readylaunch.notificationIconSelector.parent().children(".count");void 0!==t.total_notifications&&0<t.total_notifications?(u(".notification-header .mark-read-all").show(),0<a.length&&u(a).text(t.total_notifications)):(u(a).remove(),u(".notification-header .mark-read-all").fadeOut())},openMoreOption:function(e){e.preventDefault(),u(e.currentTarget).closest(".bb-rl-option-wrap").toggleClass("active")},closeMoreOption:function(e){u(e.target).closest(".bb-rl-option-wrap").length||u(".bb-rl-option-wrap").removeClass("active"),u(".header-aside div.menu-item-has-children *").is(e.target)||u(".header-aside div.menu-item-has-children").removeClass("selected")},collapsibleContextNav:function(){u(document).on("click",".bb-rl-context-btn",function(e){e.preventDefault();var t=u(this),e=t.siblings(".bb-rl-context-dropdown");u(".bb-rl-context-dropdown").not(e).hide(),u(".bb-rl-context-btn").not(t).removeClass("active"),e.is(":visible")?(e.hide(),t.removeClass("active")):(e.show(),t.addClass("active"))}),u(document).on("click",function(e){u(e.target).closest(".bb-rl-context-wrap").length||(u(".bb-rl-context-dropdown").hide(),u(".bb-rl-context-btn").removeClass("active"))}),u(document).on("click",".bb-rl-context-dropdown",function(e){e.stopPropagation()})},showHeaderNotifications:function(e){e.preventDefault();e=u(e.currentTarget).closest("div.menu-item-has-children");e.siblings(".selected").removeClass("selected"),e.toggleClass("selected"),"header-notifications-dropdown-elem"!==e.attr("id")||e.hasClass("selected")||bp.Readylaunch.beforeUnload()},toggleMobileMenu:function(e){e.preventDefault(),u("body").toggleClass("bb-mobile-menu-open")},markNotificationRead:function(e){e.preventDefault();var t,a=u(e.currentTarget),e=a.data("notification-id"),i=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==e&&(a.closest(".read-item").fadeOut(),i.html(parseInt(i.html())-1),bp.Readylaunch.markAsReadNotifications.push(e)),"all"===e&&((t=a.closest(".notification-wrap")).find(".header-ajax-container .notification-list").addClass("loading"),u.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,id:e},success:function(e){e.success&&e.data&&(t.find(".header-ajax-container .notification-list").removeClass("loading"),e.success&&e.data&&e.data.contents&&t.find(".header-ajax-container .notification-list").html(e.data.contents),void 0!==e.data.total_notifications&&0<e.data.total_notifications&&0<i.length&&u(i).text(e.data.total_notifications))}}))},markNotificationDelete:function(e){e.preventDefault();var t=u(e.currentTarget),a=t.data("notification-id"),e=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==a&&(t.closest(".read-item").fadeOut(),e.html(parseInt(e.html())-1),bp.Readylaunch.deletedNotifications.push(a))},beforeUnload:function(){if(0===bp.Readylaunch.markAsReadNotifications.length&&0===bp.Readylaunch.deletedNotifications.length)return!1;u.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,read_notification_ids:bp.Readylaunch.markAsReadNotifications.join(","),deleted_notification_ids:bp.Readylaunch.deletedNotifications.join(",")},success:function(e){var t;e.success&&(t=bp.Readylaunch.notificationIconSelector.parent().children(".count"),void 0!==e.data.total_notifications&&0<e.data.total_notifications&&0<t.length&&u(t).text(e.data.total_notifications))},error:function(){}}),bp.Readylaunch.markAsReadNotifications=[],bp.Readylaunch.deletedNotifications=[]},Utilities:{createDropzoneOptions:function(e){return _.extend({url:BP_Nouveau.ajaxurl,timeout:108e5,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1},e)},setupDropzoneEventHandlers:function(n,i,e){var t=_.extend({mediaType:"media",otherButtonSelectors:[]},e),o=t.modelKey,a=t.uploaderSelector,d=t.actionName,l=t.nonceName,s=t.mediaType,c=t.otherButtonSelectors,r=t.parentSelector,e=t.parentAttachmentSelector,b=t.ActiveComponent;i.on("addedfile",function(e){e[s+"_edit_data"]&&(n[o].push(e[s+"_edit_data"]),n.model.set(o,n[o])),"video"===s&&(e.dataURL&&e.video_edit_data.thumb.length?(u(e.previewElement).find(".dz-image").prepend('<img src=" '+e.video_edit_data.thumb+' "  alt=""/>'),u(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-image"))}),i.on("uploadprogress",function(e){n.$el.closest(r).addClass("media-uploading");var t=u(e.previewElement).find(".dz-progress-ring circle")[0],a=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=a+" "+a,t.style.strokeDashoffset=a-e.upload.progress.toFixed(0)/100*a,u(e.previewElement).find(".dz-progress [data-dz-progress]").text(e.upload.progress.toFixed(0)+"%")}),i.on("sending",function(e,t,a){a.append("action",d),a.append("_wpnonce",BP_Nouveau.nonces[l]);var i=n.$el.parents(r);c.forEach(function(e){e=i.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").addClass("disable")})}),i.on("success",function(e,t){var a;t.data.id&&("activity"===b&&(bp.privacyEditable||(t.data.group_id=bp.group_id,t.data.privacy=bp.privacy)),e.id=t.data.id,t.data.uuid=e.upload.uuid,t.data.saved=!1,t.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,n[o].push(t.data),n.model.set(o,n[o])),"document"===s&&(a=(a=e.upload.filename).substr(a.lastIndexOf(".")+1),t=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,t=_.isEmpty(t)?"bb-icon-file-"+a:t,u(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").length&&u(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").removeClass("bb-icons-rl-file").addClass(t)),"activity"===b&&(bp.draft_content_changed=!0)}),i.on("error",function(e,t){var a;e.accepted?(a=t&&t.data&&t.data.feedback||BP_Nouveau.media.connection_lost_error,u(e.previewElement).find(".dz-error-message span").text(a)):(Backbone.trigger("onError","<div>"+BP_Nouveau.media.invalid_media_type+". "+(t||"")+"<div>"),i.removeFile(e),n.$el.closest(r).removeClass("media-uploading"))}),i.on("removedfile",function(t){var a;"activity"===b?bp.draft_activity.allow_delete_media&&(n[o]=n[o].filter(function(e){return t.id!==e.id&&(!t[s+"_edit_data"]||t[s+"_edit_data"].id!==e.id)}),n.model.set(o,n[o]),bp.draft_content_changed=!0,0===i.files.length&&(n.$el.closest(r).removeClass("media-uploading"),a=n.$el.parents(r),c.forEach(function(e){e=a.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").removeClass("disable active no-click")}),n.model.unset(o))):0===i.files.length&&(n.$el.closest(r).removeClass("media-uploading"),a=n.$el.parents(r),c.forEach(function(e){e=a.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").removeClass("disable active no-click")}),n.model.unset(o))}),i.on("complete",function(){0===i.getUploadingFiles().length&&0===i.getQueuedFiles().length&&0<i.files.length&&n.$el.closest(r).removeClass("media-uploading")}),n.$el.find(a).addClass("open").removeClass("closed"),u(e).removeClass("empty").closest(r).addClass("focus-in--attm")},createThumbnailFromUrl:function(t,e,a){var a=a&&a.data?a.data("key"):"",i=e||this.dropzone_obj;if((i=a&&i[a]?i[a]:i)&&"function"==typeof i.createThumbnailFromUrl)try{i.createThumbnailFromUrl(t,i.options.thumbnailWidth,i.options.thumbnailHeight,i.options.thumbnailMethod,!0,function(e){i.emit("thumbnail",t,e),i.emit("complete",t)})}catch(e){console.error("Error creating thumbnail:",e)}}},bbReloadWindow:function(){function e(e){void 0!==e&&bp.Readylaunch.beforeUnload()}window.onbeforeunload=e,window.unload=e}},bp.Readylaunch.start()}((bp,jQuery));