window.bp=window.bp||{},(f=>{var e=BP_Nouveau,s=e.is_as3cf_active,c=e.is_om_active,n=e.media,t=e.ajaxurl,m=e.nonces;bp.Readylaunch={start:function(){this.deletedNotifications=[],this.markAsReadNotifications=[],this.notificationIconSelector=f(".bb-icons-rl-bell-simple"),this.addListeners(),this.mobileSubMenu(),this.initSelect2Filters(),this.styledSelect(),this.bbReloadWindow(),this.initBBNavOverflow()},addListeners:function(){var e=f(document);f(".bb-nouveau-list").on("scroll",this.bbScrollHeaderDropDown.bind(this)),e.on("click",".notification-link, .notification-header-tab-action, .bb-rl-header-container .bb-rl-load-more a",this.bbHandleLoadMore.bind(this)),e.on("heartbeat-send",this.bbHeartbeatSend.bind(this)),e.on("heartbeat-tick",this.bbHeartbeatTick.bind(this)),e.on("click",".bb-rl-option-wrap__action",this.openMoreOption.bind(this)),e.on("click",this.closeMoreOption.bind(this)),e.on("click","#bb-rl-profile-theme-light, #bb-rl-profile-theme-dark",this.ToggleDarkMode.bind(this)),e.on("click",".header-aside div.menu-item-has-children > a",this.showHeaderNotifications.bind(this)),e.on("click",".bb-rl-left-panel-mobile, .bb-rl-close-panel-mobile",this.toggleMobileMenu.bind(this)),e.on("click",".bb-rl-left-panel-widget .bb-rl-list > h2",this.toggleLeftPanelWidget.bind(this)),e.on("click",".action-unread",this.markNotificationRead.bind(this)),e.on("click",".action-delete",this.markNotificationDelete.bind(this)),e.on("click",".bb-rl-header-container .header-aside .user-link",this.profileNav.bind(this)),e.on("click",".bb-rl-header-search",this.searchModelToggle.bind(this)),e.on("click",".bb-rl-profile-list-item--after",this.toggleProfileListItem.bind(this))},profileNav:function(e){e.preventDefault(),f(e.currentTarget).closest(".user-wrap").toggleClass("active")},searchModelToggle:function(e){e.preventDefault(),f("#bb-rl-network-search-modal").removeClass("bp-hide")},toggleProfileListItem:function(e){e.preventDefault(),e.stopPropagation();e=f(e.currentTarget).closest(".bb-rl-profile-list-item");f(".bb-rl-profile-list-item").not(e).removeClass("active"),e.toggleClass("active")},bbScrollHeaderDropDown:function(e){var t,e=e.target;"notification-list"===e.id&&e.scrollTop+e.offsetHeight+30>=e.scrollHeight&&!e.classList.contains("loading")&&(t=f(e).find(".bb-rl-load-more")).length&&(e.classList.add("loading"),t.find("a").trigger("click"))},mobileSubMenu:function(){f(".bb-readylaunch-mobile-menu .sub-menu, .bb-readylaunchpanel-menu .sub-menu").each(function(){f(this).closest("li.menu-item-has-children").find("a:first").append('<i class="bb-icons-rl-caret-down submenu-toggle"></i>')}),f(document).on("click",".submenu-toggle",function(e){e.preventDefault(),f(this).closest(".menu-item-has-children").toggleClass("open-parent")})},initSelect2Filters:function(){var e=this,t=3,i=0;function a(){"complete"!==document.readyState||void 0===f.fn.select2||0===f(".bb-rl-filter select").length?i<t&&(i++,setTimeout(a,500)):e.gridListFilter()}f(document).ready(function(){a()})},gridListFilter:function(){f(".bb-rl-filter select").each(function(){var e=f(this),t="";e.data("bb-caret")&&(t+=" bb-rl-caret-icon "),e.data("bb-icon")&&(t=(t+=" bb-rl-has-icon ")+" "+e.data("bb-icon")+" "),"rounded"===e.data("bb-border")&&(t+=" bb-rl-rounded-border "),e.data("dropdown-align")&&(t+=" bb-rl-align-adaptive "),e.select2({theme:"rl",dropdownParent:e.parent()}),e.next(".select2-container").find(".select2-selection").addClass("bb-rl-select2-container"+t),e.on("select2:open",function(){var e=f(this),t="";e.data("dropdown-align")&&(t+=" bb-rl-dropdown-align-adaptive "),f(".select2-dropdown").addClass("bb-rl-select2-dropdown"),e.closest(".bb-rl-filter").find(".bb-rl-select2-dropdown").addClass(t)})})},styledSelect:function(){f(".bb-rl-styled-select select").each(function(){var e=f(this),t="";e.closest(".bb-rl-styled-select").hasClass("bb-rl-styled-select--default")&&(t+=" bb-rl-select-default"),e.select2({theme:"bb-rl-select2",containerCssClass:"bb-rl-select2-container "+t,dropdownCssClass:"bb-rl-select2-dropdown",dropdownParent:e.parent()})})},bbHandleLoadMore:function(e){e.preventDefault();var t,i,a=f(e.target).closest(".notification-link, .notification-header-tab-action, .bb-rl-load-more a");!a.length||!(i=a.closest(".notification-wrap")).length||i.data("loading")||a.hasClass("notification-link")&&i.hasClass("selected")||(i.data("loading",!0),t=i.attr("id"),i=i.hasClass("bb-message-dropdown-notification"),a=a.data("page")?a.data("page")+1:1,this.bbPerformAjaxRequest(e,{action:i?"bb_fetch_header_messages":"bb_fetch_header_notifications",page:a,isMessage:i,containerId:t}))},bbPerformAjaxRequest:function(e,t){e.preventDefault();var i=f.extend({action:"",page:1,isMessage:!1,containerId:""},t),a=f("#"+i.containerId),e=(1<i.page?a.find(".bb-rl-load-more").before('<i class="bb-rl-loader"></i>'):a.find(".notification-list").html('<i class="bb-rl-loader"></i>'),{action:i.action,nonce:bbReadyLaunchFront.nonce,page:i.page});f.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:e,success:function(e){var t;a.data("loading",!1),e.success&&e.data&&((t=a.find(".notification-list")).find(".bb-rl-loader").has(".bb-rl-loader")&&t.find(".bb-rl-loader").remove(".bb-rl-loader"),1<i.page?t.find(".bb-rl-load-more").replaceWith(e.data):t.html(e.data))},error:function(){a.data("loading",!1),a.find(".notification-list").html("<p>Failed to load data. Please try again.</p>")},complete:function(){a.data("loading",!1),a.find(".notification-list").removeClass("loading")}})},bbHeartbeatSend:function(e,t){t.bb_fetch_header_notifications=!0,0<bp.Readylaunch.markAsReadNotifications.length&&(t.mark_as_read_notifications=bp.Readylaunch.markAsReadNotifications.join(",")),0<bp.Readylaunch.deletedNotifications.length&&(t.mark_as_delete_notifications=bp.Readylaunch.deletedNotifications.join(","))},bbHeartbeatTick:function(e,t){this.bbpInjectNotifications(e,t),t.mark_as_read_processed&&(bp.Readylaunch.markAsReadNotifications=[]),t.mark_as_delete_processed&&(bp.Readylaunch.deletedNotifications=[])},bbpInjectNotifications:function(e,t){void 0!==t.unread_notifications&&""!==t.unread_notifications&&f("#header-notifications-dropdown-elem .notification-dropdown .notification-list").empty().html(t.unread_notifications);var i=bp.Readylaunch.notificationIconSelector.parent().children(".count");void 0!==t.total_notifications&&0<t.total_notifications?(f(".notification-header .mark-read-all").show(),0<i.length&&f(i).text(t.total_notifications)):(f(i).remove(),f(".notification-header .mark-read-all").fadeOut())},openMoreOption:function(e){e.preventDefault(),f(".bb-rl-option-wrap").not(f(e.currentTarget).closest(".bb-rl-option-wrap")).removeClass("active"),f(e.currentTarget).closest(".bb-rl-option-wrap").toggleClass("active")},closeMoreOption:function(e){f(e.target).closest(".bb-rl-option-wrap").length||f(".bb-rl-option-wrap").removeClass("active"),f(".header-aside div.menu-item-has-children *").is(e.target)||f(".header-aside div.menu-item-has-children").removeClass("selected"),f(e.target).closest(".user-wrap").length||f(e.target).closest(".bb-rl-profile-dropdown").length||f(".user-wrap").removeClass("active"),f("#bb-rl-network-search-modal .bp-search-form-wrapper *, .bb-rl-header-search, .bb-rl-header-search *, .select2-container, .select2-container *, #bb-rl-network-search-modal .bp-search-form-wrapper, #bb-rl-network-search-modal .bp-search-form-wrapper *, .bb-rl-network-search-clear").is(e.target)||f("#bb-rl-network-search-modal").addClass("bp-hide")},ToggleDarkMode:function(e){e.preventDefault();e=f("body");e.toggleClass("bb-rl-dark-mode"),e.hasClass("bb-rl-dark-mode")?f.cookie("bb-rl-dark-mode","true",{expires:365,path:"/"}):f.cookie("bb-rl-dark-mode","false",{expires:365,path:"/"})},showHeaderNotifications:function(e){e.preventDefault();e=f(e.currentTarget).closest("div.menu-item-has-children");e.siblings(".selected").removeClass("selected"),e.toggleClass("selected"),"header-notifications-dropdown-elem"===e.attr("id")&&!e.hasClass("selected")&&(0<bp.Readylaunch.markAsReadNotifications.length||0<bp.Readylaunch.deletedNotifications.length)&&bp.Readylaunch.beforeUnload()},toggleMobileMenu:function(e){e.preventDefault(),f("body").toggleClass("bb-mobile-menu-open")},toggleLeftPanelWidget:function(e){e.preventDefault(),f(window).width()<993&&f(e.currentTarget).closest(".bb-rl-left-panel-widget").toggleClass("is-open")},markNotificationRead:function(e){e.preventDefault();var t,e=f(e.currentTarget),i=e.data("notification-id"),a=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==i&&(e.closest(".read-item").fadeOut(),a.html(parseInt(a.html())-1),bp.Readylaunch.markAsReadNotifications.push(i)),"all"===i&&((t=e.closest(".notification-wrap")).find(".header-ajax-container .notification-list").addClass("loading"),f.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,read_notification_ids:i},success:function(e){e.success&&e.data&&(t.find(".header-ajax-container .notification-list").removeClass("loading"),e.success&&e.data&&e.data.contents&&t.find(".header-ajax-container .notification-list").html(e.data.contents),void 0!==e.data.total_notifications)&&0<a.length&&(0<e.data.total_notifications?f(a).text(e.data.total_notifications):f(a).remove())}}))},markNotificationDelete:function(e){e.preventDefault();var e=f(e.currentTarget),t=e.data("notification-id"),i=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==t&&(e.closest(".read-item").fadeOut(),i.html(parseInt(i.html())-1),bp.Readylaunch.deletedNotifications.push(t))},beforeUnload:function(){if(0===bp.Readylaunch.markAsReadNotifications.length&&0===bp.Readylaunch.deletedNotifications.length)return!1;f.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,read_notification_ids:bp.Readylaunch.markAsReadNotifications.join(","),deleted_notification_ids:bp.Readylaunch.deletedNotifications.join(",")},success:function(e){var t;e.success&&(t=bp.Readylaunch.notificationIconSelector.parent().children(".count"),void 0!==e.data.total_notifications)&&0<e.data.total_notifications&&0<t.length&&f(t).text(e.data.total_notifications)},error:function(){}}),bp.Readylaunch.markAsReadNotifications=[],bp.Readylaunch.deletedNotifications=[]},Utilities:{createDropzoneOptions:function(e){return _.extend({url:t,timeout:108e5,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1},e)},setupDropzoneEventHandlers:function(o,d,a){var e=_.extend({mediaType:"media",otherButtonSelectors:[]},a),l=e.modelKey,t=e.uploaderSelector,r=e.actionName,s=e.nonceName,c=e.mediaType,b=e.otherButtonSelectors,u=e.parentSelector,i=e.parentAttachmentSelector,h=e.ActiveComponent;d.on("addedfile",function(e){e[c+"_edit_data"]&&(o[l].push(e[c+"_edit_data"]),o.model.set(l,o[l])),"video"===c&&(e.dataURL&&e.video_edit_data.thumb.length?(f(e.previewElement).find(".dz-image").prepend('<img src=" '+e.video_edit_data.thumb+' "  alt=""/>'),f(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-image"))}),d.on("uploadprogress",function(e){o.$el.closest(u).addClass("media-uploading");var t=f(e.previewElement).find(".dz-progress-ring circle")[0],i=2*t.r.baseVal.value*Math.PI;t.style.strokeDasharray=i+" "+i,t.style.strokeDashoffset=i-e.upload.progress.toFixed(0)/100*i,f(e.previewElement).find(".dz-progress [data-dz-progress]").text(e.upload.progress.toFixed(0)+"%")}),d.on("sending",function(e,t,i){i.append("action",r),i.append("_wpnonce",m[s]);var a=0,a=(f("#bbp_forum_id").length&&(a=f("#bbp_forum_id").val()),i.append("bbp_forum_id",a),0),n=(f("#bbp_topic_id").length&&(a=f("#bbp_topic_id").val()),i.append("bbp_topic_id",a),o.$el.parents(u));b.forEach(function(e){e=n.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").addClass("disable")})}),d.on("success",function(e,t){var i,a,n;(t="video"===c&&!0===e.upload.chunked?JSON.parse(e.xhr.response):t).data&&t.data.id&&("activity"!==h||bp.privacyEditable||(t.data.group_id=bp.group_id,t.data.privacy=bp.privacy),e.id=t.data.id,t.data.uuid=e.upload.uuid,t.data.saved=!1,t.data.menu_order=f(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,"video"===c&&(i=setInterval(function(){(f(e.previewElement).closest(".dz-preview").hasClass("dz-has-no-thumbnail")||f(e.previewElement).closest(".dz-preview").hasClass("dz-has-thumbnail"))&&(t.data.js_preview=f(e.previewElement).find(".dz-image img").attr("src"),clearInterval(i))})),o[l].push(t.data),o.model.set(l,o[l])),"document"===c&&(n=(n=e.upload.filename).substr(n.lastIndexOf(".")+1),a=_.isUndefined(t.data.svg_icon)?"":t.data.svg_icon,n=_.isEmpty(a)?"bb-icon-file-"+n:a,f(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").length)&&f(e.previewElement).find(".dz-details .dz-icon .bb-icons-rl-file").removeClass("bb-icons-rl-file").addClass(n),"activity"===h&&(bp.draft_content_changed=!0)}),d.on("error",function(e,t){var i;e.accepted?(i=t&&t.data&&t.data.feedback||n.connection_lost_error,f(e.previewElement).find(".dz-error-message span").text(i)):(i=n.invalid_media_type+". "+(t||""),a.errorMessage&&(i=a.errorMessage),Backbone.trigger("onError","<div>"+i+"<div>"),d.removeFile(e),o.$el.closest(u).removeClass("media-uploading"))}),d.on("removedfile",function(t){function e(){0===d.files.length&&(o.$el.closest(u).removeClass("media-uploading"),i=o.$el.parents(u),b.forEach(function(e){e=i.find(e);e.length&&e.parents(".bb-rl-post-elements-buttons-item").removeClass("disable active no-click")}),o.model.unset(l))}var i,a;if("activity"===h){if(bp.draft_activity.allow_delete_media){if(o[l]&&o[l].length)for(var n in o[l])t.id===o[l][n].id?_.isUndefined(o[l][n].saved)||o[l][n].saved||bp.Nouveau.Media.removeAttachment(t.id):!t[c+"_edit_data"]||(a=t[c+"_edit_data"].id)!==o[l][n].id||_.isUndefined(o[l][n].saved)||o[l][n].saved||bp.Nouveau.Media.removeAttachment(a);o[l]=o[l].filter(function(e){return t.id!==e.id&&(!t[c+"_edit_data"]||t[c+"_edit_data"].id!==e.id)}),o.model.set(l,o[l]),bp.draft_content_changed=!0,e()}}else e()}),d.on("complete",function(){0===d.getUploadingFiles().length&&0===d.getQueuedFiles().length&&0<d.files.length&&o.$el.closest(u).removeClass("media-uploading")}),o.$el.find(t).addClass("open").removeClass("closed"),f(i).removeClass("empty").closest(u).addClass("focus-in--attm")},injectFiles:function(e){var t=e.commonData,n=e.id,o=e.fileType,d=e.dropzoneObj,l=e.draftData||!1,r=e.dropzoneData||null;t.forEach(function(e,t){0<parseInt(n,10)?(i={id:e.attachment_id||e.doc_id||e.vid_id,name:e.name||e.full_name,saved:!0,group_id:e.group_id||0,menu_order:e.menu_order||0,uuid:e.attachment_id||e.doc_id||e.vid_id,url:e.url,type:o},"media"===o?(i.media_id=e.id,i.thumb=e.thumb||"",i.album_id=e.album_id||0):"document"===o?(i.document_id=e.id,i.size=e.size||0,i.full_name=e.full_name||e.name,i.folder_id=e.folder_id||0,i.svg_icon=e.svg_icon||""):"video"===o&&(i.video_id=e.id,i.thumb=e.thumb||"",i.size=e.size||0,i.album_id=e.album_id||0)):(i={id:e.id||e.doc_id||e.vid_id,name:e.name||e.full_name,saved:!1,group_id:e.group_id||0,menu_order:e.menu_order||0,uuid:e.id||e.doc_id||e.vid_id,url:e.url,type:o},"media"===o?(i.thumb=e.thumb||"",i.album_id=e.album_id||0):"document"===o?(i.size=e.size||0,i.full_name=e.full_name||e.name,i.folder_id=e.folder_id||0,i.svg_icon=e.svg_icon||""):"video"===o&&(i.thumb=e.thumb||"",i.album_id=e.album_id||0,i.size=e.size||0)),_.isNull(r)||r.push(i);var i,a={name:e.name||e.full_name||e.title,size:e.size||0,accepted:!0,kind:"media"===o?"image":"file",upload:{filename:e.name||e.full_name||e.title,uuid:e.attachment_id||e.doc_id||e.vid_id},dataURL:e.url,id:e.attachment_id||e.doc_id||e.vid_id};"media"===o?a.media_edit_data=i:"document"===o?(a.document_edit_data=i,a.svg_icon=_.isUndefined(e.svg_icon)?"":e.svg_icon):"video"===o&&(a.video_edit_data=i,a.dataThumb=_.isUndefined(e.thumb)?"":e.thumb),d&&(d.files.push(a),d.emit("addedfile",a),"media"===o&&(void 0!==s&&"1"===s||void 0!==c&&"1"===c?(f(d.files[t].previewElement).find("img").attr("src",e.thumb),d.emit("thumbnail",e.thumb)):bp.Readylaunch.Utilities.createThumbnailFromUrl(a,d)),d.emit("complete",a),"media"===o)&&!0===l&&(d.emit("dz-success"),d.emit("dz-complete"))})},createThumbnailFromUrl:function(t,e,i){var i=i&&i.data?i.data("key"):"",a=e||this.dropzone_obj;if((a=i&&a[i]?a[i]:a)&&"function"==typeof a.createThumbnailFromUrl)try{a.createThumbnailFromUrl(t,a.options.thumbnailWidth,a.options.thumbnailHeight,a.options.thumbnailMethod,!0,function(e){a.emit("thumbnail",t,e),a.emit("complete",t)})}catch(e){console.error("Error creating thumbnail:",e)}}},bbReloadWindow:function(){function e(e){void 0!==e&&bp.Readylaunch.beforeUnload()}window.onbeforeunload=e,window.unload=e},initBBNavOverflow:function(){var i=this;function e(e,t){f(e).each(function(){i.bbNavOverflow(this,t)}),window.addEventListener("resize",function(){f(e).each(function(){i.bbNavOverflow(this,t)})}),window.addEventListener("load",function(){f(e).each(function(){i.bbNavOverflow(this,t)})})}e("#object-nav > ul",100),e(".bb-rl-header .bb-readylaunch-menu",200),f(document).on("click",".bb-rl-nav-more",function(e){e.preventDefault(),f(this).toggleClass("active open").next().toggleClass("active open")}),f(document).on("click",".bb-rl-hideshow .bb-rl-sub-menu a",function(){f("body").trigger("click");var e=f(this).parent();e.parent(".bb-rl-sub-menu").find("li").removeClass("current selected"),e.addClass("current selected")}),f(document).click(function(e){var t=f(".bb-rl-nav-more, .bb-rl-sub-menu");t.is(e.target)||0!==t.has(e.target).length||f(".bb-rl-nav-more").removeClass("active open").next().removeClass("active open")})},bbNavOverflow:function(e,t){var i,a,n,o=f(e);o.append(f(o.children("li.bb-rl-hideshow").children("ul")).html()),o.children("li.bb-rl-hideshow").remove(),o=f(o=e),i=0,a="",n=o.width()-t,f.each(o.children("li"),function(){i+=f(this).outerWidth(!0),n<i&&(a+=f("<div>").append(f(this).clone()).html(),f(this).remove())}),o.append('<li class="bb-rl-hideshow menu-item-has-children1" data-no-dynamic-translation><a class="bb-rl-nav-more" href="#">'+bbReadyLaunchFront.more_nav+'<i class="bb-icons-rl-caret-down"></i></a><ul class="bb-rl-sub-menu" data-no-dynamic-translation>'+a+"</ul></li>"),0<o.find("li.bb-rl-hideshow").find("li").length?o.find("li.bb-rl-hideshow").show():o.find("li.bb-rl-hideshow").hide()}},bp.Readylaunch.start()})((bp,jQuery));