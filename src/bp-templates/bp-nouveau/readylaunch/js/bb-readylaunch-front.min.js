window.bp=window.bp||{},function(n){bp.Readylaunch={start:function(){this.deletedNotifications=[],this.markAsReadNotifications=[],this.notificationIconSelector=n(".bb-icons-rl-bell-simple"),this.addListeners(),this.mobileSubMenu(),this.bbReloadWindow()},addListeners:function(){n(".bb-nouveau-list").scroll("scroll",this.bbScrollHeaderDropDown.bind(this)),n(document).on("click",".notification-link, .notification-header-tab-action, .bb-rl-load-more a",this.bbHandleLoadMore.bind(this)),n(document).on("heartbeat-send",this.bbHeartbeatSend.bind(this)),n(document).on("heartbeat-tick",this.bbHeartbeatTick.bind(this)),n(document).on("click",".bb-rl-option-wrap__action",this.openMoreOption.bind(this)),n(document).on("click",this.closeMoreOption.bind(this)),n(document).on("click",".header-aside div.menu-item-has-children > a",this.showHeaderNotifications.bind(this)),n(document).on("click",".bb-rl-left-panel-mobile, .bb-rl-close-panel-mobile",this.toggleMobileMenu.bind(this)),n(document).on("click",".action-unread",this.markNotificationRead.bind(this)),n(document).on("click",".action-delete",this.markNotificationDelete.bind(this))},bbScrollHeaderDropDown:function(t){var a,t=t.target;"notification-list"===t.id&&t.scrollTop+t.offsetHeight>=t.scrollHeight&&!t.classList.contains("loading")&&(a=n(t).find(".bb-rl-load-more")).length&&(t.classList.add("loading"),a.find("a").trigger("click"))},mobileSubMenu:function(){n(".bb-readylaunch-mobile-menu .sub-menu, .bb-readylaunchpanel-menu .sub-menu").each(function(){n(this).closest("li.menu-item-has-children").find("a:first").append('<i class="bb-icons-rl-caret-down submenu-toggle"></i>')}),n(document).on("click",".submenu-toggle",function(t){t.preventDefault(),n(this).closest(".menu-item-has-children").toggleClass("open-parent")})},bbHandleLoadMore:function(t){t.preventDefault();var a,e,i=n(t.target).closest(".notification-link, .notification-header-tab-action, .bb-rl-load-more a");!i.length||!(e=i.closest(".notification-wrap")).length||e.hasClass("selected")||e.data("loading")||(e.data("loading",!0),a=e.attr("id"),e=e.hasClass("bb-message-dropdown-notification"),i=i.data("page")?i.data("page")+1:1,this.bbPerformAjaxRequest(t,{action:e?"bb_fetch_header_messages":"bb_fetch_header_notifications",page:i,isMessage:e,containerId:a}))},bbPerformAjaxRequest:function(t,a){t.preventDefault();var e=n.extend({action:"",page:1,isMessage:!1,containerId:""},a),i=n("#"+e.containerId),t=(1<e.page?i.find(".bb-rl-load-more").before('<i class="bb-rl-loader"></i>'):i.find(".notification-list").html('<i class="bb-rl-loader"></i>'),{action:e.action,nonce:bbReadyLaunchFront.nonce,page:e.page});n.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:t,success:function(t){var a;i.data("loading",!1),t.success&&t.data&&((a=i.find(".notification-list")).find(".bb-rl-loader").has(".bb-rl-loader")&&a.find(".bb-rl-loader").remove(".bb-rl-loader"),1<e.page?a.find(".bb-rl-load-more").replaceWith(t.data):a.html(t.data))},error:function(){i.data("loading",!1),i.find(".notification-list").html("<p>Failed to load data. Please try again.</p>")}})},bbHeartbeatSend:function(t,a){a.bb_fetch_header_notifications=!0,0<bp.Readylaunch.markAsReadNotifications.length&&(a.mark_as_read_notifications=bp.Readylaunch.markAsReadNotifications.join(",")),0<bp.Readylaunch.deletedNotifications.length&&(a.mark_as_delete_notifications=bp.Readylaunch.deletedNotifications.join(","))},bbHeartbeatTick:function(t,a){this.bbpInjectNotifications(t,a),a.mark_as_read_processed&&(bp.Readylaunch.markAsReadNotifications=[]),a.mark_as_delete_processed&&(bp.Readylaunch.deletedNotifications=[])},bbpInjectNotifications:function(t,a){void 0!==a.unread_notifications&&""!==a.unread_notifications&&n("#header-notifications-dropdown-elem .notification-dropdown .notification-list").empty().html(a.unread_notifications);var e=bp.Readylaunch.notificationIconSelector.parent().children(".count");void 0!==a.total_notifications&&0<a.total_notifications?(n(".notification-header .mark-read-all").show(),0<e.length&&n(e).text(a.total_notifications)):(n(e).remove(),n(".notification-header .mark-read-all").fadeOut())},openMoreOption:function(t){t.preventDefault(),n(t.currentTarget).closest(".bb-rl-option-wrap").toggleClass("active")},closeMoreOption:function(t){n(t.target).closest(".bb-rl-option-wrap").length||n(".bb-rl-option-wrap").removeClass("active"),n(".header-aside div.menu-item-has-children *").is(t.target)||n(".header-aside div.menu-item-has-children").removeClass("selected")},showHeaderNotifications:function(t){t.preventDefault();t=n(t.currentTarget).closest("div.menu-item-has-children");t.siblings(".selected").removeClass("selected"),t.toggleClass("selected"),"header-notifications-dropdown-elem"!==t.attr("id")||t.hasClass("selected")||bp.Readylaunch.beforeUnload()},toggleMobileMenu:function(t){t.preventDefault(),n("body").toggleClass("bb-mobile-menu-open")},markNotificationRead:function(t){t.preventDefault();var a,t=n(t.currentTarget),e=t.data("notification-id"),i=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==e&&(t.closest(".read-item").fadeOut(),i.html(parseInt(i.html())-1),bp.Readylaunch.markAsReadNotifications.push(e)),"all"===e&&((a=t.closest(".notification-wrap")).find(".header-ajax-container .notification-list").addClass("loading"),n.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,id:e},success:function(t){t.success&&t.data&&(a.find(".header-ajax-container .notification-list").removeClass("loading"),t.success&&t.data&&t.data.contents&&a.find(".header-ajax-container .notification-list").html(t.data.contents),void 0!==t.data.total_notifications)&&0<t.data.total_notifications&&0<i.length&&n(i).text(t.data.total_notifications)}}))},markNotificationDelete:function(t){t.preventDefault();var t=n(t.currentTarget),a=t.data("notification-id"),e=bp.Readylaunch.notificationIconSelector.parent().children(".count");"all"!==a&&(t.closest(".read-item").fadeOut(),e.html(parseInt(e.html())-1),bp.Readylaunch.deletedNotifications.push(a))},beforeUnload:function(){if(0===bp.Readylaunch.markAsReadNotifications.length&&0===bp.Readylaunch.deletedNotifications.length)return!1;n.ajax({type:"POST",url:bbReadyLaunchFront.ajax_url,data:{action:"bb_mark_notification_read",nonce:bbReadyLaunchFront.nonce,read_notification_ids:bp.Readylaunch.markAsReadNotifications.join(","),deleted_notification_ids:bp.Readylaunch.deletedNotifications.join(",")},success:function(t){var a;t.success&&(a=bp.Readylaunch.notificationIconSelector.parent().children(".count"),void 0!==t.data.total_notifications)&&0<t.data.total_notifications&&0<a.length&&n(a).text(t.data.total_notifications)},error:function(){}}),bp.Readylaunch.markAsReadNotifications=[],bp.Readylaunch.deletedNotifications=[]},bbReloadWindow:function(){function t(t){void 0!==t&&bp.Readylaunch.beforeUnload()}window.onbeforeunload=t,window.unload=t}},bp.Readylaunch.start()}((bp,jQuery));