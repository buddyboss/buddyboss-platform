window.bp=window.bp||{},function(n){bp.Readylaunch={start:function(){this.addListeners()},addListeners:function(){n(".bb-nouveau-list").scroll("scroll",this.bbScrollHeaderDropDown.bind(this)),n(document).on("click",".notification-link, .load-more a",this.bbHandleLoadMore.bind(this)),n(document).on("heartbeat-send",this.bbHeartbeatSend.bind(this)),n(document).on("heartbeat-tick",this.bbHeartbeatTick.bind(this)),n(document).on("click",".bbrl-option-wrap__action",this.openMoreOption.bind(this)),n(document).on("click",this.closeMoreOption.bind(this)),n(document).on("click",".header-aside div.menu-item-has-children > a",this.showHeaderNotifications.bind(this))},bbScrollHeaderDropDown:function(t){var e=t.target;"notification-list"===e.id&&e.scrollTop+e.offsetHeight>=e.scrollHeight&&!e.classList.contains("loading")&&((t=n(e).find(".load-more")).length&&(e.classList.add("loading"),t.find("a").trigger("click")))},bbHandleLoadMore:function(t){t.preventDefault();var e,i,a=n(t.target).closest(".notification-link, .load-more a");!a.length||(i=a.closest(".notification-wrap")).length&&(i.data("loading")||(i.data("loading",!0),e=i.attr("id"),i=i.hasClass("bb-message-dropdown-notification"),a=a.data("page")?a.data("page")+1:1,this.bbPerformAjaxRequest(t,{action:i?"bb_fetch_header_messages":"bb_fetch_header_notifications",page:a,isMessage:i,containerId:e})))},bbPerformAjaxRequest:function(t,e){t.preventDefault();var i=n.extend({action:"",page:1,isMessage:!1,containerId:""},e),a=n("#"+i.containerId);1<i.page?a.find(".load-more").before('<i class="bbrl-loader"></i>'):a.find(".notification-list").html('<i class="bbrl-loader"></i>');e={action:i.action,nonce:bbReadyLaunchFront.nonce,page:i.page};n.ajax({type:"GET",url:bbReadyLaunchFront.ajax_url,data:e,success:function(t){var e;a.data("loading",!1),t.success&&t.data&&((e=a.find(".notification-list")).find(".bbrl-loader").has(".bbrl-loader")&&e.find(".bbrl-loader").remove(".bbrl-loader"),1<i.page?e.find(".load-more").replaceWith(t.data):e.html(t.data))},error:function(){a.data("loading",!1),a.find(".notification-list").html("<p>Failed to load data. Please try again.</p>")}})},bbHeartbeatSend:function(t,e){e.bb_fetch_header_notifications=!0},bbHeartbeatTick:function(t,e){this.bpInjectNotifications(t,e)},bpInjectNotifications:function(t,e){void 0!==e.unread_notifications&&""!==e.unread_notifications&&n("#header-notifications-dropdown-elem .notification-dropdown .notification-list").empty().html(e.unread_notifications);var i=n(".bb-icon-bell"),a=n(i).parent().children(".count");void 0!==e.total_notifications&&0<e.total_notifications?(n(".notification-header .mark-read-all").show(),0<a.length?n(a).text(e.total_notifications):n(i).parent(":not(.group-subscription)").append('<span class="count"> '+e.total_notifications+" </span>")):(n(a).remove(),n(".notification-header .mark-read-all").fadeOut())},openMoreOption:function(t){t.preventDefault(),n(t.currentTarget).closest(".bbrl-option-wrap").toggleClass("active")},closeMoreOption:function(t){n(t.target).closest(".bbrl-option-wrap").length||n(".bbrl-option-wrap").removeClass("active"),n(".header-aside div.menu-item-has-children *").is(t.target)||n(".header-aside div.menu-item-has-children").removeClass("selected")},showHeaderNotifications:function(t){t.preventDefault();t=n(t.currentTarget).closest("div.menu-item-has-children");t.siblings(".selected").removeClass("selected"),t.toggleClass("selected")}},bp.Readylaunch.start()}((bp,jQuery));