window.bp=window.bp||{},function(o){bp.Readylaunch={start:function(){this.addListeners()},addListeners:function(){o(".bb-nouveau-list").scroll("scroll",this.bbScrollHeaderDropDown.bind(this)),o(document).on("click",".notification-link, .load-more a",this.bbHandleLoadMore.bind(this)),o(document).on("heartbeat-send",this.bbHeartbeatSend.bind(this)),o(document).on("heartbeat-tick",this.bbHeartbeatTick.bind(this))},bbScrollHeaderDropDown:function(t){var a,t=t.target;"notification-list"===t.id&&t.scrollTop+t.offsetHeight>=t.scrollHeight&&!t.classList.contains("loading")&&(a=o(t).find(".load-more")).length&&(t.classList.add("loading"),a.find("a").trigger("click"))},bbHandleLoadMore:function(t){t.preventDefault();var a,i,n=o(t.target).closest(".notification-link, .load-more a");n.length&&(i=n.closest(".notification-wrap")).length&&!i.data("loading")&&(i.data("loading",!0),a=i.attr("id"),i=i.hasClass("bb-message-dropdown-notification"),n=n.data("page")?n.data("page")+1:1,this.bbPerformAjaxRequest(t,{action:i?"bb_fetch_header_messages":"bb_fetch_header_notifications",page:n,isMessage:i,containerId:a}))},bbPerformAjaxRequest:function(t,a){t.preventDefault();var i=o.extend({action:"",page:1,isMessage:!1,containerId:""},a),n=o("#"+i.containerId),t=(1<i.page?n.find(".load-more").before('<i class="bbrl-loader"></i>'):n.find(".notification-list").html('<i class="bbrl-loader"></i>'),{action:i.action,nonce:bbReadyLaunchFront.nonce,page:i.page});o.ajax({type:"GET",url:bbReadyLaunchFront.ajax_url,data:t,success:function(t){var a;n.data("loading",!1),t.success&&t.data&&((a=n.find(".notification-list")).find(".bbrl-loader").has(".bbrl-loader")&&a.find(".bbrl-loader").remove(".bbrl-loader"),1<i.page?a.find(".load-more").replaceWith(t.data):a.html(t.data))},error:function(){n.data("loading",!1),n.find(".notification-list").html("<p>Failed to load data. Please try again.</p>")}})},bbHeartbeatSend:function(t,a){a.bb_fetch_header_notifications=!0},bbHeartbeatTick:function(t,a){this.bpInjectNotifications(t,a)},bpInjectNotifications:function(t,a){void 0!==a.unread_notifications&&""!==a.unread_notifications&&o("#header-notifications-dropdown-elem .notification-dropdown .notification-list").empty().html(a.unread_notifications);var i=o(".bb-icon-bell"),n=o(i).parent().children(".count");void 0!==a.total_notifications&&0<a.total_notifications?(o(".notification-header .mark-read-all").show(),0<n.length?o(n).text(a.total_notifications):o(i).parent(":not(.group-subscription)").append('<span class="count"> '+a.total_notifications+" </span>")):(o(n).remove(),o(".notification-header .mark-read-all").fadeOut())}},bp.Readylaunch.start()}((bp,jQuery));